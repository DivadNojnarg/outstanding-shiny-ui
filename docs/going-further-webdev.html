<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 28 Divide and Conquere | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<meta name="description" content="28.1 Motivations Adapting an external HTML template to R requires time, efforts and competent people. As an example, it took me about two years to get {shinyMobile} on the road, definitely not a...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 28 Divide and Conquere | Outstanding User Interfaces with Shiny">
<meta property="og:type" content="book">
<meta property="og:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<meta property="og:description" content="28.1 Motivations Adapting an external HTML template to R requires time, efforts and competent people. As an example, it took me about two years to get {shinyMobile} on the road, definitely not a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 28 Divide and Conquere | Outstanding User Interfaces with Shiny">
<meta name="twitter:description" content="28.1 Motivations Adapting an external HTML template to R requires time, efforts and competent people. As an example, it took me about two years to get {shinyMobile} on the road, definitely not a...">
<meta name="twitter:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">2</span> Manipulate HTML tags from R with {htmltools}</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">3</span> Discover Shiny dependencies</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Handle HTML dependencies with {htmltools}</a></li>
<li><a class="" href="web-applications.html"><span class="header-section-number">5</span> Web application concepts</a></li>
<li class="book-part">Beautify with CSS and Sass</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">6</span> CSS for Shiny</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">7</span> Tidy your CSS with Sass</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">8</span> Beautify with {fresh}</a></li>
<li><a class="" href="beautify-with-bootstraplib.html"><span class="header-section-number">9</span> Become a theming wizard with {bslib}</a></li>
<li class="book-part">Unleash interactivity with JavaScript</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> Communicate between R and JS</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">12</span> Understand and develop new Shiny inputs</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Mastering Shinyâ€™s events</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Optimize your apps with custom handlers</a></li>
<li class="book-part">Practice: A Bootstrap 4 dashboard template</li>
<li><a class="" href="custom-templates-dependencies.html"><span class="header-section-number">16</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">17</span> Create template elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">18</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">19</span> Adding more interactivity</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">20</span> Testing and validating templates elements</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="" href="workflow-charpente.html"><span class="header-section-number">21</span> Automate new template creation with {charpente}</a></li>
<li class="book-part">Case study: Mobile development for Shiny</li>
<li><a class="" href="mobile-shiny-intro.html"><span class="header-section-number">22</span> Introduction</a></li>
<li><a class="" href="mobile-shinyMobile.html"><span class="header-section-number">23</span> Reconstruct {shinyMobile}</a></li>
<li><a class="" href="mobile-pwa.html"><span class="header-section-number">24</span> {shinyMobile} and PWA</a></li>
<li><a class="" href="mobile-widgets.html"><span class="header-section-number">25</span> Design widgets</a></li>
<li><a class="" href="mobile-going-further.html"><span class="header-section-number">26</span> Fine tune {shinyMobile}</a></li>
<li class="book-part">Going further</li>
<li><a class="" href="going-further-reactR.html"><span class="header-section-number">27</span> Shiny and React with {reactR}</a></li>
<li><a class="active" href="going-further-webdev.html"><span class="header-section-number">28</span> Divide and Conquere</a></li>
<li><a class="" href="going-further-where-to-go.html"><span class="header-section-number">29</span> What to do next?</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="code-outputs.html"><span class="header-section-number">A</span> Code outputs</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="going-further-webdev" class="section level1" number="28">
<h1>
<span class="header-section-number">28</span> Divide and Conquere<a class="anchor" aria-label="anchor" href="#going-further-webdev"><i class="fas fa-link"></i></a>
</h1>
<div id="motivations-3" class="section level2" number="28.1">
<h2>
<span class="header-section-number">28.1</span> Motivations<a class="anchor" aria-label="anchor" href="#motivations-3"><i class="fas fa-link"></i></a>
</h2>
<p>Adapting an external HTML template to R requires time, efforts and competent people. As an example, it took me about two years to get <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> on the road, definitely not a compatible timeline for more urgent projects which have to be released under weeks.</p>
<p>What if, instead, we decided to handle the UI part with usual web languages like HTML, JS and CSS, thereby avoiding the time consuming HTML to R conversion and input binding creation?</p>
<p>Theoretically, any front-end web developer could take care of creating the user interface. There already exists HTML templates for <a href="https://shiny.rstudio.com/articles/templates.html">Shiny</a>, allowing one to leverage any existing HTML skeleton. The result may be literally stunning, as shown during the latest Shiny <a href="https://nz-stefan.shinyapps.io/commute-explorer-2/?_ga=2.70875408.1031573581.1632613467-748932920.1610966288">contest</a> and illustrated on Figure <a href="going-further-webdev.html#fig:htmlTemplate-app">28.1</a>. However, from a modern web development point of view, there are nowadays much more suited tools to build and maintain application like React and webpack from the previous chapter.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:htmlTemplate-app"></span>
<img src="images/going-further/htmlTemplate-app.png" alt="Commute explorer app, Shiny Contest winner 2021." width="100%"><p class="caption">
FIGURE 28.1: Commute explorer app, Shiny Contest winner 2021.
</p>
</div>
<p></p>
<p>Eventually, the above approach would permit the R developers, that are most of the time not a UI design experts, to focus on the <strong>business logic</strong> and improve the code base quality. On the other hands, the web developers could focus on building the user interface with their favorite web tools and prepare the link with the R part, without necessarily have a deep knowledge of R.</p>
<p>This chapter may be of interest to any company leveraging Shiny and having people with different programming background who wish to better work together around that same technology.</p>
<p>In the following, Iâ€™ll show you how one may seamlessly leverage Shiny and some modern web dev tools like JSX, ES6, webpack and external JS viz libraries.</p>
</div>
<div id="state-of-the-art" class="section level2" number="28.2">
<h2>
<span class="header-section-number">28.2</span> State of the art<a class="anchor" aria-label="anchor" href="#state-of-the-art"><i class="fas fa-link"></i></a>
</h2>
<p>Letâ€™s make a list of all requirements for such a project. Since we are working with both web languages and R, we may select <a href="https://github.com/JohnCoene/packer">packer</a> <span class="citation">(<a href="references.html#ref-R-packer" role="doc-biblioref">Coene 2021a</a>)</span> that briefly allows to use <code>webpack</code>, a JavaScript <strong>bundler</strong>, in any R project. Moreover, we seek for a robust R <strong>package</strong> template structure for Shiny, which is a perfect task for <a href="https://github.com/ThinkR-open/golem">golem</a>. As for the icing on the cake, <a href="https://github.com/JohnCoene/packer">packer</a> offers a plug and play function to set up a <a href="https://github.com/ThinkR-open/golem">golem</a> project with <code>webpack</code>, through <code><a href="https://rdrr.io/pkg/packer/man/scaffold_golem.html">packer::scaffold_golem()</a></code>.</p>
<div class="noteblock">
<p>An excellent introduction exposing how to maintain robust JavaScript code inside a Shiny project, featuring webpack and NPM, may be found in JavaScript for R (<a href="https://book.javascript-for-r.com/webpack-intro.html" class="uri">https://book.javascript-for-r.com/webpack-intro.html</a>) by John Coene.</p>
</div>
<p>To install <a href="https://github.com/JohnCoene/packer">packer</a> and <a href="https://github.com/ThinkR-open/golem">golem</a>, we run:</p>
<p></p>
<div class="sourceCode" id="cb1035"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CRAN</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"packer"</span>, <span class="st">"golem"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># development version</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"JohnCoene/packer"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"ThinkR-open/golem"</span><span class="op">)</span></code></pre></div>
<p></p>
</div>
<div id="about-the-project" class="section level2" number="28.3">
<h2>
<span class="header-section-number">28.3</span> About the project<a class="anchor" aria-label="anchor" href="#about-the-project"><i class="fas fa-link"></i></a>
</h2>
<div id="topic" class="section level3" number="28.3.1">
<h3>
<span class="header-section-number">28.3.1</span> Topic<a class="anchor" aria-label="anchor" href="#topic"><i class="fas fa-link"></i></a>
</h3>
<p>We are going to develop an ordinary differential equation solver app for the Van Der Pol oscillator, whose equations may be found below:</p>
<p><span class="math display">\[\begin{equation}
  \begin{cases}
    \dot{x}=y,\\
    \dot{y}=\mu (1-x^2)y-x.
  \end{cases}
\end{equation}\]</span></p>
<p>Importantly, we donâ€™t really focus on the scientific content and the app will be very simple regarding its features. As shown above, there is only one parameter namely <span class="math inline">\(\mu\)</span>, which we will vary to see its influence on the whole system.</p>
</div>
<div id="initialize-the-project" class="section level3" number="28.3.2">
<h3>
<span class="header-section-number">28.3.2</span> Initialize the project<a class="anchor" aria-label="anchor" href="#initialize-the-project"><i class="fas fa-link"></i></a>
</h3>
<p>We assume that the R developer is the first to setup the project, even though in theory, both can do.</p>
<p></p>
<div class="sourceCode" id="cb1036"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">golem</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/golem/man/create_golem.html">create_golem</a></span><span class="op">(</span><span class="st">"vdpMod"</span><span class="op">)</span></code></pre></div>
<p></p>
<p>We then call the specific <a href="https://github.com/JohnCoene/packer">packer</a> function to setup a <a href="https://github.com/ThinkR-open/golem">golem</a> compatible structure:</p>
<p></p>
<div class="sourceCode" id="cb1037"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">packer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/packer/man/scaffold_golem.html">scaffold_golem</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p></p>
<p>You should end up with the file structure depicted on Figure <a href="going-further-webdev.html#fig:vdpMod-init">28.2</a>.</p>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:vdpMod-init"></span>
<img src="images/going-further/vdpMod-init.png" alt="vdpMod project initialization with {golem} and {packer}." width="50%"><p class="caption">
FIGURE 28.2: vdpMod project initialization with {golem} and {packer}.
</p>
</div>
<p></p>
<p>The structure is basically the same provided by <a href="https://github.com/ThinkR-open/golem">golem</a> with addition of extra files for JS code management by <a href="https://github.com/JohnCoene/packer">packer</a>. This is the same principle shown in chapters <a href="workflow-charpente.html#workflow-charpente">21</a> and <a href="going-further-reactR.html#going-further-reactR">27</a>. Letâ€™s pause here for the R setup and continue later in this chapter.</p>
<div class="noteblock">
<p>With the latest <a href="https://github.com/JohnCoene/packer">packer</a> github version, you may get a plug and play Framework7 project by running <code><a href="https://rdrr.io/pkg/packer/man/scaffold_golem.html">packer::scaffold_golem(framework7 = TRUE)</a></code>.</p>
</div>
</div>
<div id="ui-design" class="section level3" number="28.3.3">
<h3>
<span class="header-section-number">28.3.3</span> UI design<a class="anchor" aria-label="anchor" href="#ui-design"><i class="fas fa-link"></i></a>
</h3>
<p>The UI will contain a slider input to change <span class="math inline">\(\mu\)</span> as well as two plots, one for the solutions <code>x</code> and <code>y</code> and another for the <strong>phase plan</strong> analysis including the vector field and a simple trajectory from a chosen initial condition. In short, phase plan [analysis allows to <strong>qualitatively</strong> study a non linear systems, that is determine:</p>
<ul>
<li>What are the <strong>steady states</strong> (state for which the system does not change in time).</li>
<li>The nature of the steady states (stable, unstable).</li>
<li>Whether there are <strong>bifurcations</strong> (change in number of steady state and stability).</li>
<li>â€¦ This is just wonderful believe me!</li>
</ul>
<p>After knowing all those details, we may easily predict given an initial condition, how the system will react to any external perturbation. If you want to know more, this <a href="https://www.springer.com/gp/book/9780387952239">book</a> is a good starting point.</p>
<p>To build the user interface, we selected the <a href="https://framework7.io/">Framework7</a> template, already mentioned in part <a href="mobile-shiny-intro.html#mobile-shiny-intro">22</a> since we want this app to be optimized for <strong>mobile</strong> platforms. Besides, as <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> does not implement all its features yet, this will also allow us to fully exploit the Framework7 API. The graphic output part will be handled by <a href="https://echarts.apache.org/en/index.html">echartsjs</a>, offering quite amazing vector field outputs, as depicted <a href="https://echarts.apache.org/examples/en/editor.html?c=flowGL-noise&amp;gl=1&amp;theme=dark">here</a>.</p>
</div>
<div id="r-business-logic" class="section level3" number="28.3.4">
<h3>
<span class="header-section-number">28.3.4</span> R Business logic<a class="anchor" aria-label="anchor" href="#r-business-logic"><i class="fas fa-link"></i></a>
</h3>
<p>Before designing the app and dive into the reactivity, letâ€™s first think about the business logic. On the server side, we want to write the model equations, create a function to solve it, compute the vector fieldâ€¦ in a <code>.R/model.R</code> script. The first step is to store the equations. As it is a two dimensions ODE system, we can use a simple vector:</p>
<p></p>
<div class="sourceCode" id="cb1038"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vdp_equations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"Y"</span>,
  <span class="st">"p['mu'] * (1 - X^2) * Y - X"</span>
<span class="op">)</span></code></pre></div>
<p></p>
<p>Equations are solved with the <a href="http://desolve.r-forge.r-project.org/">deSolve</a> package <span class="citation">(<a href="references.html#ref-R-deSolve" role="doc-biblioref">Soetaert, Petzoldt, and Setzer 2021</a>)</span>, whose performances are enough for this example (For more complex examples, one may switch to compiled code with Fortran, C or C++, <a href="http://desolve.r-forge.r-project.org/">deSolve</a> providing a convenient API for compiled code).</p>
<p></p>
<div class="sourceCode" id="cb1039"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">solve_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Y0</span>, <span class="va">t</span>, <span class="va">model</span>, <span class="va">parms</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Y0</span>, times <span class="op">=</span> <span class="va">t</span>, <span class="va">model</span>, <span class="va">parms</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p><code>Y0</code> refers to the initial condition, <code>t</code> is the time for which we integrate, <code>model</code> contains the equations and <code>parms</code> is a vector of parameters. Importantly, <a href="http://desolve.r-forge.r-project.org/">deSolve</a> requires the model to be written as follows (<code>t</code> being the time, <code>y</code> a 2D vector and <code>p</code> a parameter vector), returning the value of <code>x</code> and <code>y</code> in a list:</p>
<p></p>
<div class="sourceCode" id="cb1040"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vdp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">p</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="op">{</span>
    <span class="va">dX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html">parse</a></span><span class="op">(</span>text <span class="op">=</span> <span class="va">vdp_equations</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
    <span class="va">dY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html">parse</a></span><span class="op">(</span>text <span class="op">=</span> <span class="va">vdp_equations</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">dX</span>, Y<span class="op">=</span><span class="va">dY</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>From there, calling <code>solve_model()</code> will return a vector containing our solutions at each time step:</p>
<p></p>
<div class="sourceCode" id="cb1041"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">solve_model</span><span class="op">(</span>
  Y0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
  t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.1</span><span class="op">)</span>,
  <span class="va">vdp</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>#&gt;    time        X           Y
#&gt; 1   0.0 1.000000  1.00000000
#&gt; 2   0.1 1.094807  0.89424469
#&gt; 3   0.2 1.178502  0.77803473
#&gt; 4   0.3 1.250123  0.65309701
#&gt; 5   0.4 1.308892  0.52128961
#&gt; 6   0.5 1.354215  0.38451526
#&gt; 7   0.6 1.385692  0.24464299
#&gt; 8   0.7 1.403100  0.10344169
#&gt; 9   0.8 1.406390 -0.03746953
#&gt; 10  0.9 1.395664 -0.17665503
#&gt; 11  1.0 1.371158 -0.31286984</code></pre>
<p></p>
<p>It is therefore straightforward to plot <strong>solutions</strong>. However, this output does not tell use anything about the <strong>vector field</strong>. Below is the code used to generate it. <code>mag</code> represents the speed along trajectories resulting from a linear combination of the vertical speed and the horizontal speed components, respectively <code>dy</code> and <code>dx</code>. It is obtained after applying the Pythagorean theorem:</p>
<p><span class="math display">\[\begin{equation}
  mag = \sqrt{dx^2 + dy^2}
\end{equation}\]</span></p>
<p>We will use it later to setup appropriate color code in the JS code:</p>
<p></p>
<div class="sourceCode" id="cb1043"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">build_phase_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xgrid</span>, <span class="va">ygrid</span>, <span class="va">p</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">vectors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xgrid</span>, y <span class="op">=</span> <span class="va">ygrid</span><span class="op">)</span>
  <span class="va">X</span> <span class="op">&lt;-</span> <span class="va">vectors</span><span class="op">$</span><span class="va">x</span>
  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">vectors</span><span class="op">$</span><span class="va">y</span>
  <span class="va">vectors</span><span class="op">$</span><span class="va">dx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html">parse</a></span><span class="op">(</span>text <span class="op">=</span> <span class="va">vdp_equations</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="va">vectors</span><span class="op">$</span><span class="va">dy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html">parse</a></span><span class="op">(</span>text <span class="op">=</span> <span class="va">vdp_equations</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="va">vectors</span><span class="op">$</span><span class="va">mag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span>
    <span class="va">vectors</span><span class="op">$</span><span class="va">dx</span> <span class="op">*</span> <span class="va">vectors</span><span class="op">$</span><span class="va">dx</span> <span class="op">+</span> 
    <span class="va">vectors</span><span class="op">$</span><span class="va">dy</span> <span class="op">*</span> <span class="va">vectors</span><span class="op">$</span><span class="va">dy</span>
  <span class="op">)</span>
  <span class="va">vectors</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb1044"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>
<span class="va">phase_plan</span> <span class="op">&lt;-</span> <span class="fu">build_phase_data</span><span class="op">(</span><span class="va">grid</span>, <span class="va">grid</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Original is 441 rows, we provide a subset</span>
<span class="va">phase_plan</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></code></pre></div>
<pre><code>#&gt;     x   y  dx   dy       mag
#&gt; 1 -10 -10 -10 1000 1000.0500
#&gt; 2  -9 -10 -10  809  809.0618
#&gt; 3  -8 -10 -10  638  638.0784
#&gt; 4  -7 -10 -10  487  487.1027
#&gt; 5  -6 -10 -10  356  356.1404</code></pre>
<p></p>
<p>We obtain a matrix indicating for each <code>(X,Y)</code> in the grid what are the vertical and horizontal speed, respectively <code>dX</code> and <code>dY</code> as well as the resulting speed, <code>mag</code>, thereby allowing to draw the <a href="https://en.wikipedia.org/wiki/Phase_plane">phase plan</a>.</p>
<p>The last step is to create a main wrapper that will call <code>solve_model()</code> and <code>build_phase_data()</code> at once. Remember that on the UI side, we generate two outputs, the time series and the phase portrait. The first one requires data obtained from <code>solve_model()</code>. The second one requires a subset of <code>solve_model()</code> output and <code>build_phase_data()</code>. Since <code>solve_model()</code> returns a matrix, we convert it to a <code>data.frame</code>, easier to handle on the JS side:</p>
<p></p>
<div class="sourceCode" id="cb1046"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">generate_model_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">pars</span>, <span class="va">grid</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">model_output</span> <span class="op">&lt;-</span> <span class="fu">solve_model</span><span class="op">(</span>
    Y0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
    t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">.1</span><span class="op">)</span>,
    <span class="va">model</span>,
    <span class="va">pars</span>
  <span class="op">)</span>
  
  <span class="co"># time series (x = f(t), y = f(t))</span>
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">model_output</span><span class="op">)</span>
  <span class="va">modelData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">time</span>, X <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, Y <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>
  
  <span class="co"># phase plan</span>
  <span class="va">trajectoryData</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span><span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">trajectoryData</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  
  <span class="va">phaseData</span> <span class="op">&lt;-</span> <span class="fu">build_phase_data</span><span class="op">(</span><span class="va">grid</span>, <span class="va">grid</span>, <span class="va">pars</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">phaseData</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  
  <span class="co"># return data</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    lineData <span class="op">=</span> <span class="va">modelData</span>,
    phaseData <span class="op">=</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">toJSON</a></span><span class="op">(</span><span class="va">phaseData</span>, pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    trajectoryData <span class="op">=</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">toJSON</a></span><span class="op">(</span>
      <span class="va">trajectoryData</span>, 
      pretty <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>This is basically all we need! I highly encourage you not to dive into
<strong>reactivity</strong> first, as this is significantly harder to debug. This way, you can
design unit test for these functions without having to handle the Shiny machinery.</p>
</div>
<div id="add-shiny" class="section level3" number="28.3.5">
<h3>
<span class="header-section-number">28.3.5</span> Add Shiny<a class="anchor" aria-label="anchor" href="#add-shiny"><i class="fas fa-link"></i></a>
</h3>
<p>Now that the business logic is safe, we describe what we must do on the server side. Remember that the original idea is to have a slider which we can move to see what impact <span class="math inline">\(\mu\)</span> has on the whole system.</p>
<p>In the main <code>.R/app_server.R</code> script, we set a reactive expression containing the vector of parameters (here we only have one but you may imagine to add more later):</p>
<p></p>
<div class="sourceCode" id="cb1047"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">mu</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">mu</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p></p>
<p>Then, we add an <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent()</a></code> listening to any change in <code>pars()</code>, triggered as a result of a UI action, that is a slider input change. Inside, we generate the model data with <code>generate_model_data()</code> and send them to JS through the websocket with <code>session$sendCustomMessage</code>:</p>
<p></p>
<div class="sourceCode" id="cb1048"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="fu">pars</span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span>
  <span class="va">session</span><span class="op">$</span><span class="fu">sendCustomMessage</span><span class="op">(</span>
    <span class="st">"model-data"</span>,
    <span class="fu">generate_model_data</span><span class="op">(</span><span class="va">vdp</span>, <span class="fu">pars</span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p></p>
<p>Thatâ€™s all folks! I hope you start to realize the benefits of extracting the business logic out of Shiny. For more complex apps, we recommend to start developing modules and not put the whole code inside <code>.R/app_server.R</code>.</p>
<p>This is all what the R developer would have to do:</p>
<ul>
<li>Write the business logic.</li>
<li>Add reactivity and send data to JS.</li>
<li>Talk to the JS developer about what inputs should be on the UI side â€¦</li>
</ul>
<p>Now letâ€™s see what happens on the Front-end side.</p>
</div>
<div id="create-the-interface" class="section level3" number="28.3.6">
<h3>
<span class="header-section-number">28.3.6</span> Create the interface<a class="anchor" aria-label="anchor" href="#create-the-interface"><i class="fas fa-link"></i></a>
</h3>
<p>This is where the front-end developers come to play and believe me, there is quite some work for them.</p>
<div id="setup-dev-js-dependencies" class="section level4" number="28.3.6.1">
<h4>
<span class="header-section-number">28.3.6.1</span> Setup dev JS dependencies<a class="anchor" aria-label="anchor" href="#setup-dev-js-dependencies"><i class="fas fa-link"></i></a>
</h4>
<p>The first thing is to continue with the package setup to add development libraries necessary for building the JS code.
For now, those dependencies are listed in <code>./package.json</code> and only cover <code>webpack</code>:</p>
<p></p>
<div class="sourceCode" id="cb1049"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1049-1"><a href="going-further-webdev.html#cb1049-1" aria-hidden="true" tabindex="-1"></a><span class="st">"devDependencies"</span><span class="op">:</span> {</span>
<span id="cb1049-2"><a href="going-further-webdev.html#cb1049-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"webpack"</span><span class="op">:</span> <span class="st">"^5.53.0"</span><span class="op">,</span></span>
<span id="cb1049-3"><a href="going-further-webdev.html#cb1049-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"webpack-cli"</span><span class="op">:</span> <span class="st">"^4.8.0"</span><span class="op">,</span></span>
<span id="cb1049-4"><a href="going-further-webdev.html#cb1049-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"webpack-merge"</span><span class="op">:</span> <span class="st">"^5.8.0"</span></span>
<span id="cb1049-5"><a href="going-further-webdev.html#cb1049-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Since weâ€™ll be using quite modern JS syntay (ES6) and some JSX, we have to install <strong>Babel</strong> that will compile our code to a JS code that all web browsers can understand.</p>
<p></p>
<div class="sourceCode" id="cb1050"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">packer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/packer/man/npm_install.html">npm_install</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">"babel"</span>, 
    <span class="st">"babel-loader"</span>, 
    <span class="st">"@babel/core"</span>, 
    <span class="st">"@babel/preset-env"</span>
  <span class="op">)</span>, 
  scope <span class="op">=</span> <span class="st">"dev"</span>
<span class="op">)</span></code></pre></div>
<p></p>
<p>As we depend on Framework7 and echartsjs, we install them as production dependencies (needed by the app):</p>
<p></p>
<div class="sourceCode" id="cb1051"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">packer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/packer/man/npm_install.html">npm_install</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">"framework7"</span>, 
    <span class="st">"echarts"</span>, 
    <span class="st">"echarts-gl"</span>
  <span class="op">)</span>,
  scope <span class="op">=</span> <span class="st">"prod"</span>
<span class="op">)</span></code></pre></div>
<p></p>
<p>You should obtain this JSON:</p>
<p></p>
<div class="sourceCode" id="cb1052"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1052-1"><a href="going-further-webdev.html#cb1052-1" aria-hidden="true" tabindex="-1"></a><span class="st">"devDependencies"</span><span class="op">:</span> {</span>
<span id="cb1052-2"><a href="going-further-webdev.html#cb1052-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"@babel/core"</span><span class="op">:</span> <span class="st">"^7.15.5"</span><span class="op">,</span></span>
<span id="cb1052-3"><a href="going-further-webdev.html#cb1052-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"@babel/preset-env"</span><span class="op">:</span> <span class="st">"^7.15.6"</span><span class="op">,</span></span>
<span id="cb1052-4"><a href="going-further-webdev.html#cb1052-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"babel"</span><span class="op">:</span> <span class="st">"^6.23.0"</span><span class="op">,</span></span>
<span id="cb1052-5"><a href="going-further-webdev.html#cb1052-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"babel-loader"</span><span class="op">:</span> <span class="st">"^8.2.2"</span><span class="op">,</span></span>
<span id="cb1052-6"><a href="going-further-webdev.html#cb1052-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"webpack"</span><span class="op">:</span> <span class="st">"^5.53.0"</span><span class="op">,</span></span>
<span id="cb1052-7"><a href="going-further-webdev.html#cb1052-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"webpack-cli"</span><span class="op">:</span> <span class="st">"^4.8.0"</span><span class="op">,</span></span>
<span id="cb1052-8"><a href="going-further-webdev.html#cb1052-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"webpack-merge"</span><span class="op">:</span> <span class="st">"^5.8.0"</span></span>
<span id="cb1052-9"><a href="going-further-webdev.html#cb1052-9" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb1052-10"><a href="going-further-webdev.html#cb1052-10" aria-hidden="true" tabindex="-1"></a><span class="st">"dependencies"</span><span class="op">:</span> {</span>
<span id="cb1052-11"><a href="going-further-webdev.html#cb1052-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"echarts"</span><span class="op">:</span> <span class="st">"^5.2.1"</span><span class="op">,</span></span>
<span id="cb1052-12"><a href="going-further-webdev.html#cb1052-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"echarts-gl"</span><span class="op">:</span> <span class="st">"^2.0.8"</span><span class="op">,</span></span>
<span id="cb1052-13"><a href="going-further-webdev.html#cb1052-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"framework7"</span><span class="op">:</span> <span class="st">"^6.3.4"</span></span>
<span id="cb1052-14"><a href="going-further-webdev.html#cb1052-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>We modify the <code>./srcjs/config/loader.json</code> to include the required loaders for <code>js</code>, <code>jsx</code> and <code>css</code> files. For css, <a href="https://github.com/JohnCoene/packer">packer</a> exposes a functions, <code>use_loader_rule()</code>:</p>
<p></p>
<div class="sourceCode" id="cb1053"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">use_loader_rule</span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"style-loader"</span>, <span class="st">"css-loader"</span><span class="op">)</span>,
  test <span class="op">=</span> <span class="st">"\\.css$"</span>
<span class="op">)</span></code></pre></div>
<p></p>
<p>which gives:</p>
<p></p>
<div class="sourceCode" id="cb1054"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1054-1"><a href="going-further-webdev.html#cb1054-1" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb1054-2"><a href="going-further-webdev.html#cb1054-2" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb1054-3"><a href="going-further-webdev.html#cb1054-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"test"</span><span class="op">:</span> <span class="st">"</span><span class="sc">\.</span><span class="st">css$"</span><span class="op">,</span></span>
<span id="cb1054-4"><a href="going-further-webdev.html#cb1054-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"use"</span><span class="op">:</span> [</span>
<span id="cb1054-5"><a href="going-further-webdev.html#cb1054-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"style-loader"</span><span class="op">,</span></span>
<span id="cb1054-6"><a href="going-further-webdev.html#cb1054-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"css-loader"</span></span>
<span id="cb1054-7"><a href="going-further-webdev.html#cb1054-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb1054-8"><a href="going-further-webdev.html#cb1054-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1054-9"><a href="going-further-webdev.html#cb1054-9" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
<p></p>
<p>Interestingly, Framework7 allows to write JSX code without the need of importing React. This is very convenient but require to add an extra <a href="https://www.npmjs.com/package/framework7-loader">loader</a> as well as a babel react component (you may imagine to design a <code>use_loader_framework7()</code> function â€¦):</p>
<p></p>
<div class="sourceCode" id="cb1055"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">use_loader_rule</span><span class="op">(</span>
  <span class="st">"framework7-loader"</span>, 
  test <span class="op">=</span> <span class="st">"\\.(f7).(html|js|jsx)$"</span>,
  use <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"babel-loader"</span>, <span class="st">"framework7-loader"</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu">packer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/packer/man/npm_install.html">npm_install</a></span><span class="op">(</span><span class="st">"@babel/preset-react"</span>, scope <span class="op">=</span> <span class="st">"dev"</span><span class="op">)</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb1056"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1056-1"><a href="going-further-webdev.html#cb1056-1" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb1056-2"><a href="going-further-webdev.html#cb1056-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... style loader ...</span></span>
<span id="cb1056-3"><a href="going-further-webdev.html#cb1056-3" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb1056-4"><a href="going-further-webdev.html#cb1056-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"test"</span><span class="op">:</span> <span class="st">"</span><span class="sc">\.</span><span class="st">(f7).(html|js|jsx)$"</span><span class="op">,</span></span>
<span id="cb1056-5"><a href="going-further-webdev.html#cb1056-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"use"</span><span class="op">:</span> [</span>
<span id="cb1056-6"><a href="going-further-webdev.html#cb1056-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"babel-loader"</span><span class="op">,</span></span>
<span id="cb1056-7"><a href="going-further-webdev.html#cb1056-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"framework7-loader"</span></span>
<span id="cb1056-8"><a href="going-further-webdev.html#cb1056-8" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb1056-9"><a href="going-further-webdev.html#cb1056-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1056-10"><a href="going-further-webdev.html#cb1056-10" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
<p></p>
<p>Alternatively, one can copy the <code>./package.json</code> from <a href="https://github.com/RinteRface/shinyComponent/tree/07ef8216c5803147691d95343ef6639a0e1ecf2f">here</a> to get exactly the same package versions I used when I initialized this project and call <code><a href="https://rdrr.io/pkg/packer/man/npm_install.html">packer::npm_install()</a></code> to pull the dependencies and install them for the project.</p>
<p>We create a <code>./.babelrc</code> script providing some configuration for Babel to handle JSX. Within the terminal, we call <code>touch .babelrc</code> and add it the following code:</p>
<p></p>
<div class="sourceCode" id="cb1057"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1057-1"><a href="going-further-webdev.html#cb1057-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1057-2"><a href="going-further-webdev.html#cb1057-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"presets"</span><span class="op">:</span> [</span>
<span id="cb1057-3"><a href="going-further-webdev.html#cb1057-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"@babel/preset-env"</span><span class="op">,</span></span>
<span id="cb1057-4"><a href="going-further-webdev.html#cb1057-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"@babel/preset-react"</span></span>
<span id="cb1057-5"><a href="going-further-webdev.html#cb1057-5" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb1057-6"><a href="going-further-webdev.html#cb1057-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>We can ultimately bundle our JS code and check whether the app starts:</p>
<p></p>
<div class="sourceCode" id="cb1058"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">packer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/packer/man/bundle.html">bundle</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span>
<span class="fu">run_app</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p></p>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:vdpMod-basic-app"></span>
<img src="images/going-further/vdpMod-basic-app.png" alt="vdpMod basic app." width="100%"><p class="caption">
FIGURE 28.3: vdpMod basic app.
</p>
</div>
<p></p>
</div>
<div id="basic-r-ui-skeleton" class="section level4" number="28.3.6.2">
<h4>
<span class="header-section-number">28.3.6.2</span> Basic R UI skeleton<a class="anchor" aria-label="anchor" href="#basic-r-ui-skeleton"><i class="fas fa-link"></i></a>
</h4>
<p>The package configuration is successful but we still have to modify the <code>./R/app_ui.R</code> to be consistent with the Framework7 expectations. According to what is required in the <a href="https://framework7.io/docs/app-layout.html">documentation</a>, the <code>body</code> must contain a tag with the an id, followed by the <code>index.js</code> JS code (obtained after compilation with <a href="https://github.com/JohnCoene/packer">packer</a>). The order is important as not following it will break the app:</p>
<p></p>
<div class="sourceCode" id="cb1059"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">app_ui</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">request</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span>
    <span class="co"># Leave this function for adding external resources</span>
    <span class="fu">golem_add_external_resources</span><span class="op">(</span><span class="va">title</span><span class="op">)</span>,
    <span class="co"># Your application UI logic</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"app"</span><span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">script</span><span class="op">(</span>src <span class="op">=</span> <span class="st">"www/index.js"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>Note that we also have to consider meta tags in the header to handle the viewport, mobile platformsâ€¦ This is done inside <code>golem_add_external_resources()</code>. Besides, we had to comment out the <code>bundle_resources()</code> call since it would have added the dependencies in the head, before the app tag, which is not consistent with the Framework7 requirements:</p>
<p></p>
<div class="sourceCode" id="cb1060"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">golem_add_external_resources</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">title</span><span class="op">)</span><span class="op">{</span>

  <span class="fu">add_resource_path</span><span class="op">(</span>
    <span class="st">'www'</span>, <span class="fu">app_sys</span><span class="op">(</span><span class="st">'app/www'</span><span class="op">)</span>
  <span class="op">)</span>

  <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span>
    <span class="fu">favicon</span><span class="op">(</span><span class="op">)</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>charset <span class="op">=</span> <span class="st">"utf-8"</span><span class="op">)</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
      name <span class="op">=</span> <span class="st">"viewport"</span>,
      content <span class="op">=</span> <span class="st">"width=device-width, initial-scale=1,
      maximum-scale=1, minimum-scale=1, user-scalable=no,
      viewport-fit=cover"</span>
    <span class="op">)</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
      name <span class="op">=</span> <span class="st">"apple-mobile-web-app-capable"</span>,
      content <span class="op">=</span> <span class="st">"yes"</span>
    <span class="op">)</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"theme-color"</span>, content <span class="op">=</span> <span class="st">"#2196f3"</span><span class="op">)</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">title</span><span class="op">(</span><span class="va">title</span><span class="op">)</span>
    <span class="co"># removed code</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>This is all what we need on the R UI side since most of the code will be written in JSX.</p>
</div>
<div id="create-the-app-layout-in-js" class="section level4" number="28.3.6.3">
<h4>
<span class="header-section-number">28.3.6.3</span> Create the app layout in JS<a class="anchor" aria-label="anchor" href="#create-the-app-layout-in-js"><i class="fas fa-link"></i></a>
</h4>
<p>We have the R logic, the R/UI skeleton but few steps remain such as initializing the app as discussed in <a href="mobile-shinyMobile.html#mobile-initialization">23.4</a>.
Everything happens in the <code>./srcjs/index.js</code> script. For now it should be like below:</p>
<p></p>
<div class="sourceCode" id="cb1061"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1061-1"><a href="going-further-webdev.html#cb1061-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { message } <span class="im">from</span> <span class="st">'./modules/message.js'</span><span class="op">;</span></span>
<span id="cb1061-2"><a href="going-further-webdev.html#cb1061-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="st">'shiny'</span><span class="op">;</span></span>
<span id="cb1061-3"><a href="going-further-webdev.html#cb1061-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1061-4"><a href="going-further-webdev.html#cb1061-4" aria-hidden="true" tabindex="-1"></a><span class="co">// In shiny server use:</span></span>
<span id="cb1061-5"><a href="going-further-webdev.html#cb1061-5" aria-hidden="true" tabindex="-1"></a><span class="co">// session$sendCustomMessage('show-packer', 'hello packer!')</span></span>
<span id="cb1061-6"><a href="going-further-webdev.html#cb1061-6" aria-hidden="true" tabindex="-1"></a>Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(<span class="st">'show-packer'</span><span class="op">,</span> (msg) <span class="kw">=&gt;</span> {</span>
<span id="cb1061-7"><a href="going-further-webdev.html#cb1061-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(msg)<span class="op">;</span></span>
<span id="cb1061-8"><a href="going-further-webdev.html#cb1061-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p></p>
<p>which is a placeholder provided by <a href="https://github.com/JohnCoene/packer">packer</a>. While we donâ€™t need it,
note how we may seamlessly import functions from one script to another with just an <code>import</code> statement followed by the function name and the script path. Weâ€™ll use this syntax all over the place. What do we need now? We import <code>Framework7</code> required for the app initialization in <code>new Framework7({...})</code>:</p>
<p></p>
<div class="sourceCode" id="cb1062"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1062-1"><a href="going-further-webdev.html#cb1062-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="st">'shiny'</span><span class="op">;</span></span>
<span id="cb1062-2"><a href="going-further-webdev.html#cb1062-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Import Framework7</span></span>
<span id="cb1062-3"><a href="going-further-webdev.html#cb1062-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> Framework7 <span class="im">from</span> <span class="st">'framework7'</span><span class="op">;</span></span></code></pre></div>
<p></p>
<p>Then, we import the css, whose assets are located under <code>./node_modules/framework7</code> and as shown on Figure <a href="going-further-webdev.html#fig:vdpMod-framework7-resources">28.4</a>. To capture all CSS, weâ€™ll point to <code>framework7/framework7-bundle.min.css</code> (bundle usually corresponds to all components):</p>
<p></p>
<div class="sourceCode" id="cb1063"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1063-1"><a href="going-further-webdev.html#cb1063-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="st">'shiny'</span><span class="op">;</span></span>
<span id="cb1063-2"><a href="going-further-webdev.html#cb1063-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Import Framework7</span></span>
<span id="cb1063-3"><a href="going-further-webdev.html#cb1063-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> Framework7 <span class="im">from</span> <span class="st">'framework7'</span><span class="op">;</span></span>
<span id="cb1063-4"><a href="going-further-webdev.html#cb1063-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Import Framework7 Styles</span></span>
<span id="cb1063-5"><a href="going-further-webdev.html#cb1063-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="st">'framework7/framework7-bundle.min.css'</span><span class="op">;</span></span></code></pre></div>
<p></p>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:vdpMod-framework7-resources"></span>
<img src="images/going-further/vdpMod-framework7-resources.png" alt="Framework7 assets in node modules." width="50%"><p class="caption">
FIGURE 28.4: Framework7 assets in node modules.
</p>
</div>
<p></p>
<p>The way we imported Framework7 does not provide any other component. To lighten the JS code, Framework7 has a modular organisation, thereby consisting in inporting only what we require. According to Figure <a href="going-further-webdev.html#fig:vdpMod-framework7-resources">28.4</a>, those components are located in <code>framework7/esm/components/&lt;COMPONENT_NAME&gt;/&lt;SCRIPT.js&gt;</code>
If you remember correctly, we seek for a slider widget to update the model parameter value. Moreover, itâ€™s always nice to notify the user when the new results are available, so letâ€™s do it with a toast:</p>
<p></p>
<div class="sourceCode" id="cb1064"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1064-1"><a href="going-further-webdev.html#cb1064-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ... Other imports ...</span></span>
<span id="cb1064-2"><a href="going-further-webdev.html#cb1064-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1064-3"><a href="going-further-webdev.html#cb1064-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Install F7 Components using .use() method on class:</span></span>
<span id="cb1064-4"><a href="going-further-webdev.html#cb1064-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">Range</span> <span class="im">from</span> <span class="st">'framework7/esm/components/range/range.js'</span><span class="op">;</span></span>
<span id="cb1064-5"><a href="going-further-webdev.html#cb1064-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> Toast <span class="im">from</span> <span class="st">'framework7/esm/components/toast/toast.js'</span><span class="op">;</span></span>
<span id="cb1064-6"><a href="going-further-webdev.html#cb1064-6" aria-hidden="true" tabindex="-1"></a>Framework7<span class="op">.</span><span class="fu">use</span>([<span class="bu">Range</span><span class="op">,</span> Toast])<span class="op">;</span></span></code></pre></div>
<p></p>
<p>For the layout, we selected the main App component template, documented <a href="https://framework7.io/docs/router-component.html#main-app-component">here</a>. Overall, it offers a better way to organize the app code in different component modules, the <code>App</code> being the top level component:</p>
<p></p>
<div class="sourceCode" id="cb1065"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1065-1"><a href="going-further-webdev.html#cb1065-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ... Other imports ...</span></span>
<span id="cb1065-2"><a href="going-further-webdev.html#cb1065-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1065-3"><a href="going-further-webdev.html#cb1065-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> App <span class="im">from</span> <span class="st">'./components/app.f7.jsx'</span><span class="op">;</span></span>
<span id="cb1065-4"><a href="going-further-webdev.html#cb1065-4" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> app <span class="op">=</span> <span class="kw">new</span> <span class="fu">Framework7</span>({</span>
<span id="cb1065-5"><a href="going-further-webdev.html#cb1065-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">el</span><span class="op">:</span> <span class="st">'#app'</span><span class="op">,</span></span>
<span id="cb1065-6"><a href="going-further-webdev.html#cb1065-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">theme</span><span class="op">:</span> <span class="st">'ios'</span><span class="op">,</span></span>
<span id="cb1065-7"><a href="going-further-webdev.html#cb1065-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// specify main app component</span></span>
<span id="cb1065-8"><a href="going-further-webdev.html#cb1065-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">component</span><span class="op">:</span> App</span>
<span id="cb1065-9"><a href="going-further-webdev.html#cb1065-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p></p>
<p><code>el</code> targets the app tag <code>id</code> defined in <code>./R/app_ui.R</code>. If you ever have to change it, donâ€™t forget to replace it in both places. The <code>component</code> slot hosts the <code>App</code> which has to be defined. We assumed it is created in a <code>./srcjs/components/app.f7.jsx</code>, <code>.</code> being the root of the <code>srcjs</code> folder. Interestingly, it has the <code>.jsx</code> extension, the JSX syntax being very convenient to mix HTML and JavaScript code in the same file. It is crucial to name the files <code>&lt;name&gt;.f7.jsx</code> as it will allow the Framework7 loader to work properly. Practically, a template file will always look the same. We export the main component as a function that may have some parameters. Each component must return a <strong>render</strong> function containing some tags. Below is a <code>./srcjs/components/list.f7.jsx</code> example:</p>
<p></p>
<div class="sourceCode" id="cb1066"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb1066-1"><a href="going-further-webdev.html#cb1066-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1066-2"><a href="going-further-webdev.html#cb1066-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1066-3"><a href="going-further-webdev.html#cb1066-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ListItem <span class="op">=</span> (props) <span class="kw">=&gt;</span> {</span>
<span id="cb1066-4"><a href="going-further-webdev.html#cb1066-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb1066-5"><a href="going-further-webdev.html#cb1066-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;li&gt;</span><span class="va">{</span>props<span class="op">.</span><span class="at">title</span><span class="va">}</span><span class="kw">&lt;/li&gt;</span></span>
<span id="cb1066-6"><a href="going-further-webdev.html#cb1066-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1066-7"><a href="going-further-webdev.html#cb1066-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1066-8"><a href="going-further-webdev.html#cb1066-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1066-9"><a href="going-further-webdev.html#cb1066-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> () <span class="kw">=&gt;</span> (</span>
<span id="cb1066-10"><a href="going-further-webdev.html#cb1066-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;ul&gt;</span></span>
<span id="cb1066-11"><a href="going-further-webdev.html#cb1066-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">&lt;ListItem</span> <span class="ot">title</span><span class="op">=</span><span class="st">"Item 1"</span> <span class="fu">/&gt;</span></span>
<span id="cb1066-12"><a href="going-further-webdev.html#cb1066-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">&lt;ListItem</span> <span class="ot">title</span><span class="op">=</span><span class="st">"Item 2"</span> <span class="fu">/&gt;</span></span>
<span id="cb1066-13"><a href="going-further-webdev.html#cb1066-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/ul&gt;</span></span>
<span id="cb1066-14"><a href="going-further-webdev.html#cb1066-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1066-15"><a href="going-further-webdev.html#cb1066-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>You may even split the code into more small pieces, below we assume <code>list-item.f7.jsx</code> is in the same directory as the main component:</p>
<p></p>
<div class="sourceCode" id="cb1067"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb1067-1"><a href="going-further-webdev.html#cb1067-1" aria-hidden="true" tabindex="-1"></a><span class="co">// list-item.f7.jsx</span></span>
<span id="cb1067-2"><a href="going-further-webdev.html#cb1067-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> (props) <span class="kw">=&gt;</span> {</span>
<span id="cb1067-3"><a href="going-further-webdev.html#cb1067-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> () <span class="kw">=&gt; &lt;li&gt;</span><span class="va">{</span>props<span class="op">.</span><span class="at">title</span><span class="va">}</span><span class="kw">&lt;/li&gt;</span><span class="op">;</span></span>
<span id="cb1067-4"><a href="going-further-webdev.html#cb1067-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb1068"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb1068-1"><a href="going-further-webdev.html#cb1068-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ListItem <span class="im">from</span> <span class="st">'./list-item.f7.jsx'</span><span class="op">;</span></span>
<span id="cb1068-2"><a href="going-further-webdev.html#cb1068-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1068-3"><a href="going-further-webdev.html#cb1068-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1068-4"><a href="going-further-webdev.html#cb1068-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> () <span class="kw">=&gt;</span> (</span>
<span id="cb1068-5"><a href="going-further-webdev.html#cb1068-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;ul&gt;</span></span>
<span id="cb1068-6"><a href="going-further-webdev.html#cb1068-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">&lt;ListItem</span> <span class="ot">title</span><span class="op">=</span><span class="st">"Item 1"</span> <span class="fu">/&gt;</span></span>
<span id="cb1068-7"><a href="going-further-webdev.html#cb1068-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">&lt;ListItem</span> <span class="ot">title</span><span class="op">=</span><span class="st">"Item 2"</span> <span class="fu">/&gt;</span></span>
<span id="cb1068-8"><a href="going-further-webdev.html#cb1068-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/ul&gt;</span></span>
<span id="cb1068-9"><a href="going-further-webdev.html#cb1068-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1068-10"><a href="going-further-webdev.html#cb1068-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>We define the preliminary main app component in <code>./srcjs/components/app.f7.jsx</code>, the layout being composed of a <code>navbar</code> (top), a <code>toolbar</code> (bottom) and the page content, as already discussed in <a href="mobile-shinyMobile.html#framework7-layouts">23.3</a>:</p>
<p></p>
<div class="sourceCode" id="cb1069"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb1069-1"><a href="going-further-webdev.html#cb1069-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> (props<span class="op">,</span> context) <span class="kw">=&gt;</span> {</span>
<span id="cb1069-2"><a href="going-further-webdev.html#cb1069-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> title <span class="op">=</span> <span class="st">'Hello World'</span><span class="op">;</span></span>
<span id="cb1069-3"><a href="going-further-webdev.html#cb1069-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> content <span class="op">=</span> <span class="st">'App content'</span><span class="op">;</span></span>
<span id="cb1069-4"><a href="going-further-webdev.html#cb1069-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1069-5"><a href="going-further-webdev.html#cb1069-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> () <span class="kw">=&gt;</span> (</span>
<span id="cb1069-6"><a href="going-further-webdev.html#cb1069-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;div</span> <span class="ot">id</span><span class="op">=</span><span class="st">"app"</span><span class="kw">&gt;</span></span>
<span id="cb1069-7"><a href="going-further-webdev.html#cb1069-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"view view-main view-init safe-areas"</span><span class="kw">&gt;</span></span>
<span id="cb1069-8"><a href="going-further-webdev.html#cb1069-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"page"</span><span class="kw">&gt;</span></span>
<span id="cb1069-9"><a href="going-further-webdev.html#cb1069-9" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"navbar"</span><span class="kw">&gt;</span></span>
<span id="cb1069-10"><a href="going-further-webdev.html#cb1069-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"navbar-bg"</span><span class="kw">&gt;&lt;/div&gt;</span></span>
<span id="cb1069-11"><a href="going-further-webdev.html#cb1069-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"navbar-inner"</span><span class="kw">&gt;</span></span>
<span id="cb1069-12"><a href="going-further-webdev.html#cb1069-12" aria-hidden="true" tabindex="-1"></a>              <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"title"</span><span class="kw">&gt;</span><span class="va">{</span>title<span class="va">}</span><span class="kw">&lt;/div&gt;</span></span>
<span id="cb1069-13"><a href="going-further-webdev.html#cb1069-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1069-14"><a href="going-further-webdev.html#cb1069-14" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1069-15"><a href="going-further-webdev.html#cb1069-15" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"toolbar toolbar-bottom"</span><span class="kw">&gt;</span></span>
<span id="cb1069-16"><a href="going-further-webdev.html#cb1069-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"toolbar-inner"</span><span class="kw">&gt;</span></span>
<span id="cb1069-17"><a href="going-further-webdev.html#cb1069-17" aria-hidden="true" tabindex="-1"></a>              <span class="kw">&lt;a</span> <span class="ot">href</span><span class="op">=</span><span class="st">"#"</span> <span class="kw">&gt;</span>Link 1<span class="kw">&lt;/a&gt;</span></span>
<span id="cb1069-18"><a href="going-further-webdev.html#cb1069-18" aria-hidden="true" tabindex="-1"></a>              <span class="kw">&lt;a</span> <span class="ot">href</span><span class="op">=</span><span class="st">"#"</span> <span class="kw">&gt;</span>Link 2<span class="kw">&lt;/a&gt;</span></span>
<span id="cb1069-19"><a href="going-further-webdev.html#cb1069-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1069-20"><a href="going-further-webdev.html#cb1069-20" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1069-21"><a href="going-further-webdev.html#cb1069-21" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"page-content"</span><span class="kw">&gt;</span></span>
<span id="cb1069-22"><a href="going-further-webdev.html#cb1069-22" aria-hidden="true" tabindex="-1"></a>           <span class="va">{</span>content<span class="va">}</span></span>
<span id="cb1069-23"><a href="going-further-webdev.html#cb1069-23" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1069-24"><a href="going-further-webdev.html#cb1069-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1069-25"><a href="going-further-webdev.html#cb1069-25" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1069-26"><a href="going-further-webdev.html#cb1069-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1069-27"><a href="going-further-webdev.html#cb1069-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1069-28"><a href="going-further-webdev.html#cb1069-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p><code>props</code> are elements passed to the component (see <a href="going-further-reactR.html#react-map">27.1.2.2</a>) and <code>context</code> is an object containing <a href="https://framework7.io/docs/router-component.html#component-context">helpers</a> such as:</p>
<ul>
<li>
<code>$f7</code> refers to app instance.</li>
<li>
<code>$update</code> to programmatically re-render the component.</li>
</ul>
<p>Once done, we run and preview the app according to Figure <a href="going-further-webdev.html#fig:vdpMod-basic-app-2">28.5</a>. We are slowly getting there!</p>
<p></p>
<div class="sourceCode" id="cb1070"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">packer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/packer/man/bundle.html">bundle</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span>
<span class="fu">run_app</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p></p>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:vdpMod-basic-app-2"></span>
<img src="images/going-further/vdpMod-basic-app-2.png" alt="vdpMod basic app with main app component template." width="40%"><p class="caption">
FIGURE 28.5: vdpMod basic app with main app component template.
</p>
</div>
<p></p>
<p>We add the slider component that is going to drive the model computation inside <code>./srcjs/components/vdp.f7.jsx</code>, leveraging the Framework7 range widget described <a href="https://framework7.io/docs/range-slider.html#range-slider-auto-initialization">here</a>. To lighten the JS code, we decide to rely on the auto-initialized widget. All attributes are stored in <code>data-&lt;ATTR&gt;</code> format and the <code>range-slider-init</code> class ensures to get the widget properly initialized. The range is inserted in a block container for a better display. We finally bind it an <a href="https://framework7.io/docs/range-slider.html#app-and-range-slider-instance-events">event</a> listening to any value change so that we can assign a Shiny input value and use it on the R side:</p>
<p></p>
<div class="sourceCode" id="cb1071"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb1071-1"><a href="going-further-webdev.html#cb1071-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> VdpWidget <span class="op">=</span> (props<span class="op">,</span> { $f7<span class="op">,</span> $update}) <span class="kw">=&gt;</span> {</span>
<span id="cb1071-2"><a href="going-further-webdev.html#cb1071-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Handle range change for ODE model computation</span></span>
<span id="cb1071-3"><a href="going-further-webdev.html#cb1071-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> getRangeValue <span class="op">=</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb1071-4"><a href="going-further-webdev.html#cb1071-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> range <span class="op">=</span> $f7<span class="op">.</span><span class="at">range</span><span class="op">.</span><span class="fu">get</span>(e<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb1071-5"><a href="going-further-webdev.html#cb1071-5" aria-hidden="true" tabindex="-1"></a>    Shiny<span class="op">.</span><span class="fu">setInputValue</span>(range<span class="op">.</span><span class="at">el</span><span class="op">.</span><span class="at">id</span><span class="op">,</span> range<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb1071-6"><a href="going-further-webdev.html#cb1071-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$update</span>()<span class="op">;</span></span>
<span id="cb1071-7"><a href="going-further-webdev.html#cb1071-7" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb1071-8"><a href="going-further-webdev.html#cb1071-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1071-9"><a href="going-further-webdev.html#cb1071-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> () <span class="kw">=&gt;</span> (</span>
<span id="cb1071-10"><a href="going-further-webdev.html#cb1071-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;div&gt;</span></span>
<span id="cb1071-11"><a href="going-further-webdev.html#cb1071-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"block-title"</span><span class="kw">&gt;</span>Parameter value (mu)<span class="kw">&lt;/div&gt;</span></span>
<span id="cb1071-12"><a href="going-further-webdev.html#cb1071-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"block"</span><span class="kw">&gt;</span></span>
<span id="cb1071-13"><a href="going-further-webdev.html#cb1071-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;div</span></span>
<span id="cb1071-14"><a href="going-further-webdev.html#cb1071-14" aria-hidden="true" tabindex="-1"></a>          <span class="ot">class</span><span class="op">=</span><span class="st">"range-slider range-slider-init"</span></span>
<span id="cb1071-15"><a href="going-further-webdev.html#cb1071-15" aria-hidden="true" tabindex="-1"></a>          <span class="ot">data-min</span><span class="op">=</span><span class="st">"0"</span></span>
<span id="cb1071-16"><a href="going-further-webdev.html#cb1071-16" aria-hidden="true" tabindex="-1"></a>          <span class="ot">data-min</span><span class="op">=</span><span class="st">"0"</span></span>
<span id="cb1071-17"><a href="going-further-webdev.html#cb1071-17" aria-hidden="true" tabindex="-1"></a>          <span class="ot">data-max</span><span class="op">=</span><span class="st">"2"</span></span>
<span id="cb1071-18"><a href="going-further-webdev.html#cb1071-18" aria-hidden="true" tabindex="-1"></a>          <span class="ot">data-step</span><span class="op">=</span><span class="st">"0.1"</span></span>
<span id="cb1071-19"><a href="going-further-webdev.html#cb1071-19" aria-hidden="true" tabindex="-1"></a>          <span class="ot">data-label</span><span class="op">=</span><span class="st">"true"</span></span>
<span id="cb1071-20"><a href="going-further-webdev.html#cb1071-20" aria-hidden="true" tabindex="-1"></a>          <span class="ot">data-value</span><span class="op">=</span><span class="st">"0.1"</span></span>
<span id="cb1071-21"><a href="going-further-webdev.html#cb1071-21" aria-hidden="true" tabindex="-1"></a>          <span class="ot">data-scale</span><span class="op">=</span><span class="st">"true"</span></span>
<span id="cb1071-22"><a href="going-further-webdev.html#cb1071-22" aria-hidden="true" tabindex="-1"></a>          <span class="ot">data-scale-steps</span><span class="op">=</span><span class="st">"2"</span></span>
<span id="cb1071-23"><a href="going-further-webdev.html#cb1071-23" aria-hidden="true" tabindex="-1"></a>          <span class="ot">data-scale-sub-steps</span><span class="op">=</span><span class="st">"10"</span></span>
<span id="cb1071-24"><a href="going-further-webdev.html#cb1071-24" aria-hidden="true" tabindex="-1"></a>          <span class="ot">id</span><span class="op">=</span><span class="st">"mu"</span></span>
<span id="cb1071-25"><a href="going-further-webdev.html#cb1071-25" aria-hidden="true" tabindex="-1"></a>          <span class="ot">onrangeChange</span><span class="op">=</span><span class="va">{</span>(e) <span class="kw">=&gt;</span> <span class="fu">getRangeValue</span>(e)<span class="va">}</span></span>
<span id="cb1071-26"><a href="going-further-webdev.html#cb1071-26" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&gt;&lt;/div&gt;</span></span>
<span id="cb1071-27"><a href="going-further-webdev.html#cb1071-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;/div&gt;</span>  </span>
<span id="cb1071-28"><a href="going-further-webdev.html#cb1071-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1071-29"><a href="going-further-webdev.html#cb1071-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1071-30"><a href="going-further-webdev.html#cb1071-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1071-31"><a href="going-further-webdev.html#cb1071-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1071-32"><a href="going-further-webdev.html#cb1071-32" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> { VdpWidget }<span class="op">;</span></span></code></pre></div>
<p></p>
<p>Inside <code>./srcjs/components/app.f7.jsx</code>, we import the newly designed component and replace <code>{content}</code>:</p>
<p></p>
<div class="sourceCode" id="cb1072"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb1072-1"><a href="going-further-webdev.html#cb1072-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> VdpWidget <span class="im">from</span> <span class="st">'./vdp.f7.jsx'</span><span class="op">;</span></span>
<span id="cb1072-2"><a href="going-further-webdev.html#cb1072-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1072-3"><a href="going-further-webdev.html#cb1072-3" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> (props) <span class="kw">=&gt;</span> {</span>
<span id="cb1072-4"><a href="going-further-webdev.html#cb1072-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> title <span class="op">=</span> <span class="st">'Hello World'</span><span class="op">;</span></span>
<span id="cb1072-5"><a href="going-further-webdev.html#cb1072-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1072-6"><a href="going-further-webdev.html#cb1072-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> () <span class="kw">=&gt;</span> (</span>
<span id="cb1072-7"><a href="going-further-webdev.html#cb1072-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;div</span> <span class="ot">id</span><span class="op">=</span><span class="st">"app"</span><span class="kw">&gt;</span></span>
<span id="cb1072-8"><a href="going-further-webdev.html#cb1072-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"view view-main view-init safe-areas"</span><span class="kw">&gt;</span></span>
<span id="cb1072-9"><a href="going-further-webdev.html#cb1072-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"page"</span><span class="kw">&gt;</span></span>
<span id="cb1072-10"><a href="going-further-webdev.html#cb1072-10" aria-hidden="true" tabindex="-1"></a>          <span class="er">&lt;</span>!-- Navbar --&gt;</span>
<span id="cb1072-11"><a href="going-further-webdev.html#cb1072-11" aria-hidden="true" tabindex="-1"></a>          <span class="er">&lt;</span>!-- Toolbar --&gt;</span>
<span id="cb1072-12"><a href="going-further-webdev.html#cb1072-12" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"page-content"</span><span class="kw">&gt;</span></span>
<span id="cb1072-13"><a href="going-further-webdev.html#cb1072-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">&lt;VdpWidget</span> <span class="ot">label</span><span class="op">=</span><span class="st">"Van der Pol Model"</span><span class="fu">/&gt;</span></span>
<span id="cb1072-14"><a href="going-further-webdev.html#cb1072-14" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1072-15"><a href="going-further-webdev.html#cb1072-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1072-16"><a href="going-further-webdev.html#cb1072-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1072-17"><a href="going-further-webdev.html#cb1072-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1072-18"><a href="going-further-webdev.html#cb1072-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1072-19"><a href="going-further-webdev.html#cb1072-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>On the R side, you may add this in the server code to track the range value:</p>
<p></p>
<div class="sourceCode" id="cb1073"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">mu</span>, <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">mu</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p></p>
<p>After recompiling, this gives us Figure <a href="going-further-webdev.html#fig:vdpMod-basic-app-3">28.6</a>.</p>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:vdpMod-basic-app-3"></span>
<img src="images/going-further/vdpMod-basic-app-3.png" alt="vdpMod basic app with range slider." width="40%"><p class="caption">
FIGURE 28.6: vdpMod basic app with range slider.
</p>
</div>
<p></p>
<p>Youâ€™ll notice that <code>input$mu</code> only exist after the range is dragged. To give it an initial value, we design an additional function, <code>initializeVdpWidget</code> located in <code>./srcjs/components/vdp.f7.jsx</code>, taking the app instance as parameter. Inside, we listen to the <code>shiny:connected</code>, create <code>input$mu</code> giving it the initial range value. We finally export the new function:</p>
<p></p>
<div class="sourceCode" id="cb1074"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1074-1"><a href="going-further-webdev.html#cb1074-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> initializeVdpWidget <span class="op">=</span> (app) <span class="kw">=&gt;</span> {</span>
<span id="cb1074-2"><a href="going-further-webdev.html#cb1074-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(<span class="bu">document</span>)<span class="op">.</span><span class="fu">on</span>(<span class="st">'shiny:connected'</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1074-3"><a href="going-further-webdev.html#cb1074-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Init vals for ODE model computation</span></span>
<span id="cb1074-4"><a href="going-further-webdev.html#cb1074-4" aria-hidden="true" tabindex="-1"></a>    Shiny<span class="op">.</span><span class="fu">setInputValue</span>(</span>
<span id="cb1074-5"><a href="going-further-webdev.html#cb1074-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">'mu'</span><span class="op">,</span> </span>
<span id="cb1074-6"><a href="going-further-webdev.html#cb1074-6" aria-hidden="true" tabindex="-1"></a>      <span class="pp">parseFloat</span>(<span class="fu">$</span>(<span class="st">'#mu'</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">'data-value'</span>)<span class="op">,</span> <span class="dv">10</span>)<span class="op">,</span> </span>
<span id="cb1074-7"><a href="going-further-webdev.html#cb1074-7" aria-hidden="true" tabindex="-1"></a>      {<span class="dt">priority</span><span class="op">:</span> <span class="st">'event'</span>}</span>
<span id="cb1074-8"><a href="going-further-webdev.html#cb1074-8" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb1074-9"><a href="going-further-webdev.html#cb1074-9" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1074-10"><a href="going-further-webdev.html#cb1074-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1074-11"><a href="going-further-webdev.html#cb1074-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1074-12"><a href="going-further-webdev.html#cb1074-12" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> { VdpWidget<span class="op">,</span> initializeVdpWidget }<span class="op">;</span></span></code></pre></div>
<p></p>
<p>Inside <code>./srcjs/components/app.f7.jsx</code>, we update our import field, passing an extra parameter <code>$f7</code> which captures the app instance required by <code>initializeVdpWidget</code>:</p>
<p></p>
<div class="sourceCode" id="cb1075"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1075-1"><a href="going-further-webdev.html#cb1075-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { VdpWidget<span class="op">,</span> initializeVdpWidget } <span class="im">from</span> <span class="st">'./vdp.f7.jsx'</span><span class="op">;</span></span>
<span id="cb1075-2"><a href="going-further-webdev.html#cb1075-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> (props<span class="op">,</span> { $f7 }) <span class="kw">=&gt;</span> {</span>
<span id="cb1075-3"><a href="going-further-webdev.html#cb1075-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1075-4"><a href="going-further-webdev.html#cb1075-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">initializeVdpWidget</span>($f7)<span class="op">;</span></span>
<span id="cb1075-5"><a href="going-further-webdev.html#cb1075-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... unchanged ...</span></span>
<span id="cb1075-6"><a href="going-further-webdev.html#cb1075-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Congratulations, we are now ready to move to the last part about creating the visualization.</p>
</div>
<div id="plot-model-data-with-echartsjs" class="section level4" number="28.3.6.4">
<h4>
<span class="header-section-number">28.3.6.4</span> Plot model data with echartsjs<a class="anchor" aria-label="anchor" href="#plot-model-data-with-echartsjs"><i class="fas fa-link"></i></a>
</h4>
<p>As stated above, we leverage echarts and echarts-gl to plot the model results. Like for other dependencies, we have to import them, specifically in the <code>./srcjs/components/vdp.f7.jsx</code> component:</p>
<p></p>
<div class="sourceCode" id="cb1076"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1076-1"><a href="going-further-webdev.html#cb1076-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Import plotting library</span></span>
<span id="cb1076-2"><a href="going-further-webdev.html#cb1076-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> echarts <span class="im">from</span> <span class="st">'echarts'</span><span class="op">;</span></span>
<span id="cb1076-3"><a href="going-further-webdev.html#cb1076-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="st">'echarts-gl'</span><span class="op">;</span></span></code></pre></div>
<p></p>
<p>To work properly, <a href="https://echarts.apache.org/handbook/en/get-started/">echarts</a> requires to setup an HTML empty container in the DOM with height and width in pixels, as well as an <strong>id</strong>. I recommend using percentage for width so as to fill the entire parent container:</p>
<p></p>
<div class="sourceCode" id="cb1077"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb1077-1"><a href="going-further-webdev.html#cb1077-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;div</span> <span class="er">id</span><span class="ot">=</span><span class="st">"my-plot"</span> <span class="er">style</span><span class="ot">=</span><span class="st">"width:100%; min-height:400px;"</span><span class="kw">&gt;&lt;/div&gt;</span></span></code></pre></div>
<p></p>
<p>On the JS side, we instantiate the plot and set the options list to give it a title, set the axis labels, add the time series:</p>
<p></p>
<div class="sourceCode" id="cb1078"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1078-1"><a href="going-further-webdev.html#cb1078-1" aria-hidden="true" tabindex="-1"></a>myChart <span class="op">=</span> echarts<span class="op">.</span><span class="fu">init</span>(<span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'my-plot'</span>))<span class="op">;</span></span>
<span id="cb1078-2"><a href="going-further-webdev.html#cb1078-2" aria-hidden="true" tabindex="-1"></a>myChartOptions <span class="op">=</span> {</span>
<span id="cb1078-3"><a href="going-further-webdev.html#cb1078-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> { <span class="dt">text</span><span class="op">:</span> <span class="st">'Plot title'</span> }<span class="op">,</span></span>
<span id="cb1078-4"><a href="going-further-webdev.html#cb1078-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">legend</span><span class="op">:</span> { <span class="dt">data</span><span class="op">:</span>[<span class="op">...</span>] }<span class="op">,</span></span>
<span id="cb1078-5"><a href="going-further-webdev.html#cb1078-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">xAxis</span><span class="op">:</span> { <span class="dt">data</span><span class="op">:</span> <span class="op">...</span>}<span class="op">,</span></span>
<span id="cb1078-6"><a href="going-further-webdev.html#cb1078-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">yAxis</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="op">...</span> }<span class="op">,</span></span>
<span id="cb1078-7"><a href="going-further-webdev.html#cb1078-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">series</span><span class="op">:</span> [</span>
<span id="cb1078-8"><a href="going-further-webdev.html#cb1078-8" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1078-9"><a href="going-further-webdev.html#cb1078-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="op">...,</span></span>
<span id="cb1078-10"><a href="going-further-webdev.html#cb1078-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="op">...,</span></span>
<span id="cb1078-11"><a href="going-further-webdev.html#cb1078-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">data</span><span class="op">:</span> <span class="op">...</span></span>
<span id="cb1078-12"><a href="going-further-webdev.html#cb1078-12" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1078-13"><a href="going-further-webdev.html#cb1078-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// other data</span></span>
<span id="cb1078-14"><a href="going-further-webdev.html#cb1078-14" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb1078-15"><a href="going-further-webdev.html#cb1078-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb1078-16"><a href="going-further-webdev.html#cb1078-16" aria-hidden="true" tabindex="-1"></a>myChart<span class="op">.</span><span class="fu">setOption</span>(myChartOptions)<span class="op">;</span></span></code></pre></div>
<p></p>
<p>Obviously, many more options exist, but this is enough for this example.
We edit the <code>VdpWidget</code> render function to include the time series plot of model solution, below the range slider:</p>
<p></p>
<div class="sourceCode" id="cb1079"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb1079-1"><a href="going-further-webdev.html#cb1079-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> VdpWidget <span class="op">=</span> (props<span class="op">,</span> { $f7<span class="op">,</span> $update}) <span class="kw">=&gt;</span> {</span>
<span id="cb1079-2"><a href="going-further-webdev.html#cb1079-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... unchanged ...</span></span>
<span id="cb1079-3"><a href="going-further-webdev.html#cb1079-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1079-4"><a href="going-further-webdev.html#cb1079-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotStyle <span class="op">=</span> {</span>
<span id="cb1079-5"><a href="going-further-webdev.html#cb1079-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="st">'100%'</span><span class="op">,</span></span>
<span id="cb1079-6"><a href="going-further-webdev.html#cb1079-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minHeight</span><span class="op">:</span> <span class="st">'400px'</span></span>
<span id="cb1079-7"><a href="going-further-webdev.html#cb1079-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1079-8"><a href="going-further-webdev.html#cb1079-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1079-9"><a href="going-further-webdev.html#cb1079-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> () <span class="kw">=&gt;</span> (</span>
<span id="cb1079-10"><a href="going-further-webdev.html#cb1079-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;div&gt;</span></span>
<span id="cb1079-11"><a href="going-further-webdev.html#cb1079-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"block-title"</span><span class="kw">&gt;</span><span class="va">{</span>props<span class="op">.</span><span class="at">label</span><span class="va">}</span><span class="kw">&lt;/div&gt;</span></span>
<span id="cb1079-12"><a href="going-further-webdev.html#cb1079-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"block block-strong text-align-center"</span><span class="kw">&gt;</span></span>
<span id="cb1079-13"><a href="going-further-webdev.html#cb1079-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;p&gt;</span>The below model is computed by R!<span class="kw">&lt;/p&gt;</span></span>
<span id="cb1079-14"><a href="going-further-webdev.html#cb1079-14" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>!-- range slider block --&gt;</span>
<span id="cb1079-15"><a href="going-further-webdev.html#cb1079-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1079-16"><a href="going-further-webdev.html#cb1079-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"card card-outline"</span><span class="kw">&gt;</span></span>
<span id="cb1079-17"><a href="going-further-webdev.html#cb1079-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"card-content card-content-padding"</span><span class="kw">&gt;</span></span>
<span id="cb1079-18"><a href="going-further-webdev.html#cb1079-18" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;div</span> <span class="ot">id</span><span class="op">=</span><span class="st">"line-plot"</span> <span class="ot">style</span><span class="op">=</span><span class="va">{</span>plotStyle<span class="va">}</span><span class="kw">&gt;&lt;/div&gt;</span></span>
<span id="cb1079-19"><a href="going-further-webdev.html#cb1079-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1079-20"><a href="going-further-webdev.html#cb1079-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1079-21"><a href="going-further-webdev.html#cb1079-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1079-22"><a href="going-further-webdev.html#cb1079-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1079-23"><a href="going-further-webdev.html#cb1079-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>The initialization happens once, thatâ€™s why we include it inside the existing <code>shiny:connect</code> event listener in the <code>initializeVdpWidget</code> function. Notice how we make the plot responsive to any viewport change, by calling the echarts <code>resize</code> method when the window is resized:</p>
<p></p>
<div class="sourceCode" id="cb1080"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1080-1"><a href="going-further-webdev.html#cb1080-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> initializeVdpWidget <span class="op">=</span> (app) <span class="kw">=&gt;</span> {</span>
<span id="cb1080-2"><a href="going-further-webdev.html#cb1080-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> linePlot<span class="op">;</span></span>
<span id="cb1080-3"><a href="going-further-webdev.html#cb1080-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(<span class="bu">document</span>)<span class="op">.</span><span class="fu">on</span>(<span class="st">'shiny:connected'</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1080-4"><a href="going-further-webdev.html#cb1080-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... unchanged ...</span></span>
<span id="cb1080-5"><a href="going-further-webdev.html#cb1080-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// prepare echarts plots</span></span>
<span id="cb1080-6"><a href="going-further-webdev.html#cb1080-6" aria-hidden="true" tabindex="-1"></a>    linePlot <span class="op">=</span> echarts<span class="op">.</span><span class="fu">init</span>(<span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'line-plot'</span>))<span class="op">;</span></span>
<span id="cb1080-7"><a href="going-further-webdev.html#cb1080-7" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1080-8"><a href="going-further-webdev.html#cb1080-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1080-9"><a href="going-further-webdev.html#cb1080-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Resize plot, responsive</span></span>
<span id="cb1080-10"><a href="going-further-webdev.html#cb1080-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(<span class="bu">window</span>)<span class="op">.</span><span class="fu">on</span>(<span class="st">'resize'</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb1080-11"><a href="going-further-webdev.html#cb1080-11" aria-hidden="true" tabindex="-1"></a>    linePlot<span class="op">.</span><span class="fu">resize</span>()<span class="op">;</span></span>
<span id="cb1080-12"><a href="going-further-webdev.html#cb1080-12" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1080-13"><a href="going-further-webdev.html#cb1080-13" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p></p>
<p>The next step is to recover the model data sent from R with the <code>session$sendCustomMessage("model-data", ...)</code> in <code>./R/app_server.R</code>. We create a dedicated message handler on the JS side still in <code>initializeVdpWidget</code>. As a reminder, since we send a list from R, items are accessed with <code>message.&lt;FIELD&gt;</code> in JS:</p>
<p></p>
<div class="sourceCode" id="cb1081"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1081-1"><a href="going-further-webdev.html#cb1081-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> initializeVdpWidget <span class="op">=</span> (app) <span class="kw">=&gt;</span> {</span>
<span id="cb1081-2"><a href="going-further-webdev.html#cb1081-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... shiny:connected ...</span></span>
<span id="cb1081-3"><a href="going-further-webdev.html#cb1081-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1081-4"><a href="going-further-webdev.html#cb1081-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Recover ODE data from R</span></span>
<span id="cb1081-5"><a href="going-further-webdev.html#cb1081-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> lineData<span class="op">,</span> linePlotOptions<span class="op">;</span></span>
<span id="cb1081-6"><a href="going-further-webdev.html#cb1081-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1081-7"><a href="going-further-webdev.html#cb1081-7" aria-hidden="true" tabindex="-1"></a>  Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(</span>
<span id="cb1081-8"><a href="going-further-webdev.html#cb1081-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'model-data'</span><span class="op">,</span> (message) <span class="kw">=&gt;</span> {</span>
<span id="cb1081-9"><a href="going-further-webdev.html#cb1081-9" aria-hidden="true" tabindex="-1"></a>      lineData <span class="op">=</span> message<span class="op">.</span><span class="at">lineData</span><span class="op">;</span></span>
<span id="cb1081-10"><a href="going-further-webdev.html#cb1081-10" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1081-11"><a href="going-further-webdev.html#cb1081-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>We set the plot options. For the time series chart, weâ€™ll display the solution X (<code>lineData['X']</code>) and Y (<code>lineData['Y']</code>) as a function of time (<code>lineData['t']</code>). The plot type is <code>line</code>:</p>
<p></p>
<div class="sourceCode" id="cb1082"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1082-1"><a href="going-further-webdev.html#cb1082-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> initializeVdpWidget <span class="op">=</span> (app) <span class="kw">=&gt;</span> {</span>
<span id="cb1082-2"><a href="going-further-webdev.html#cb1082-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... shiny:connected ...</span></span>
<span id="cb1082-3"><a href="going-further-webdev.html#cb1082-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1082-4"><a href="going-further-webdev.html#cb1082-4" aria-hidden="true" tabindex="-1"></a>  Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(</span>
<span id="cb1082-5"><a href="going-further-webdev.html#cb1082-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'model-data'</span><span class="op">,</span> (message) <span class="kw">=&gt;</span> {</span>
<span id="cb1082-6"><a href="going-further-webdev.html#cb1082-6" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ... recover data ...</span></span>
<span id="cb1082-7"><a href="going-further-webdev.html#cb1082-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1082-8"><a href="going-further-webdev.html#cb1082-8" aria-hidden="true" tabindex="-1"></a>      <span class="co">// set options</span></span>
<span id="cb1082-9"><a href="going-further-webdev.html#cb1082-9" aria-hidden="true" tabindex="-1"></a>      linePlotOptions <span class="op">=</span> {</span>
<span id="cb1082-10"><a href="going-further-webdev.html#cb1082-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb1082-11"><a href="going-further-webdev.html#cb1082-11" aria-hidden="true" tabindex="-1"></a>          <span class="dt">text</span><span class="op">:</span> <span class="st">'Time series plot'</span></span>
<span id="cb1082-12"><a href="going-further-webdev.html#cb1082-12" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb1082-13"><a href="going-further-webdev.html#cb1082-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">legend</span><span class="op">:</span> { <span class="dt">data</span><span class="op">:</span> [<span class="st">'X'</span><span class="op">,</span> <span class="st">'Y'</span>] }<span class="op">,</span></span>
<span id="cb1082-14"><a href="going-further-webdev.html#cb1082-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">xAxis</span><span class="op">:</span> { <span class="dt">data</span><span class="op">:</span> lineData[<span class="st">'t'</span>] }<span class="op">,</span></span>
<span id="cb1082-15"><a href="going-further-webdev.html#cb1082-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">yAxis</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">'value'</span> }<span class="op">,</span></span>
<span id="cb1082-16"><a href="going-further-webdev.html#cb1082-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">series</span><span class="op">:</span> [</span>
<span id="cb1082-17"><a href="going-further-webdev.html#cb1082-17" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb1082-18"><a href="going-further-webdev.html#cb1082-18" aria-hidden="true" tabindex="-1"></a>            <span class="dt">name</span><span class="op">:</span> <span class="st">'X'</span><span class="op">,</span></span>
<span id="cb1082-19"><a href="going-further-webdev.html#cb1082-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">type</span><span class="op">:</span> <span class="st">'line'</span><span class="op">,</span></span>
<span id="cb1082-20"><a href="going-further-webdev.html#cb1082-20" aria-hidden="true" tabindex="-1"></a>            <span class="dt">data</span><span class="op">:</span> lineData[<span class="st">'X'</span>]</span>
<span id="cb1082-21"><a href="going-further-webdev.html#cb1082-21" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb1082-22"><a href="going-further-webdev.html#cb1082-22" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb1082-23"><a href="going-further-webdev.html#cb1082-23" aria-hidden="true" tabindex="-1"></a>            <span class="dt">name</span><span class="op">:</span> <span class="st">'Y'</span><span class="op">,</span></span>
<span id="cb1082-24"><a href="going-further-webdev.html#cb1082-24" aria-hidden="true" tabindex="-1"></a>            <span class="dt">type</span><span class="op">:</span> <span class="st">'line'</span><span class="op">,</span></span>
<span id="cb1082-25"><a href="going-further-webdev.html#cb1082-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">data</span><span class="op">:</span> lineData[<span class="st">'Y'</span>]</span>
<span id="cb1082-26"><a href="going-further-webdev.html#cb1082-26" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb1082-27"><a href="going-further-webdev.html#cb1082-27" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1082-28"><a href="going-further-webdev.html#cb1082-28" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb1082-29"><a href="going-further-webdev.html#cb1082-29" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1082-30"><a href="going-further-webdev.html#cb1082-30" aria-hidden="true" tabindex="-1"></a>      <span class="co">// use configuration item and data specified to show chart</span></span>
<span id="cb1082-31"><a href="going-further-webdev.html#cb1082-31" aria-hidden="true" tabindex="-1"></a>      linePlot<span class="op">.</span><span class="fu">setOption</span>(linePlotOptions)<span class="op">;</span></span>
<span id="cb1082-32"><a href="going-further-webdev.html#cb1082-32" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1082-33"><a href="going-further-webdev.html#cb1082-33" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>We finally leverage the Framework7 toast API to send a message to the user, telling the model is up to date:</p>
<p></p>
<div class="sourceCode" id="cb1083"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1083-1"><a href="going-further-webdev.html#cb1083-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> initializeVdpWidget <span class="op">=</span> (app) <span class="kw">=&gt;</span> {</span>
<span id="cb1083-2"><a href="going-further-webdev.html#cb1083-2" aria-hidden="true" tabindex="-1"></a>  Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(</span>
<span id="cb1083-3"><a href="going-further-webdev.html#cb1083-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'model-data'</span><span class="op">,</span> (message) <span class="kw">=&gt;</span> {</span>
<span id="cb1083-4"><a href="going-further-webdev.html#cb1083-4" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ... plot config ...</span></span>
<span id="cb1083-5"><a href="going-further-webdev.html#cb1083-5" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1083-6"><a href="going-further-webdev.html#cb1083-6" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Notify plot update</span></span>
<span id="cb1083-7"><a href="going-further-webdev.html#cb1083-7" aria-hidden="true" tabindex="-1"></a>      app<span class="op">.</span><span class="at">toast</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb1083-8"><a href="going-further-webdev.html#cb1083-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> <span class="st">'Model successfuly computed'</span><span class="op">,</span></span>
<span id="cb1083-9"><a href="going-further-webdev.html#cb1083-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">closeTimeout</span><span class="op">:</span> <span class="dv">2000</span><span class="op">,</span></span>
<span id="cb1083-10"><a href="going-further-webdev.html#cb1083-10" aria-hidden="true" tabindex="-1"></a>      })<span class="op">.</span><span class="fu">open</span>()<span class="op">;</span></span>
<span id="cb1083-11"><a href="going-further-webdev.html#cb1083-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1083-12"><a href="going-further-webdev.html#cb1083-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>After rebuilding the JS code, you should get Figure <a href="going-further-webdev.html#fig:vdpMod-basic-app-4">28.7</a>.</p>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:vdpMod-basic-app-4"></span>
<img src="images/going-further/vdpMod-basic-app-4.png" alt="vdpMod basic app with time series output." width="40%"><p class="caption">
FIGURE 28.7: vdpMod basic app with time series output.
</p>
</div>
<p></p>
</div>
<div id="exercise-add-the-phase-portrait" class="section level4" number="28.3.6.5">
<h4>
<span class="header-section-number">28.3.6.5</span> Exercise: add the phase portrait<a class="anchor" aria-label="anchor" href="#exercise-add-the-phase-portrait"><i class="fas fa-link"></i></a>
</h4>
<p>Based on the example shown <a href="https://echarts.apache.org/examples/en/editor.html?c=flowGL-noise&amp;gl=1&amp;theme=dark">here</a>, youâ€™ll have to add the phase portrait chart to the current application.</p>
<ol style="list-style-type: decimal">
<li>In <code>VdpWidget</code>, add the card container that will hold the phase plan, right after the time series card. The plot will have the <code>phase-plot</code> id:</li>
</ol>
<p></p>
<div class="sourceCode" id="cb1084"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb1084-1"><a href="going-further-webdev.html#cb1084-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> VdpWidget <span class="op">=</span> (props<span class="op">,</span> { $f7<span class="op">,</span> $update}) <span class="kw">=&gt;</span> {</span>
<span id="cb1084-2"><a href="going-further-webdev.html#cb1084-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... getRangeValue ...</span></span>
<span id="cb1084-3"><a href="going-further-webdev.html#cb1084-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... plotStyle ...</span></span>
<span id="cb1084-4"><a href="going-further-webdev.html#cb1084-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> () <span class="kw">=&gt;</span> (</span>
<span id="cb1084-5"><a href="going-further-webdev.html#cb1084-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;div&gt;</span></span>
<span id="cb1084-6"><a href="going-further-webdev.html#cb1084-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"block-title"</span><span class="kw">&gt;</span><span class="va">{</span>props<span class="op">.</span><span class="at">label</span><span class="va">}</span><span class="kw">&lt;/div&gt;</span></span>
<span id="cb1084-7"><a href="going-further-webdev.html#cb1084-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;div</span> <span class="ot">class</span><span class="op">=</span><span class="st">"block block-strong text-align-center"</span><span class="kw">&gt;</span></span>
<span id="cb1084-8"><a href="going-further-webdev.html#cb1084-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;p&gt;</span>The below model is computed by R!<span class="kw">&lt;/p&gt;</span></span>
<span id="cb1084-9"><a href="going-further-webdev.html#cb1084-9" aria-hidden="true" tabindex="-1"></a>        <span class="er">&lt;</span>!-- range slider block --&gt;</span>
<span id="cb1084-10"><a href="going-further-webdev.html#cb1084-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1084-11"><a href="going-further-webdev.html#cb1084-11" aria-hidden="true" tabindex="-1"></a>      <span class="er">&lt;</span>!-- line plot --&gt;</span>
<span id="cb1084-12"><a href="going-further-webdev.html#cb1084-12" aria-hidden="true" tabindex="-1"></a>      TO ADD</span>
<span id="cb1084-13"><a href="going-further-webdev.html#cb1084-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1084-14"><a href="going-further-webdev.html#cb1084-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1084-15"><a href="going-further-webdev.html#cb1084-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<ol start="2" style="list-style-type: decimal">
<li>In <code>initializeVdpWidget</code>, inside the <code>shiny:connected</code> event listener,
initialize the new <code>phasePlot</code> instance. Fill in the <code>...</code>.</li>
</ol>
<p></p>
<div class="sourceCode" id="cb1085"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1085-1"><a href="going-further-webdev.html#cb1085-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> initializeVdpWidget <span class="op">=</span> (app) <span class="kw">=&gt;</span> {</span>
<span id="cb1085-2"><a href="going-further-webdev.html#cb1085-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> linePlot<span class="op">,</span> <span class="op">...;</span></span>
<span id="cb1085-3"><a href="going-further-webdev.html#cb1085-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(<span class="bu">document</span>)<span class="op">.</span><span class="fu">on</span>(<span class="st">'shiny:connected'</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1085-4"><a href="going-further-webdev.html#cb1085-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... Init vals for ODE model computation ...</span></span>
<span id="cb1085-5"><a href="going-further-webdev.html#cb1085-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... Time series plot init ...</span></span>
<span id="cb1085-6"><a href="going-further-webdev.html#cb1085-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span> <span class="op">=</span> echarts<span class="op">.</span><span class="fu">init</span>(<span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="op">...</span>))<span class="op">;</span></span>
<span id="cb1085-7"><a href="going-further-webdev.html#cb1085-7" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1085-8"><a href="going-further-webdev.html#cb1085-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb1085-9"><a href="going-further-webdev.html#cb1085-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<ol start="3" style="list-style-type: decimal">
<li>Ensure it is properly resized by adding an entry to the <code>resize</code> event listener. Fill in the <code>...</code>.</li>
</ol>
<p></p>
<div class="sourceCode" id="cb1086"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1086-1"><a href="going-further-webdev.html#cb1086-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> initializeVdpWidget <span class="op">=</span> (app) <span class="kw">=&gt;</span> {</span>
<span id="cb1086-2"><a href="going-further-webdev.html#cb1086-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1086-3"><a href="going-further-webdev.html#cb1086-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">//... shiny:connected ...</span></span>
<span id="cb1086-4"><a href="going-further-webdev.html#cb1086-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1086-5"><a href="going-further-webdev.html#cb1086-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(<span class="bu">window</span>)<span class="op">.</span><span class="fu">on</span>(<span class="st">'resize'</span><span class="op">,</span> <span class="kw">function</span>(){</span>
<span id="cb1086-6"><a href="going-further-webdev.html#cb1086-6" aria-hidden="true" tabindex="-1"></a>    linePlot<span class="op">.</span><span class="fu">resize</span>()<span class="op">;</span></span>
<span id="cb1086-7"><a href="going-further-webdev.html#cb1086-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">....</span><span class="fu">resize</span>()<span class="op">;</span></span>
<span id="cb1086-8"><a href="going-further-webdev.html#cb1086-8" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1086-9"><a href="going-further-webdev.html#cb1086-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1086-10"><a href="going-further-webdev.html#cb1086-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<ol start="4" style="list-style-type: decimal">
<li>In <code>initializeVdpWidget</code>, after the <code>linePlotOptions</code>, create a new
<code>phasePlotOptions</code> object containing the plot title. Fill in the <code>...</code>.</li>
</ol>
<p></p>
<div class="sourceCode" id="cb1087"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1087-1"><a href="going-further-webdev.html#cb1087-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> initializeVdpWidget <span class="op">=</span> (app) <span class="kw">=&gt;</span> {</span>
<span id="cb1087-2"><a href="going-further-webdev.html#cb1087-2" aria-hidden="true" tabindex="-1"></a> <span class="co">// ... shiny:connected ...</span></span>
<span id="cb1087-3"><a href="going-further-webdev.html#cb1087-3" aria-hidden="true" tabindex="-1"></a> <span class="co">// ... resize plots ...</span></span>
<span id="cb1087-4"><a href="going-further-webdev.html#cb1087-4" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> lineData<span class="op">,</span> linePlotOptions<span class="op">,</span> phasePlotOptions<span class="op">,</span> </span>
<span id="cb1087-5"><a href="going-further-webdev.html#cb1087-5" aria-hidden="true" tabindex="-1"></a> phaseData<span class="op">,</span> trajectoryData<span class="op">;</span></span>
<span id="cb1087-6"><a href="going-further-webdev.html#cb1087-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1087-7"><a href="going-further-webdev.html#cb1087-7" aria-hidden="true" tabindex="-1"></a> Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(</span>
<span id="cb1087-8"><a href="going-further-webdev.html#cb1087-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'model-data'</span><span class="op">,</span> (message) <span class="kw">=&gt;</span> {</span>
<span id="cb1087-9"><a href="going-further-webdev.html#cb1087-9" aria-hidden="true" tabindex="-1"></a>    lineData <span class="op">=</span> message<span class="op">.</span><span class="at">lineData</span><span class="op">;</span></span>
<span id="cb1087-10"><a href="going-further-webdev.html#cb1087-10" aria-hidden="true" tabindex="-1"></a>    phaseData <span class="op">=</span> message<span class="op">.</span><span class="at">phaseData</span><span class="op">;</span></span>
<span id="cb1087-11"><a href="going-further-webdev.html#cb1087-11" aria-hidden="true" tabindex="-1"></a>    trajectoryData <span class="op">=</span> message<span class="op">.</span><span class="at">trajectoryData</span><span class="op">;</span></span>
<span id="cb1087-12"><a href="going-further-webdev.html#cb1087-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1087-13"><a href="going-further-webdev.html#cb1087-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span> <span class="op">=</span> {</span>
<span id="cb1087-14"><a href="going-further-webdev.html#cb1087-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb1087-15"><a href="going-further-webdev.html#cb1087-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> <span class="st">'Phase plot'</span></span>
<span id="cb1087-16"><a href="going-further-webdev.html#cb1087-16" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb1087-17"><a href="going-further-webdev.html#cb1087-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">xAxis</span><span class="op">:</span> {</span>
<span id="cb1087-18"><a href="going-further-webdev.html#cb1087-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">'value'</span></span>
<span id="cb1087-19"><a href="going-further-webdev.html#cb1087-19" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb1087-20"><a href="going-further-webdev.html#cb1087-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yAxis</span><span class="op">:</span> {</span>
<span id="cb1087-21"><a href="going-further-webdev.html#cb1087-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">'value'</span></span>
<span id="cb1087-22"><a href="going-further-webdev.html#cb1087-22" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1087-23"><a href="going-further-webdev.html#cb1087-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1087-24"><a href="going-further-webdev.html#cb1087-24" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1087-25"><a href="going-further-webdev.html#cb1087-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p>Since we plot Y against X (it was X and Y against time in the previous plot), we add two entries to the previous configuration.</p>
<ol start="5" style="list-style-type: decimal">
<li>The first layer is a flow GL chart showing particles movement in the vector field. The chosen <strong>type</strong> <code>flowGL</code> entry ensures we utilize the proper chart module. We pass the <code>phaseData</code> recovered from the R side. Other properties are responsible for controlling the particle appearance like the speed, size and transparency. You may try with different values to see what happens in the plot. Fill in the <code>...</code>.</li>
</ol>
<p></p>
<div class="sourceCode" id="cb1088"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1088-1"><a href="going-further-webdev.html#cb1088-1" aria-hidden="true" tabindex="-1"></a>phasePlotOptions <span class="op">=</span> {</span>
<span id="cb1088-2"><a href="going-further-webdev.html#cb1088-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... title, axis ...</span></span>
<span id="cb1088-3"><a href="going-further-webdev.html#cb1088-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">series</span><span class="op">:</span> [</span>
<span id="cb1088-4"><a href="going-further-webdev.html#cb1088-4" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1088-5"><a href="going-further-webdev.html#cb1088-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="op">...,</span></span>
<span id="cb1088-6"><a href="going-further-webdev.html#cb1088-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">data</span><span class="op">:</span> <span class="op">...,</span></span>
<span id="cb1088-7"><a href="going-further-webdev.html#cb1088-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">particleDensity</span><span class="op">:</span> <span class="dv">64</span><span class="op">,</span></span>
<span id="cb1088-8"><a href="going-further-webdev.html#cb1088-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">particleSize</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb1088-9"><a href="going-further-webdev.html#cb1088-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">particleSpeed</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb1088-10"><a href="going-further-webdev.html#cb1088-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">supersampling</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb1088-11"><a href="going-further-webdev.html#cb1088-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">particleType</span><span class="op">:</span> <span class="st">'point'</span><span class="op">,</span></span>
<span id="cb1088-12"><a href="going-further-webdev.html#cb1088-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">itemStyle</span><span class="op">:</span> {</span>
<span id="cb1088-13"><a href="going-further-webdev.html#cb1088-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb1088-14"><a href="going-further-webdev.html#cb1088-14" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1088-15"><a href="going-further-webdev.html#cb1088-15" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1088-16"><a href="going-further-webdev.html#cb1088-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Other series</span></span>
<span id="cb1088-17"><a href="going-further-webdev.html#cb1088-17" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb1088-18"><a href="going-further-webdev.html#cb1088-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<ol start="6" style="list-style-type: decimal">
<li>How do we control the flow chart visual aspect? As a reminder, <code>phaseData</code> is a matrix with 5 columns, the last one being a measure of the flow speed. Ideally, we would like to set up a scale representing different speeds. This is where we introduce the <strong>visualMap</strong> property, which exposes multiple sub-properties like:</li>
</ol>
<ul>
<li>
<code>show</code> to display a scale.</li>
<li>
<code>min</code> and <code>max</code> to set the color grid.</li>
<li>
<code>dimension</code> is the column of data used to apply colors (here <code>mag</code>).</li>
<li>
<code>inRange.color</code> defines a color palette for all values in the range. The provided examples default to 11 predefined colors.</li>
</ul>
<p><code>min</code> and <code>max</code> are determined as per below calculation. Fill in the <code>...</code>.</p>
<p></p>
<div class="sourceCode" id="cb1089"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1089-1"><a href="going-further-webdev.html#cb1089-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> magMin <span class="op">=</span> <span class="kw">Infinity</span><span class="op">;</span></span>
<span id="cb1089-2"><a href="going-further-webdev.html#cb1089-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> magMax <span class="op">=</span> <span class="op">-</span><span class="kw">Infinity</span><span class="op">;</span></span>
<span id="cb1089-3"><a href="going-further-webdev.html#cb1089-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> message<span class="op">.</span><span class="at">phaseData</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1089-4"><a href="going-further-webdev.html#cb1089-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> magTemp <span class="op">=</span> message<span class="op">.</span><span class="at">phaseData</span>[i][<span class="dv">4</span>]<span class="op">;</span></span>
<span id="cb1089-5"><a href="going-further-webdev.html#cb1089-5" aria-hidden="true" tabindex="-1"></a>  magMax <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...,</span> <span class="op">...</span>)<span class="op">;</span></span>
<span id="cb1089-6"><a href="going-further-webdev.html#cb1089-6" aria-hidden="true" tabindex="-1"></a>  magMin <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="op">...,</span> <span class="op">...</span>)<span class="op">;</span></span>
<span id="cb1089-7"><a href="going-further-webdev.html#cb1089-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb1090"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1090-1"><a href="going-further-webdev.html#cb1090-1" aria-hidden="true" tabindex="-1"></a>phasePlotOptions <span class="op">=</span> {</span>
<span id="cb1090-2"><a href="going-further-webdev.html#cb1090-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">visualMap</span><span class="op">:</span> {</span>
<span id="cb1090-3"><a href="going-further-webdev.html#cb1090-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">show</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb1090-4"><a href="going-further-webdev.html#cb1090-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">min</span><span class="op">:</span> <span class="op">...,</span></span>
<span id="cb1090-5"><a href="going-further-webdev.html#cb1090-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">max</span><span class="op">:</span> <span class="op">...,</span></span>
<span id="cb1090-6"><a href="going-further-webdev.html#cb1090-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">dimension</span><span class="op">:</span> <span class="op">...,</span> <span class="co">// hint: column to select in phaseData</span></span>
<span id="cb1090-7"><a href="going-further-webdev.html#cb1090-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inRange</span><span class="op">:</span> {</span>
<span id="cb1090-8"><a href="going-further-webdev.html#cb1090-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">color</span><span class="op">:</span> [</span>
<span id="cb1090-9"><a href="going-further-webdev.html#cb1090-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'#313695'</span><span class="op">,</span></span>
<span id="cb1090-10"><a href="going-further-webdev.html#cb1090-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'#4575b4'</span><span class="op">,</span></span>
<span id="cb1090-11"><a href="going-further-webdev.html#cb1090-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'#74add1'</span><span class="op">,</span></span>
<span id="cb1090-12"><a href="going-further-webdev.html#cb1090-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'#abd9e9'</span><span class="op">,</span></span>
<span id="cb1090-13"><a href="going-further-webdev.html#cb1090-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'#e0f3f8'</span><span class="op">,</span></span>
<span id="cb1090-14"><a href="going-further-webdev.html#cb1090-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'#ffffbf'</span><span class="op">,</span></span>
<span id="cb1090-15"><a href="going-further-webdev.html#cb1090-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'#fee090'</span><span class="op">,</span></span>
<span id="cb1090-16"><a href="going-further-webdev.html#cb1090-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'#fdae61'</span><span class="op">,</span></span>
<span id="cb1090-17"><a href="going-further-webdev.html#cb1090-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'#f46d43'</span><span class="op">,</span></span>
<span id="cb1090-18"><a href="going-further-webdev.html#cb1090-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'#d73027'</span><span class="op">,</span></span>
<span id="cb1090-19"><a href="going-further-webdev.html#cb1090-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'#a50026'</span></span>
<span id="cb1090-20"><a href="going-further-webdev.html#cb1090-20" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb1090-21"><a href="going-further-webdev.html#cb1090-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1090-22"><a href="going-further-webdev.html#cb1090-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1090-23"><a href="going-further-webdev.html#cb1090-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p></p>
<ol start="7" style="list-style-type: decimal">
<li>The last data to show is the trajectory from the initial condition. Right after the flow GL data serie, we add an extra JSON pointing to <code>trajectoryData</code>. Fill in the <code>...</code>.</li>
</ol>
<p></p>
<div class="sourceCode" id="cb1091"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1091-1"><a href="going-further-webdev.html#cb1091-1" aria-hidden="true" tabindex="-1"></a>series<span class="op">:</span> [</span>
<span id="cb1091-2"><a href="going-further-webdev.html#cb1091-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// flowGL data</span></span>
<span id="cb1091-3"><a href="going-further-webdev.html#cb1091-3" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb1091-4"><a href="going-further-webdev.html#cb1091-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="op">...,</span></span>
<span id="cb1091-5"><a href="going-further-webdev.html#cb1091-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span> <span class="op">...,</span></span>
<span id="cb1091-6"><a href="going-further-webdev.html#cb1091-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">symbol</span><span class="op">:</span> <span class="st">'none'</span></span>
<span id="cb1091-7"><a href="going-further-webdev.html#cb1091-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1091-8"><a href="going-further-webdev.html#cb1091-8" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
<p></p>
<ol start="8" style="list-style-type: decimal">
<li>Finally, at the end of the <code>model-data</code> Shiny custom handler, we apply the newly defined options to the plot instance. Fill in the <code>...</code>.</li>
</ol>
<p></p>
<div class="sourceCode" id="cb1092"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1092-1"><a href="going-further-webdev.html#cb1092-1" aria-hidden="true" tabindex="-1"></a>phasePlot<span class="op">.</span><span class="fu">setOption</span>(<span class="op">...</span>)<span class="op">;</span></span></code></pre></div>
<p></p>
<p>Recompile the code and enjoy the result displayed on Figure <a href="going-further-webdev.html#fig:vdpMod-basic-app-5">28.8</a>.</p>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:vdpMod-basic-app-5"></span>
<img src="images/going-further/vdpMod-basic-app-5.png" alt="vdpMod basic app with time series output and phase portrait." width="40%"><p class="caption">
FIGURE 28.8: vdpMod basic app with time series output and phase portrait.
</p>
</div>
<p></p>
</div>
</div>
</div>
<div id="final-product" class="section level2" number="28.4">
<h2>
<span class="header-section-number">28.4</span> Final product<a class="anchor" aria-label="anchor" href="#final-product"><i class="fas fa-link"></i></a>
</h2>
<p>Final code project may be found <a href="https://github.com/DivadNojnarg/vdpMod/tree/a995480862aebb399be951cf3a28c51cc0e844eb">here</a>.</p>
<p>To go even further, part of the app logic may be delegated to a Plumber API, which the web developer can query to fetch data from. This is however out of the scope of this book.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="going-further-reactR.html"><span class="header-section-number">27</span> Shiny and React with {reactR}</a></div>
<div class="next"><a href="going-further-where-to-go.html"><span class="header-section-number">29</span> What to do next?</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#going-further-webdev"><span class="header-section-number">28</span> Divide and Conquere</a></li>
<li><a class="nav-link" href="#motivations-3"><span class="header-section-number">28.1</span> Motivations</a></li>
<li><a class="nav-link" href="#state-of-the-art"><span class="header-section-number">28.2</span> State of the art</a></li>
<li>
<a class="nav-link" href="#about-the-project"><span class="header-section-number">28.3</span> About the project</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#topic"><span class="header-section-number">28.3.1</span> Topic</a></li>
<li><a class="nav-link" href="#initialize-the-project"><span class="header-section-number">28.3.2</span> Initialize the project</a></li>
<li><a class="nav-link" href="#ui-design"><span class="header-section-number">28.3.3</span> UI design</a></li>
<li><a class="nav-link" href="#r-business-logic"><span class="header-section-number">28.3.4</span> R Business logic</a></li>
<li><a class="nav-link" href="#add-shiny"><span class="header-section-number">28.3.5</span> Add Shiny</a></li>
<li><a class="nav-link" href="#create-the-interface"><span class="header-section-number">28.3.6</span> Create the interface</a></li>
</ul>
</li>
<li><a class="nav-link" href="#final-product"><span class="header-section-number">28.4</span> Final product</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/going-further-webdev.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/going-further-webdev.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It was last built on 2021-11-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
