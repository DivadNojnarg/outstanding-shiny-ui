<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 23 Reconstruct {shinyMobile} | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<meta name="description" content="This section has been written and tested with Framework7 5.7.14. Some feature may change in future releases. However, fear not! The process follows the same general principles.  As a reminder, the...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 23 Reconstruct {shinyMobile} | Outstanding User Interfaces with Shiny">
<meta property="og:type" content="book">
<meta property="og:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<meta property="og:description" content="This section has been written and tested with Framework7 5.7.14. Some feature may change in future releases. However, fear not! The process follows the same general principles.  As a reminder, the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 23 Reconstruct {shinyMobile} | Outstanding User Interfaces with Shiny">
<meta name="twitter:description" content="This section has been written and tested with Framework7 5.7.14. Some feature may change in future releases. However, fear not! The process follows the same general principles.  As a reminder, the...">
<meta name="twitter:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">2</span> Mastering {htmltools}</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">3</span> Discover Shiny dependencies</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Dependency utilities</a></li>
<li><a class="" href="web-applications.html"><span class="header-section-number">5</span> Web application concepts</a></li>
<li class="book-part">Beautify with CSS and Sass</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">6</span> CSS for Shiny</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">7</span> Introduction to Sass</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">8</span> Beautify with {fresh}</a></li>
<li><a class="" href="beautify-with-bootstraplib.html"><span class="header-section-number">9</span> Beautify with {bslib}</a></li>
<li class="book-part">Unleash interactivity with JavaScript</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> R and JS</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">12</span> Shiny’s input system</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Mastering Shiny’s events</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Dynamically manage content with handlers</a></li>
<li class="book-part">Practice 1: a dashboard template</li>
<li><a class="" href="custom-templates-dependencies.html"><span class="header-section-number">16</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">17</span> Create template elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">18</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">19</span> Adding more interactivity</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">20</span> Testing and validating templates elements</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="" href="workflow-charpente.html"><span class="header-section-number">21</span> Introduction to {charpente}</a></li>
<li class="book-part">Case study 2: Mobile development with Shiny</li>
<li><a class="" href="mobile-shiny-intro.html"><span class="header-section-number">22</span> Introduction</a></li>
<li><a class="active" href="mobile-shinyMobile.html"><span class="header-section-number">23</span> Reconstruct {shinyMobile}</a></li>
<li><a class="" href="mobile-pwa.html"><span class="header-section-number">24</span> {shinyMobile} and PWA</a></li>
<li><a class="" href="mobile-widgets.html"><span class="header-section-number">25</span> Design widgets</a></li>
<li><a class="" href="mobile-going-further.html"><span class="header-section-number">26</span> Fine tune {shinyMobile}</a></li>
<li class="book-part">Going further</li>
<li><a class="" href="going-further-reactR.html"><span class="header-section-number">27</span> R + Shiny + React: welcome {reactR}</a></li>
<li><a class="" href="going-further-webdev.html"><span class="header-section-number">28</span> Divide and Conquere</a></li>
<li><a class="" href="going-further-where-to-go.html"><span class="header-section-number">29</span> What to do next?</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="code-outputs.html"><span class="header-section-number">A</span> Code outputs</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="mobile-shinyMobile" class="section level1">
<h1>
<span class="header-section-number">23</span> Reconstruct <code>{shinyMobile}</code><a class="anchor" aria-label="anchor" href="#mobile-shinyMobile"><i class="fas fa-link"></i></a>
</h1>
<div class="importantblock">
<p>This section has been written and tested with Framework7 <code>5.7.14</code>.
Some feature may change in future releases.
However, fear not! The process follows the same general principles.</p>
</div>
<div class="warningblock">
<p>As a reminder, the code examples shown throughout this chapter are gathered in the <code>{OSUICode}</code> package accessible <a href="https://github.com/DivadNojnarg/OSUICode/tree/1d42aa7531705954d3c21921c8bbb10623b20d12">here</a>.</p>
</div>
<div id="introduction-to-framework7" class="section level2">
<h2>
<span class="header-section-number">23.1</span> Introduction to Framework7<a class="anchor" aria-label="anchor" href="#introduction-to-framework7"><i class="fas fa-link"></i></a>
</h2>
<p>Framework7 is the HTML/CSS/JavaScript engine that fuels <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a>.
It is a flexible toolkit to build <strong>native</strong> looking web apps or progressive
web apps (PWA). It has an incredibly rich ecosystem:</p>
<ul>
<li>Provides a core JavaScript API, <strong>React</strong> API, <strong>Vue</strong> API, <strong>Svelte</strong> API.</li>
<li>A CLI (command line interface) to ease the creation of <strong>PWA</strong>, provide boilerplate and starter templates.</li>
<li>A full set of native <a href="https://framework7.io/icons/">icons</a>.</li>
<li>Hundreds of components with different look for <strong>iOS</strong> and <strong>material design</strong>, even desktop.</li>
<li>A comprehensive set of <a href="https://framework7.io/docs/">documentation</a>.</li>
<li>A supportive <a href="https://forum.framework7.io/">community</a>.</li>
</ul>
</div>
<div id="initiate-the-package" class="section level2">
<h2>
<span class="header-section-number">23.2</span> Initiate the package<a class="anchor" aria-label="anchor" href="#initiate-the-package"><i class="fas fa-link"></i></a>
</h2>
<p>This is time to initialize the <strong>package</strong> structure and extract the Framework7 <strong>dependencies</strong>.
To get an idea of the package file structure, we run:</p>
<div class="sourceCode" id="cb845"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RinteRface/charpente">charpente</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb846"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/get_dependency_assets.html">get_dependency_assets</a></span><span class="op">(</span><span class="st">"framework7"</span>, tag <span class="op">=</span> <span class="st">"5.7.14"</span><span class="op">)</span> 
<span class="co"># Output was manually truncated for formatting reasons</span>
<span class="co">#&gt; $url</span>
<span class="co">#&gt; [1] "https://cdn.jsdelivr.net/npm/framework7@5.7.14/"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $files</span>
<span class="co">#&gt;                                 name</span>
<span class="co">#&gt; 2          framework7.bundle.min.css</span>
<span class="co">#&gt; 6                 framework7.min.css</span>
<span class="co">#&gt; 11          framework7.bundle.min.js</span>
<span class="co">#&gt; 15                 framework7.min.js</span>
<span class="co">#&gt; 18         framework7-lite.bundle.js</span>
<span class="co">#&gt; 19     framework7-lite.bundle.min.js</span>
<span class="co">#&gt; 23            framework7-lite.min.js</span>
<span class="co">#&gt;                                            hash</span>
<span class="co">#&gt; 2  P0Yv9hUd1e2zLYv9F3eEiJ29wz3ZOSIbdHGEj3Jwzyo=</span>
<span class="co">#&gt; 6  fYS3dYPbdZeiQAM9wTUQiLP82ZTcVoA970gb2Ov7EFY=</span>
<span class="co">#&gt; 11 k0i6vZYYH7MIgZvxSp4eQFS2HCEXy1ae5BF/YWSMyys=</span>
<span class="co">#&gt; 15 FJ+5ZHj8V2fzT7Lts0ELaWSC4ZJtmxQzRuWeWwke9a0=</span>
<span class="co">#&gt; 18 EiVuejoa3kTItzhZ5mw7WhB+Ah75R5HpM+34hijj7wA=</span>
<span class="co">#&gt; 19 LKMinGOXYGPI4wdD4ZIPp5kx84PP3f7EkD8dUxFPRAI=</span>
<span class="co">#&gt; 23 liT0rss/O3G2MtXQ3/zAu+8jmTrrPhwiqV+Pd58qJJo=</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $hasSubfolders</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>We browse to the <a href="https://framework7.io/docs/package.html">package</a> page,
which provides details about all necessary components. We are going to use the <strong>bundle</strong> version since
the lite approach is missing several components, particularly Framework7 widgets. We therefore target <code>framework7.bundle.min.js</code> and <code>framework7.bundle.min.css</code>:</p>
<div class="sourceCode" id="cb847"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"shinyMobile"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_charpente.html">create_charpente</a></span><span class="op">(</span><span class="va">path</span>, license <span class="op">=</span> <span class="st">"mit"</span><span class="op">)</span></code></pre></div>
<p>Once the package created and opened, we download Framework7 dependencies, specifying
the following version, that is <code>5.7.14</code>, and targeting <code>bundle.min</code> files by setting <code><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options(bundle = TRUE)</a></code> (default to <code>FALSE</code>):</p>
<div class="sourceCode" id="cb848"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency</a></span><span class="op">(</span>
  <span class="st">"framework7"</span>, 
  tag <span class="op">=</span> <span class="st">"5.7.14"</span>, 
  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options</a></span><span class="op">(</span>bundle <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Besides, this generates the <code>framework7-dependencies.R</code> script:</p>
<div class="sourceCode" id="cb849"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">add_framework7_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="op">{</span>
 <span class="va">framework7_deps</span> <span class="op">&lt;-</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"framework7"</span>,
  version <span class="op">=</span> <span class="st">"5.7.14"</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"framework7-5.7.14"</span><span class="op">)</span>,
  script <span class="op">=</span> <span class="st">"js/framework7.bundle.min.js"</span>,
  stylesheet <span class="op">=</span> <span class="st">"css/framework7.bundle.min.css"</span>,
  package <span class="op">=</span> <span class="st">"shinyMobile"</span>,
 <span class="op">)</span>
 <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span><span class="va">tag</span>, <span class="va">framework7_deps</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="framework7-layouts" class="section level2">
<h2>
<span class="header-section-number">23.3</span> Framework7 Layouts<a class="anchor" aria-label="anchor" href="#framework7-layouts"><i class="fas fa-link"></i></a>
</h2>
<p>Framework7 has three predefined layouts (Figure <a href="mobile-shinyMobile.html#fig:mobile-framework7-layouts">23.1</a>):</p>
<ul>
<li>
<strong>Single page</strong> layout.</li>
<li>
<strong>Multi tabs</strong> layout.</li>
<li>
<strong>Split</strong> layout, targeting tablet/desktop. It is composed of a sidebar and a main panel.</li>
</ul>
<div class="figure">
<span style="display:block;" id="fig:mobile-framework7-layouts"></span>
<img src="images/mobile/mobile-shinymobile-single-layout.png" alt="Framework7 layouts" width="33%"><img src="images/mobile/mobile-shinymobile-tabs-layout.png" alt="Framework7 layouts" width="33%"><img src="images/mobile/mobile-shinymobile-split-layout.png" alt="Framework7 layouts" width="33%"><p class="caption">
FIGURE 23.1: Framework7 layouts
</p>
</div>
<p>Let’s start simple and choose the single page layout, whose corresponding HTML is
given by:</p>
<div class="sourceCode" id="cb850"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb850-1"><a href="mobile-shinyMobile.html#cb850-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb850-2"><a href="mobile-shinyMobile.html#cb850-2"></a><span class="kw">&lt;html&gt;</span></span>
<span id="cb850-3"><a href="mobile-shinyMobile.html#cb850-3"></a>  <span class="kw">&lt;head&gt;</span></span>
<span id="cb850-4"><a href="mobile-shinyMobile.html#cb850-4"></a>    <span class="co">&lt;!-- Head content (see below) --&gt;</span></span>
<span id="cb850-5"><a href="mobile-shinyMobile.html#cb850-5"></a>  <span class="kw">&lt;/head&gt;</span></span>
<span id="cb850-6"><a href="mobile-shinyMobile.html#cb850-6"></a>  <span class="kw">&lt;body&gt;</span></span>
<span id="cb850-7"><a href="mobile-shinyMobile.html#cb850-7"></a>    <span class="co">&lt;!-- App root element (see below) --&gt;</span></span>
<span id="cb850-8"><a href="mobile-shinyMobile.html#cb850-8"></a>  </span>
<span id="cb850-9"><a href="mobile-shinyMobile.html#cb850-9"></a>    <span class="co">&lt;!-- Path to Framework7 Library Bundle JS--&gt;</span></span>
<span id="cb850-10"><a href="mobile-shinyMobile.html#cb850-10"></a>    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">"text/javascript"</span> </span>
<span id="cb850-11"><a href="mobile-shinyMobile.html#cb850-11"></a><span class="ot">      src=</span><span class="st">"path/to/framework7.bundle.min.js"</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb850-12"><a href="mobile-shinyMobile.html#cb850-12"></a>    <span class="co">&lt;!-- Path to your app js--&gt;</span></span>
<span id="cb850-13"><a href="mobile-shinyMobile.html#cb850-13"></a>    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">"text/javascript"</span> </span>
<span id="cb850-14"><a href="mobile-shinyMobile.html#cb850-14"></a><span class="ot">      src=</span><span class="st">"path/to/my-app.js"</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb850-15"><a href="mobile-shinyMobile.html#cb850-15"></a>  <span class="kw">&lt;/body&gt;</span></span>
<span id="cb850-16"><a href="mobile-shinyMobile.html#cb850-16"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>The <code>head</code> tag contains <strong>meta</strong> tags (some are required for <strong>PWA</strong> features) which are discussed in the next Chapter <a href="mobile-pwa.html#mobile-pwa">24</a>.
The most important part is the dependencies that will be included. Note that
the order matters: Framework7 dependencies go first, other dependencies follow.</p>
<div class="sourceCode" id="cb851"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb851-1"><a href="mobile-shinyMobile.html#cb851-1"></a><span class="kw">&lt;head&gt;</span></span>
<span id="cb851-2"><a href="mobile-shinyMobile.html#cb851-2"></a>  <span class="co">&lt;!-- Required meta tags--&gt;</span></span>
<span id="cb851-3"><a href="mobile-shinyMobile.html#cb851-3"></a>  <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">"utf-8"</span><span class="kw">&gt;</span></span>
<span id="cb851-4"><a href="mobile-shinyMobile.html#cb851-4"></a>  <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">"viewport"</span><span class="ot"> content=</span><span class="st">"width=device-width, </span></span>
<span id="cb851-5"><a href="mobile-shinyMobile.html#cb851-5"></a><span class="st">    initial-scale=1, maximum-scale=1, minimum-scale=1, </span></span>
<span id="cb851-6"><a href="mobile-shinyMobile.html#cb851-6"></a><span class="st">    user-scalable=no, viewport-fit=cover"</span><span class="kw">&gt;</span></span>
<span id="cb851-7"><a href="mobile-shinyMobile.html#cb851-7"></a>  <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">"apple-mobile-web-app-capable"</span><span class="ot"> content=</span><span class="st">"yes"</span><span class="kw">&gt;</span></span>
<span id="cb851-8"><a href="mobile-shinyMobile.html#cb851-8"></a>  <span class="co">&lt;!-- Color theme for statusbar (Android only) --&gt;</span></span>
<span id="cb851-9"><a href="mobile-shinyMobile.html#cb851-9"></a>  <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">"theme-color"</span><span class="ot"> content=</span><span class="st">"#2196f3"</span><span class="kw">&gt;</span></span>
<span id="cb851-10"><a href="mobile-shinyMobile.html#cb851-10"></a>  <span class="co">&lt;!-- Your app title --&gt;</span></span>
<span id="cb851-11"><a href="mobile-shinyMobile.html#cb851-11"></a>  <span class="kw">&lt;title&gt;</span>My App<span class="kw">&lt;/title&gt;</span></span>
<span id="cb851-12"><a href="mobile-shinyMobile.html#cb851-12"></a>  <span class="co">&lt;!-- Path to Framework7 Library Bundle CSS --&gt;</span></span>
<span id="cb851-13"><a href="mobile-shinyMobile.html#cb851-13"></a>  <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">"stylesheet"</span> </span>
<span id="cb851-14"><a href="mobile-shinyMobile.html#cb851-14"></a><span class="ot">    href=</span><span class="st">"path/to/framework7.bundle.min.css"</span><span class="kw">&gt;</span></span>
<span id="cb851-15"><a href="mobile-shinyMobile.html#cb851-15"></a>  <span class="co">&lt;!-- Path to your custom app styles--&gt;</span></span>
<span id="cb851-16"><a href="mobile-shinyMobile.html#cb851-16"></a>  <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">"stylesheet"</span><span class="ot"> href=</span><span class="st">"path/to/my-app.css"</span><span class="kw">&gt;</span></span>
<span id="cb851-17"><a href="mobile-shinyMobile.html#cb851-17"></a><span class="kw">&lt;/head&gt;</span></span></code></pre></div>
<p>The <code>body</code> tag is composed of several layers. The first one is the <code>app</code> <strong>root</strong> element, which is crucial to the template <strong>initialization</strong>. We’ll come back on that point in the next section.</p>
<div class="sourceCode" id="cb852"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb852-1"><a href="mobile-shinyMobile.html#cb852-1"></a><span class="co">&lt;!-- App root element --&gt;</span></span>
<span id="cb852-2"><a href="mobile-shinyMobile.html#cb852-2"></a><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">"app"</span><span class="kw">&gt;</span></span>
<span id="cb852-3"><a href="mobile-shinyMobile.html#cb852-3"></a>  <span class="co">&lt;!-- Your main view, should have "view-main" class --&gt;</span></span>
<span id="cb852-4"><a href="mobile-shinyMobile.html#cb852-4"></a>  <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"view view-main"</span><span class="kw">&gt;</span></span>
<span id="cb852-5"><a href="mobile-shinyMobile.html#cb852-5"></a>    <span class="co">&lt;!-- Initial Page --&gt;</span></span>
<span id="cb852-6"><a href="mobile-shinyMobile.html#cb852-6"></a>    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"page"</span><span class="kw">&gt;</span></span>
<span id="cb852-7"><a href="mobile-shinyMobile.html#cb852-7"></a>      <span class="co">&lt;!-- Top Navbar --&gt;</span></span>
<span id="cb852-8"><a href="mobile-shinyMobile.html#cb852-8"></a>      </span>
<span id="cb852-9"><a href="mobile-shinyMobile.html#cb852-9"></a>      <span class="co">&lt;!-- Bottom Toolbar --&gt;</span></span>
<span id="cb852-10"><a href="mobile-shinyMobile.html#cb852-10"></a>  </span>
<span id="cb852-11"><a href="mobile-shinyMobile.html#cb852-11"></a>      <span class="co">&lt;!-- Scrollable page content --&gt;</span></span>
<span id="cb852-12"><a href="mobile-shinyMobile.html#cb852-12"></a>      </span>
<span id="cb852-13"><a href="mobile-shinyMobile.html#cb852-13"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb852-14"><a href="mobile-shinyMobile.html#cb852-14"></a>  <span class="kw">&lt;/div&gt;</span></span>
<span id="cb852-15"><a href="mobile-shinyMobile.html#cb852-15"></a><span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<p>Then, we find the <strong>view</strong> component, inside which is located the <strong>page</strong>, hosting the <strong>navbar</strong>, <strong>toolbar</strong> (bottom bar) and the <strong>page content</strong>.</p>
<div class="sourceCode" id="cb853"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb853-1"><a href="mobile-shinyMobile.html#cb853-1"></a><span class="co">&lt;!-- Top Navbar --&gt;</span></span>
<span id="cb853-2"><a href="mobile-shinyMobile.html#cb853-2"></a><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"navbar"</span><span class="kw">&gt;</span></span>
<span id="cb853-3"><a href="mobile-shinyMobile.html#cb853-3"></a>  <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"navbar-bg"</span><span class="kw">&gt;&lt;/div&gt;</span></span>
<span id="cb853-4"><a href="mobile-shinyMobile.html#cb853-4"></a>  <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"navbar-inner"</span><span class="kw">&gt;</span></span>
<span id="cb853-5"><a href="mobile-shinyMobile.html#cb853-5"></a>    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"title"</span><span class="kw">&gt;</span>Awesome App<span class="kw">&lt;/div&gt;</span></span>
<span id="cb853-6"><a href="mobile-shinyMobile.html#cb853-6"></a>  <span class="kw">&lt;/div&gt;</span></span>
<span id="cb853-7"><a href="mobile-shinyMobile.html#cb853-7"></a><span class="kw">&lt;/div&gt;</span></span>
<span id="cb853-8"><a href="mobile-shinyMobile.html#cb853-8"></a></span>
<span id="cb853-9"><a href="mobile-shinyMobile.html#cb853-9"></a><span class="co">&lt;!-- Bottom Toolbar --&gt;</span></span>
<span id="cb853-10"><a href="mobile-shinyMobile.html#cb853-10"></a><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"toolbar toolbar-bottom"</span><span class="kw">&gt;</span></span>
<span id="cb853-11"><a href="mobile-shinyMobile.html#cb853-11"></a>  <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"toolbar-inner"</span><span class="kw">&gt;</span></span>
<span id="cb853-12"><a href="mobile-shinyMobile.html#cb853-12"></a>    <span class="co">&lt;!-- Toolbar links --&gt;</span></span>
<span id="cb853-13"><a href="mobile-shinyMobile.html#cb853-13"></a>    <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">"#"</span><span class="ot"> class=</span><span class="st">"link"</span><span class="kw">&gt;</span>Link 1<span class="kw">&lt;/a&gt;</span></span>
<span id="cb853-14"><a href="mobile-shinyMobile.html#cb853-14"></a>    <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">"#"</span><span class="ot"> class=</span><span class="st">"link"</span><span class="kw">&gt;</span>Link 2<span class="kw">&lt;/a&gt;</span></span>
<span id="cb853-15"><a href="mobile-shinyMobile.html#cb853-15"></a>  <span class="kw">&lt;/div&gt;</span></span>
<span id="cb853-16"><a href="mobile-shinyMobile.html#cb853-16"></a><span class="kw">&lt;/div&gt;</span></span>
<span id="cb853-17"><a href="mobile-shinyMobile.html#cb853-17"></a></span>
<span id="cb853-18"><a href="mobile-shinyMobile.html#cb853-18"></a><span class="co">&lt;!-- Scrollable page content --&gt;</span></span>
<span id="cb853-19"><a href="mobile-shinyMobile.html#cb853-19"></a><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"page-content"</span><span class="kw">&gt;</span></span>
<span id="cb853-20"><a href="mobile-shinyMobile.html#cb853-20"></a>  <span class="kw">&lt;p&gt;</span>Page content goes here<span class="kw">&lt;/p&gt;</span></span>
<span id="cb853-21"><a href="mobile-shinyMobile.html#cb853-21"></a>  <span class="co">&lt;!-- Other content --&gt;</span></span>
<span id="cb853-22"><a href="mobile-shinyMobile.html#cb853-22"></a><span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<p>Although, Framework7 inserts JavaScript code at the end of the body, we can include them in the <code>head</code> as well.</p>
<p>Leveraging the <a href="https://github.com/RinteRface/charpente">charpente</a> <code><a href="https://rdrr.io/pkg/charpente/man/html_2_R.html">html_2_R()</a></code>, we convert the above code to R and extract the <code><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page()</a></code> function. We replace the title content with a title parameter, paying attention to remove all CSS and JS links, as they are already included with the <code><a href="https://rdrr.io/pkg/OSUICode/man/add_dependencies.html">add_dependencies()</a></code> function applied to <code>body</code>. The page content is contained in a <code>...</code> parameter.
We also move the <code>navbar</code> and <code>toolbar</code> content to create two other layout functions. Meta tags are commented for space reasons but are available <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/blob/0ba1c35b85342c6933cc56489bae41186cc01601/R/shinyMobile.R#L74">here</a>:</p>
<div class="sourceCode" id="cb854"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f7_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">navbar</span>, <span class="va">toolbar</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span>
      <span class="co"># Meta tags are commented for space reasons</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">title</span><span class="op">(</span><span class="va">title</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/add_dependencies.html">add_dependencies</a></span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span>
        <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
          id <span class="op">=</span> <span class="st">"app"</span>,
          <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
            class <span class="op">=</span> <span class="st">"view view-main"</span>,
            <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
              class <span class="op">=</span> <span class="st">"page"</span>,
              <span class="va">navbar</span>,
              <span class="va">toolbar</span>,
              <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>class <span class="op">=</span> <span class="st">"page-content"</span>, <span class="va">...</span><span class="op">)</span>
            <span class="op">)</span>
          <span class="op">)</span>
        <span class="op">)</span>
      <span class="op">)</span>,
      deps <span class="op">=</span> <span class="st">"framework7"</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Below are the <code>navbar</code> and <code>toolbar</code> components. The navbar has only a title parameter and
the toolbar may contain items in a <code>...</code> parameter. In practice they may contain more elements,
but this is enough for now:</p>
<div class="sourceCode" id="cb855"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f7_navbar</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">title</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"navbar"</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>class <span class="op">=</span> <span class="st">"navbar-bg"</span><span class="op">)</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
      class <span class="op">=</span> <span class="st">"navbar-inner"</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
        class <span class="op">=</span> <span class="st">"title"</span>,
        <span class="va">title</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">f7_toolbar</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"toolbar toolbar-bottom"</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
      class <span class="op">=</span> <span class="st">"toolbar-inner"</span>,
      <span class="va">...</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="noteblock">
<p>Don’t forget to regularly insert roxygen documentation with the insert roxygen skeleton RStudio feature (Figure <a href="mobile-shinyMobile.html#fig:mobile-insert-roxygen">23.2</a>) and run <code>devtools::document()</code>, <code>devtools::load_all()</code>.</p>
<div class="figure">
<span style="display:block;" id="fig:mobile-insert-roxygen"></span>
<img src="images/mobile/mobile-insert-roxygen.png" alt="RStudio helper to add roxygen2 skeleton to any R function. " width="100%"><p class="caption">
FIGURE 23.2: RStudio helper to add roxygen2 skeleton to any R function.
</p>
</div>
</div>
<p>At this point, we can try to run a simple shiny app. Best practice is to save the <code>app.R</code> file in the <code>./inst/demo</code> folder:</p>
<!-- Won't be deployed -->
<div class="sourceCode" id="cb856"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page</a></span><span class="op">(</span>
  <span class="st">"Test"</span>,
  navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_navbar.html">f7_navbar</a></span><span class="op">(</span><span class="st">"Title"</span><span class="op">)</span>,
  toolbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_toolbar.html">f7_toolbar</a></span><span class="op">(</span><span class="op">)</span>,
  title <span class="op">=</span> <span class="st">"shinyMobile"</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>which displays nothing, but returns no error. We actually forgot the app <strong>initialization</strong> step.</p>
</div>
<div id="app-initialization-1" class="section level2">
<h2>
<span class="header-section-number">23.4</span> App initialization<a class="anchor" aria-label="anchor" href="#app-initialization-1"><i class="fas fa-link"></i></a>
</h2>
<p>This step is mandatory to <strong>activate</strong> all template <strong>components</strong> (router, panels, …).
We create a custom script with <code>create_js</code>, which automatically updates the <a href="https://github.com/RinteRface/charpente">charpente</a> provided <code>main.js</code> entry point:</p>
<div class="sourceCode" id="cb857"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_js</a></span><span class="op">(</span><span class="st">"init"</span><span class="op">)</span></code></pre></div>
<p>We add the following piece of JS inside <code>init.js</code>:</p>
<div class="sourceCode" id="cb858"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb858-1"><a href="mobile-shinyMobile.html#cb858-1"></a><span class="at">$</span>( document ).<span class="at">ready</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb858-2"><a href="mobile-shinyMobile.html#cb858-2"></a>  app <span class="op">=</span> <span class="kw">new</span> <span class="at">Framework7</span>(<span class="op">{</span></span>
<span id="cb858-3"><a href="mobile-shinyMobile.html#cb858-3"></a>    <span class="co">// App root element</span></span>
<span id="cb858-4"><a href="mobile-shinyMobile.html#cb858-4"></a>    <span class="dt">root</span><span class="op">:</span> <span class="st">'#app'</span><span class="op">,</span></span>
<span id="cb858-5"><a href="mobile-shinyMobile.html#cb858-5"></a>    <span class="co">// App Name</span></span>
<span id="cb858-6"><a href="mobile-shinyMobile.html#cb858-6"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">'My App'</span><span class="op">,</span></span>
<span id="cb858-7"><a href="mobile-shinyMobile.html#cb858-7"></a>    <span class="co">// other options</span></span>
<span id="cb858-8"><a href="mobile-shinyMobile.html#cb858-8"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb858-9"><a href="mobile-shinyMobile.html#cb858-9"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Importantly, we made <code>app</code> global so as to access it in other scopes. There is currently no easy way to workaround this issue.</p>
<div class="warningblock">
<p>Most of the code inside <code>init.js</code> is wrapped in a function that waits the document to be ready before interacting with the <strong>DOM</strong>. This is necessary since the configuration is retrieved from a <code>script</code> DOM element inserted when the application starts, thus not immediately available. If you try to remove the <code>$( document ).ready(function(...)});</code>, an error will be raised since the configuration cannot be properly retrieved.</p>
</div>
<p>This script creates the app instance necessary to leverage Framework7 <a href="https://framework7.io/docs/app.html#app-methods-properties">methods</a>,
initialize other <strong>widgets</strong>, interact with layout elements and listen to app events (offline, online, …). Since the root element is a direct child of the body, the <code>root</code> property is not
mandatory. The full configuration list may be found <a href="https://framework7.io/docs/app.html">here</a>.
The next step consists in initializing the main view, we add this line right after the app creation:</p>
<div class="sourceCode" id="cb859"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb859-1"><a href="mobile-shinyMobile.html#cb859-1"></a><span class="kw">let</span> mainView <span class="op">=</span> <span class="va">app</span>.<span class="va">views</span>.<span class="at">create</span>(<span class="st">'.view-main'</span>)<span class="op">;</span></span></code></pre></div>
<p>Once done, we compress the corresponding JS file to create the <code>shinyMobile.min.js</code> code,
update the <code><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page()</a></code> to include the new dependency, after the Framework7 one, and document the package to setup the package imports:</p>
<div class="sourceCode" id="cb860"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># updated f7_page</span>
<span class="va">f7_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">navbar</span>, <span class="va">toolbar</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span>
      <span class="co"># Head content (unchanged)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/add_dependencies.html">add_dependencies</a></span><span class="op">(</span>
      <span class="co"># Body tag (unchanged)</span>
      deps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"framework7"</span>, <span class="st">"shinyMobile"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="co"># Initialize NAMESPACE file</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">document</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The working app is shown on Figure <a href="mobile-shinyMobile.html#fig:mobile-shinyMobile-firstapp">23.3</a>.
The right panel displays the developer tools inside which we can seamlessly debug the JS code, by
leveraging <strong>source maps</strong>.</p>
<div class="figure">
<span style="display:block;" id="fig:mobile-shinyMobile-firstapp"></span>
<img src="images/mobile/mobile-shinyMobile-firstapp.png" alt="First working {shinyMobile} app" width="100%"><p class="caption">
FIGURE 23.3: First working {shinyMobile} app
</p>
</div>
<p>From now, we can add a welcome notification message with the <a href="https://framework7.io/docs/notification.html">notification</a> API. There are two steps:</p>
<ul>
<li>Create the notification instance with <code>app.notification.create(parameters)</code>.</li>
<li>Tell the app to open the notification at start with <code>app.notification.open()</code>.</li>
</ul>
<p>We add the following code to <code>init.js</code> and call <code><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js()</a></code>:</p>
<div class="sourceCode" id="cb861"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb861-1"><a href="mobile-shinyMobile.html#cb861-1"></a><span class="kw">let</span> notification <span class="op">=</span> <span class="va">app</span>.<span class="va">notification</span>.<span class="at">create</span>(<span class="op">{</span></span>
<span id="cb861-2"><a href="mobile-shinyMobile.html#cb861-2"></a>  <span class="dt">text</span><span class="op">:</span> <span class="st">'Welcome to shinyMobile!'</span><span class="op">,</span></span>
<span id="cb861-3"><a href="mobile-shinyMobile.html#cb861-3"></a>  <span class="dt">on</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb861-4"><a href="mobile-shinyMobile.html#cb861-4"></a>    <span class="dt">opened</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></span>
<span id="cb861-5"><a href="mobile-shinyMobile.html#cb861-5"></a>      <span class="va">console</span>.<span class="at">log</span>(<span class="st">'Notification opened'</span>)<span class="op">;</span></span>
<span id="cb861-6"><a href="mobile-shinyMobile.html#cb861-6"></a>    <span class="op">}</span></span>
<span id="cb861-7"><a href="mobile-shinyMobile.html#cb861-7"></a>  <span class="op">}</span></span>
<span id="cb861-8"><a href="mobile-shinyMobile.html#cb861-8"></a><span class="op">}</span>).<span class="at">open</span>()<span class="op">;</span></span></code></pre></div>
<p>It opens at app start up and closes on swipe gesture. The Framework7 API is quite easy to
understand and extremely powerful. Chapter <a href="mobile-widgets.html#mobile-widgets">25</a> gives a better introduction to the main Framework7 widgets.</p>
</div>
<div id="app-configuration" class="section level2">
<h2>
<span class="header-section-number">23.5</span> App configuration<a class="anchor" aria-label="anchor" href="#app-configuration"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="https://framework7.io/docs/app.html">app</a> object has a tremendous amount of methods and parameters. In this section, we briefly describe the most significant and how to set them up.
Among all parameters, there are metadata parameters like <strong>name</strong> and <strong>version</strong>. Once the app initialized, all app parameters are accessible with the <code>.</code> notation. For instance, if you set a version number, it is accessible later with <code>app.version</code>.</p>
<div id="global-theme" class="section level3">
<h3>
<span class="header-section-number">23.5.1</span> Global theme<a class="anchor" aria-label="anchor" href="#global-theme"><i class="fas fa-link"></i></a>
</h3>
<p><strong>theme</strong> controls the overall app design (Figure <a href="mobile-shinyMobile.html#fig:mobile-framework7-themes">23.4</a>):</p>
<ul>
<li>
<code>ios</code> corresponds the <strong>iOS</strong> design.</li>
<li>
<code>md</code> stands for <strong>material</strong> design.</li>
<li>
<code>aurora</code> is a <strong>desktop</strong> optimized design.</li>
</ul>
<p>As this parameter is set to <code>auto</code>, Framework7 detects the
current device stored in <code>app.device</code>, and accordingly adapts the design. Nothing prevents you from forcing the iOS layout on android devices, even though being quite irrelevant. Here are many properties to <a href="https://framework7.io/docs/device.html">review</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:mobile-framework7-themes"></span>
<img src="images/mobile/mobile-shinymobile-slider-ios.png" alt="Framework7 skins: iOS (left), md (right)." width="50%"><img src="images/mobile/mobile-shinymobile-slider-md.png" alt="Framework7 skins: iOS (left), md (right)." width="50%"><p class="caption">
FIGURE 23.4: Framework7 skins: iOS (left), md (right).
</p>
</div>
</div>
<div id="events-1" class="section level3">
<h3>
<span class="header-section-number">23.5.2</span> Events<a class="anchor" aria-label="anchor" href="#events-1"><i class="fas fa-link"></i></a>
</h3>
<p>The app is able to emit events whenever relevant like <code>init</code>, <code>resize</code>, <code>online</code>, <code>offline</code>, which
allows to add interactivity:</p>
<div class="sourceCode" id="cb862"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb862-1"><a href="mobile-shinyMobile.html#cb862-1"></a>app <span class="op">=</span> <span class="kw">new</span> <span class="at">Framework7</span>(<span class="op">{</span></span>
<span id="cb862-2"><a href="mobile-shinyMobile.html#cb862-2"></a>  <span class="dt">on</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb862-3"><a href="mobile-shinyMobile.html#cb862-3"></a>    <span class="dt">init</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></span>
<span id="cb862-4"><a href="mobile-shinyMobile.html#cb862-4"></a>      <span class="va">console</span>.<span class="at">log</span>(<span class="st">'App initialized'</span>)<span class="op">;</span></span>
<span id="cb862-5"><a href="mobile-shinyMobile.html#cb862-5"></a>    <span class="op">},</span></span>
<span id="cb862-6"><a href="mobile-shinyMobile.html#cb862-6"></a>    <span class="co">// other events</span></span>
<span id="cb862-7"><a href="mobile-shinyMobile.html#cb862-7"></a>  <span class="op">}</span></span>
<span id="cb862-8"><a href="mobile-shinyMobile.html#cb862-8"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
</div>
<div id="components-configuration" class="section level3">
<h3>
<span class="header-section-number">23.5.3</span> Components configuration<a class="anchor" aria-label="anchor" href="#components-configuration"><i class="fas fa-link"></i></a>
</h3>
<p>All Framework7 components are highly customizable. Yet, if you know that some
parameters are not going to change, it is a good idea to make them global and share them
across all instances. For example, notifications have global options. Let’s add this code
to the <code>init.js</code> script directly inside the <code>var app = new Framework7({ ... })</code>:</p>
<div class="sourceCode" id="cb863"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb863-1"><a href="mobile-shinyMobile.html#cb863-1"></a>notification<span class="op">:</span> <span class="op">{</span></span>
<span id="cb863-2"><a href="mobile-shinyMobile.html#cb863-2"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">'My App'</span><span class="op">,</span></span>
<span id="cb863-3"><a href="mobile-shinyMobile.html#cb863-3"></a>  <span class="dt">closeTimeout</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb863-4"><a href="mobile-shinyMobile.html#cb863-4"></a><span class="op">}</span></span></code></pre></div>
<p>This means all notifications will close after three seconds and have the <code>My App</code> title. We rebuild the JS code with <code><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js()</a></code> and run the previous app example. We add another notification to the <code>init.js</code> script with a delay of one second so as to test this global feature. Note the use of the internal Framework7 <a href="https://framework7.io/docs/utils.html#nexttick">utils</a> <code>app.utils.nextTick</code>, which is nothing more than a <code>setTimeout</code> function</p>
<div class="sourceCode" id="cb864"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb864-1"><a href="mobile-shinyMobile.html#cb864-1"></a><span class="kw">let</span> otherMessage <span class="op">=</span> <span class="va">app</span>.<span class="va">notification</span>.<span class="at">create</span>(<span class="op">{</span></span>
<span id="cb864-2"><a href="mobile-shinyMobile.html#cb864-2"></a>  <span class="dt">text</span><span class="op">:</span> <span class="st">'You look great!'</span></span>
<span id="cb864-3"><a href="mobile-shinyMobile.html#cb864-3"></a><span class="op">}</span>)<span class="op">;</span></span>
<span id="cb864-4"><a href="mobile-shinyMobile.html#cb864-4"></a>  </span>
<span id="cb864-5"><a href="mobile-shinyMobile.html#cb864-5"></a><span class="co">// equivalent to setTimeout ...</span></span>
<span id="cb864-6"><a href="mobile-shinyMobile.html#cb864-6"></a><span class="va">app</span>.<span class="va">utils</span>.<span class="at">nextTick</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb864-7"><a href="mobile-shinyMobile.html#cb864-7"></a>  <span class="va">otherMessage</span>.<span class="at">open</span>()<span class="op">;</span></span>
<span id="cb864-8"><a href="mobile-shinyMobile.html#cb864-8"></a><span class="op">},</span> <span class="dv">1000</span>)<span class="op">;</span></span></code></pre></div>
</div>
<div id="allow-end-user-configuration" class="section level3">
<h3>
<span class="header-section-number">23.5.4</span> Allow end-user configuration<a class="anchor" aria-label="anchor" href="#allow-end-user-configuration"><i class="fas fa-link"></i></a>
</h3>
<p>In the above sections, we described some parameters to configure the app. Yet,
we did setup all values directly in JavaScript. How do we allow the end user to provide
his very own parameters?</p>
<p>The idea is the following:</p>
<ul>
<li>We create an options argument in the <code><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page()</a></code> function which accepts a list
of parameters.</li>
<li>We convert it to the JSON format and store it in a tag, ideally next to the <code>body</code> element.</li>
<li>We recover those data on the JS side and update the app initialization method.</li>
</ul>
<p>The <code><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page()</a></code> may be accordingly modified. We convert the options list to a JSON with <code><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">jsonlite::toJSON</a></code> and embed it in a script tag (as a reminder, we exploit this method in section <a href="shiny-input-system.html#secondary-inputs">12.2</a>).
The <code>data-for</code> attribute with the <strong>id</strong> attribute guarantees the uniqueness of our configuration script:</p>
<div class="sourceCode" id="cb865"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">config_tag</span> <span class="op">&lt;-</span> <span class="fu">shiny</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">tags</a></span><span class="op">$</span><span class="fu">script</span><span class="op">(</span>
  type <span class="op">=</span> <span class="st">"application/json"</span>,
  `data-for` <span class="op">=</span> <span class="st">"app"</span>,
  <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">toJSON</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">options</span>,
    auto_unbox <span class="op">=</span> <span class="cn">TRUE</span>,
    json_verbatim <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>We then create an intermediate <code>body_tag</code> component where we insert the configuration tag.</p>
<div class="sourceCode" id="cb866"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f7_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">navbar</span>, <span class="va">toolbar</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, 
                    <span class="va">options</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>

  <span class="co"># Create config (see above) </span>

  <span class="co"># create body_tag</span>
  <span class="va">body_tag</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span>
    <span class="co"># Body content (unchanged)</span>
    <span class="co"># Config tag </span>
    <span class="va">config_tag</span>
  <span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span>
      <span class="co"># Head content (unchanged)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/add_dependencies.html">add_dependencies</a></span><span class="op">(</span>
      <span class="va">body_tag</span>,
      deps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"framework7"</span>, <span class="st">"shinyMobile"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>On the JS side, the data collection must occur before the app initialization and is quite easy with the jQuery <code>find</code> method:</p>
<div class="sourceCode" id="cb867"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb867-1"><a href="mobile-shinyMobile.html#cb867-1"></a><span class="kw">let</span> config <span class="op">=</span> <span class="at">$</span>(document).<span class="at">find</span>(<span class="st">"script[data-for='app']"</span>)<span class="op">;</span></span>
<span id="cb867-2"><a href="mobile-shinyMobile.html#cb867-2"></a>config <span class="op">=</span> <span class="va">JSON</span>.<span class="at">parse</span>(<span class="va">config</span>.<span class="at">html</span>())<span class="op">;</span></span></code></pre></div>
<p>We accordingly update the app initialization:</p>
<div class="sourceCode" id="cb868"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb868-1"><a href="mobile-shinyMobile.html#cb868-1"></a>app <span class="op">=</span> <span class="kw">new</span> <span class="at">Framework7</span>(<span class="op">{</span></span>
<span id="cb868-2"><a href="mobile-shinyMobile.html#cb868-2"></a>  <span class="co">// App root element</span></span>
<span id="cb868-3"><a href="mobile-shinyMobile.html#cb868-3"></a>  <span class="dt">root</span><span class="op">:</span> <span class="st">'#app'</span><span class="op">,</span></span>
<span id="cb868-4"><a href="mobile-shinyMobile.html#cb868-4"></a>  <span class="co">// App Name</span></span>
<span id="cb868-5"><a href="mobile-shinyMobile.html#cb868-5"></a>  <span class="dt">name</span><span class="op">:</span> <span class="st">'My App'</span><span class="op">,</span></span>
<span id="cb868-6"><a href="mobile-shinyMobile.html#cb868-6"></a>  <span class="dt">version</span><span class="op">:</span> <span class="va">config</span>.<span class="at">version</span><span class="op">,</span></span>
<span id="cb868-7"><a href="mobile-shinyMobile.html#cb868-7"></a>  <span class="co">// other options</span></span>
<span id="cb868-8"><a href="mobile-shinyMobile.html#cb868-8"></a>  <span class="dt">theme</span><span class="op">:</span> <span class="va">config</span>.<span class="at">theme</span><span class="op">,</span></span>
<span id="cb868-9"><a href="mobile-shinyMobile.html#cb868-9"></a>  <span class="dt">notification</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb868-10"><a href="mobile-shinyMobile.html#cb868-10"></a>    <span class="dt">closeTimeout</span><span class="op">:</span> <span class="dv">3000</span></span>
<span id="cb868-11"><a href="mobile-shinyMobile.html#cb868-11"></a>  <span class="op">}</span></span>
<span id="cb868-12"><a href="mobile-shinyMobile.html#cb868-12"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>What happens if the user forgets to supply the version number? <code>data.version</code> is undefined
and the app still works! The biggest advantage of this approach is the fact that all <code>TRUE</code>
and <code>FALSE</code> (R) are converted to <code>true</code> and <code>false</code> (JS), which avoids unnecessary conversion steps.
However, we are still missing many potential configuration options. For instance, with the above code,
only <code>root</code>, <code>name</code>, <code>version</code>, <code>theme</code>, <code>notifications</code>, <code>touch</code> are considered. If the user
provides any other option, it is ignored.</p>
<p>In theory, this is what we could do to make sure that all elements are considered:</p>
<div class="sourceCode" id="cb869"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb869-1"><a href="mobile-shinyMobile.html#cb869-1"></a>app <span class="op">=</span> <span class="kw">new</span> <span class="at">Framework7</span>(config)<span class="op">;</span></span>
<span id="cb869-2"><a href="mobile-shinyMobile.html#cb869-2"></a><span class="co">// Don't forget to set the root!</span></span>
<span id="cb869-3"><a href="mobile-shinyMobile.html#cb869-3"></a><span class="va">config</span>.<span class="at">root</span> <span class="op">=</span> <span class="st">"#app"</span><span class="op">;</span></span></code></pre></div>
<p>It is assumed that the user exactly knows what to provide in the list, especially mandatory elements.
Knowing the tremendous number of options, it might be slightly overwhelming for a new user. What we suggest is to provide a default option list, say <code>shinyMobile_options</code>, available for <code><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page()</a></code>:</p>
<div class="sourceCode" id="cb870"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shinyMobile_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  theme <span class="op">=</span> <span class="st">"auto"</span>,
  dark <span class="op">=</span> <span class="cn">TRUE</span>,
  filled <span class="op">=</span> <span class="cn">FALSE</span>,
  color <span class="op">=</span> <span class="st">"#007aff"</span>,
  iosTranslucentBars <span class="op">=</span> <span class="cn">FALSE</span>,
  navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    iosCenterTitle <span class="op">=</span> <span class="cn">TRUE</span>,
    hideOnPageScroll <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>,
  toolbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    hideOnPageScroll <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span>,
  <span class="co"># remaining options ...</span>
<span class="op">)</span>

<span class="va">f7_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
  <span class="co"># other parameters are not mentioned</span>
  <span class="va">options</span> <span class="op">=</span> <span class="va">shinyMobile_options</span>
<span class="op">)</span> <span class="op">{</span>
  <span class="co"># function body ...</span>
<span class="op">}</span></code></pre></div>
<p>You only need to add one line of documentation in the roxygen part and write <code>app = new Framework7(config);</code> on the JS side, which is convenient to maintain. This approach avoids to create too many parameters, but be careful about the documentation, as it may cause frustration for the end user. Don’t forget that since <code>config</code> is an object,
you may add any other properties, methods, on the fly with the <code>.</code> notation or <code>app.utils.extend</code>.</p>
<div class="noteblock">
<p>You finally may ask why we put <code>dark</code>, <code>color</code> and <code>filled</code> in the options list given they
are not part of the app API parameters. As any unknown parameter is not considered by the <code>Framework7</code> class, we can definitely keep them here, which is easier to treat on the JS side.</p>
</div>
</div>
<div id="modify-configuration" class="section level3">
<h3>
<span class="header-section-number">23.5.5</span> Modify configuration<a class="anchor" aria-label="anchor" href="#modify-configuration"><i class="fas fa-link"></i></a>
</h3>
<p>As previously stated, the app configuration is passed during the initialization process, through
<code>new Framework7(config)</code>. What if the user wants to programmatically change these options
when the app is running?</p>
<p>Since app parameters are located in <code>app.params</code>, the idea would be to extend that list:</p>
<div class="sourceCode" id="cb871"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb871-1"><a href="mobile-shinyMobile.html#cb871-1"></a><span class="kw">let</span> newParams <span class="op">=</span> <span class="op">{</span></span>
<span id="cb871-2"><a href="mobile-shinyMobile.html#cb871-2"></a>  <span class="dt">dialog</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb871-3"><a href="mobile-shinyMobile.html#cb871-3"></a>    <span class="dt">buttonOk</span><span class="op">:</span>  <span class="st">"Yeaaaah!"</span><span class="op">,</span></span>
<span id="cb871-4"><a href="mobile-shinyMobile.html#cb871-4"></a>    <span class="dt">buttonCancel</span><span class="op">:</span> <span class="st">"Ouuups!"</span></span>
<span id="cb871-5"><a href="mobile-shinyMobile.html#cb871-5"></a>  <span class="op">}</span></span>
<span id="cb871-6"><a href="mobile-shinyMobile.html#cb871-6"></a><span class="op">}</span></span>
<span id="cb871-7"><a href="mobile-shinyMobile.html#cb871-7"></a><span class="va">app</span>.<span class="va">utils</span>.<span class="at">extend</span>(<span class="va">app</span>.<span class="at">params</span><span class="op">,</span> newParams)<span class="op">;</span></span></code></pre></div>
<p>The above example changes the default buttons text for all modal dialog.</p>
<div class="warningblock">
<p>As far as I know, some options won’t work like the <strong>global theme</strong>, which
would require to re-initialize the app and is not possible.</p>
</div>
</div>
<div id="mobile-global-data" class="section level3">
<h3>
<span class="header-section-number">23.5.6</span> Global data and methods<a class="anchor" aria-label="anchor" href="#mobile-global-data"><i class="fas fa-link"></i></a>
</h3>
<p>The Framework7 <strong>data</strong> parameters allows to store global elements, data, and use them in different scripts:</p>
<div class="sourceCode" id="cb872"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb872-1"><a href="mobile-shinyMobile.html#cb872-1"></a><span class="va">config</span>.<span class="at">data</span> <span class="op">=</span> <span class="kw">function</span> () <span class="op">{</span></span>
<span id="cb872-2"><a href="mobile-shinyMobile.html#cb872-2"></a>  <span class="cf">return</span> <span class="op">{</span></span>
<span id="cb872-3"><a href="mobile-shinyMobile.html#cb872-3"></a>    <span class="dt">username</span><span class="op">:</span> <span class="st">'dgranj'</span><span class="op">,</span></span>
<span id="cb872-4"><a href="mobile-shinyMobile.html#cb872-4"></a>    <span class="dt">firstName</span><span class="op">:</span> <span class="st">'David'</span><span class="op">,</span></span>
<span id="cb872-5"><a href="mobile-shinyMobile.html#cb872-5"></a>    <span class="dt">lastName</span><span class="op">:</span> <span class="st">'Granjon'</span><span class="op">,</span></span>
<span id="cb872-6"><a href="mobile-shinyMobile.html#cb872-6"></a>    <span class="co">// may also be array</span></span>
<span id="cb872-7"><a href="mobile-shinyMobile.html#cb872-7"></a>    <span class="dt">widgets</span><span class="op">:</span> []</span>
<span id="cb872-8"><a href="mobile-shinyMobile.html#cb872-8"></a>  <span class="op">};</span></span>
<span id="cb872-9"><a href="mobile-shinyMobile.html#cb872-9"></a><span class="op">};</span></span></code></pre></div>
<p>Similarly <strong>methods</strong> hosts all global app methods, functions you may re-use in different parts. Like for <code>app.data</code>, we access them with <code>app.methods</code>:</p>
<div class="sourceCode" id="cb873"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb873-1"><a href="mobile-shinyMobile.html#cb873-1"></a><span class="va">config</span>.<span class="at">methods</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb873-2"><a href="mobile-shinyMobile.html#cb873-2"></a>  <span class="dt">getUsername</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb873-3"><a href="mobile-shinyMobile.html#cb873-3"></a>    <span class="va">app</span>.<span class="va">data</span>.<span class="at">username</span><span class="op">;</span></span>
<span id="cb873-4"><a href="mobile-shinyMobile.html#cb873-4"></a>  <span class="op">},</span></span>
<span id="cb873-5"><a href="mobile-shinyMobile.html#cb873-5"></a>  <span class="co">// other methods</span></span>
<span id="cb873-6"><a href="mobile-shinyMobile.html#cb873-6"></a><span class="op">}</span></span></code></pre></div>
<div class="importantblock">
<p>Since Framework7 6.0.0, <code>app.data</code> has been removed in favor of a more flexible alternative called <code>store</code>. It is documented <a href="https://framework7.io/docs/store.html">here</a>.</p>
</div>
</div>
<div id="mobile-shinyMobile-other" class="section level3">
<h3>
<span class="header-section-number">23.5.7</span> Other elements<a class="anchor" aria-label="anchor" href="#mobile-shinyMobile-other"><i class="fas fa-link"></i></a>
</h3>
<p>Framework7 provides mobile specific modules like <a href=""><code>touch</code></a>, which is a long press event (here 750 ms). This is something you can usually do on many mobile apps. The touch module parameters are defined as follows:</p>
<div class="sourceCode" id="cb874"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb874-1"><a href="mobile-shinyMobile.html#cb874-1"></a>touch<span class="op">:</span> <span class="op">{</span></span>
<span id="cb874-2"><a href="mobile-shinyMobile.html#cb874-2"></a>  <span class="dt">tapHold</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb874-3"><a href="mobile-shinyMobile.html#cb874-3"></a>  <span class="dt">tapHoldDelay</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span></span>
<span id="cb874-4"><a href="mobile-shinyMobile.html#cb874-4"></a><span class="op">}</span></span></code></pre></div>
<p>which translates into a named list in R:</p>
<div class="sourceCode" id="cb875"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  tapHold <span class="op">=</span> <span class="cn">TRUE</span>,
  tapHoldDelay <span class="op">=</span> <span class="fl">750</span>,
  <span class="co"># other touch options</span>
<span class="op">)</span></code></pre></div>
<p>To activate that feature, we update <code><a href="https://rdrr.io/pkg/OSUICode/man/shinyMobile_options.html">shinyMobile_options()</a></code>:</p>
<div class="sourceCode" id="cb876"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shinyMobile_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  theme <span class="op">=</span> <span class="st">"auto"</span>,
  dark <span class="op">=</span> <span class="cn">TRUE</span>,
  filled <span class="op">=</span> <span class="cn">FALSE</span>,
  color <span class="op">=</span> <span class="st">"#007aff"</span>,
  iosTranslucentBars <span class="op">=</span> <span class="cn">FALSE</span>,
  navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    iosCenterTitle <span class="op">=</span> <span class="cn">TRUE</span>,
    hideOnPageScroll <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>,
  toolbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    hideOnPageScroll <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span>,
  <span class="co"># TOUCH MODULE OPTIONS</span>
  touch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    tapHold <span class="op">=</span> <span class="cn">TRUE</span>,
    tapHoldDelay <span class="op">=</span> <span class="fl">750</span>,
    iosTouchRipple <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span>
  <span class="co"># remaining options ...</span>
<span class="op">)</span></code></pre></div>
<p>We create a button element and add it the <code>taphold</code> event in <code>init.js</code>:</p>
<div class="sourceCode" id="cb877"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb877-1"><a href="mobile-shinyMobile.html#cb877-1"></a><span class="at">$</span>(<span class="st">'#mybutton'</span>).<span class="at">on</span>(<span class="st">'taphold'</span><span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></span>
<span id="cb877-2"><a href="mobile-shinyMobile.html#cb877-2"></a>  <span class="va">app</span>.<span class="va">dialog</span>.<span class="at">alert</span>(<span class="st">'Tap hold fired!'</span>)<span class="op">;</span></span>
<span id="cb877-3"><a href="mobile-shinyMobile.html#cb877-3"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>The <code>app.R</code> script should look like:</p>
<div class="sourceCode" id="cb878"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "shinyMobile/taphold" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page</a></span><span class="op">(</span>
  allowPWA <span class="op">=</span> <span class="cn">FALSE</span>,
  <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"list inset"</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span>
        <span class="va">tags</span><span class="op">$</span><span class="fu">a</span><span class="op">(</span>
          href <span class="op">=</span> <span class="st">"#"</span>,
          id <span class="op">=</span> <span class="st">"mybutton"</span>,
          class <span class="op">=</span> <span class="st">"list-button color-red"</span>,
          <span class="st">"Large Red Button"</span>
        <span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>,
  navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_navbar.html">f7_navbar</a></span><span class="op">(</span><span class="st">"Taphold demo"</span><span class="op">)</span>,
  toolbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_toolbar.html">f7_toolbar</a></span><span class="op">(</span><span class="op">)</span>,
  title <span class="op">=</span> <span class="st">"shinyMobile"</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<div class="warningblock">
<p>Once the app is running, don’t forget to open the developer tools and
set the device on mobile mode (iPhone or android) since <code>taphold</code> does not fire
on desktop (Figure <a href="mobile-shinyMobile.html#fig:mobile-shinyMobile-taphold">23.5</a>). You may place a breakpoint
inside the <code>taphold</code> event listener to check that it is properly triggered.</p>
</div>
<p><code>taphold</code> also triggers events related to the click like text selection, which is rarely desirable. Hence, we have to add the following code to <code>init.js</code>, making sure to check that <code>touch</code> exists:</p>
<div class="sourceCode" id="cb879"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb879-1"><a href="mobile-shinyMobile.html#cb879-1"></a><span class="co">// tapHold custom css</span></span>
<span id="cb879-2"><a href="mobile-shinyMobile.html#cb879-2"></a><span class="cf">if</span> (<span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">"touch"</span>)) <span class="op">{</span></span>
<span id="cb879-3"><a href="mobile-shinyMobile.html#cb879-3"></a>  <span class="cf">if</span> (<span class="va">config</span>.<span class="va">touch</span>.<span class="at">tapHold</span>) <span class="op">{</span></span>
<span id="cb879-4"><a href="mobile-shinyMobile.html#cb879-4"></a>    <span class="at">$</span>(<span class="st">"&lt;style&gt;"</span>)</span>
<span id="cb879-5"><a href="mobile-shinyMobile.html#cb879-5"></a>      .<span class="at">prop</span>(<span class="st">"type"</span><span class="op">,</span> <span class="st">"text/css"</span>)</span>
<span id="cb879-6"><a href="mobile-shinyMobile.html#cb879-6"></a>      .<span class="at">html</span>(</span>
<span id="cb879-7"><a href="mobile-shinyMobile.html#cb879-7"></a>        <span class="vs">`-moz-user-select: none;</span></span>
<span id="cb879-8"><a href="mobile-shinyMobile.html#cb879-8"></a><span class="vs">        -webkit-user-select: none;</span></span>
<span id="cb879-9"><a href="mobile-shinyMobile.html#cb879-9"></a><span class="vs">        user-select: none;`</span></span>
<span id="cb879-10"><a href="mobile-shinyMobile.html#cb879-10"></a>      )</span>
<span id="cb879-11"><a href="mobile-shinyMobile.html#cb879-11"></a>      .<span class="at">appendTo</span>(<span class="st">"head"</span>)<span class="op">;</span></span>
<span id="cb879-12"><a href="mobile-shinyMobile.html#cb879-12"></a>  <span class="op">}</span></span>
<span id="cb879-13"><a href="mobile-shinyMobile.html#cb879-13"></a><span class="op">}</span></span></code></pre></div>
<p>It disables classic text selection after a long press in the window.</p>
<div class="figure">
<span style="display:block;" id="fig:mobile-shinyMobile-taphold"></span>
<img src="images/mobile/mobile-shinymobile-taphold.png" alt="Long press or taphold event" width="100%"><p class="caption">
FIGURE 23.5: Long press or taphold event
</p>
</div>
<p>An important remark is the click handling in Framework7. Framework7 has its own internal <a href="https://framework7.io/docs/view.html">router</a> that allows to pass data between pages and perform quite
advanced actions. Do you remember the <code>app.views.create('.view-main');</code> step? This real purpose is actually to activate the internal router. While extremely convenient for classic web apps,
this feature is not completely suited for Shiny that does not natively support multi pages apps.
The recent <a href="https://github.com/ColinFay/brochure">work</a> in the field is promising and plays well
with <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> (see <a href="https://github.com/RinteRface/shinyMobile/issues/136">here</a>) but this is out of the scope of this chapter. The internal router has strong implications, for instance clicking on
<code>&lt;a href="https://www.google.com/"&gt;Click me&lt;/a&gt;</code> will fail (while it works like
a charm for a classic shiny app).</p>
<p>To fix this issue, Framework7 has a <code>clicks</code> module options, accepting any valid CSS selector.
Below is the default configuration:</p>
<div class="sourceCode" id="cb880"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb880-1"><a href="mobile-shinyMobile.html#cb880-1"></a>clicks<span class="op">:</span> <span class="op">{</span></span>
<span id="cb880-2"><a href="mobile-shinyMobile.html#cb880-2"></a>  <span class="dt">externalLinks</span><span class="op">:</span> <span class="st">'.external'</span><span class="op">,</span></span>
<span id="cb880-3"><a href="mobile-shinyMobile.html#cb880-3"></a><span class="op">}</span></span></code></pre></div>
<p>Consequently, in order to skip the internal router, links must have the <code>.external</code> class.</p>
<div class="sourceCode" id="cb881"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "shinyMobile/links" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="va">my_broken_link</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">a</a></span><span class="op">(</span>
  href <span class="op">=</span> <span class="st">"https://www.google.com/"</span>,
  <span class="st">"Broken link"</span>
<span class="op">)</span>
<span class="va">my_external_link</span> <span class="op">&lt;-</span> <span class="va">my_broken_link</span>
<span class="va">my_external_link</span><span class="op">$</span><span class="va">attribs</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="st">"external"</span>
<span class="va">my_external_link</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"External link"</span>

<span class="co"># shinyMobile</span>
<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page</a></span><span class="op">(</span>
  allowPWA <span class="op">=</span> <span class="cn">FALSE</span>,
  navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_navbar.html">f7_navbar</a></span><span class="op">(</span><span class="st">"Links"</span><span class="op">)</span>,
  toolbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_toolbar.html">f7_toolbar</a></span><span class="op">(</span>
    <span class="va">my_broken_link</span>,
    <span class="va">my_external_link</span>
  <span class="op">)</span>,
  title <span class="op">=</span> <span class="st">"shinyMobile"</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<div class="importantblock">
<p>One might be tempted to target all <code>a</code> elements: this is a bad idea,
as it also target tabs navigation, which eventually fails! Therefore, it is best
practice to add the <code>external</code> class to all the necessary links like <code><a href="https://rdrr.io/pkg/htmltools/man/builder.html">a(href = "https://www.google.com/", "Click me", class = "external")</a></code></p>
</div>
</div>
</div>
<div id="mobile-shinyMobile-theming" class="section level2">
<h2>
<span class="header-section-number">23.6</span> Theming and colors<a class="anchor" aria-label="anchor" href="#mobile-shinyMobile-theming"><i class="fas fa-link"></i></a>
</h2>
<p>Framework7 offers 15 color <a href="https://framework7.io/docs/color-themes.html?theme=light&amp;bars=empty&amp;color=%09+%23673ab7">themes</a> with a dark/light global appearance. To apply them, we add <code>color-theme-COLOR</code> to the
parent element. Best practice is to target the <code>body</code> since it is the parent of all the page
content, thereby ensuring global consistency. The dark theme is triggered by adding the
<code>theme-dark</code> class to <code>html</code>. Since <code>body</code> belongs to <code><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page()</a></code> but not <code>html</code> (added by
Shiny at startup), we can apply the color in R, while the dark mode has to be activated from JS:</p>
<div class="sourceCode" id="cb882"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f7_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">navbar</span>, <span class="va">toolbar</span>, 
                    <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">options</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">body_cl</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">options</span><span class="op">$</span><span class="va">color</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">body_cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"color-theme-%s"</span>, <span class="va">options</span><span class="op">$</span><span class="va">color</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="co"># Config tag (unchanged)</span>
  
  <span class="co"># Modify the body tag to add a class</span>
  <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span>
    class <span class="op">=</span> <span class="va">body_cl</span>,
    <span class="co"># ... App wrapper (unchanged),</span>
    <span class="va">config_tag</span>
  <span class="op">)</span>
  
  <span class="co"># ...</span>
  
<span class="op">}</span></code></pre></div>
<p>This approach assumes the user to pass the color name as parameter like <code>pink</code>, <code>yellow</code> and won’t be considered in the remaining of the book.
What if we want to allow more flexibility and add any existing HEX color?
Framework7 has tools, namely <code>app.utils.colorThemeCSSProperties</code>, that is a JS method
creating the required CSS on the fly depending on the provided HEX color. For instance, if we select a
cyberpunk green color:</p>
<div class="sourceCode" id="cb883"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb883-1"><a href="mobile-shinyMobile.html#cb883-1"></a><span class="va">app</span>.<span class="va">utils</span>.<span class="at">colorThemeCSSProperties</span>(<span class="st">'#42f5a1'</span>)<span class="op">;</span></span>
<span id="cb883-2"><a href="mobile-shinyMobile.html#cb883-2"></a><span class="co">// /* Custom color theme */</span></span>
<span id="cb883-3"><a href="mobile-shinyMobile.html#cb883-3"></a><span class="co">// {</span></span>
<span id="cb883-4"><a href="mobile-shinyMobile.html#cb883-4"></a><span class="co">//   "--f7-theme-color": "#42f5a1";</span></span>
<span id="cb883-5"><a href="mobile-shinyMobile.html#cb883-5"></a><span class="co">//   "--f7-theme-color-rgb": "66, 245, 161";</span></span>
<span id="cb883-6"><a href="mobile-shinyMobile.html#cb883-6"></a><span class="co">//   "--f7-theme-color-shade": "#1bf38e";</span></span>
<span id="cb883-7"><a href="mobile-shinyMobile.html#cb883-7"></a><span class="co">//   "--f7-theme-color-tint": "#69f7b4";</span></span>
<span id="cb883-8"><a href="mobile-shinyMobile.html#cb883-8"></a><span class="co">// }</span></span></code></pre></div>
<p>The commented code has to be injected in the app CSS. I personally don’t think its a problem
to look for a specific HEX code, knowing that many tools can help. Therefore, I prefer the
second approach. We edit the <code>init.js</code> code by adding the following JS snippet:</p>
<div class="sourceCode" id="cb884"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb884-1"><a href="mobile-shinyMobile.html#cb884-1"></a><span class="cf">if</span> (<span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">'color'</span>)) <span class="op">{</span></span>
<span id="cb884-2"><a href="mobile-shinyMobile.html#cb884-2"></a>  <span class="kw">let</span> colorCSS <span class="op">=</span> <span class="va">app</span>.<span class="va">utils</span>.<span class="at">colorThemeCSSProperties</span>(<span class="va">config</span>.<span class="at">color</span>)<span class="op">;</span></span>
<span id="cb884-3"><a href="mobile-shinyMobile.html#cb884-3"></a>  <span class="at">$</span>(<span class="st">'&lt;style&gt;'</span>)</span>
<span id="cb884-4"><a href="mobile-shinyMobile.html#cb884-4"></a>    .<span class="at">prop</span>(<span class="st">'type'</span><span class="op">,</span> <span class="st">'text/css'</span>)</span>
<span id="cb884-5"><a href="mobile-shinyMobile.html#cb884-5"></a>    .<span class="at">html</span>(<span class="vs">`:root {</span></span>
<span id="cb884-6"><a href="mobile-shinyMobile.html#cb884-6"></a><span class="vs">      --f7-theme-color: </span><span class="sc">${</span>colorCSS[<span class="st">"--f7-theme-color"</span>]<span class="sc">}</span><span class="vs">;</span></span>
<span id="cb884-7"><a href="mobile-shinyMobile.html#cb884-7"></a><span class="vs">      --f7-theme-color-rgb: </span><span class="sc">${</span>colorCSS[<span class="st">"--f7-theme-color-rgb"</span>]<span class="sc">}</span><span class="vs">;</span></span>
<span id="cb884-8"><a href="mobile-shinyMobile.html#cb884-8"></a><span class="vs">      --f7-theme-color-shade: </span><span class="sc">${</span>colorCSS[<span class="st">"--f7-theme-color-shade"</span>]<span class="sc">}</span><span class="vs">;</span></span>
<span id="cb884-9"><a href="mobile-shinyMobile.html#cb884-9"></a><span class="vs">      --f7-theme-color-tint: </span><span class="sc">${</span>colorCSS[<span class="st">"--f7-theme-color-tint"</span>]<span class="sc">}</span><span class="vs">;</span></span>
<span id="cb884-10"><a href="mobile-shinyMobile.html#cb884-10"></a><span class="vs">    }`</span>)</span>
<span id="cb884-11"><a href="mobile-shinyMobile.html#cb884-11"></a>    .<span class="at">appendTo</span>(<span class="st">"head"</span>)<span class="op">;</span></span>
<span id="cb884-12"><a href="mobile-shinyMobile.html#cb884-12"></a><span class="op">}</span></span></code></pre></div>
<p><code>config.hasOwnProperty('color')</code> ensures that this code does not run if color is missing from the
provided config. Then, we generate an object, <code>colorCSS</code>, containing the theme color properties with <code>app.utils.colorThemeCSSProperties(config.color)</code>.
Importantly, as this is an object, we can’t insert it in a string. However, we can extract its
properties 1 by 1 to generate the relevant piece of CSS, for instance <code>colorCSS["--f7-theme-color"]</code>. Then we add a <code>style</code> tag to the <code>head</code>
containing the CSS rule. Once done, recompile the JS
with <code><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js()</a></code> and try with the following app.</p>
<div class="sourceCode" id="cb885"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "shinyMobile/white-filled" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="va">shinyMobile_options</span><span class="op">$</span><span class="va">filled</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="va">shinyMobile_options</span><span class="op">$</span><span class="va">dark</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page</a></span><span class="op">(</span>
  allowPWA <span class="op">=</span> <span class="cn">FALSE</span>,
  options <span class="op">=</span> <span class="va">shinyMobile_options</span>,
  <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"block"</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">button</span><span class="op">(</span>
      class <span class="op">=</span> <span class="st">"button button-large button-fill"</span>,
      <span class="st">"Click"</span>
    <span class="op">)</span>
  <span class="op">)</span>,
  navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_navbar.html">f7_navbar</a></span><span class="op">(</span><span class="st">"White/filled design"</span><span class="op">)</span>,
  toolbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_toolbar.html">f7_toolbar</a></span><span class="op">(</span><span class="op">)</span>,
  title <span class="op">=</span> <span class="st">"shinyMobile"</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>We can go further and apply the <code>filled</code> theme, which is an alternative design where all
<code>navbar</code>, <code>toolbar</code>, … are filled with the theme color. In that case, we add the following CSS inside <code>init.js</code>:</p>
<div class="sourceCode" id="cb886"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb886-1"><a href="mobile-shinyMobile.html#cb886-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">'filled'</span>)) <span class="va">config</span>.<span class="at">filled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb886-2"><a href="mobile-shinyMobile.html#cb886-2"></a><span class="cf">if</span> (<span class="va">config</span>.<span class="at">filled</span>) <span class="op">{</span></span>
<span id="cb886-3"><a href="mobile-shinyMobile.html#cb886-3"></a>  <span class="kw">let</span> filledCSS <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb886-4"><a href="mobile-shinyMobile.html#cb886-4"></a><span class="vs">    :root,</span></span>
<span id="cb886-5"><a href="mobile-shinyMobile.html#cb886-5"></a><span class="vs">    :root.theme-dark,</span></span>
<span id="cb886-6"><a href="mobile-shinyMobile.html#cb886-6"></a><span class="vs">    :root .theme-dark {</span></span>
<span id="cb886-7"><a href="mobile-shinyMobile.html#cb886-7"></a><span class="vs">      --f7-bars-bg-color: var(--f7-theme-color);</span></span>
<span id="cb886-8"><a href="mobile-shinyMobile.html#cb886-8"></a><span class="vs">      --f7-bars-bg-color-rgb: var(--f7-theme-color-rgb);</span></span>
<span id="cb886-9"><a href="mobile-shinyMobile.html#cb886-9"></a><span class="vs">      --f7-bars-translucent-opacity: 0.9;</span></span>
<span id="cb886-10"><a href="mobile-shinyMobile.html#cb886-10"></a><span class="vs">      --f7-bars-text-color: #fff;</span></span>
<span id="cb886-11"><a href="mobile-shinyMobile.html#cb886-11"></a><span class="vs">      --f7-bars-link-color: #fff;</span></span>
<span id="cb886-12"><a href="mobile-shinyMobile.html#cb886-12"></a><span class="vs">      --f7-navbar-subtitle-text-color: rgba(255,255,255,0.85);</span></span>
<span id="cb886-13"><a href="mobile-shinyMobile.html#cb886-13"></a><span class="vs">      --f7-bars-border-color: transparent;</span></span>
<span id="cb886-14"><a href="mobile-shinyMobile.html#cb886-14"></a><span class="vs">      --f7-tabbar-link-active-color: #fff;</span></span>
<span id="cb886-15"><a href="mobile-shinyMobile.html#cb886-15"></a><span class="vs">      --f7-tabbar-link-inactive-color: rgba(255,255,255,0.54);</span></span>
<span id="cb886-16"><a href="mobile-shinyMobile.html#cb886-16"></a><span class="vs">      --f7-sheet-border-color: transparent;</span></span>
<span id="cb886-17"><a href="mobile-shinyMobile.html#cb886-17"></a><span class="vs">      --f7-tabbar-link-active-border-color: #fff;</span></span>
<span id="cb886-18"><a href="mobile-shinyMobile.html#cb886-18"></a><span class="vs">    }</span></span>
<span id="cb886-19"><a href="mobile-shinyMobile.html#cb886-19"></a><span class="vs">    .appbar,</span></span>
<span id="cb886-20"><a href="mobile-shinyMobile.html#cb886-20"></a><span class="vs">    .navbar,</span></span>
<span id="cb886-21"><a href="mobile-shinyMobile.html#cb886-21"></a><span class="vs">    .toolbar,</span></span>
<span id="cb886-22"><a href="mobile-shinyMobile.html#cb886-22"></a><span class="vs">    .subnavbar,</span></span>
<span id="cb886-23"><a href="mobile-shinyMobile.html#cb886-23"></a><span class="vs">    .calendar-header,</span></span>
<span id="cb886-24"><a href="mobile-shinyMobile.html#cb886-24"></a><span class="vs">    .calendar-footer {</span></span>
<span id="cb886-25"><a href="mobile-shinyMobile.html#cb886-25"></a><span class="vs">      --f7-touch-ripple-color: var(--f7-touch-ripple-white);</span></span>
<span id="cb886-26"><a href="mobile-shinyMobile.html#cb886-26"></a><span class="vs">      --f7-link-highlight-color: var(--f7-link-highlight-white);</span></span>
<span id="cb886-27"><a href="mobile-shinyMobile.html#cb886-27"></a><span class="vs">      --f7-button-text-color: #fff;</span></span>
<span id="cb886-28"><a href="mobile-shinyMobile.html#cb886-28"></a><span class="vs">      --f7-button-pressed-bg-color: rgba(255,255,255,0.1);</span></span>
<span id="cb886-29"><a href="mobile-shinyMobile.html#cb886-29"></a><span class="vs">    }</span></span>
<span id="cb886-30"><a href="mobile-shinyMobile.html#cb886-30"></a><span class="vs">    .navbar-large-transparent,</span></span>
<span id="cb886-31"><a href="mobile-shinyMobile.html#cb886-31"></a><span class="vs">    .navbar-large.navbar-transparent {</span></span>
<span id="cb886-32"><a href="mobile-shinyMobile.html#cb886-32"></a><span class="vs">      --f7-navbar-large-title-text-color: #000;</span></span>
<span id="cb886-33"><a href="mobile-shinyMobile.html#cb886-33"></a><span class="vs">    </span></span>
<span id="cb886-34"><a href="mobile-shinyMobile.html#cb886-34"></a><span class="vs">      --r: 0;</span></span>
<span id="cb886-35"><a href="mobile-shinyMobile.html#cb886-35"></a><span class="vs">      --g: 122;</span></span>
<span id="cb886-36"><a href="mobile-shinyMobile.html#cb886-36"></a><span class="vs">      --b: 255;</span></span>
<span id="cb886-37"><a href="mobile-shinyMobile.html#cb886-37"></a><span class="vs">      --progress: var(--f7-navbar-large-collapse-progress);</span></span>
<span id="cb886-38"><a href="mobile-shinyMobile.html#cb886-38"></a><span class="vs">      --f7-bars-link-color: rgb(</span></span>
<span id="cb886-39"><a href="mobile-shinyMobile.html#cb886-39"></a><span class="vs">        calc(var(--r) + (255 - var(--r)) * var(--progress)),</span></span>
<span id="cb886-40"><a href="mobile-shinyMobile.html#cb886-40"></a><span class="vs">        calc(var(--g) + (255 - var(--g)) * var(--progress)),</span></span>
<span id="cb886-41"><a href="mobile-shinyMobile.html#cb886-41"></a><span class="vs">        calc(var(--b) + (255 - var(--b)) * var(--progress))</span></span>
<span id="cb886-42"><a href="mobile-shinyMobile.html#cb886-42"></a><span class="vs">      );</span></span>
<span id="cb886-43"><a href="mobile-shinyMobile.html#cb886-43"></a><span class="vs">    }</span></span>
<span id="cb886-44"><a href="mobile-shinyMobile.html#cb886-44"></a><span class="vs">    .theme-dark .navbar-large-transparent,</span></span>
<span id="cb886-45"><a href="mobile-shinyMobile.html#cb886-45"></a><span class="vs">    .theme-dark .navbar-large.navbar-transparent {</span></span>
<span id="cb886-46"><a href="mobile-shinyMobile.html#cb886-46"></a><span class="vs">      --f7-navbar-large-title-text-color: #fff;</span></span>
<span id="cb886-47"><a href="mobile-shinyMobile.html#cb886-47"></a><span class="vs">  }`</span><span class="op">;</span></span>
<span id="cb886-48"><a href="mobile-shinyMobile.html#cb886-48"></a>  </span>
<span id="cb886-49"><a href="mobile-shinyMobile.html#cb886-49"></a>  <span class="at">$</span>(<span class="st">'&lt;style&gt;'</span>)</span>
<span id="cb886-50"><a href="mobile-shinyMobile.html#cb886-50"></a>    .<span class="at">prop</span>(<span class="st">'type'</span><span class="op">,</span> <span class="st">'text/css'</span>)</span>
<span id="cb886-51"><a href="mobile-shinyMobile.html#cb886-51"></a>    .<span class="at">html</span>(<span class="vs">`</span><span class="sc">${</span>filledCSS<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb886-52"><a href="mobile-shinyMobile.html#cb886-52"></a>    .<span class="at">appendTo</span>(<span class="st">"head"</span>)<span class="op">;</span></span>
<span id="cb886-53"><a href="mobile-shinyMobile.html#cb886-53"></a><span class="op">}</span></span></code></pre></div>
<p>The result is displayed on Figure <a href="mobile-shinyMobile.html#fig:mobile-shinyMobile-theming">23.6</a>. Don’t forget to set <code>filled = TRUE</code> in <code>shinyMobile_options</code>.</p>
<div class="figure">
<span style="display:block;" id="fig:mobile-shinyMobile-theming"></span>
<img src="images/mobile/mobile-shinyMobile-theming.png" alt="Filled blue color theme" width="100%"><p class="caption">
FIGURE 23.6: Filled blue color theme
</p>
</div>
<p>Let’s finish this section with the <strong>dark</strong> mode. We leverage the Framework7 app method
element since we could also toggle the dark mode under other circumstances. We add a
<code>toggleDarkTheme</code> function to the methods object then trigger it depending on the value
of the config. If the user don’t provide any value, we set <code>config.dark</code> to <code>false</code>. We insert it right before <code>app = new Framework7(config);</code> inside <code>init.js</code>:</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb887-1"><a href="mobile-shinyMobile.html#cb887-1"></a><span class="co">// ... get config</span></span>
<span id="cb887-2"><a href="mobile-shinyMobile.html#cb887-2"></a><span class="va">config</span>.<span class="at">methods</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb887-3"><a href="mobile-shinyMobile.html#cb887-3"></a>  <span class="dt">toggleDarkTheme</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></span>
<span id="cb887-4"><a href="mobile-shinyMobile.html#cb887-4"></a>    <span class="kw">let</span> self <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb887-5"><a href="mobile-shinyMobile.html#cb887-5"></a>    <span class="kw">let</span> $html <span class="op">=</span> <span class="va">self</span>.<span class="at">$</span>(<span class="st">'html'</span>)<span class="op">;</span></span>
<span id="cb887-6"><a href="mobile-shinyMobile.html#cb887-6"></a>    <span class="va">$html</span>.<span class="at">toggleClass</span>(<span class="st">'theme-dark'</span>)<span class="op">;</span></span>
<span id="cb887-7"><a href="mobile-shinyMobile.html#cb887-7"></a>  <span class="op">}</span></span>
<span id="cb887-8"><a href="mobile-shinyMobile.html#cb887-8"></a><span class="op">};</span></span>
<span id="cb887-9"><a href="mobile-shinyMobile.html#cb887-9"></a></span>
<span id="cb887-10"><a href="mobile-shinyMobile.html#cb887-10"></a><span class="cf">if</span> (<span class="op">!</span><span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">'dark'</span>)) <span class="va">config</span>.<span class="at">dark</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb887-11"><a href="mobile-shinyMobile.html#cb887-11"></a></span>
<span id="cb887-12"><a href="mobile-shinyMobile.html#cb887-12"></a>app <span class="op">=</span> <span class="kw">new</span> <span class="at">Framework7</span>(config)<span class="op">;</span></span>
<span id="cb887-13"><a href="mobile-shinyMobile.html#cb887-13"></a></span>
<span id="cb887-14"><a href="mobile-shinyMobile.html#cb887-14"></a><span class="cf">if</span> (<span class="va">config</span>.<span class="at">dark</span>) <span class="op">{</span></span>
<span id="cb887-15"><a href="mobile-shinyMobile.html#cb887-15"></a>  <span class="va">app</span>.<span class="va">methods</span>.<span class="at">toggleDarkTheme</span>()<span class="op">;</span></span>
<span id="cb887-16"><a href="mobile-shinyMobile.html#cb887-16"></a><span class="op">}</span></span>
<span id="cb887-17"><a href="mobile-shinyMobile.html#cb887-17"></a></span>
<span id="cb887-18"><a href="mobile-shinyMobile.html#cb887-18"></a><span class="co">// ... other code</span></span></code></pre></div>
<p>At this point <code>init.js</code> is given in appendix <a href="code-outputs.html#mobile-shinyMobile-appendix">A.2.1</a>.</p>
<div class="sourceCode" id="cb888"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "shinyMobile/dark-filled" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="va">shinyMobile_options</span><span class="op">$</span><span class="va">filled</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page</a></span><span class="op">(</span>
  allowPWA <span class="op">=</span> <span class="cn">FALSE</span>,
  options <span class="op">=</span> <span class="va">shinyMobile_options</span>,
  <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"block"</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">button</span><span class="op">(</span>
      class <span class="op">=</span> <span class="st">"button button-large button-fill"</span>,
      <span class="st">"Click"</span>
    <span class="op">)</span>
  <span class="op">)</span>,
  navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_navbar.html">f7_navbar</a></span><span class="op">(</span><span class="st">"Dark/filled design"</span><span class="op">)</span>,
  toolbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_toolbar.html">f7_toolbar</a></span><span class="op">(</span><span class="op">)</span>,
  title <span class="op">=</span> <span class="st">"shinyMobile"</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>The overall expected result is shown Figure <a href="mobile-shinyMobile.html#fig:mobile-shinyMobile-dark">23.7</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:mobile-shinyMobile-dark"></span>
<img src="images/mobile/mobile-shinyMobile-dark.png" alt="Dark mode in {shinyMobile}" width="100%"><p class="caption">
FIGURE 23.7: Dark mode in {shinyMobile}
</p>
</div>
</div>
<div id="mobile-modularizeJS" class="section level2">
<h2>
<span class="header-section-number">23.7</span> Modularize JS code<a class="anchor" aria-label="anchor" href="#mobile-modularizeJS"><i class="fas fa-link"></i></a>
</h2>
<p>As shown above, the <code>init.js</code> code starts to grow and this is not a good sign.
In this section, we show how to utilize the <code>import</code> and <code>export</code> statements, possible
owing to the <code>esbuild</code> JS bundler. Note that this is a more modern version of writing equivalent to the <code>module.exports</code> and <code>require</code> shown in <a href="survival-kit-javascript.html#about-js-modules">10.4.6.1</a>.</p>
<p>In the R console, we run <code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_js("helpers_config", add_reference = FALSE)</a></code>, which creates a new JS script but does not import it in the <code>main.js</code> <code>esbuild</code> entry point. Inside we extract a function containing all steps to set up the app configuration object:</p>
<div class="sourceCode" id="cb889"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb889-1"><a href="mobile-shinyMobile.html#cb889-1"></a><span class="im">export</span> <span class="kw">const</span> setConfig <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb889-2"><a href="mobile-shinyMobile.html#cb889-2"></a>  <span class="co">// collect all data elements stored in body</span></span>
<span id="cb889-3"><a href="mobile-shinyMobile.html#cb889-3"></a>  <span class="kw">let</span> config <span class="op">=</span> <span class="at">$</span>(document).<span class="at">find</span>(<span class="st">"script[data-for='app']"</span>)<span class="op">;</span></span>
<span id="cb889-4"><a href="mobile-shinyMobile.html#cb889-4"></a>  config <span class="op">=</span> <span class="va">JSON</span>.<span class="at">parse</span>(<span class="va">config</span>.<span class="at">html</span>())<span class="op">;</span></span>
<span id="cb889-5"><a href="mobile-shinyMobile.html#cb889-5"></a></span>
<span id="cb889-6"><a href="mobile-shinyMobile.html#cb889-6"></a>  <span class="co">// always erase existing root value just in case the user </span></span>
<span id="cb889-7"><a href="mobile-shinyMobile.html#cb889-7"></a>  <span class="co">// changes the root. This may be harmful</span></span>
<span id="cb889-8"><a href="mobile-shinyMobile.html#cb889-8"></a>  <span class="va">config</span>.<span class="at">root</span> <span class="op">=</span> <span class="st">"#app"</span><span class="op">;</span></span>
<span id="cb889-9"><a href="mobile-shinyMobile.html#cb889-9"></a></span>
<span id="cb889-10"><a href="mobile-shinyMobile.html#cb889-10"></a>  <span class="co">// store app methods</span></span>
<span id="cb889-11"><a href="mobile-shinyMobile.html#cb889-11"></a>  <span class="va">config</span>.<span class="at">methods</span> <span class="op">=</span>  <span class="op">{</span></span>
<span id="cb889-12"><a href="mobile-shinyMobile.html#cb889-12"></a>    <span class="dt">toggleDarkTheme</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb889-13"><a href="mobile-shinyMobile.html#cb889-13"></a>      <span class="kw">let</span> self <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb889-14"><a href="mobile-shinyMobile.html#cb889-14"></a>      <span class="kw">let</span> $html <span class="op">=</span> <span class="va">self</span>.<span class="at">$</span>(<span class="st">"html"</span>)<span class="op">;</span></span>
<span id="cb889-15"><a href="mobile-shinyMobile.html#cb889-15"></a>      <span class="va">$html</span>.<span class="at">toggleClass</span>(<span class="st">"theme-dark"</span>)<span class="op">;</span></span>
<span id="cb889-16"><a href="mobile-shinyMobile.html#cb889-16"></a>    <span class="op">}</span></span>
<span id="cb889-17"><a href="mobile-shinyMobile.html#cb889-17"></a>  <span class="op">};</span></span>
<span id="cb889-18"><a href="mobile-shinyMobile.html#cb889-18"></a></span>
<span id="cb889-19"><a href="mobile-shinyMobile.html#cb889-19"></a>  <span class="co">// App data</span></span>
<span id="cb889-20"><a href="mobile-shinyMobile.html#cb889-20"></a>  <span class="va">config</span>.<span class="at">data</span> <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb889-21"><a href="mobile-shinyMobile.html#cb889-21"></a>    <span class="cf">return</span> <span class="op">{</span></span>
<span id="cb889-22"><a href="mobile-shinyMobile.html#cb889-22"></a>      <span class="co">// any interesting element to save</span></span>
<span id="cb889-23"><a href="mobile-shinyMobile.html#cb889-23"></a>    <span class="op">};</span></span>
<span id="cb889-24"><a href="mobile-shinyMobile.html#cb889-24"></a>  <span class="op">};</span></span>
<span id="cb889-25"><a href="mobile-shinyMobile.html#cb889-25"></a></span>
<span id="cb889-26"><a href="mobile-shinyMobile.html#cb889-26"></a>  <span class="cf">return</span> config<span class="op">;</span></span>
<span id="cb889-27"><a href="mobile-shinyMobile.html#cb889-27"></a><span class="op">};</span></span></code></pre></div>
<p>This function does not have any argument and must return the <code>config</code> variable that will be subsequently injected in <code>new Framework7(config)</code> to initialize the app. In the <code>init.js</code> script, we import the <code>setConfig()</code> function and call it within <code>$( document ).ready</code>:</p>
<div class="sourceCode" id="cb890"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb890-1"><a href="mobile-shinyMobile.html#cb890-1"></a><span class="im">import</span> <span class="op">{</span> setConfig <span class="op">}</span> <span class="im">from</span> <span class="st">'./helpers_config.js'</span><span class="op">;</span></span>
<span id="cb890-2"><a href="mobile-shinyMobile.html#cb890-2"></a></span>
<span id="cb890-3"><a href="mobile-shinyMobile.html#cb890-3"></a><span class="at">$</span>( document ).<span class="at">ready</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb890-4"><a href="mobile-shinyMobile.html#cb890-4"></a>  <span class="kw">let</span> config <span class="op">=</span> <span class="at">setConfig</span>()<span class="op">;</span></span>
<span id="cb890-5"><a href="mobile-shinyMobile.html#cb890-5"></a>  <span class="co">// create app instance</span></span>
<span id="cb890-6"><a href="mobile-shinyMobile.html#cb890-6"></a>  app <span class="op">=</span> <span class="kw">new</span> <span class="at">Framework7</span>(config)<span class="op">;</span></span>
<span id="cb890-7"><a href="mobile-shinyMobile.html#cb890-7"></a>  <span class="co">// ...</span></span>
<span id="cb890-8"><a href="mobile-shinyMobile.html#cb890-8"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>We finally bundle our code with <code><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js()</a></code>.</p>
<div class="warningblock">
<p>If the function has a side effect, for instance modify a variable located in another scope, it must return the transformed variable output, so that it can be tracked at the upper level.</p>
</div>
<p>We have now set all foundations. In the next chapter, we see how to convert a <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> app (and any vanilla shiny app) into a <strong>progressive web app</strong> (PWA).</p>
</div>
<div id="exercise-4" class="section level2">
<h2>
<span class="header-section-number">23.8</span> Exercise<a class="anchor" aria-label="anchor" href="#exercise-4"><i class="fas fa-link"></i></a>
</h2>
<p>Continue to improve the JS code by adding an extra helper consisting of all related theme and layout features.</p>
<ol style="list-style-type: decimal">
<li>Run <code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_js("helpers_theme", add_reference = FALSE)</a></code>.</li>
<li>Add it a <code>setTouchStyle</code> function (copy and paste code from <a href="mobile-shinyMobile.html#mobile-shinyMobile-other">23.5.7</a>):</li>
</ol>
<div class="sourceCode" id="cb891"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb891-1"><a href="mobile-shinyMobile.html#cb891-1"></a><span class="kw">const</span> setTouchStyle <span class="op">=</span> (config) <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb891-2"><a href="mobile-shinyMobile.html#cb891-2"></a>  <span class="cf">if</span> (<span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">"touch"</span>)) <span class="op">{</span></span>
<span id="cb891-3"><a href="mobile-shinyMobile.html#cb891-3"></a>    <span class="cf">if</span> (<span class="va">config</span>.<span class="va">touch</span>.<span class="at">tapHold</span>) <span class="op">{</span></span>
<span id="cb891-4"><a href="mobile-shinyMobile.html#cb891-4"></a>      <span class="co">// touch logic</span></span>
<span id="cb891-5"><a href="mobile-shinyMobile.html#cb891-5"></a>    <span class="op">}</span></span>
<span id="cb891-6"><a href="mobile-shinyMobile.html#cb891-6"></a>  <span class="op">}</span></span>
<span id="cb891-7"><a href="mobile-shinyMobile.html#cb891-7"></a><span class="op">};</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Add it a <code>setColorTheme</code> function (copy and paste code from <a href="mobile-shinyMobile.html#mobile-shinyMobile-theming">23.6</a>):</li>
</ol>
<div class="sourceCode" id="cb892"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb892-1"><a href="mobile-shinyMobile.html#cb892-1"></a><span class="kw">const</span> setColorTheme <span class="op">=</span> (config<span class="op">,</span> app) <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb892-2"><a href="mobile-shinyMobile.html#cb892-2"></a>  <span class="cf">if</span> (<span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">'color'</span>)) <span class="op">{</span></span>
<span id="cb892-3"><a href="mobile-shinyMobile.html#cb892-3"></a>    <span class="co">// logic </span></span>
<span id="cb892-4"><a href="mobile-shinyMobile.html#cb892-4"></a>  <span class="op">}</span></span>
<span id="cb892-5"><a href="mobile-shinyMobile.html#cb892-5"></a><span class="op">};</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Add it a <code>setFilledTheme</code> function (copy and paste code from <a href="mobile-shinyMobile.html#mobile-shinyMobile-theming">23.6</a>):</li>
</ol>
<div class="sourceCode" id="cb893"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb893-1"><a href="mobile-shinyMobile.html#cb893-1"></a><span class="kw">const</span> setFilledTheme <span class="op">=</span> (config) <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb893-2"><a href="mobile-shinyMobile.html#cb893-2"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">'filled'</span>)) <span class="va">config</span>.<span class="at">filled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb893-3"><a href="mobile-shinyMobile.html#cb893-3"></a>  <span class="cf">if</span> (<span class="va">config</span>.<span class="at">filled</span>) <span class="op">{</span></span>
<span id="cb893-4"><a href="mobile-shinyMobile.html#cb893-4"></a>    <span class="co">// logic </span></span>
<span id="cb893-5"><a href="mobile-shinyMobile.html#cb893-5"></a>  <span class="op">}</span></span>
<span id="cb893-6"><a href="mobile-shinyMobile.html#cb893-6"></a><span class="op">};</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Add it the <code>setDarkMode</code> function:</li>
</ol>
<div class="sourceCode" id="cb894"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb894-1"><a href="mobile-shinyMobile.html#cb894-1"></a><span class="kw">const</span> setDarkMode <span class="op">=</span> (config<span class="op">,</span> app) <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb894-2"><a href="mobile-shinyMobile.html#cb894-2"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">'dark'</span>)) <span class="va">config</span>.<span class="at">dark</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb894-3"><a href="mobile-shinyMobile.html#cb894-3"></a>  <span class="cf">if</span> (<span class="va">config</span>.<span class="at">dark</span>) <span class="op">{</span></span>
<span id="cb894-4"><a href="mobile-shinyMobile.html#cb894-4"></a>    <span class="va">app</span>.<span class="va">methods</span>.<span class="at">toggleDarkTheme</span>()<span class="op">;</span></span>
<span id="cb894-5"><a href="mobile-shinyMobile.html#cb894-5"></a>  <span class="op">}</span></span>
<span id="cb894-6"><a href="mobile-shinyMobile.html#cb894-6"></a><span class="op">};</span></span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Finish by exporting the <code>initTheme</code> function, that calls all previously defined helpers:</li>
</ol>
<div class="sourceCode" id="cb895"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb895-1"><a href="mobile-shinyMobile.html#cb895-1"></a><span class="im">export</span> <span class="kw">const</span> initTheme <span class="op">=</span> (config<span class="op">,</span> app) <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb895-2"><a href="mobile-shinyMobile.html#cb895-2"></a>  <span class="at">setTouchStyle</span>(config)<span class="op">;</span></span>
<span id="cb895-3"><a href="mobile-shinyMobile.html#cb895-3"></a>  <span class="at">setColorTheme</span>(config<span class="op">,</span> app)<span class="op">;</span></span>
<span id="cb895-4"><a href="mobile-shinyMobile.html#cb895-4"></a>  <span class="at">setFilledTheme</span>(config)<span class="op">;</span></span>
<span id="cb895-5"><a href="mobile-shinyMobile.html#cb895-5"></a>  <span class="at">setDarkMode</span>(config<span class="op">,</span> app)<span class="op">;</span></span>
<span id="cb895-6"><a href="mobile-shinyMobile.html#cb895-6"></a><span class="op">};</span></span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>Move to the <code>init.js</code> script and import the <code>helpers_theme.js</code>.</li>
</ol>
<div class="sourceCode" id="cb896"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb896-1"><a href="mobile-shinyMobile.html#cb896-1"></a><span class="im">import</span> <span class="op">{</span> initTheme <span class="op">}</span> <span class="im">from</span> <span class="st">'./helpers_theme.js'</span></span></code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>
<code>initTheme</code> has to be called after app instantiation. You should obtain something like below. Once done, rebuild the JS code with <code><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js()</a></code> and test with an app example.</li>
</ol>
<div class="sourceCode" id="cb897"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb897-1"><a href="mobile-shinyMobile.html#cb897-1"></a><span class="im">import</span> <span class="op">{</span> setConfig <span class="op">}</span> <span class="im">from</span> <span class="st">'./helpers_config.js'</span><span class="op">;</span></span>
<span id="cb897-2"><a href="mobile-shinyMobile.html#cb897-2"></a><span class="im">import</span> <span class="op">{</span> initTheme <span class="op">}</span> <span class="im">from</span> <span class="st">'./helpers_theme.js'</span></span>
<span id="cb897-3"><a href="mobile-shinyMobile.html#cb897-3"></a></span>
<span id="cb897-4"><a href="mobile-shinyMobile.html#cb897-4"></a><span class="at">$</span>( document ).<span class="at">ready</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb897-5"><a href="mobile-shinyMobile.html#cb897-5"></a>  <span class="kw">let</span> config <span class="op">=</span> <span class="at">setConfig</span>()<span class="op">;</span></span>
<span id="cb897-6"><a href="mobile-shinyMobile.html#cb897-6"></a>  <span class="co">// create app instance</span></span>
<span id="cb897-7"><a href="mobile-shinyMobile.html#cb897-7"></a>  app <span class="op">=</span> <span class="kw">new</span> <span class="at">Framework7</span>(config)<span class="op">;</span></span>
<span id="cb897-8"><a href="mobile-shinyMobile.html#cb897-8"></a>  </span>
<span id="cb897-9"><a href="mobile-shinyMobile.html#cb897-9"></a>  <span class="co">// Set theme: dark mode, touch, filled, color, taphold css</span></span>
<span id="cb897-10"><a href="mobile-shinyMobile.html#cb897-10"></a>  <span class="at">initTheme</span>(config<span class="op">,</span> app)<span class="op">;</span></span>
<span id="cb897-11"><a href="mobile-shinyMobile.html#cb897-11"></a>  <span class="co">// ...</span></span>
<span id="cb897-12"><a href="mobile-shinyMobile.html#cb897-12"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="mobile-shiny-intro.html"><span class="header-section-number">22</span> Introduction</a></div>
<div class="next"><a href="mobile-pwa.html"><span class="header-section-number">24</span> {shinyMobile} and PWA</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#mobile-shinyMobile"><span class="header-section-number">23</span> Reconstruct {shinyMobile}</a></li>
<li><a class="nav-link" href="#introduction-to-framework7"><span class="header-section-number">23.1</span> Introduction to Framework7</a></li>
<li><a class="nav-link" href="#initiate-the-package"><span class="header-section-number">23.2</span> Initiate the package</a></li>
<li><a class="nav-link" href="#framework7-layouts"><span class="header-section-number">23.3</span> Framework7 Layouts</a></li>
<li><a class="nav-link" href="#app-initialization-1"><span class="header-section-number">23.4</span> App initialization</a></li>
<li>
<a class="nav-link" href="#app-configuration"><span class="header-section-number">23.5</span> App configuration</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#global-theme"><span class="header-section-number">23.5.1</span> Global theme</a></li>
<li><a class="nav-link" href="#events-1"><span class="header-section-number">23.5.2</span> Events</a></li>
<li><a class="nav-link" href="#components-configuration"><span class="header-section-number">23.5.3</span> Components configuration</a></li>
<li><a class="nav-link" href="#allow-end-user-configuration"><span class="header-section-number">23.5.4</span> Allow end-user configuration</a></li>
<li><a class="nav-link" href="#modify-configuration"><span class="header-section-number">23.5.5</span> Modify configuration</a></li>
<li><a class="nav-link" href="#mobile-global-data"><span class="header-section-number">23.5.6</span> Global data and methods</a></li>
<li><a class="nav-link" href="#mobile-shinyMobile-other"><span class="header-section-number">23.5.7</span> Other elements</a></li>
</ul>
</li>
<li><a class="nav-link" href="#mobile-shinyMobile-theming"><span class="header-section-number">23.6</span> Theming and colors</a></li>
<li><a class="nav-link" href="#mobile-modularizeJS"><span class="header-section-number">23.7</span> Modularize JS code</a></li>
<li><a class="nav-link" href="#exercise-4"><span class="header-section-number">23.8</span> Exercise</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/mobile-shinyMobile.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/mobile-shinyMobile.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It was last built on 2021-09-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
