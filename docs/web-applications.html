<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Web application concepts | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.9002/transition.js"></script><script src="libs/bs3compat-0.2.5.9002/tabs.js"></script><script src="libs/bs3compat-0.2.5.9002/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="libs/font-awesome-5.15.3/css/all.min.css" rel="stylesheet">
<link href="libs/font-awesome-5.15.3/css/v4-shims.min.css" rel="stylesheet">
<script src="libs/core-js-2.5.3/shim.min.js"></script><script src="libs/react-17.0.0/react.min.js"></script><script src="libs/react-17.0.0/react-dom.min.js"></script><script src="libs/reactwidget-1.0.0/react-tools.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">2</span> htmltools overview</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">3</span> Discover Shiny dependencies</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Dependency utilities</a></li>
<li><a class="active" href="web-applications.html"><span class="header-section-number">5</span> Web application concepts</a></li>
<li class="book-part">Beautify with CSS and Sass</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">6</span> CSS for Shiny</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">7</span> Introduction to Sass</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">8</span> Beautify with {fresh}</a></li>
<li><a class="" href="beautify-with-bootstraplib.html"><span class="header-section-number">9</span> Beautify with {bslib}</a></li>
<li class="book-part">Unleash interactivity with JavaScript</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> R and JS</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">12</span> Shiny’s input system</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Mastering Shiny’s events</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Dynamically manage content with handlers</a></li>
<li class="book-part">Practice 1: a dashboard template</li>
<li><a class="" href="custom-templates-selection.html"><span class="header-section-number">16</span> Template selection</a></li>
<li><a class="" href="custom-templates-dependencies.html"><span class="header-section-number">17</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">18</span> Create template elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">19</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">20</span> Adding more interactivity</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">21</span> Testing and validating templates elements</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="" href="workflow-charpente.html"><span class="header-section-number">22</span> Introduction to {charpente}</a></li>
<li class="book-part">Case study 2: Mobile development with Shiny</li>
<li><a class="" href="mobile-shiny-intro.html"><span class="header-section-number">23</span> Introduction</a></li>
<li><a class="" href="mobile-shinyMobile.html"><span class="header-section-number">24</span> Reconstruct {shinyMobile}</a></li>
<li><a class="" href="mobile-pwa.html"><span class="header-section-number">25</span> {shinyMobile} and PWA</a></li>
<li><a class="" href="mobile-widgets.html"><span class="header-section-number">26</span> Design widgets</a></li>
<li><a class="" href="mobile-going-further.html"><span class="header-section-number">27</span> Fine tune shinyMobile</a></li>
<li class="book-part">Going further</li>
<li><a class="" href="going-further-reactR.html"><span class="header-section-number">28</span> R + Shiny + React: welcome {reactR}</a></li>
<li><a class="" href="going-further-where-to-go.html"><span class="header-section-number">29</span> What to do next?</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="web-applications" class="section level1">
<h1>
<span class="header-section-number">5</span> Web application concepts<a class="anchor" aria-label="anchor" href="#web-applications"><i class="fas fa-link"></i></a>
</h1>
<p>In this chapter, we discuss about the fundamental concepts underlying web applications, like the client-server model,
the HTTP protocol and web servers, showing how Shiny integrates that system and what are the differences
with the classic web standards. This chapter may significantly ease the understanding of part 3.</p>
<div id="the-client-server-model" class="section level2">
<h2>
<span class="header-section-number">5.1</span> The client-server model<a class="anchor" aria-label="anchor" href="#the-client-server-model"><i class="fas fa-link"></i></a>
</h2>
<p>A Shiny app is a <strong>web application</strong> and like all web applications,
it follows the <strong>server-client</strong> model which consists in:</p>
<ul>
<li>A <strong>client</strong> which sends <strong>requests</strong> to the server through the network.</li>
<li>A <strong>server</strong> composed of hardware and software elements that treats the client request.</li>
<li>A <strong>network</strong> inside which flow requests between the server and the client. It is done
with the HyperText Transfer protocol (HTTP).</li>
</ul>
<p>Each time a client sends a request, it is processed by the server, which provides an answer and closes the connection,
before treating any other request. In practice, to get a web page, the client emits many requests, one to get the page and then one request per JS/CSS/image assets. As an example, try to run the following in the R console and open the developer tools:</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>Under the network tab, we notice many files (if nothing is shown, reload the web browser tab), which actually correspond to all requests made by the client to the server, Figure <a href="web-applications.html#fig:shinyapp-requests">5.1</a>. We also get the current answer status, 200 being the OK HTTP <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">status</a>, the size and the time needed to treat the request. Nowadays, there exists mechanisms like web browser caching to speed up the request treatment. Don’t believe that each time you visit a shiny app, all requests are answered by the server. Actually, most assets are recovered from the web browser cache, that takes significantly less time, although sometimes misleading. I am sure you already found this situation when, after updating your shiny app style, you still get the old design. Most of the time this is a caching issue and resetting Chrome’s cache solves the problem.</p>
<div class="figure">
<span id="fig:shinyapp-requests"></span>
<img src="images/survival-kit/shinyapp-requests.png" alt="Request flow between client and server at shiny app start." width="100%"><p class="caption">
FIGURE 5.1: Request flow between client and server at shiny app start.
</p>
</div>
</div>
<div id="about-http-requests" class="section level2">
<h2>
<span class="header-section-number">5.2</span> About HTTP requests<a class="anchor" aria-label="anchor" href="#about-http-requests"><i class="fas fa-link"></i></a>
</h2>
<p>If we inspect the first request from Figure <a href="web-applications.html#fig:shinyapp-requests">5.1</a>, we obtain Figure <a href="web-applications.html#fig:http-request-details">5.2</a>. An HTTP request is composed of:</p>
<ul>
<li>A <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods"><strong>method</strong></a> that indicates the intentions.
We mostly use <code>GET</code> to ask for something or <code>POST</code>, to submit something.</li>
<li>An <strong>url</strong>, corresponding to the path to the targeted element. Here, if nothing is specified in the path, the server will try to get the main HTML page, also called <code>index.html</code>.</li>
</ul>
<div class="figure">
<span id="fig:http-request-details"></span>
<img src="images/survival-kit/http-request-details.png" alt="Details about an HTTP request" width="100%"><p class="caption">
FIGURE 5.2: Details about an HTTP request
</p>
</div>
<p>The HTTP protocol is unidirectional, that is, you may see it as a phone call during which you are only
allowed one question, thereby terminating the call.</p>
<p><a href="https://httr.r-lib.org/">httr</a> <span class="citation">(Wickham <a href="references.html#ref-R-httr" role="doc-biblioref">2020</a>)</span> allows to do most of the HTTP request directly from R like:</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://httr.r-lib.org/">httr</a></span><span class="op">)</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr.r-lib.org/reference/GET.html">GET</a></span><span class="op">(</span><span class="st">"https://www.google.com"</span><span class="op">)</span></code></pre></div>
</div>
<div id="structure-of-an-url" class="section level2">
<h2>
<span class="header-section-number">5.3</span> Structure of an URL<a class="anchor" aria-label="anchor" href="#structure-of-an-url"><i class="fas fa-link"></i></a>
</h2>
<p>The url (uniform resource locator) defines the unique location of the content to access on the server. The general structure is
the <a href="https://developer.mozilla.org/en-US/docs/Learn/Common_questions/What_is_a_URL">following</a>:</p>
<pre><code>&lt;PROTOCOL&gt;://&lt;HOST&gt;:&lt;PORT&gt;/&lt;PATH&gt;?&lt;QUERY&gt;#&lt;ANCHOR&gt;</code></pre>
<p><strong>PROTOCOL</strong> or (scheme) is the communication protocol, that is <code>HTTP</code> or <code>HTTPS</code> (encrypted HTTP). <strong>HOST</strong> is an IP adress or a domain name, that may be bought. For instance <code>google.com</code> is an owned domain name. The <strong>PORT</strong> indicates which program to use to access the specified resources (80 and 443 are the default HTTP and HTTPS values, respectively). <strong>PATH</strong> is the location of the resource on the server. For instance, if you run the above basic Shiny app and enter <code>http://127.0.0.1:&lt;PORT&gt;/shared/jquery.min.js</code> (replace PORT by your own value), you’ll see the jQuery.min.js code, that is actually needed by Shiny. <strong>QUERY</strong> is the place where to add extra parameters, following the <code>key/value</code> notation like <code>?key1=value1&amp;...</code>. In a Shiny app, query parameters may be retrieved with <code><a href="https://rdrr.io/pkg/shiny/man/parseQueryString.html">parseQueryString()</a></code> or altered by <code><a href="https://rdrr.io/pkg/shiny/man/updateQueryString.html">updateQueryString()</a></code>.</p>
</div>
<div id="web-app-file-structure" class="section level2">
<h2>
<span class="header-section-number">5.4</span> Web app files structure<a class="anchor" aria-label="anchor" href="#web-app-file-structure"><i class="fas fa-link"></i></a>
</h2>
<p>There are substantial differences between Shiny and classic web applications regarding the project file structure.
While web applications are composed of at least an <code>index.html</code> file, as well as optional
pages and assets (extra CSS and JS files, images), we don’t exactly find such a file structure in Shiny.
A basic Shiny app folder is mostly composed of:</p>
<ul>
<li>
<strong>app.R</strong> or <strong>ui.R/server.R</strong>
</li>
<li>A <strong>www</strong> folder containing assets like JS, CSS, images.</li>
</ul>
<p>Where is the <code>index.html</code> file? It is actually created on the fly when you run <code><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp()</a></code>. The detailed processes are
mentioned later in this chapter.</p>
</div>
<div id="serving-web-apps" class="section level2">
<h2>
<span class="header-section-number">5.5</span> Serving web apps<a class="anchor" aria-label="anchor" href="#serving-web-apps"><i class="fas fa-link"></i></a>
</h2>
<p>In order to expose our app to the rest of the world, we have to host is somewhere, that is a web server.
A server actually corresponds to:</p>
<ul>
<li>A <strong>hardware</strong> layer, namely the machine or virtual machine able to run programs. Most of servers are running
under Linux. It is actually pretty straightforward to set up your own server thanks to the many solutions like <a href="https://www.digitalocean.com/">digitalocean</a> or the <a href="https://aws.amazon.com/">amazon web service</a>, also known as (AWS).</li>
<li>A <strong>software</strong> layer, that are programs necessary to treat the client requests. You probably know <a href="https://httpd.apache.org/">Apache</a> or <a href="https://www.nginx.com/">nginx</a>, that are the most common solutions.</li>
</ul>
<p>How is a Shiny app served? In the Shiny context, we need a software able to run R scripts, thereby preventing us from relying on classic hosting strategies. RStudio developed multiple solutions, the most famous is likely <strong>shiny server</strong>:</p>
<ul>
<li>Shiny server <a href="https://rstudio.com/products/shiny/download-server/">open source</a>.</li>
<li>Shiny server <a href="https://rstudio.com/products/shiny-server-pro/">pro</a>.</li>
<li>
<a href="https://rstudio.com/products/connect/evaluation/">RStudio Connect</a>.</li>
<li>
<a href="https://www.shinyapps.io/">shinyapps.io</a>.</li>
</ul>
<p>You can see Shiny server as an improved web server. Indeed, in addition to run Rmd documents (R markdown) or shiny apps, it is able to interpret classic HTML files. An excellent guide developed by Dean Attali to set up your own server is available <a href="https://deanattali.com/2015/05/09/setup-rstudio-shiny-server-digital-ocean/">here</a>.</p>
<p>Another noticeable difference between web servers and shiny server is the running <strong>port</strong>, which default to <code>3838</code> for the latter (instead of the classic <code>80</code>), although entirely customizable through the configuration file.</p>
</div>
<div id="about-httpuv" class="section level2">
<h2>
<span class="header-section-number">5.6</span> About <code>{httpuv}</code><a class="anchor" aria-label="anchor" href="#about-httpuv"><i class="fas fa-link"></i></a>
</h2>
<p>In addition to the shiny server layer, that is able to run R code and start any app on the server as a result of a user request, Shiny relies on <a href="https://github.com/rstudio/httpuv">httpuv</a> <span class="citation">(Cheng and Chang <a href="references.html#ref-R-httpuv" role="doc-biblioref">2021</a>)</span> which fires a web server for each app directly from R, making it possible to handle HTTP requests but also the R and JS communication, that will be covered later in chapter <a href="shiny-intro.html#shiny-intro">11</a>.</p>
</div>
<div id="shiny-app-lifecycle" class="section level2">
<h2>
<span class="header-section-number">5.7</span> Shiny app lifecycle<a class="anchor" aria-label="anchor" href="#shiny-app-lifecycle"><i class="fas fa-link"></i></a>
</h2>
<p>Whenever a user (client) accesses a shiny app with his web browser, a series of events occurs (Figure <a href="web-applications.html#fig:shinyapp-lifecycle">5.3</a>):</p>
<ol style="list-style-type: decimal">
<li>The client sends a HTTP <code>CONNECT</code> request to the server (Shiny server) containing the path
to the targeted app.</li>
<li>The shiny server starts the targeted app with <code><a href="https://rdrr.io/pkg/shiny/man/runApp.html">runApp()</a></code>.</li>
</ol>
<p>Under the hood, <code><a href="https://rdrr.io/pkg/shiny/man/runApp.html">runApp()</a></code>:</p>
<ul>
<li>Calls <code><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp()</a></code> that returns a shiny app object composed of a server function and the UI.
The UI has to be formatted to be a function returning an HTTP response, as requested by <a href="https://github.com/rstudio/httpuv">httpuv</a>. Section <a href="web-applications.html#build-shiny-ui">5.7.1</a> explains this process in details.</li>
<li>Calls <code>startApp</code> that creates HTTP and websocket (WS) handlers. WS handlers are responsible for controlling the WS behavior when the app starts, when a message is received from a client and when the app closes. WS are necessary to allow communication between R and JS, as shown in Chapter <a href="shiny-intro.html#shiny-intro">11</a>.</li>
<li>Calls <code>startServer</code> from <a href="https://github.com/rstudio/httpuv">httpuv</a>, that starts the HTTP server and opens the server websocket connection.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>If the R code does not contain errors, the server returns the Shiny UI HTML code to the client.</li>
<li>The HTML code is received and interpreted by the client web browser.</li>
<li>The HTML page is rendered. It is an exact mirror of the initially provided <code>ui.R</code> code.</li>
</ol>
<div class="figure">
<span id="fig:shinyapp-lifecycle"></span>
<img src="images/survival-kit/shinyapp-lifecycle.png" alt="Shiny App lifecycle" width="100%"><p class="caption">
FIGURE 5.3: Shiny App lifecycle
</p>
</div>
<p>The returned HTML contains all the necessary JavaScript to subsequently open the client websocket connection and start the dialog between R and JS. This will be discussed in Chapter <a href="shiny-intro.html#shiny-intro">11</a>.</p>
<div id="build-shiny-ui" class="section level3">
<h3>
<span class="header-section-number">5.7.1</span> Building the UI<a class="anchor" aria-label="anchor" href="#build-shiny-ui"><i class="fas fa-link"></i></a>
</h3>
<p>As stated above in <a href="web-applications.html#web-app-file-structure">5.4</a>, the Shiny app file structure does not follow all the web development standards. Particularly, there is no <code>index.html</code> file.</p>
<p>What definitely makes Shiny wonderful is the ability to only write R code to produce HTML. Although convenient for R users, there is a moment where all this R code has to become HTML, since web browsers are just not able to process R files.</p>
<p>Shiny must provide a string containing the HTML code that will be later given to the <a href="https://github.com/rstudio/httpuv">httpuv</a> server and displayed to the end user, if the request is successful. Moreover, it must be a valid HTML template, as shown in chapter <a href="web-intro.html#simplest-html-template">1.3.3</a>, which is not the case we you use top level UI shiny function like <code>fluidPage</code>:</p>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">p</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "&lt;div class=\"container-fluid\"&gt;\n  &lt;p&gt;&lt;/p&gt;\n&lt;/div&gt;"</code></pre>
<p>In the above output, we miss the <code>&lt;!DOCTYPE html&gt;</code> indicating to the web browser that our
document is HTML and load the appropriate interpreter. Additionally, <code>html</code>, <code>head</code> and <code>body</code> are not
provided with <code><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage()</a></code>.</p>
<p>How does Shiny create an appropriate HTML template? These steps heavily relies on <a href="https://github.com/rstudio/htmltools">htmltools</a>, particularly the <code><a href="https://rdrr.io/pkg/htmltools/man/renderDocument.html">renderDocument()</a></code> function. If this has not been documented in chapter <a href="htmltools-overview.html#htmltools-overview">2</a>, it’s mainly because it is, in theory, quite unlikely you’ll ever use those functions, unless you try to develop another web framework for R, built on top of <a href="https://github.com/rstudio/httpuv">httpuv</a>, like <code>{ambriorix}</code> or <code>{fiery}</code>. Another use case is <a href="https://github.com/RinteRface/argonR">argonR</a> which allows to design Bootstrap 4 HTML templates, on top of the <a href="https://www.creative-tim.com/product/argon-design-system">argon</a> design system.</p>
<p>Under the hood, <code><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp()</a></code> does many things, particularly creating a valid HTTP response template for <a href="https://github.com/rstudio/httpuv">httpuv</a>, through the internal <code>shiny:::uiHttpHandler</code> function.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;The interested reader will have a look at the following &lt;a href="https://github.com/rstudio/shiny/blob/60db1e02b03d8e6fb146c9bb1bbfbce269231add/R/shinyui.R"&gt;script&lt;/a&gt; that contains all
previously mentioned functions like &lt;code&gt;uiHttpHandler&lt;/code&gt;.&lt;/p&gt;'><sup>2</sup></a> The conversion from R to HTML is achieved by <code>shiny:::renderPage</code>. First, the provided UI R code is wrapped in a <code>tags$body()</code>, if not yet done. As a reminder <code>fluidPage</code> does not create a <code>body</code> tag, which is required to produce a valid HTML template. The result is given to <code><a href="https://rdrr.io/pkg/htmltools/man/htmlTemplate.html">htmlTemplate()</a></code> to fill the following boilerplate, part of the Shiny package:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb151-1"><a href="web-applications.html#cb151-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb151-2"><a href="web-applications.html#cb151-2"></a><span class="kw">&lt;html</span><span class="er">{{</span><span class="ot"> if (isTRUE</span><span class="er">(nzchar(lang)))</span><span class="ot"> paste0</span><span class="er">("</span><span class="ot"> lang=</span><span class="st">\</span><span class="er">"",</span><span class="ot"> lang</span><span class="er">,</span> <span class="er">"\"")</span> <span class="er">}}</span><span class="kw">&gt;</span></span>
<span id="cb151-3"><a href="web-applications.html#cb151-3"></a>  <span class="kw">&lt;head&gt;</span></span>
<span id="cb151-4"><a href="web-applications.html#cb151-4"></a>  {{ headContent() }}</span>
<span id="cb151-5"><a href="web-applications.html#cb151-5"></a>  <span class="kw">&lt;/head&gt;</span></span>
<span id="cb151-6"><a href="web-applications.html#cb151-6"></a>  {{ body }}</span>
<span id="cb151-7"><a href="web-applications.html#cb151-7"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>If we assume that our UI is built as follows, applying <code><a href="https://rdrr.io/pkg/htmltools/man/htmlTemplate.html">htmlTemplate()</a></code> on it yields:</p>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textInput.html">textInput</a></span><span class="op">(</span><span class="st">"caption"</span>, <span class="st">"Caption"</span>, <span class="st">"Data Summary"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">verbatimTextOutput</a></span><span class="op">(</span><span class="st">"value"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlTemplate.html">htmlTemplate</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"template"</span>, <span class="st">"default.html"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span>, 
  lang <span class="op">=</span> <span class="st">"en"</span>, 
  body <span class="op">=</span> <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span><span class="va">ui</span><span class="op">)</span>, 
  document_ <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb153"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb153-1"><a href="web-applications.html#cb153-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb153-2"><a href="web-applications.html#cb153-2"></a><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">"en"</span><span class="kw">&gt;</span></span>
<span id="cb153-3"><a href="web-applications.html#cb153-3"></a>  <span class="kw">&lt;head&gt;</span></span>
<span id="cb153-4"><a href="web-applications.html#cb153-4"></a>    <span class="co">&lt;!-- HEAD_CONTENT --&gt;</span></span>
<span id="cb153-5"><a href="web-applications.html#cb153-5"></a>  <span class="kw">&lt;/head&gt;</span></span>
<span id="cb153-6"><a href="web-applications.html#cb153-6"></a>  <span class="kw">&lt;body&gt;</span></span>
<span id="cb153-7"><a href="web-applications.html#cb153-7"></a>    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"container-fluid"</span><span class="kw">&gt;</span></span>
<span id="cb153-8"><a href="web-applications.html#cb153-8"></a>      <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"form-group shiny-input-container"</span><span class="kw">&gt;</span></span>
<span id="cb153-9"><a href="web-applications.html#cb153-9"></a>        <span class="kw">&lt;label</span> </span>
<span id="cb153-10"><a href="web-applications.html#cb153-10"></a><span class="ot">          class=</span><span class="st">"control-label"</span> </span>
<span id="cb153-11"><a href="web-applications.html#cb153-11"></a><span class="ot">          id=</span><span class="st">"caption-label"</span> </span>
<span id="cb153-12"><a href="web-applications.html#cb153-12"></a><span class="ot">          for=</span><span class="st">"caption"</span><span class="kw">&gt;</span></span>
<span id="cb153-13"><a href="web-applications.html#cb153-13"></a>          Caption</span>
<span id="cb153-14"><a href="web-applications.html#cb153-14"></a>        <span class="kw">&lt;/label&gt;</span></span>
<span id="cb153-15"><a href="web-applications.html#cb153-15"></a>        <span class="kw">&lt;input</span> </span>
<span id="cb153-16"><a href="web-applications.html#cb153-16"></a><span class="ot">          id=</span><span class="st">"caption"</span> </span>
<span id="cb153-17"><a href="web-applications.html#cb153-17"></a><span class="ot">          type=</span><span class="st">"text"</span> </span>
<span id="cb153-18"><a href="web-applications.html#cb153-18"></a><span class="ot">          class=</span><span class="st">"form-control"</span> </span>
<span id="cb153-19"><a href="web-applications.html#cb153-19"></a><span class="ot">          value=</span><span class="st">"Data Summary"</span><span class="kw">/&gt;</span></span>
<span id="cb153-20"><a href="web-applications.html#cb153-20"></a>      <span class="kw">&lt;/div&gt;</span></span>
<span id="cb153-21"><a href="web-applications.html#cb153-21"></a>      <span class="kw">&lt;pre</span> </span>
<span id="cb153-22"><a href="web-applications.html#cb153-22"></a><span class="ot">        class=</span><span class="st">"shiny-text-output noplaceholder"</span> </span>
<span id="cb153-23"><a href="web-applications.html#cb153-23"></a><span class="ot">        id=</span><span class="st">"value"</span><span class="kw">&gt;</span></span>
<span id="cb153-24"><a href="web-applications.html#cb153-24"></a>      <span class="kw">&lt;/pre&gt;</span></span>
<span id="cb153-25"><a href="web-applications.html#cb153-25"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb153-26"><a href="web-applications.html#cb153-26"></a>  <span class="kw">&lt;/body&gt;</span></span>
<span id="cb153-27"><a href="web-applications.html#cb153-27"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>You may wonder what <code>headContent()</code> does. It inserts the string <code>&lt;!-- HEAD_CONTENT --&gt;</code> inside the head tag so that
shiny knows where to insert the dependencies, that is all mandatory JS and CSS assets. Then, all necessary dependencies like jQuery, Bootstrap and shiny css/javascript files (<code>shiny:::shinyDependencies</code>) are added in the UI head by <code><a href="https://rdrr.io/pkg/htmltools/man/renderDocument.html">renderDocument()</a></code>. <code><a href="https://rdrr.io/pkg/htmltools/man/renderDocument.html">renderDocument()</a></code> is a three steps process:</p>
<ul>
<li>Convert all R shiny tags to HTML with <code><a href="https://rdrr.io/pkg/htmltools/man/renderTags.html">renderTags()</a></code>. For each tag, <code><a href="https://rdrr.io/pkg/htmltools/man/renderTags.html">renderTags()</a></code> returns a list of
four elements: the head content, any singletons, the list of dependencies and the HTML string.</li>
<li>Treat the dependencies with <code><a href="https://rdrr.io/pkg/htmltools/man/resolveDependencies.html">resolveDependencies()</a></code> to remove conflicts, as shown in Chapter <a href="htmltools-dependencies.html#resolve-dependencies">4.5</a>.</li>
<li>Process the dependencies with <code><a href="https://rdrr.io/pkg/shiny/man/createWebDependency.html">createWebDependency()</a></code>, which make sure each dependency can be served over HTTP.</li>
<li>Convert dependencies R code to HTML with <code><a href="https://rdrr.io/pkg/htmltools/man/renderDependencies.html">renderDependencies()</a></code> and insert it in the
template <code>head</code>, replacing the <code>&lt;!-- HEAD_CONTENT --&gt;</code> string.</li>
</ul>
<p>For instance, we call <code><a href="https://rdrr.io/pkg/htmltools/man/renderTags.html">renderTags()</a></code> on the shiny <code><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon()</a></code>:</p>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools">htmltools</a></span><span class="op">)</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/renderTags.html">renderTags</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"cogs"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></code></pre></div>
<pre><code>## List of 4
##  $ head        : 'html' chr ""
##   ..- attr(*, "html")= logi TRUE
##  $ singletons  : chr(0) 
##  $ dependencies:List of 1
##   ..$ :List of 9
##   .. ..$ name      : chr "font-awesome"
##   .. ..$ version   : chr "5.15.3"
##   .. ..$ src       :List of 1
##   .. .. ..$ file: chr "/Library/Frameworks/R.framework/Versions/3.6/Resources/library/fontawesome/fontawesome"
##   .. ..$ meta      : NULL
##   .. ..$ script    : NULL
##   .. ..$ stylesheet: chr [1:2] "css/all.min.css" "css/v4-shims.min.css"
##   .. ..$ head      : NULL
##   .. ..$ attachment: NULL
##   .. ..$ all_files : logi TRUE
##   .. ..- attr(*, "class")= chr "html_dependency"
##  $ html        : 'html' chr "&lt;i class=\"fa fa-cogs\" role=\"presentation\" aria-label=\"cogs icon\"&gt;&lt;/i&gt;"
##   ..- attr(*, "html")= logi TRUE</code></pre>
<p>and then <code><a href="https://rdrr.io/pkg/htmltools/man/renderDependencies.html">renderDependencies()</a></code> on the tag dependency:</p>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/renderDependencies.html">renderDependencies</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">dependencies</span><span class="op">)</span>, <span class="st">"href"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "&lt;link href=\"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/fontawesome/fontawesome/css/all.min.css\" rel=\"stylesheet\" /&gt;\n&lt;link href=\"/Library/Frameworks/R.framework/Versions/3.6/Resources/library/fontawesome/fontawesome/css/v4-shims.min.css\" rel=\"stylesheet\" /&gt;"</code></pre>
<p>Let’s apply <code><a href="https://rdrr.io/pkg/htmltools/man/renderDocument.html">renderDocument()</a></code> to our previous template:</p>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">html</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/renderDocument.html">renderDocument</a></span><span class="op">(</span>
  <span class="va">ui</span>,
  deps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
        <span class="st">"jquery"</span>, 
        <span class="st">"3.5.1"</span>, 
        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>href <span class="op">=</span> <span class="st">"shared"</span><span class="op">)</span>, 
        script <span class="op">=</span> <span class="st">"jquery.min.js"</span>
      <span class="op">)</span>
    <span class="op">)</span>, 
    <span class="fu">shiny</span><span class="fu">:::</span><span class="fu">shinyDependencies</span><span class="op">(</span><span class="op">)</span> <span class="co"># Shiny JS + CSS</span>
  <span class="op">)</span>,
  processDep <span class="op">=</span> <span class="va">createWebDependency</span>
<span class="op">)</span></code></pre></div>
<pre><code>## shiny devmode - Using full shiny javascript file. To use the minified version, call `options(shiny.minified = TRUE)`
## This message is displayed once every 8 hours.</code></pre>
<p>The final HTML output is shown below:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb160-1"><a href="web-applications.html#cb160-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb160-2"><a href="web-applications.html#cb160-2"></a><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">"en"</span><span class="kw">&gt;</span></span>
<span id="cb160-3"><a href="web-applications.html#cb160-3"></a>  <span class="kw">&lt;head&gt;</span></span>
<span id="cb160-4"><a href="web-applications.html#cb160-4"></a>    <span class="kw">&lt;meta</span><span class="ot"> http-equiv=</span><span class="st">"Content-Type"</span><span class="ot"> content=</span><span class="st">"text/html; </span></span>
<span id="cb160-5"><a href="web-applications.html#cb160-5"></a><span class="st">    charset=utf-8"</span><span class="kw">/&gt;</span></span>
<span id="cb160-6"><a href="web-applications.html#cb160-6"></a>    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">"application/shiny-singletons"</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb160-7"><a href="web-applications.html#cb160-7"></a>    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">"application/html-dependencies"</span><span class="kw">&gt;</span>jquery[<span class="dv">3</span>.<span class="fl">5.1</span>]<span class="op">;</span></span>
<span id="cb160-8"><a href="web-applications.html#cb160-8"></a>    shiny<span class="op">-</span>css[<span class="dv">1</span>.<span class="fl">6.0</span>]<span class="op">;</span>shiny<span class="op">-</span>javascript[<span class="dv">1</span>.<span class="fl">6.0</span>]<span class="op">;</span></span>
<span id="cb160-9"><a href="web-applications.html#cb160-9"></a>    bootstrap[<span class="dv">3</span>.<span class="fl">4.1</span>]<span class="kw">&lt;/script&gt;</span></span>
<span id="cb160-10"><a href="web-applications.html#cb160-10"></a>    <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">"shared/jquery.min.js"</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb160-11"><a href="web-applications.html#cb160-11"></a>    <span class="kw">&lt;link</span><span class="ot"> href=</span><span class="st">"shared/shiny.min.css"</span><span class="ot"> rel=</span><span class="st">"stylesheet"</span> <span class="kw">/&gt;</span></span>
<span id="cb160-12"><a href="web-applications.html#cb160-12"></a>    <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">"shared/shiny.min.js"</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb160-13"><a href="web-applications.html#cb160-13"></a>    <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">"viewport"</span><span class="ot"> content=</span><span class="st">"width=device-width, </span></span>
<span id="cb160-14"><a href="web-applications.html#cb160-14"></a><span class="st">    initial-scale=1"</span> <span class="kw">/&gt;</span></span>
<span id="cb160-15"><a href="web-applications.html#cb160-15"></a>    <span class="kw">&lt;link</span><span class="ot"> href=</span><span class="st">"shared/bootstrap/css/bootstrap.min.css"</span> </span>
<span id="cb160-16"><a href="web-applications.html#cb160-16"></a><span class="ot">    rel=</span><span class="st">"stylesheet"</span> <span class="kw">/&gt;</span></span>
<span id="cb160-17"><a href="web-applications.html#cb160-17"></a>    <span class="kw">&lt;link</span><span class="ot"> href=</span><span class="st">"shared/bootstrap/accessibility/css/</span></span>
<span id="cb160-18"><a href="web-applications.html#cb160-18"></a><span class="st">    bootstrap-accessibility.min.css"</span><span class="ot"> rel=</span><span class="st">"stylesheet"</span> <span class="kw">/&gt;</span></span>
<span id="cb160-19"><a href="web-applications.html#cb160-19"></a>    <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">"shared/bootstrap/js/bootstrap.min.js"</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb160-20"><a href="web-applications.html#cb160-20"></a>    <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">"shared/bootstrap/accessibility/js</span></span>
<span id="cb160-21"><a href="web-applications.html#cb160-21"></a><span class="st">    /bootstrap-accessibility.min.js"</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb160-22"><a href="web-applications.html#cb160-22"></a>  <span class="kw">&lt;/head&gt;</span></span>
<span id="cb160-23"><a href="web-applications.html#cb160-23"></a>  <span class="kw">&lt;body&gt;</span></span>
<span id="cb160-24"><a href="web-applications.html#cb160-24"></a>    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"container-fluid"</span><span class="kw">&gt;</span></span>
<span id="cb160-25"><a href="web-applications.html#cb160-25"></a>      <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"form-group shiny-input-container"</span><span class="kw">&gt;</span></span>
<span id="cb160-26"><a href="web-applications.html#cb160-26"></a>        <span class="kw">&lt;label</span> </span>
<span id="cb160-27"><a href="web-applications.html#cb160-27"></a><span class="ot">          class=</span><span class="st">"control-label"</span> </span>
<span id="cb160-28"><a href="web-applications.html#cb160-28"></a><span class="ot">          id=</span><span class="st">"caption-label"</span> </span>
<span id="cb160-29"><a href="web-applications.html#cb160-29"></a><span class="ot">          for=</span><span class="st">"caption"</span><span class="kw">&gt;</span></span>
<span id="cb160-30"><a href="web-applications.html#cb160-30"></a>          Caption</span>
<span id="cb160-31"><a href="web-applications.html#cb160-31"></a>        <span class="kw">&lt;/label&gt;</span></span>
<span id="cb160-32"><a href="web-applications.html#cb160-32"></a>        <span class="kw">&lt;input</span> </span>
<span id="cb160-33"><a href="web-applications.html#cb160-33"></a><span class="ot">          id=</span><span class="st">"caption"</span> </span>
<span id="cb160-34"><a href="web-applications.html#cb160-34"></a><span class="ot">          type=</span><span class="st">"text"</span> </span>
<span id="cb160-35"><a href="web-applications.html#cb160-35"></a><span class="ot">          class=</span><span class="st">"form-control"</span> </span>
<span id="cb160-36"><a href="web-applications.html#cb160-36"></a><span class="ot">          value=</span><span class="st">"Data Summary"</span><span class="kw">/&gt;</span></span>
<span id="cb160-37"><a href="web-applications.html#cb160-37"></a>      <span class="kw">&lt;/div&gt;</span></span>
<span id="cb160-38"><a href="web-applications.html#cb160-38"></a>      <span class="kw">&lt;pre</span> </span>
<span id="cb160-39"><a href="web-applications.html#cb160-39"></a><span class="ot">        class=</span><span class="st">"shiny-text-output noplaceholder"</span> </span>
<span id="cb160-40"><a href="web-applications.html#cb160-40"></a><span class="ot">        id=</span><span class="st">"value"</span><span class="kw">&gt;</span></span>
<span id="cb160-41"><a href="web-applications.html#cb160-41"></a>      <span class="kw">&lt;/pre&gt;</span></span>
<span id="cb160-42"><a href="web-applications.html#cb160-42"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb160-43"><a href="web-applications.html#cb160-43"></a>  <span class="kw">&lt;/body&gt;</span></span>
<span id="cb160-44"><a href="web-applications.html#cb160-44"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>The final step is to return an HTTP response containing the HTML string. As of <a href="https://shiny.rstudio.com/">shiny</a> <code>1.6.0</code>, the <code>httpResponse</code> function is exported by default:</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/httpResponse.html">httpResponse</a></span><span class="op">(</span>
  status <span class="op">=</span> <span class="fl">200</span>,
  content <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Encoding.html">enc2utf8</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span>, <span class="va">html</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## $status
## [1] 200
## 
## $content_type
## [1] "text/html; charset=UTF-8"
## 
## $content
## [1] "&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n  &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"/&gt;\n  &lt;script type=\"application/shiny-singletons\"&gt;&lt;/script&gt;\n  &lt;script type=\"application/html-dependencies\"&gt;jquery[3.6.0];shiny-css[1.6.0.9022];shiny-javascript[1.6.0.9022];bootstrap[3.4.1]&lt;/script&gt;\n&lt;script src=\"shared/jquery.min.js\"&gt;&lt;/script&gt;\n&lt;link href=\"shared/shiny.min.css\" rel=\"stylesheet\" /&gt;\n&lt;script src=\"shared/shiny.js\"&gt;&lt;/script&gt;\n&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" /&gt;\n&lt;link href=\"shared/bootstrap/css/bootstrap.min.css\" rel=\"stylesheet\" /&gt;\n&lt;link href=\"shared/bootstrap/accessibility/css/bootstrap-accessibility.min.css\" rel=\"stylesheet\" /&gt;\n&lt;script src=\"shared/bootstrap/js/bootstrap.min.js\"&gt;&lt;/script&gt;\n&lt;script src=\"shared/bootstrap/accessibility/js/bootstrap-accessibility.min.js\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div class=\"container-fluid\"&gt;\n    &lt;div class=\"form-group shiny-input-container\"&gt;\n      &lt;label class=\"control-label\" id=\"caption-label\" for=\"caption\"&gt;Caption&lt;/label&gt;\n      &lt;input id=\"caption\" type=\"text\" class=\"form-control\" value=\"Data Summary\"/&gt;\n    &lt;/div&gt;\n    &lt;pre class=\"shiny-text-output noplaceholder\" id=\"value\"&gt;&lt;/pre&gt;\n  &lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n"
## 
## $headers
## $headers$`X-UA-Compatible`
## [1] "IE=edge,chrome=1"
## 
## 
## attr(,"class")
## [1] "httpResponse"</code></pre>
</div>
<div id="serving-html-with-httpuv" class="section level3">
<h3>
<span class="header-section-number">5.7.2</span> Serving HTML with <code>{httpuv}</code><a class="anchor" aria-label="anchor" href="#serving-html-with-httpuv"><i class="fas fa-link"></i></a>
</h3>
<p>Once the UI is processed, Shiny makes it available to end users by leveraging <a href="https://github.com/rstudio/httpuv">httpuv</a>, which provides tools to set up an HTTP server. The main function is <code>startServer</code> that requires a <strong>host</strong>, <strong>port</strong> and an <strong>app</strong>. If you run a shiny app locally, the default host is <code>localhost</code> or <code>127.0.0.1</code> and the port is randomly chosen by <code>shinyApp</code> or <code>runApp</code>, even though you may fix it. The most important element is the app and <a href="https://github.com/rstudio/httpuv">httpuv</a> expects a list of functions like:</p>
<ul>
<li>
<code>call</code>, to handle the client HTTP request and return the server HTTP response. Depending on the context,
Shiny may return different responses like 403 (unauthorized), 404 (not found) or 200 (OK).</li>
<li>
<code>onHeaders</code> if the request contains headers. For instance, this may be required for authentication.</li>
<li>
<code>staticPaths</code> to serve assets, especially CSS or JS files.</li>
</ul>
<p>A valid <code>call</code> function template containing the previously processed HTML UI is defined below:</p>
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">app</span><span class="op">$</span><span class="va">call</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">req</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    status <span class="op">=</span> <span class="fl">200L</span>,
    headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      <span class="st">'Content-Type'</span> <span class="op">=</span> <span class="st">'text/html'</span>
    <span class="op">)</span>,
    body <span class="op">=</span> <span class="va">html</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We then invoke <code>startServer</code>:</p>
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/httpuv">httpuv</a></span><span class="op">)</span>
<span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/httpuv/man/startServer.html">startServer</a></span><span class="op">(</span>
  <span class="st">"127.0.0.1"</span>,
  <span class="fl">8080</span>,
  <span class="va">app</span>
<span class="op">)</span></code></pre></div>
<p>Now, if we browse to <code>127.0.0.1:8080</code>, we see the text input. However, opening the HTML inspector shows many errors, most of them due to the fact that we forgot to serve static assets, all located in the <code>inst/www/shared</code> folder of the <a href="https://shiny.rstudio.com/">shiny</a> package. Let’s do it below by adding a <code>staticPaths</code> component to our app:</p>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s</span><span class="op">$</span><span class="kw">stop</span><span class="op">(</span><span class="op">)</span> <span class="co"># stop the server before running it again!</span>
<span class="va">app</span><span class="op">$</span><span class="va">staticPaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shared <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span>
  package <span class="op">=</span> <span class="st">"shiny"</span>, 
  <span class="st">"www"</span>, 
  <span class="st">"shared"</span>
<span class="op">)</span><span class="op">)</span>
<span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/httpuv/man/startServer.html">startServer</a></span><span class="op">(</span>
  <span class="st">"127.0.0.1"</span>,
  <span class="fl">8080</span>,
  <span class="va">app</span>
<span class="op">)</span></code></pre></div>
<p>The response may be inspecting directly from R (ideally within another R session) with an <a href="https://httr.r-lib.org/">httr</a> <code>GET</code> request:</p>
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html">GET</a></span><span class="op">(</span><span class="st">"http://127.0.0.1:8080"</span><span class="op">)</span>

<span class="co">## Response [http://127.0.0.1:8080]</span>
<span class="co">##  Date: 2021-03-04 23:41</span>
<span class="co">##  Status: 200</span>
<span class="co">##  Content-Type: text/html</span>
<span class="co">##  Size: 5 B</span></code></pre></div>
<p>Keep in mind that Shiny does much more things to setup the server and we just highlighted the most important steps.
The above code crashes since the HTML page returned to the client tries to connect to a server websocket, that does not yet exist.</p>
</div>
</div>
<div id="summary-1" class="section level2">
<h2>
<span class="header-section-number">5.8</span> Summary<a class="anchor" aria-label="anchor" href="#summary-1"><i class="fas fa-link"></i></a>
</h2>
<p>So far so good! You hopefully now better understand what is a shiny app, how it is served and the differences between classic web apps.</p>

</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="htmltools-dependencies.html"><span class="header-section-number">4</span> Dependency utilities</a></div>
<div class="next"><a href="beautify-css.html"><span class="header-section-number">6</span> CSS for Shiny</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#web-applications"><span class="header-section-number">5</span> Web application concepts</a></li>
<li><a class="nav-link" href="#the-client-server-model"><span class="header-section-number">5.1</span> The client-server model</a></li>
<li><a class="nav-link" href="#about-http-requests"><span class="header-section-number">5.2</span> About HTTP requests</a></li>
<li><a class="nav-link" href="#structure-of-an-url"><span class="header-section-number">5.3</span> Structure of an URL</a></li>
<li><a class="nav-link" href="#web-app-file-structure"><span class="header-section-number">5.4</span> Web app files structure</a></li>
<li><a class="nav-link" href="#serving-web-apps"><span class="header-section-number">5.5</span> Serving web apps</a></li>
<li><a class="nav-link" href="#about-httpuv"><span class="header-section-number">5.6</span> About {httpuv}</a></li>
<li>
<a class="nav-link" href="#shiny-app-lifecycle"><span class="header-section-number">5.7</span> Shiny app lifecycle</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#build-shiny-ui"><span class="header-section-number">5.7.1</span> Building the UI</a></li>
<li><a class="nav-link" href="#serving-html-with-httpuv"><span class="header-section-number">5.7.2</span> Serving HTML with {httpuv}</a></li>
</ul>
</li>
<li><a class="nav-link" href="#summary-1"><span class="header-section-number">5.8</span> Summary</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/web-applications.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/web-applications.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>
</div>

  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It was last built on 2021-07-29.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
