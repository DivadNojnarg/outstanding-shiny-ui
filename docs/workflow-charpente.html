<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 21 Automate new template creation with {charpente} | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<meta name="description" content="FIGURE 21.1: The {charpente} package.   21.1 Motivations Translating an HTML template into an R API requires the creation of a package. This is not a good practice to proceed as follows: ui &lt;-...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 21 Automate new template creation with {charpente} | Outstanding User Interfaces with Shiny">
<meta property="og:type" content="book">
<meta property="og:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<meta property="og:description" content="FIGURE 21.1: The {charpente} package.   21.1 Motivations Translating an HTML template into an R API requires the creation of a package. This is not a good practice to proceed as follows: ui &lt;-...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 21 Automate new template creation with {charpente} | Outstanding User Interfaces with Shiny">
<meta name="twitter:description" content="FIGURE 21.1: The {charpente} package.   21.1 Motivations Translating an HTML template into an R API requires the creation of a package. This is not a good practice to proceed as follows: ui &lt;-...">
<meta name="twitter:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">2</span> Manipulate HTML tags from R with {htmltools}</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">3</span> Discover Shiny dependencies</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Handle HTML dependencies with {htmltools}</a></li>
<li><a class="" href="web-applications.html"><span class="header-section-number">5</span> Web application concepts</a></li>
<li class="book-part">Beautify with CSS and Sass</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">6</span> CSS for Shiny</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">7</span> Tidy your CSS with Sass</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">8</span> Beautify with {fresh}</a></li>
<li><a class="" href="beautify-with-bootstraplib.html"><span class="header-section-number">9</span> Become a theming wizard with {bslib}</a></li>
<li class="book-part">Unleash interactivity with JavaScript</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> Communicate between R and JS</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">12</span> Understand and develop new Shiny inputs</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Mastering Shiny’s events</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Optimize your apps with custom handlers</a></li>
<li class="book-part">Practice: A Bootstrap 4 dashboard template</li>
<li><a class="" href="custom-templates-dependencies.html"><span class="header-section-number">16</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">17</span> Create template elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">18</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">19</span> Adding more interactivity</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">20</span> Testing and validating templates elements</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="active" href="workflow-charpente.html"><span class="header-section-number">21</span> Automate new template creation with {charpente}</a></li>
<li class="book-part">Case study: Mobile development for Shiny</li>
<li><a class="" href="mobile-shiny-intro.html"><span class="header-section-number">22</span> Introduction</a></li>
<li><a class="" href="mobile-shinyMobile.html"><span class="header-section-number">23</span> Reconstruct {shinyMobile}</a></li>
<li><a class="" href="mobile-pwa.html"><span class="header-section-number">24</span> {shinyMobile} and PWA</a></li>
<li><a class="" href="mobile-widgets.html"><span class="header-section-number">25</span> Design widgets</a></li>
<li><a class="" href="mobile-going-further.html"><span class="header-section-number">26</span> Fine tune {shinyMobile}</a></li>
<li class="book-part">Going further</li>
<li><a class="" href="going-further-reactR.html"><span class="header-section-number">27</span> Shiny and React with {reactR}</a></li>
<li><a class="" href="going-further-webdev.html"><span class="header-section-number">28</span> Divide and Conquere</a></li>
<li><a class="" href="going-further-where-to-go.html"><span class="header-section-number">29</span> What to do next?</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="code-outputs.html"><span class="header-section-number">A</span> Code outputs</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="workflow-charpente" class="section level1" number="21">
<h1>
<span class="header-section-number">21</span> Automate new template creation with {charpente}<a class="anchor" aria-label="anchor" href="#workflow-charpente"><i class="fas fa-link"></i></a>
</h1>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:workflow-charpente-hex"></span>
<img src="images/workflow/charpente-hex.png" alt="The {charpente} package." width="15%"><p class="caption">
FIGURE 21.1: The {charpente} package.
</p>
</div>
<p></p>
<div id="motivations-2" class="section level2" number="21.1">
<h2>
<span class="header-section-number">21.1</span> Motivations<a class="anchor" aria-label="anchor" href="#motivations-2"><i class="fas fa-link"></i></a>
</h2>
<p>Translating an HTML template into an R API requires the creation of a package. This is not a good practice to proceed as follows:</p>
<p></p>
<div class="sourceCode" id="cb798"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shinyWidgets/man/useShinydashboard.html">useShinydashboard</a></span><span class="op">(</span><span class="op">)</span>,
  <span class="va">tags</span><span class="op">$</span><span class="fu">script</span><span class="op">(</span>
    <span class="st">"$(function() {
      // JS logic
    });
    "</span>
  <span class="op">)</span>,
  <span class="co"># R UI elements</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    
  <span class="co"># R server logic</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p></p>
<p>Imagine if we had to repeat the process for more than twenty components. The R package structure provides many advantages like:</p>
<ul>
<li>Develop a comprehensive <strong>documentation</strong> of the underlying API.</li>
<li>Design <strong>unit tests</strong> to guaranty code robustness and improve long term plan.</li>
<li>Relevant file organization, easing collaboration.</li>
</ul>
</div>
<div id="general-idea" class="section level2" number="21.2">
<h2>
<span class="header-section-number">21.2</span> General idea<a class="anchor" aria-label="anchor" href="#general-idea"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://github.com/RinteRface/charpente">{charpente}</a> is a game changer for custom template creation and has been widely used to help developing RinteRface packages.
<a href="https://github.com/RinteRface/charpente">charpente</a> <span class="citation">(<a href="references.html#ref-R-charpente" role="doc-biblioref">Granjon and Coene 2021</a>)</span> drastically:</p>
<ul>
<li>Eases the <strong>import</strong> of external dependencies.</li>
<li>Speeds up the HTML to R <strong>conversion</strong>, which is quite frankly a rather boring process,
allowing to focus on the features rather than the syntax. This feature builds on top of the <code>{html2R}</code> shiny app by Alan Dipert, already mentioned in Chapter <a href="htmltools-overview.html#htmltools-overview">2</a>.</li>
<li>Eases <strong>JS code management</strong>, leveraging <a href="https://esbuild.github.io/">esbuild</a>.</li>
</ul>
<p>Let’s try below with <code><a href="https://rdrr.io/pkg/charpente/man/html_2_R.html">html_2_R()</a></code>:</p>
<p></p>
<div class="sourceCode" id="cb799"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RinteRface/charpente">charpente</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/charpente/man/html_2_R.html">html_2_R</a></span><span class="op">(</span><span class="st">'&lt;div class="divclass" id = "someid"&gt;&lt;/div&gt;'</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; </code></pre>
<pre><code>#&gt; ── Converting code ... ──</code></pre>
<pre><code>#&gt; </code></pre>
<pre><code>#&gt; ✓ Code converted with success.</code></pre>
<pre><code>#&gt; ℹ Copy and paste the following R code</code></pre>
<pre><code>#&gt; ──────────────────────────────────────────────────</code></pre>
<pre><code>#&gt; tags$div(
#&gt;   class = "divclass",
#&gt;   id = "someid"
#&gt; )</code></pre>
<p></p>
<p><code>html_2_R</code> has a <strong>prefix</strong> parameter which adds a <code>tags$</code> prefix if TRUE. It is
TRUE by default which prevents errors with non exported Shiny tags like <code>nav</code>, as discussed in <a href="htmltools-overview.html#htmltools-overview">2</a>.</p>
<p>The second main benefit of <a href="https://github.com/RinteRface/charpente">charpente</a> is the dependency management system. We explain the main principles in the below example.</p>
</div>
<div id="a-case-study-shinybulma" class="section level2" number="21.3">
<h2>
<span class="header-section-number">21.3</span> A case study: <code>{shinybulma}</code><a class="anchor" aria-label="anchor" href="#a-case-study-shinybulma"><i class="fas fa-link"></i></a>
</h2>
<p>In the following, we’ll illustrate <a href="https://github.com/RinteRface/charpente">charpente</a>’s workflow, through a case <a href="https://github.com/RinteRface/Unleash-Shiny-Exercise-1">study</a> involving <a href="https://bulma.io/">bulma</a>, a more and more popular open source CSS framework for the web. Importantly, there <strong>isn’t</strong> any JavaScript in the bulma core code.
We’ll see later that the recent <a href="https://bulmajs.tomerbe.co.uk/">bulma JS</a> provides such an implementation. For now, we only focus on HTML and CSS.</p>
<p>To initialize a <a href="https://github.com/RinteRface/charpente">charpente</a> package, we run:</p>
<p></p>
<div class="sourceCode" id="cb807"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"mypkg"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_charpente.html">create_charpente</a></span><span class="op">(</span><span class="va">path</span>, license <span class="op">=</span> <span class="st">"mit"</span><span class="op">)</span></code></pre></div>
<p></p>
<p>This sets up a minimal viable package under version control (<strong>git</strong>) and optionally GitHub remote setup, Figure <a href="workflow-charpente.html#fig:workflow-charpente-pkg">21.2</a>.</p>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:workflow-charpente-pkg"></span>
<img src="images/workflow/charpente-pkg.png" alt="Package structure for {charpente}." width="75%"><p class="caption">
FIGURE 21.2: Package structure for {charpente}.
</p>
</div>
<p></p>
<p>By default, the package <code>DESCRIPTION</code> <code>Imports</code> field has <code>shiny</code>, <code>htmltools</code> and
<code>utils</code>. <a href="https://github.com/RinteRface/charpente">charpente</a> is never required to be a dependency of your package since it might
be invasive.</p>
<p>In the <code>./R</code> folder, <a href="https://github.com/RinteRface/charpente">charpente</a> creates a <code>mypkg-utils.R</code> script containing:</p>
<ul>
<li>Tools to facilitate <strong>HTML dependency</strong> management like <code>add_dependencies</code> (see corresponding section below).</li>
<li>Some <strong>validation</strong> functions mentioned in Chapter <a href="custom-templates-testing.html#custom-templates-testing">20</a>.</li>
</ul>
<p>Finally, you may see some exotic folders and files like <code>srcjs</code>, <code>package.json</code>, <code>package-lock.json</code> and <code>node_modules</code>. Fear not, we describe them later in <a href="workflow-charpente.html#organize-your-js">21.3.6</a>. Overall, they are here to support to JS code management.</p>
<div id="build-the-html-dependency" class="section level3" number="21.3.1">
<h3>
<span class="header-section-number">21.3.1</span> Build the HTML dependency<a class="anchor" aria-label="anchor" href="#build-the-html-dependency"><i class="fas fa-link"></i></a>
</h3>
<p>The interested reader may have a look at the <strong>Getting started <a href="https://bulma.io/documentation/overview/start/">guide</a></strong>,
so as to know more how to get bulma. In short, to install bulma dependencies, there are several ways:</p>
<ul>
<li>The <strong>content delivery network</strong> method (CDN) which consists in getting dependencies from a dedicated server.
Files are not stored locally which may be a problem if one does not have internet.</li>
<li>The local method consists in downloading the production files (minified CSS).</li>
<li>Using <a href="https://www.npmjs.com/">npm</a> (JS package repository but far less controlled than CRAN) that installs bulma sources as well as production files. It means one can modify
sources at anytime, which is not recommended since it would be hard to
maintain.</li>
</ul>
<p>In our case, we show the two first methods, the third being out of the scope of this book.</p>
<p>As shown in previous Chapter <a href="custom-templates-dependencies.html#custom-templates-dependencies">16</a>,
we could build the bulma dependency as follows:</p>
<p></p>
<div class="sourceCode" id="cb808"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools">htmltools</a></span><span class="op">)</span>
<span class="va">bulma_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="va">...</span>,
  version <span class="op">=</span> <span class="va">...</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>href <span class="op">=</span> <span class="va">...</span><span class="op">)</span>,
  stylesheet <span class="op">=</span> <span class="va">...</span>
<span class="op">)</span>

<span class="va">add_bulma_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span><span class="va">...</span>, <span class="va">bulma_deps</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>but this already takes too much time. This is where <a href="https://github.com/RinteRface/charpente">charpente</a> comes into play.
Specifically, the <code><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency()</a></code> function automatically points to the specified dependency by just providing its name. This means you have to know what you are looking for. Best practice is to look at the <a href="https://www.jsdelivr.com/">jsdelivr</a> website (<a href="https://github.com/RinteRface/charpente">charpente</a> is built on top of jsdelivr) and find the correct repository, as shown Figure <a href="workflow-charpente.html#fig:workflow-jsdelivr-bulma">21.3</a>. <code><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency()</a></code> will also create the <code>add_&lt;DEP_NAME&gt;_deps</code> function in a <code>&lt;DEP_NAME&gt;--dependencies.R</code> script and open it.</p>
<p><code><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options(local = FALSE)</a></code> allows you to fine tune the behavior. If local is FALSE,
<a href="https://github.com/RinteRface/charpente">charpente</a> points to the CDN without downloading any files. However, your end users will require
an internet connection to be able to access static assets required by the Shiny app.
Therefore, package developers should prefer the option <code>local = TRUE</code> to ensure dependencies are always accessible.
Extra parameters like <strong>tag</strong> control the downloaded version since HTML templates
may have several flavors. It is always good to be able to test multiple versions and select
the best option.</p>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:workflow-jsdelivr-bulma"></span>
<img src="images/workflow/jsdelivr-bulma.png" alt="jsdelivr result for bulma." width="100%"><p class="caption">
FIGURE 21.3: jsdelivr result for bulma.
</p>
</div>
<p>
Once satisfied, we simply run the below code to get the latest version, or a specific
version if <strong>tag</strong> is used:</p>
<p></p>
<div class="sourceCode" id="cb809"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CDN method </span>
<span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency</a></span><span class="op">(</span>
  <span class="st">"bulma"</span>, 
  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options</a></span><span class="op">(</span>local <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency</a></span><span class="op">(</span>
  <span class="st">"bulma"</span>, 
  tag <span class="op">=</span> <span class="st">"0.7.0"</span>, 
  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options</a></span><span class="op">(</span>local <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># local method (default)</span>
<span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency</a></span><span class="op">(</span><span class="st">"bulma"</span><span class="op">)</span></code></pre></div>
<p></p>
<p>Moreover, <code><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency()</a></code> is able to filter all files, through the <code><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options()</a></code>:</p>
<ul>
<li>
<strong>minified</strong> targets all files with <code>.min</code>, if TRUE.</li>
<li>
<strong>bundle</strong> targets all files containing <code>.bundle</code>, if TRUE.</li>
<li>
<strong>lite</strong> targets files with <code>lite</code> keyword, if TRUE.</li>
<li>
<strong>rtl</strong> target all files with <code>.rtl</code>, if TRUE. rtl design stands for right to left
and is common in some countries for instance.</li>
</ul>
<p>You may imagine that <code><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options()</a></code> targets <code>.min</code> files by default. If you don’t find
any script, you probably have to change options. For instance, some templates
like Bootstrap and Framework7 have <code>bundle.min</code> files (<code><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options(bunlde = TRUE)</a></code>), whereas bulma doesn’t.</p>
<p>We can test our new dependency:</p>
<p></p>
<div class="sourceCode" id="cb810"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/findDependencies.html">findDependencies</a></span><span class="op">(</span><span class="fu">add_bulma_deps</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p></p>
<p>which works like a charm. If you chose the local option, you also get an <code>inst/bulma-&lt;BULMA-VERSION&gt;</code> folder
with all relevant files sorted by type. The <code>bulma-dependencies.R</code> script contains the
newly created <code>add_bulma_deps</code> function, either pointing to the CDN or the local
files, depending on the chosen strategy:</p>
<p></p>
<div class="sourceCode" id="cb811"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># local dependency script output</span>

<span class="co">#' bulma dependencies utils</span>
<span class="co">#'</span>
<span class="co">#' @description This function attaches bulma dependencies </span>
<span class="co">#' to the given tag</span>
<span class="co">#'</span>
<span class="co">#' @param tag Element to attach the dependencies.</span>
<span class="co">#'</span>
<span class="co">#' @importFrom htmltools tagList htmlDependency</span>
<span class="co">#' @export</span>
<span class="va">add_bulma_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="op">{</span>
 <span class="va">bulma_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"bulma"</span>,
  version <span class="op">=</span> <span class="st">"0.9.3"</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"bulma-0.9.3"</span><span class="op">)</span>,
  stylesheet <span class="op">=</span> <span class="st">"css/bulma.min.css"</span>,
  package <span class="op">=</span> <span class="st">"mypkg"</span>,
 <span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span><span class="va">tag</span>, <span class="va">bulma_deps</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p></p>
<div class="sourceCode" id="cb812"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CDN dependencies</span>

<span class="co">#' bulma dependencies utils</span>
<span class="co">#'</span>
<span class="co">#' @description This function attaches bulma </span>
<span class="co">#' dependencies to the given tag</span>
<span class="co">#'</span>
<span class="co">#' @param tag Element to attach the dependencies.</span>
<span class="co">#'</span>
<span class="co">#' @importFrom htmltools tagList htmlDependency</span>
<span class="co">#' @export</span>
<span class="va">add_bulma_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="op">{</span>
 <span class="va">bulma_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"bulma"</span>,
  version <span class="op">=</span> <span class="st">"0.9.3"</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>href <span class="op">=</span> <span class="st">"https://cdn.jsdelivr.net/npm/bulma@0.9.3/"</span><span class="op">)</span>,
  stylesheet <span class="op">=</span> <span class="st">"css/bulma.min.css"</span>
 <span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span><span class="va">tag</span>, <span class="va">bulma_deps</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p><a href="https://github.com/RinteRface/charpente">charpente</a> sets the roxygen skeleton so that you don’t have to worry about function imports.</p>
</div>
<div id="set-up-the-minimal-page-template" class="section level3" number="21.3.2">
<h3>
<span class="header-section-number">21.3.2</span> Set up the minimal page template<a class="anchor" aria-label="anchor" href="#set-up-the-minimal-page-template"><i class="fas fa-link"></i></a>
</h3>
<p>According to the bulma <a href="https://bulma.io/documentation/overview/start/#starter-template">documentation</a>, the starter page template is:</p>
<p></p>
<div class="sourceCode" id="cb813"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb813-1"><a href="workflow-charpente.html#cb813-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb813-2"><a href="workflow-charpente.html#cb813-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;html&gt;</span></span>
<span id="cb813-3"><a href="workflow-charpente.html#cb813-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;head&gt;</span></span>
<span id="cb813-4"><a href="workflow-charpente.html#cb813-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;meta</span> <span class="er">charset</span><span class="ot">=</span><span class="st">"utf-8"</span><span class="kw">&gt;</span></span>
<span id="cb813-5"><a href="workflow-charpente.html#cb813-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;meta</span> <span class="er">name</span><span class="ot">=</span><span class="st">"viewport"</span> <span class="er">content</span><span class="ot">=</span><span class="st">"width=device-width, </span></span>
<span id="cb813-6"><a href="workflow-charpente.html#cb813-6" aria-hidden="true" tabindex="-1"></a><span class="st">      initial-scale=1"</span><span class="kw">&gt;</span></span>
<span id="cb813-7"><a href="workflow-charpente.html#cb813-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;title&gt;</span>Hello Bulma!<span class="kw">&lt;/title&gt;</span></span>
<span id="cb813-8"><a href="workflow-charpente.html#cb813-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;link</span> <span class="er">rel</span><span class="ot">=</span><span class="st">"stylesheet"</span> <span class="er">href</span><span class="ot">=</span><span class="st">"https://cdn.jsdelivr.net/</span></span>
<span id="cb813-9"><a href="workflow-charpente.html#cb813-9" aria-hidden="true" tabindex="-1"></a><span class="st">    /bulma.min.css"</span><span class="kw">&gt;</span></span>
<span id="cb813-10"><a href="workflow-charpente.html#cb813-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/head&gt;</span></span>
<span id="cb813-11"><a href="workflow-charpente.html#cb813-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;body&gt;</span></span>
<span id="cb813-12"><a href="workflow-charpente.html#cb813-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;section</span> <span class="er">class</span><span class="ot">=</span><span class="st">"section"</span><span class="kw">&gt;</span></span>
<span id="cb813-13"><a href="workflow-charpente.html#cb813-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;div</span> <span class="er">class</span><span class="ot">=</span><span class="st">"container"</span><span class="kw">&gt;</span></span>
<span id="cb813-14"><a href="workflow-charpente.html#cb813-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;h1</span> <span class="er">class</span><span class="ot">=</span><span class="st">"title"</span><span class="kw">&gt;</span></span>
<span id="cb813-15"><a href="workflow-charpente.html#cb813-15" aria-hidden="true" tabindex="-1"></a>          Hello World</span>
<span id="cb813-16"><a href="workflow-charpente.html#cb813-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;/h1&gt;</span></span>
<span id="cb813-17"><a href="workflow-charpente.html#cb813-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;p</span> <span class="er">class</span><span class="ot">=</span><span class="st">"subtitle"</span><span class="kw">&gt;</span></span>
<span id="cb813-18"><a href="workflow-charpente.html#cb813-18" aria-hidden="true" tabindex="-1"></a>          My first website with <span class="kw">&lt;strong&gt;</span>Bulma<span class="kw">&lt;/strong&gt;</span>!</span>
<span id="cb813-19"><a href="workflow-charpente.html#cb813-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;/p&gt;</span></span>
<span id="cb813-20"><a href="workflow-charpente.html#cb813-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;/div&gt;</span></span>
<span id="cb813-21"><a href="workflow-charpente.html#cb813-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/section&gt;</span></span>
<span id="cb813-22"><a href="workflow-charpente.html#cb813-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/body&gt;</span></span>
<span id="cb813-23"><a href="workflow-charpente.html#cb813-23" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p></p>
<p>Adding some <a href="https://github.com/RinteRface/charpente">charpente</a> magic with <code><a href="https://rdrr.io/pkg/charpente/man/html_2_R.html">html_2_R()</a></code>, we set the path parameter to <code>/html</code> to get the entire template. We, replace <code>...</code> with the appropriate content (see above). Since the copied HTML contains double quotations marks like <code>&lt;p class="subtitle"&gt;&lt;/p&gt;</code>, we put the string in single quotation marks.</p>
<p></p>
<p></p>
<p></p>
<div class="sourceCode" id="cb814"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># bulma_html_skeleton is the above HTML code</span>
<span class="fu"><a href="https://rdrr.io/pkg/charpente/man/html_2_R.html">html_2_R</a></span><span class="op">(</span><span class="va">bulma_html_skeleton</span>, path <span class="op">=</span> <span class="st">"/html"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; </code></pre>
<pre><code>#&gt; ── Converting code ... ──</code></pre>
<pre><code>#&gt; </code></pre>
<pre><code>#&gt; ✓ Code converted with success.</code></pre>
<pre><code>#&gt; ℹ Copy and paste the following R code</code></pre>
<pre><code>#&gt; ──────────────────────────────────────────────────</code></pre>
<pre><code>#&gt; tags$html(
#&gt;   tags$head(
#&gt;     tags$meta(charset = "utf-8"),
#&gt;     tags$meta(
#&gt;       name = "viewport",
#&gt;       content = "width=device-width, initial-scale=1"
#&gt;     ),
#&gt;     tags$title("Hello Bulma!")
#&gt;   ),
#&gt;   tags$body(tags$section(
#&gt;     class = "section",
#&gt;     tags$div(
#&gt;       class = "container",
#&gt;       tags$h1(
#&gt;         class = "title",
#&gt;         "Hello World"
#&gt;       ),
#&gt;       tags$p(
#&gt;         class = "subtitle",
#&gt;         "My first website with",
#&gt;         tags$strong("Bulma"),
#&gt;         "!"
#&gt;       )
#&gt;     )
#&gt;   ))
#&gt; )</code></pre>
<p></p>
<div class="noteblock">
<p>At run time, shiny adds <code>html</code> around the UI, thereby making it not necessary to include.
We don’t need the <code>link(rel = "stylesheet", href = "https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css")</code>
since <code>add_bulma_deps</code> does already attach the dependencies to the page. We removed <code>tags$section</code> content as it may correspond to another bulma component, like <code>bulma_section()</code>.</p>
</div>
<p>The <code>prefix</code> parameter defaults to TRUE, so that we don’t have to worry about whether tags functions are exported
by shiny (see Chapter <a href="htmltools-overview.html#htmltools-overview">2</a>).</p>
<p>The <code>bulma_page()</code> function is defined below, considering a simplified version of the above HTML to R translation, that we save in the <code>./R</code> package folder:</p>
<p></p>
<div class="sourceCode" id="cb822"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bulma_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>charset <span class="op">=</span> <span class="st">"utf-8"</span><span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"viewport"</span>,
        content <span class="op">=</span> <span class="st">"width=device-width, initial-scale=1"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">title</span><span class="op">(</span><span class="va">title</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu">add_bulma_deps</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">)</span> 
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>With some practice, going from step one to the bulma page templates literally takes three minutes,
while it would have taken much more time by hand. At any time, you may replace
the dependency with another version. Be careful, since <a href="https://github.com/RinteRface/charpente">charpente</a> does not make snapshots of old versions.</p>
</div>
<div id="exercise-add-bulmajs" class="section level3" number="21.3.3">
<h3>
<span class="header-section-number">21.3.3</span> Exercise: add bulmaJS<a class="anchor" aria-label="anchor" href="#exercise-add-bulmajs"><i class="fas fa-link"></i></a>
</h3>
<p>As stated in the above, bulma only contains CSS code. It means we need
to either develop custom JS code to add interactivity or rely on any third party existing API. <a href="https://bulmajs.tomerbe.co.uk/">bulma JS</a> is one of these.</p>
<div class="importantblock">
<p>This example has been written and tested with bulmaJS (<a href="https://www.jsdelivr.com/package/npm/@vizuaalog/bulmajs?version=0.12.1" class="uri">https://www.jsdelivr.com/package/npm/@vizuaalog/bulmajs?version=0.12.1</a>) <code>0.12.1</code>.
Some features may change in future releases.</p>
</div>
<ol style="list-style-type: decimal">
<li>Using <a href="https://github.com/RinteRface/charpente">charpente</a>, create a bulma js dependency. We point to <a href="https://bulmajs.tomerbe.co.uk/">vizuaalog/bulmajs</a> since some bulmajs already exist and is not what we want. Run the following code in the R console.</li>
</ol>
<p></p>
<div class="sourceCode" id="cb823"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/get_dependency_assets.html">get_dependency_assets</a></span><span class="op">(</span><span class="st">"@vizuaalog/bulmajs"</span><span class="op">)</span></code></pre></div>
<p></p>
<p></p>
<pre><code>#&gt; ℹ Trying with https://data.jsdelivr.com/v1/package/npm/@vizuaalog/bulmajs</code></pre>
<pre><code>#&gt; ✓ Success!</code></pre>
<pre><code>#&gt; ──────────────────────────────────────────────────</code></pre>
<pre><code>#&gt; $url
#&gt; [1] "https://cdn.jsdelivr.net/npm/@vizuaalog/bulmajs@0.12.1/dist/"
#&gt; 
#&gt; $files
#&gt;               name
#&gt; 1         alert.js
#&gt; 2         bulma.js
#&gt; 3      dropdown.js
#&gt; 4          file.js
#&gt; 5       message.js
#&gt; 6         modal.js
#&gt; 7        navbar.js
#&gt; 8  notification.js
#&gt; 9         panel.js
#&gt; 10    panelTabs.js
#&gt; 11         tabs.js
#&gt;                                            hash
#&gt; 1  0Tq89d1U9WqE3xunn1SJLwD3qQvoiDU/ujdOQAxNGME=
#&gt; 2  vbERfMn7TdJ3ZyBfxd+sGJf/fWG/GnWmvMn88FdhfAE=
#&gt; 3  a4jYH26F8++608JkISGhK0djf4oBOfa+MeKGzi0yM3U=
#&gt; 4  auA7tFsecFictV+ZLehk+avAsr6QHjDvxXXGEyq2bbw=
#&gt; 5  xIxQKW6ezuEuLxsEGB+voTYg0ZWjIldWZoZltlJIUjA=
#&gt; 6  hBvcaTjLTgUEz5N2JhIeJz2jXagbOVG7KNxn406heMI=
#&gt; 7  kZ1bvDA2eaAtPwCmyZJyQDlhmhXVXGmJot30R6iEXDY=
#&gt; 8  DLFq8emqUPpFOt948fP+iWl1/SdJdYRiFA1yLEeowpw=
#&gt; 9  NSnEBEPnog3obqVUCnTAn4d9+333/jvQpQsNlYDoYUk=
#&gt; 10 YYhbFo+xIExSfq9YIa/gDkKunSv852A+Lay4qbP6/+w=
#&gt; 11 /DBuPkvCsQJ6pg+nqBqwFsOHXphtW12e2TQmIs9+tNU=
#&gt; 
#&gt; $hasSubfolders
#&gt; [1] FALSE</code></pre>
<p></p>
<p></p>
<p></p>
<p>As shown in the code output, bulmajs does not have minified JS and CSS files. Therefore, to install the dependency, we have to specify the <code><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options(minified = FALSE)</a></code>:</p>
<p></p>
<div class="sourceCode" id="cb828"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options</a></span><span class="op">(</span>minified <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency</a></span><span class="op">(</span><span class="va">...</span>, options <span class="op">=</span> <span class="va">opts</span><span class="op">)</span></code></pre></div>
<p></p>
<p>Notice how many files are added to the dependency. Below, we only work with <strong>notifications</strong>:</p>
<ul>
<li>Only keep <code>notification.js</code> and remove all the unnecessary files</li>
<li>Only keep <code>bulma.js</code> that gather all plugins in 1 script.</li>
</ul>
<p>The best practice is usually to <strong>keep only what we need</strong> since some scripts may be <strong>heavy to load</strong>.</p>
<ol start="2" style="list-style-type: decimal">
<li>Run <code>devtools::load_all()</code>. Modify the below code to test the newly created dependency. Hint: toggle the HTML inspector to check all appropriate dependencies are there.</li>
</ol>
<p></p>
<div class="sourceCode" id="cb829"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Where should the html dependency be added?</span>
<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">bulma_page</span><span class="op">(</span><span class="op">)</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p></p>
</div>
<div id="add-custom-js" class="section level3" number="21.3.4">
<h3>
<span class="header-section-number">21.3.4</span> Add custom JS<a class="anchor" aria-label="anchor" href="#add-custom-js"><i class="fas fa-link"></i></a>
</h3>
<p>Notifications are always useful to send user feedback. Shiny has a notification system through <code><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">shiny::showNotification</a></code>. Like Shiny, Bulma <a href="https://bulmajs.tomerbe.co.uk/docs/0.11/2-core-components/notification/">notifications</a> are entirely built from JS (no need for any HTML code).</p>
<p>The API works as follows:</p>
<ul>
<li>
<code>Bulma(target).notification(config)</code> creates the notification based on a JSON option list (config).
<code>target</code> expects a jQuery selector.</li>
<li>
<code>show</code> toggles the newly instantiated notification</li>
</ul>
<p>In other words the below code attaches the notification to the <code>body</code>:</p>
<p></p>
<div class="sourceCode" id="cb830"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb830-1"><a href="workflow-charpente.html#cb830-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Bulma</span>(<span class="st">'body'</span>)<span class="op">.</span><span class="fu">notification</span>({</span>
<span id="cb830-2"><a href="workflow-charpente.html#cb830-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">body</span><span class="op">:</span> <span class="st">'Example notification'</span><span class="op">,</span></span>
<span id="cb830-3"><a href="workflow-charpente.html#cb830-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'info'</span></span>
<span id="cb830-4"><a href="workflow-charpente.html#cb830-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">show</span>()<span class="op">;</span></span></code></pre></div>
<p></p>
<p>In the following we design the R interface and JavaScript handler (which is no more than an event listener).
<a href="https://github.com/RinteRface/charpente">charpente</a> has a function that creates both pieces, namely <code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_custom_handler()</a></code>:</p>
<p></p>
<div class="sourceCode" id="cb831"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_custom_handler</a></span><span class="op">(</span><span class="st">"notification"</span><span class="op">)</span></code></pre></div>
<p></p>
<p>We obtain the <code>notification-handler.R</code> script:</p>
<p></p>
<div class="sourceCode" id="cb832"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">send_notification_message</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
  <span class="va">id</span> <span class="op">=</span> <span class="cn">NULL</span>, 
  <span class="va">options</span> <span class="op">=</span> <span class="cn">NULL</span>, 
  <span class="va">session</span> <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/domains.html">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span> <span class="op">{</span>
 <span class="va">message</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="co"># your logic</span>
 <span class="op">)</span>
 
 <span class="va">session</span><span class="op">$</span><span class="fu">sendCustomMessage</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"notification"</span>, <span class="va">message</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>and the corresponding JavaScript piece in <code>notification.js</code>,
derived from the <code><a href="https://rdrr.io/pkg/golem/man/add_files.html">golem::add_js_handler</a></code> function:</p>
<p></p>
<div class="sourceCode" id="cb833"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb833-1"><a href="workflow-charpente.html#cb833-1" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="kw">function</span>() {</span>
<span id="cb833-2"><a href="workflow-charpente.html#cb833-2" aria-hidden="true" tabindex="-1"></a>  Shiny<span class="op">.</span><span class="fu">addCustomMessageHandler</span>(</span>
<span id="cb833-3"><a href="workflow-charpente.html#cb833-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'notification'</span><span class="op">,</span> <span class="kw">function</span>(message) {</span>
<span id="cb833-4"><a href="workflow-charpente.html#cb833-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb833-5"><a href="workflow-charpente.html#cb833-5" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb833-6"><a href="workflow-charpente.html#cb833-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p></p>
<p>By default, the JS file is created in the <code>./srcjs</code> directory. This is a special directory where we store all JavaScript files that depend on the package author. For instance, bulmaJS is an external dependency and is very unlikely to be edited by the package author. For that reason, it remains in the <code>./inst</code> folder like all other external dependencies.</p>
</div>
<div id="add-custom-inputoutput-bindings" class="section level3" number="21.3.5">
<h3>
<span class="header-section-number">21.3.5</span> Add custom input/output bindings<a class="anchor" aria-label="anchor" href="#add-custom-inputoutput-bindings"><i class="fas fa-link"></i></a>
</h3>
<p>In part <a href="shiny-input-system.html#secondary-inputs">12.2</a>, we created better <a href="http://rstudio.github.io/shinydashboard/">shinydashboard</a> boxes that one
may programmatically collapse, close, and restore. Until now, there was no way to
setup an input binding skeleton and one had to copy and paste each time the same
code. <a href="https://github.com/RinteRface/charpente">charpente</a> has a <code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_input_binding()</a></code> and <code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_output_binding()</a></code> (functions that
you can also find in the development version of <a href="https://github.com/ThinkR-open/golem">golem</a>). Contrary to the custom handler case,
<code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_input_binding()</a></code> only generates the JavaScript piece since the R part is highly variable from
one input to another. To get a plug-and-play box input binding, we call:</p>
<p></p>
<div class="sourceCode" id="cb834"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_input_binding</a></span><span class="op">(</span><span class="st">"boxBinding"</span><span class="op">)</span></code></pre></div>
<p></p>
<p>which gives the <code>input-boxBinding.js</code> script in the <code>./srcjs</code> folder:</p>
<p></p>
<div class="sourceCode" id="cb835"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb835-1"><a href="workflow-charpente.html#cb835-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> boxBinding <span class="op">=</span> <span class="kw">new</span> Shiny<span class="op">.</span><span class="fu">InputBinding</span>()<span class="op">;</span></span>
<span id="cb835-2"><a href="workflow-charpente.html#cb835-2" aria-hidden="true" tabindex="-1"></a>$<span class="op">.</span><span class="fu">extend</span>(boxBinding<span class="op">,</span> {</span>
<span id="cb835-3"><a href="workflow-charpente.html#cb835-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">find</span><span class="op">:</span> <span class="kw">function</span>(scope) {</span>
<span id="cb835-4"><a href="workflow-charpente.html#cb835-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// JS logic $(scope).find('whatever')</span></span>
<span id="cb835-5"><a href="workflow-charpente.html#cb835-5" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb835-6"><a href="workflow-charpente.html#cb835-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">getValue</span><span class="op">:</span> <span class="kw">function</span>(el) {</span>
<span id="cb835-7"><a href="workflow-charpente.html#cb835-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// JS code to get value</span></span>
<span id="cb835-8"><a href="workflow-charpente.html#cb835-8" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb835-9"><a href="workflow-charpente.html#cb835-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">setValue</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> value) {</span>
<span id="cb835-10"><a href="workflow-charpente.html#cb835-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// JS code to set value</span></span>
<span id="cb835-11"><a href="workflow-charpente.html#cb835-11" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb835-12"><a href="workflow-charpente.html#cb835-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">receiveMessage</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> data) {</span>
<span id="cb835-13"><a href="workflow-charpente.html#cb835-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// this.setValue(el, data);</span></span>
<span id="cb835-14"><a href="workflow-charpente.html#cb835-14" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb835-15"><a href="workflow-charpente.html#cb835-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">subscribe</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> callback) {</span>
<span id="cb835-16"><a href="workflow-charpente.html#cb835-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">on</span>(<span class="st">'click.boxBinding'</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb835-17"><a href="workflow-charpente.html#cb835-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">callback</span>()<span class="op">;</span></span>
<span id="cb835-18"><a href="workflow-charpente.html#cb835-18" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb835-19"><a href="workflow-charpente.html#cb835-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb835-20"><a href="workflow-charpente.html#cb835-20" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb835-21"><a href="workflow-charpente.html#cb835-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">unsubscribe</span><span class="op">:</span> <span class="kw">function</span>(el) {</span>
<span id="cb835-22"><a href="workflow-charpente.html#cb835-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">off</span>(<span class="st">'.boxBinding'</span>)<span class="op">;</span></span>
<span id="cb835-23"><a href="workflow-charpente.html#cb835-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb835-24"><a href="workflow-charpente.html#cb835-24" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb835-25"><a href="workflow-charpente.html#cb835-25" aria-hidden="true" tabindex="-1"></a>Shiny<span class="op">.</span><span class="at">inputBindings</span><span class="op">.</span><span class="fu">register</span>(boxBinding<span class="op">,</span> <span class="st">'shiny.whatever'</span>)<span class="op">;</span></span></code></pre></div>
<p></p>
<p>This function has multiple options:</p>
<ul>
<li>
<strong>initialized</strong> is FALSE by default. If TRUE, it adds an <code>initialized</code> method
to the binding.</li>
<li>
<strong>dev</strong> adds some <code>console.log</code> elements whenever relevant to help in the debugging
process.</li>
<li>
<strong>event</strong> is a list containing events related to the binding. By default, it generates
a <code>click</code> event without any rate policy. To add extra events we do
<code><a href="https://rdrr.io/r/base/list.html">list(name = c("click", "whatever"), rate_policy = c(FALSE, TRUE))</a></code>.</li>
</ul>
<p>Similarly, the <code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_output_binding()</a></code> function creates a ready to use output binding JS script,
in the <code>./srcjs</code> folder (<code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_output_binding("menuOutput")</a></code>):</p>
<p></p>
<div class="sourceCode" id="cb836"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb836-1"><a href="workflow-charpente.html#cb836-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> menuOutput <span class="op">=</span> <span class="kw">new</span> Shiny<span class="op">.</span><span class="fu">OutputBinding</span>()<span class="op">;</span></span>
<span id="cb836-2"><a href="workflow-charpente.html#cb836-2" aria-hidden="true" tabindex="-1"></a>$<span class="op">.</span><span class="fu">extend</span>(menuOutput<span class="op">,</span> {</span>
<span id="cb836-3"><a href="workflow-charpente.html#cb836-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">find</span><span class="op">:</span> <span class="kw">function</span>(scope) {</span>
<span id="cb836-4"><a href="workflow-charpente.html#cb836-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// JS logic $(scope).find('whatever')</span></span>
<span id="cb836-5"><a href="workflow-charpente.html#cb836-5" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb836-6"><a href="workflow-charpente.html#cb836-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">renderValue</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> data) {</span>
<span id="cb836-7"><a href="workflow-charpente.html#cb836-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// JS logic</span></span>
<span id="cb836-8"><a href="workflow-charpente.html#cb836-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb836-9"><a href="workflow-charpente.html#cb836-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb836-10"><a href="workflow-charpente.html#cb836-10" aria-hidden="true" tabindex="-1"></a>Shiny<span class="op">.</span><span class="at">outputBindings</span><span class="op">.</span><span class="fu">register</span>(menuOutput<span class="op">,</span> <span class="st">'shiny.whatever'</span>)<span class="op">;</span></span></code></pre></div>
<p></p>
</div>
<div id="organize-your-js" class="section level3" number="21.3.6">
<h3>
<span class="header-section-number">21.3.6</span> Organize your JS code<a class="anchor" aria-label="anchor" href="#organize-your-js"><i class="fas fa-link"></i></a>
</h3>
<p>This naturally leads us to this part which is about JS code organization. Shiny developers
may have a lot of custom JS scripts, and it is generally a bad idea to put them all
under <code>./inst</code>. Instead, we store them in <code>./srcjs</code>, as already stated above. <a href="https://github.com/RinteRface/charpente">charpente</a> has a function providing
a tool to bundle the JS code for production or development, that is <code><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js()</a></code>:</p>
<ul>
<li>It compresses, mangles all JS files and concatenate them in one minified file called <code>mypkg.min.js</code>. If <strong>mode</strong> is <code>dev</code>, the files are not minified.</li>
<li>In production mode (<strong>mode</strong> is <code>prod</code>, by default), it additionally generates source maps.</li>
</ul>
<div class="noteblock">
<p>esbuild concatenates files by the order provided in the <code>./srcjs/main.js</code> entry point, automatically generated by <code><a href="https://rdrr.io/pkg/charpente/man/create_charpente.html">create_charpente()</a></code>. The configuration is provided by <a href="https://github.com/RinteRface/charpente">charpente</a> in the <code>package.json</code> file.</p>
</div>
<p>The script <code>mypkg.min.js</code> is not human readable but the generated source map
allows to reconstruct the original code, which location is under the web browser <code>./srcjs</code> folder, like all Shiny JS files. From there, we can access any mapped script and start the debugging process like setting break points.</p>
<div class="noteblock">
<p>In production, the variable names, functions, are mangled. For instance, a variable
<code>config</code> could be called <code>t</code> in the minified file.</p>
</div>
<p>Additionally, <code><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js()</a></code> creates the <code>mypkg-dependencies.R</code> file containing the HTML
dependency pointing to the newly generated JS file (below for production):</p>
<p></p>
<div class="sourceCode" id="cb837"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' mypkg dependencies utils</span>
<span class="co">#'</span>
<span class="co">#' @description This function attaches mypkg dependencies </span>
<span class="co">#' to the given tag</span>
<span class="co">#'</span>
<span class="co">#' @param tag Element to attach the dependencies.</span>
<span class="co">#'</span>
<span class="co">#' @importFrom utils packageVersion</span>
<span class="co">#' @importFrom htmltools tagList htmlDependency</span>
<span class="co">#' @export</span>
<span class="va">add_mypkg_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="op">{</span>
 <span class="va">mypkg_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"mypkg"</span>,
  version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"mypkg"</span><span class="op">)</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"mypkg-0.0.0.9000"</span><span class="op">)</span>,
  script <span class="op">=</span> <span class="st">"js/mypkg.min.js"</span>,
  package <span class="op">=</span> <span class="st">"mypkg"</span>,
 <span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span><span class="va">tag</span>, <span class="va">mypkg_deps</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>Switching between <code>prod</code> and <code>dev</code> automatically updates the <code>mypkg-dependencies.R</code> JS files.</p>
<p>Finally, under the hood, <code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_js()</a></code>, <code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_input_binding()</a></code>, <code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_output_binding()</a></code> and <code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_custom_handler()</a></code> add a reference to the newly created script in the <code>main.js</code> entry point, which may look like:</p>
<p></p>
<div class="sourceCode" id="cb838"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb838-1"><a href="workflow-charpente.html#cb838-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Gather all files to import here</span></span>
<span id="cb838-2"><a href="workflow-charpente.html#cb838-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="st">'./init.js'</span></span>
<span id="cb838-3"><a href="workflow-charpente.html#cb838-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="st">'./widgets.js'</span></span>
<span id="cb838-4"><a href="workflow-charpente.html#cb838-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="st">'./test.js'</span></span></code></pre></div>
<p></p>
<p>A real life example will be shown in the next part <a href="mobile-shinyMobile.html#mobile-modularizeJS">23.7</a> and the result showcased <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/tree/fd0ba28881869c5c605dd0e5b9f7a8f420bbedb4/srcjs">here</a>.</p>
<p><strong>export</strong> and <strong>import</strong> must be called from the top level of a script. For instance,
they cannot live inside the <code>$( document ).ready(function(...)});</code>, as this would trigger a build error.</p>
<p><a href="https://github.com/RinteRface/charpente">charpente</a> currently does not provide a similar process for CSS, as this is still work in progress. Other tools exist like <a href="https://github.com/JohnCoene/packer"><code>{packer}</code></a> by <a href="https://john-coene.com/">John Coene</a>, which leverages <a href="https://webpack.js.org/">webpack</a> to handle JS code.</p>
</div>
<div id="combine-multiple-dependencies" class="section level3" number="21.3.7">
<h3>
<span class="header-section-number">21.3.7</span> Combine multiple dependencies<a class="anchor" aria-label="anchor" href="#combine-multiple-dependencies"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://rdrr.io/pkg/OSUICode/man/add_dependencies.html">add_dependencies()</a></code> allows to select any dependency available in the <code>./R</code> folder,
provided that they follow the convention <code>&lt;depName&gt;_dependencies.R</code>
(which is always the case if you use <a href="https://github.com/RinteRface/charpente">charpente</a>).</p>
<p>For instance <code><a href="https://rdrr.io/pkg/OSUICode/man/add_dependencies.html">add_dependencies(div(), deps = c("bulma", "bulmajs"))</a></code> adds bulma (first) and
bulmajs dependencies to a <code>div</code> tag. You may change the order as you see fit, as most
of the time, the order matters. We update <code>bulma_page()</code> to benefit from the new dependencies:</p>
<p></p>
<div class="sourceCode" id="cb839"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bulma_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>charset <span class="op">=</span> <span class="st">"utf-8"</span><span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"viewport"</span>,
        content <span class="op">=</span> <span class="st">"width=device-width, initial-scale=1"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">title</span><span class="op">(</span><span class="va">title</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/add_dependencies.html">add_dependencies</a></span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span><span class="va">...</span><span class="op">)</span>,
      deps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bulma"</span>, <span class="st">"mypkg"</span><span class="op">)</span>
    <span class="op">)</span> 
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>As mentioned above, <code><a href="https://rdrr.io/pkg/OSUICode/man/add_dependencies.html">add_dependencies()</a></code> belongs to the <code>mypkg-utils.R</code> script
so that you don’t have to import <a href="https://github.com/RinteRface/charpente">charpente</a> in the <code>DESCRIPTION</code> <code>Imports</code> field.</p>
</div>
<div id="other-charpente-helpers" class="section level3" number="21.3.8">
<h3>
<span class="header-section-number">21.3.8</span> Other <code>{charpente}</code> helpers<a class="anchor" aria-label="anchor" href="#other-charpente-helpers"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s finish this section by listing other useful <a href="https://github.com/RinteRface/charpente">charpente</a> tools.
We know <code><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency()</a></code> to install an external dependency.
As shown earlier, this code installs bulma dependencies:</p>
<p></p>
<div class="sourceCode" id="cb840"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency</a></span><span class="op">(</span><span class="st">"bulma"</span><span class="op">)</span></code></pre></div>
<p></p>
<p>However, we don’t necessarily know all package versions and may need
<code>bulma 0.9.3</code> or <code>bulma 0.7.0</code>. <code><a href="https://rdrr.io/pkg/charpente/man/get_dependency_versions.html">get_dependency_versions()</a></code> allows to look for
all existing versions:</p>
<p></p>
<div class="sourceCode" id="cb841"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/get_dependency_versions.html">get_dependency_versions</a></span><span class="op">(</span><span class="st">"bulma"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; ℹ Trying with https://data.jsdelivr.com/v1/package/npm/bulma</code></pre>
<pre><code>#&gt; ✓ Success!</code></pre>
<pre><code>#&gt; ──────────────────────────────────────────────────</code></pre>
<pre><code>#&gt;  [1] "0.9.3"  "0.9.2"  "0.9.1"  "0.9.0"  "0.8.2" 
#&gt;  [6] "0.8.1"  "0.8.0"  "0.7.5"  "0.7.4"  "0.7.3" 
#&gt; [11] "0.7.2"  "0.7.1"  "0.7.0"  "0.6.2"  "0.6.1" 
#&gt; [16] "0.6.0"  "0.5.3"  "0.5.2"  "0.5.1"  "0.5.0" 
#&gt; [21] "0.4.4"  "0.4.3"  "0.4.2"  "0.4.1"  "0.4.0" 
#&gt; [26] "0.3.2"  "0.3.1"  "0.3.0"  "0.2.3"  "0.2.1" 
#&gt; [31] "0.2.0"  "0.1.2"  "0.1.1"  "0.1.0"  "0.0.28"
#&gt; [36] "0.0.27" "0.0.26" "0.0.25" "0.0.24" "0.0.23"
#&gt; [41] "0.0.22" "0.0.21" "0.0.20" "0.0.19" "0.0.18"
#&gt; [46] "0.0.17" "0.0.16" "0.0.15" "0.0.14" "0.0.13"
#&gt; [51] "0.0.12" "0.0.11" "0.0.10" "0.0.9"  "0.0.8" 
#&gt; [56] "0.0.7"  "0.0.6"  "0.0.5"  "0.0.4"</code></pre>
<div class="sourceCode" id="cb846"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/get_dependency_versions.html">get_dependency_versions</a></span><span class="op">(</span><span class="st">"bulma"</span>, latest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; ℹ Trying with https://data.jsdelivr.com/v1/package/npm/bulma</code></pre>
<pre><code>#&gt; ✓ Success!</code></pre>
<pre><code>#&gt; ──────────────────────────────────────────────────</code></pre>
<pre><code>#&gt; [1] "0.9.3"</code></pre>
<p></p>
<p>Specifying <code>latest = TRUE</code> ensures to recover the very last <strong>stable</strong> version
(it excludes alpha/beta versions).</p>
<p>You may explore also the dependency files with <code><a href="https://rdrr.io/pkg/charpente/man/get_dependency_assets.html">get_dependency_assets()</a></code>, even for
a specific version with <strong>tag</strong>:</p>
<p></p>
<div class="sourceCode" id="cb851"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/get_dependency_assets.html">get_dependency_assets</a></span><span class="op">(</span><span class="st">"bulma"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; ℹ Trying with https://data.jsdelivr.com/v1/package/npm/bulma</code></pre>
<pre><code>#&gt; ✓ Success!</code></pre>
<pre><code>#&gt; ──────────────────────────────────────────────────</code></pre>
<pre><code>#&gt; $url
#&gt; [1] "https://cdn.jsdelivr.net/npm/bulma@0.9.3/"
#&gt; 
#&gt; $files
#&gt;                name
#&gt; 1         bulma.css
#&gt; 2     bulma.css.map
#&gt; 3     bulma.min.css
#&gt; 4     bulma-rtl.css
#&gt; 5 bulma-rtl.css.map
#&gt; 6 bulma-rtl.min.css
#&gt;                                           hash
#&gt; 1 QWzsjhiaNlONAp479EIeaY+tQvrt3v1iOYtBMVZ7RJc=
#&gt; 2 039vv4Mje70ZS33gGww4tRQgCnEKI2C87RydZz8KHig=
#&gt; 3 UDtbUHqpVVfXmdJcQVU/bfDEr9xldf3Dbd0ShD0Uf/Y=
#&gt; 4 TUHS7Sxzy8yNpSvZw/kemcmvnax3Js9PHq1cPdo7i7U=
#&gt; 5 jrQYx00fN25Pxm81v1gPZtcutWE2KvnijIX5nR/V9uc=
#&gt; 6 LchhQrhf3t9LP/bBuIq1SvOWEIiX8bpgQedoeytbSV0=
#&gt; 
#&gt; $hasSubfolders
#&gt; [1] TRUE</code></pre>
<p></p>
<p>This is helpful to further fine tune <code><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options()</a></code>, as stated previously. It is indeed possible
that you don’t want bundles, minified, lite or rtl versions of scripts. Internally, <code><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency()</a></code>
relies on <code><a href="https://rdrr.io/pkg/charpente/man/get_dependency_assets.html">get_dependency_assets()</a></code>.</p>
<p><code><a href="https://rdrr.io/pkg/charpente/man/get_installed_dependency.html">get_installed_dependency()</a></code> allows to <strong>inspect</strong> which dependencies are installed. It only works
if the dependencies were created locally, that is <code><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options(local = TRUE)</a></code>.</p>
<p>Finally, one may ask how to <strong>update</strong> a given dependency. <code><a href="https://rdrr.io/pkg/charpente/man/update_dependency.html">update_dependency()</a></code> does this, provided that
the dependency is installed locally. By default, it installs the latest version of the targeted dependency.
It gives a diagnosis comparing the current installed version
with the latest available version, yielding three possible cases. Dependencies are <strong>up to date</strong>
and <code><a href="https://rdrr.io/pkg/charpente/man/update_dependency.html">update_dependency("bulma")</a></code> yields:</p>
<p></p>
<pre><code>#&gt; ℹ Trying https://data.jsdelivr.com/v1/package/npm/bulma
#&gt; ✓ Success!
#&gt; ───────────────────────────────────────────────────────
#&gt; Error in update_dependency("bulma") : Versions are identical</code></pre>
<p></p>
<p>The installed dependencies are <strong>outdated</strong> (we have 0.7.0 with <code><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency("bulma", tag = "0.7.0", options = charpente_options(local = TRUE))</a></code>), the function shows the targeted version as well as
the last one:</p>
<p></p>
<pre><code>#&gt; ℹ Trying https://data.jsdelivr.com/v1/package/npm/bulma
#&gt; ✓ Success!
#&gt; ───────────────────────────────────────────────────────
#&gt; ℹ current version: 0.7.0 ||
#&gt; target version: 0.9.3 ||
#&gt; latest version: 0.9.3
#&gt; ! Upgrading bulma to 0.9.3
#&gt; ✓ Directory inst/bulma-0.9.3/css successfully created
#&gt; ! Remove existing file R/bulma-dependencies.R</code></pre>
<p></p>
<p>The last use case is a <strong>downgrade</strong>, which may be possible if the package maintainer realizes
that the dependency version is too unstable. In the following, we have <code>bulma-0.9.3</code> installed
and downgrade to 0.7.0 with <code><a href="https://rdrr.io/pkg/charpente/man/update_dependency.html">update_dependency("bulma", version_target = "0.7.0")</a></code>:</p>
<p></p>
<pre><code>#&gt; ℹ Trying https://data.jsdelivr.com/v1/package/npm/bulma
#&gt; ✓ Success!
#&gt; ───────────────────────────────────────────────────────
#&gt; ℹ current version: 0.9.3 ||
#&gt; target version: 0.7.0 ||
#&gt; latest version: 0.9.3
#&gt; ! Downgrading bulma to 0.7.0
#&gt; ✓ Directory inst/bulma-0.7.0/css successfully created
#&gt; ! Remove existing file R/bulma-dependencies.R</code></pre>
<p></p>
</div>
</div>
<div id="other-tips" class="section level2" number="21.4">
<h2>
<span class="header-section-number">21.4</span> Other tips<a class="anchor" aria-label="anchor" href="#other-tips"><i class="fas fa-link"></i></a>
</h2>
<div id="validate-javascript" class="section level3" number="21.4.1">
<h3>
<span class="header-section-number">21.4.1</span> Validate JavaScript<a class="anchor" aria-label="anchor" href="#validate-javascript"><i class="fas fa-link"></i></a>
</h3>
<p>We could not finish this chapter without mentioning tools to <strong>validate</strong> JavaScript code. <a href="https://jshint.com">JSHint</a>, which comes with <a href="https://github.com/dreamRs/jstools">{jstools}</a>. Below is an example of how to check all the <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> JavaScript input bindings at once:</p>
<p></p>
<div class="sourceCode" id="cb859"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shinyMobileJS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span>
    <span class="st">"shinyMobile-%s/js/shinyMobile.js"</span>, 
    <span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"shinyMobile"</span><span class="op">)</span>
  <span class="op">)</span>, 
  package <span class="op">=</span> <span class="st">"shinyMobile"</span>
<span class="op">)</span>
<span class="co"># jstools print messages to the console</span>
<span class="co"># We don't want to see them all in the book ...</span>
<span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html">capture.output</a></span><span class="op">(</span>
  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">jshint_file</span><span class="op">(</span>
    input <span class="op">=</span> <span class="va">shinyMobileJS</span>, 
    options <span class="op">=</span> <span class="fu">jshint_options</span><span class="op">(</span>
      jquery <span class="op">=</span> <span class="cn">TRUE</span>, 
      globals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Shiny"</span>, <span class="st">"app"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">errors</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"line"</span>, <span class="st">"reason"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; A tibble: 51 x 2</span>
<span class="co">#&gt;    line reason                                                                              </span>
<span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;</span>
<span class="co">#&gt;  1    33 'template literal syntax' is only available in ES6. </span>
<span class="co">#&gt;  2    37 'template literal syntax' is only available in ES6.</span>
<span class="co">#&gt;  3    41 'template literal syntax' is only available in ES6. </span>
<span class="co">#&gt;  4    42 'template literal syntax' is only available in ES6. </span>
<span class="co">#&gt;  5    52 'arrow function syntax (=&gt;)' is only available in ES6. </span>
<span class="co">#&gt;  6    64 'arrow function syntax (=&gt;)' is only available in ES6.</span></code></pre></div>
<p></p>
<p>You may fine tune the <code>jshint_file</code> behavior with the <a href="https://jshint.com/docs/options/"><code>jshint_options</code></a>. One is often tempted to call <code>eval</code> in JS code, which will result in a JSHint error. An option called <code>evil</code> exists to disable the corresponding test. However, we recommend to play the game, accept those error and try to fix them instead of cheating with options! An important remark about validation is that it does not check whether your code
does what it should do. It just focus on checking whether the code could probably execute. To test
the JavaScript logic, please refer to Chapter <a href="custom-templates-testing.html#custom-templates-testing-js">20.2.2.2</a>.
Be extremely careful: if we consider the example mentioned in section <a href="survival-kit-javascript.html#broken-shiny-app-debug">10.6.2</a>, the
following code is valid JavaScript:</p>
<p></p>
<div class="sourceCode" id="cb860"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb860-1"><a href="workflow-charpente.html#cb860-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> sendNotif <span class="op">=</span> (message<span class="op">,</span> type<span class="op">,</span> duration) <span class="kw">=&gt;</span> {</span>
<span id="cb860-2"><a href="workflow-charpente.html#cb860-2" aria-hidden="true" tabindex="-1"></a>  Shiny<span class="op">.</span><span class="at">notification</span><span class="op">.</span><span class="fu">show</span>({</span>
<span id="cb860-3"><a href="workflow-charpente.html#cb860-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">html</span><span class="op">:</span> <span class="vs">`&lt;strong&gt;</span><span class="sc">${</span>message<span class="sc">}</span><span class="vs">&lt;/strong&gt;`</span><span class="op">,</span></span>
<span id="cb860-4"><a href="workflow-charpente.html#cb860-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> type<span class="op">,</span></span>
<span id="cb860-5"><a href="workflow-charpente.html#cb860-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">duration</span><span class="op">:</span> duration</span>
<span id="cb860-6"><a href="workflow-charpente.html#cb860-6" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb860-7"><a href="workflow-charpente.html#cb860-7" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb860-8"><a href="workflow-charpente.html#cb860-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb860-9"><a href="workflow-charpente.html#cb860-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sendNotif</span>(<span class="st">'Hello'</span>)</span></code></pre></div>
<p></p>
<p>and will pass the validation step without any error:</p>
<p></p>
<div class="sourceCode" id="cb861"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">jshint</span><span class="op">(</span>
  <span class="st">"const sendNotif = (message, type, duration) =&gt; {
  Shiny.notification.show({
    html: `&lt;strong&gt;${message}&lt;/strong&gt;`,
    type: type,
    duration: duration
  });
  };
  sendNotif('Hello');
  "</span>,
  options <span class="op">=</span> <span class="fu">jshint_options</span><span class="op">(</span>
    esversion <span class="op">=</span> <span class="fl">6</span>,
    jquery <span class="op">=</span> <span class="cn">TRUE</span>, 
    globals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Shiny"</span>, <span class="st">"app"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span><span class="op">$</span><span class="va">errors</span></code></pre></div>
<pre><code>#&gt; NULL</code></pre>
<p></p>
<p>Yet the code won’t work since <code>Shiny.notification</code> does not exist.</p>
</div>
<div id="test-js-code" class="section level3" number="21.4.2">
<h3>
<span class="header-section-number">21.4.2</span> Test JS code<a class="anchor" aria-label="anchor" href="#test-js-code"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://github.com/RinteRface/charpente">charpente</a> provides a starting point to <strong>test</strong> the JS code with <code><a href="https://rdrr.io/pkg/charpente/man/test_js.html">test_js()</a></code>, by leveraging the <a href="https://mochajs.org/">mocha</a> library. All tests are assumed to be contained within the <code>srcjs/test</code> folder. Inside, we find <code>test_basic.js</code>, which was created upon package initialization, as a boilerplate:</p>
<p></p>
<div class="sourceCode" id="cb863"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb863-1"><a href="workflow-charpente.html#cb863-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">'Basic test'</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb863-2"><a href="workflow-charpente.html#cb863-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">'should not fail'</span><span class="op">,</span> (done) <span class="kw">=&gt;</span> {</span>
<span id="cb863-3"><a href="workflow-charpente.html#cb863-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">done</span>()<span class="op">;</span></span>
<span id="cb863-4"><a href="workflow-charpente.html#cb863-4" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb863-5"><a href="workflow-charpente.html#cb863-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p></p>
<p>This test starts with a <code>describe</code> function, similar to the <a href="https://testthat.r-lib.org">testthat</a> <code><a href="https://testthat.r-lib.org/reference/context.html">context()</a></code> function, where you provide the general idea behind the test. <code>it</code> is equivalent to <code><a href="https://testthat.r-lib.org/reference/test_that.html">test_that()</a></code>, where we describe what specific feature is being tested. Inside, we write a series of instructions, some of them failing, others passing. Naturally, <code>mocha</code> works better with other assertions libraries like <a href="https://github.com/Automattic/expect.js">expect.js</a> or <a href="http://shouldjs.github.io/">should.js</a>, whose details are out of the scope of this book.</p>
</div>
<div id="beautify-js-code" class="section level3" number="21.4.3">
<h3>
<span class="header-section-number">21.4.3</span> Beautify JS code<a class="anchor" aria-label="anchor" href="#beautify-js-code"><i class="fas fa-link"></i></a>
</h3>
<p>If you work with the RStudio IDE, your JS code maybe sometimes messy with bad indentation.
<a href="https://github.com/dreamRs/jstools">jstools</a> also provides a function and addin to fix the problem. <code>prettier_js(code)</code> and
<code>prettier_file(input = "path/to/file.js", output = "path/to/reformated.js")</code> does this.
I often use the <code>Prettier</code> addin which is way faster than typing the function call (Figure <a href="workflow-charpente.html#fig:workflow-pretty-js">21.4</a>).</p>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:workflow-pretty-js"></span>
<img src="images/workflow/pretty-js.png" alt="Better JS formatting." width="50%"><p class="caption">
FIGURE 21.4: Better JS formatting.
</p>
</div>
<p></p>

</div>
</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="custom-templates-testing.html"><span class="header-section-number">20</span> Testing and validating templates elements</a></div>
<div class="next"><a href="mobile-shiny-intro.html"><span class="header-section-number">22</span> Introduction</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#workflow-charpente"><span class="header-section-number">21</span> Automate new template creation with {charpente}</a></li>
<li><a class="nav-link" href="#motivations-2"><span class="header-section-number">21.1</span> Motivations</a></li>
<li><a class="nav-link" href="#general-idea"><span class="header-section-number">21.2</span> General idea</a></li>
<li>
<a class="nav-link" href="#a-case-study-shinybulma"><span class="header-section-number">21.3</span> A case study: {shinybulma}</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#build-the-html-dependency"><span class="header-section-number">21.3.1</span> Build the HTML dependency</a></li>
<li><a class="nav-link" href="#set-up-the-minimal-page-template"><span class="header-section-number">21.3.2</span> Set up the minimal page template</a></li>
<li><a class="nav-link" href="#exercise-add-bulmajs"><span class="header-section-number">21.3.3</span> Exercise: add bulmaJS</a></li>
<li><a class="nav-link" href="#add-custom-js"><span class="header-section-number">21.3.4</span> Add custom JS</a></li>
<li><a class="nav-link" href="#add-custom-inputoutput-bindings"><span class="header-section-number">21.3.5</span> Add custom input/output bindings</a></li>
<li><a class="nav-link" href="#organize-your-js"><span class="header-section-number">21.3.6</span> Organize your JS code</a></li>
<li><a class="nav-link" href="#combine-multiple-dependencies"><span class="header-section-number">21.3.7</span> Combine multiple dependencies</a></li>
<li><a class="nav-link" href="#other-charpente-helpers"><span class="header-section-number">21.3.8</span> Other {charpente} helpers</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#other-tips"><span class="header-section-number">21.4</span> Other tips</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#validate-javascript"><span class="header-section-number">21.4.1</span> Validate JavaScript</a></li>
<li><a class="nav-link" href="#test-js-code"><span class="header-section-number">21.4.2</span> Test JS code</a></li>
<li><a class="nav-link" href="#beautify-js-code"><span class="header-section-number">21.4.3</span> Beautify JS code</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/workflow-charpente.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/workflow-charpente.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It was last built on 2021-11-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
