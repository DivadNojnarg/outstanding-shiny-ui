<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 24 {shinyMobile} and PWA | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<meta name="description" content="Transforming a classic Shiny app into a PWA is a game changer for end users. By the end of this chapter, you’ll be able to provide top-notch features for your Shiny apps like: Add a fullscreen...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 24 {shinyMobile} and PWA | Outstanding User Interfaces with Shiny">
<meta property="og:type" content="book">
<meta property="og:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<meta property="og:description" content="Transforming a classic Shiny app into a PWA is a game changer for end users. By the end of this chapter, you’ll be able to provide top-notch features for your Shiny apps like: Add a fullscreen...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 24 {shinyMobile} and PWA | Outstanding User Interfaces with Shiny">
<meta name="twitter:description" content="Transforming a classic Shiny app into a PWA is a game changer for end users. By the end of this chapter, you’ll be able to provide top-notch features for your Shiny apps like: Add a fullscreen...">
<meta name="twitter:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">2</span> Manipulate HTML tags from R with {htmltools}</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">3</span> Discover Shiny dependencies</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Handle HTML dependencies with {htmltools}</a></li>
<li><a class="" href="web-applications.html"><span class="header-section-number">5</span> Web application concepts</a></li>
<li class="book-part">Beautify with CSS and Sass</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">6</span> CSS for Shiny</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">7</span> Tidy your CSS with Sass</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">8</span> Beautify with {fresh}</a></li>
<li><a class="" href="beautify-with-bootstraplib.html"><span class="header-section-number">9</span> Become a theming wizard with {bslib}</a></li>
<li class="book-part">Unleash interactivity with JavaScript</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> Communicate between R and JS</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">12</span> Understand and develop new Shiny inputs</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Mastering Shiny’s events</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Optimize your apps with custom handlers</a></li>
<li class="book-part">Practice: A Bootstrap 4 dashboard template</li>
<li><a class="" href="custom-templates-dependencies.html"><span class="header-section-number">16</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">17</span> Create template elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">18</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">19</span> Adding more interactivity</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">20</span> Testing and validating template elements</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="" href="workflow-charpente.html"><span class="header-section-number">21</span> Automate new template creation with {charpente}</a></li>
<li class="book-part">Case study: Mobile development for Shiny</li>
<li><a class="" href="mobile-shiny-intro.html"><span class="header-section-number">22</span> Introduction</a></li>
<li><a class="" href="mobile-shinyMobile.html"><span class="header-section-number">23</span> Reconstruct {shinyMobile}</a></li>
<li><a class="active" href="mobile-pwa.html"><span class="header-section-number">24</span> {shinyMobile} and PWA</a></li>
<li><a class="" href="mobile-widgets.html"><span class="header-section-number">25</span> Design widgets</a></li>
<li><a class="" href="mobile-going-further.html"><span class="header-section-number">26</span> Fine-tune {shinyMobile}</a></li>
<li class="book-part">Going further</li>
<li><a class="" href="going-further-reactR.html"><span class="header-section-number">27</span> Shiny and React with {reactR}</a></li>
<li><a class="" href="going-further-webdev.html"><span class="header-section-number">28</span> Shiny and modern web development</a></li>
<li><a class="" href="going-further-where-to-go.html"><span class="header-section-number">29</span> What to do next?</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="code-outputs.html"><span class="header-section-number">A</span> Code outputs</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="mobile-pwa" class="section level1" number="24">
<h1>
<span class="header-section-number">24</span> <code>{shinyMobile}</code> and PWA<a class="anchor" aria-label="anchor" href="#mobile-pwa"><i class="fas fa-link"></i></a>
</h1>
<p>Transforming a classic Shiny app into a <strong>PWA</strong> is a game changer for end users. By the end of this chapter, you’ll be able to provide top-notch features for your Shiny apps like:</p>
<ul>
<li>Add a <strong>fullscreen</strong> support.</li>
<li>Make them <strong>installable</strong>.</li>
<li>Support <strong>offline</strong> capabilities.</li>
</ul>
<div class="importantblock">
<p>Some of the PWA features won’t work with iOS (<a href="https://medium.com/@firt/progressive-web-apps-on-ios-are-here-d00430dee3a7" class="uri">https://medium.com/@firt/progressive-web-apps-on-ios-are-here-d00430dee3a7</a>), like the install prompt.</p>
</div>
<div class="warningblock">
<p>As a reminder, the code examples shown throughout this chapter are gathered in the <code>{OSUICode}</code> package accessible here: <a href="https://github.com/DivadNojnarg/OSUICode/tree/1d42aa7531705954d3c21921c8bbb10623b20d12" class="uri">https://github.com/DivadNojnarg/OSUICode/tree/1d42aa7531705954d3c21921c8bbb10623b20d12</a>, specifically PWA apps are available here: <a href="https://github.com/DivadNojnarg/OSUICode/blob/1d42aa7531705954d3c21921c8bbb10623b20d12/inst/shinyMobile/pwa/app.R" class="uri">https://github.com/DivadNojnarg/OSUICode/blob/1d42aa7531705954d3c21921c8bbb10623b20d12/inst/shinyMobile/pwa/app.R</a>.</p>
</div>
<div id="introduction-6" class="section level2" number="24.1">
<h2>
<span class="header-section-number">24.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-6"><i class="fas fa-link"></i></a>
</h2>
<p>Below, we review one by one the necessary steps to convert a Shiny app to a <strong>PWA</strong>. To get a good idea of what our mission exactly is, we leverage the <code>Application</code> tab of the developer tools as shown on Figure <a href="mobile-pwa.html#fig:mobile-pwa-1">24.1</a>. Alternatively, you
may use the <a href="https://developers.google.com/web/tools/lighthouse/">Google Lighthouse</a> utility to provide a general diagnosis to the app, as illustrated on Figure <a href="mobile-pwa.html#fig:mobile-pwa-2">24.2</a>. There are many categories like <strong>performance</strong>, <strong>accessibility</strong>. In our case, let’s just select the PWA category, check the mobile device radio and click on generate a report.</p>
<p>According to the diagnostic result displayed in Figure <a href="mobile-pwa.html#fig:mobile-pwa-lighthouse-result">24.3</a>, we don’t meet all requirements; most importantly there is:</p>
<ul>
<li>No <strong>manifest</strong>.</li>
<li>No <strong>service worker</strong>.</li>
<li>No icons.</li>
<li>No offline fallback.</li>
</ul>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mobile-pwa-1"></span>
<img src="images/mobile/mobile-pwa-application.png" alt="Application tab of the developers tools." width="100%"><p class="caption">
FIGURE 24.1: Application tab of the developers tools.
</p>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mobile-pwa-2"></span>
<img src="images/mobile/mobile-pwa-lighthouse.png" alt="Google Lightouse utility." width="100%"><p class="caption">
FIGURE 24.2: Google Lightouse utility.
</p>
</div>
<div class="figure">
<span style="display:block;" id="fig:mobile-pwa-lighthouse-result"></span>
<img src="images/mobile/mobile-pwa-lighthouse-result.png" alt="Lighthouse audit result." width="100%"><p class="caption">
FIGURE 24.3: Lighthouse audit result.
</p>
</div>
</div>
<div id="charpente-and-pwa-tools" class="section level2" number="24.2">
<h2>
<span class="header-section-number">24.2</span> <code>{charpente}</code> and PWA tools<a class="anchor" aria-label="anchor" href="#charpente-and-pwa-tools"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://github.com/RinteRface/charpente">charpente</a> has tools to help design a PWA, particularly the <code><a href="https://rdrr.io/pkg/charpente/man/set_pwa.html">set_pwa()</a></code> function, which does all the previously mentioned steps in only one line of code. There are, however, a few prerequisites:</p>
<ul>
<li>The app must <strong>belong to a package</strong>. However, if you followed the previous chapter, this is already the case.</li>
<li>The function must target the app directory.</li>
</ul>
<p>Let’s create a <code>inst/examples/pwa-app</code> sub-folder and the <code>app.R</code> file:</p>
<div class="sourceCode" id="cb917"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a></span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page</a></span><span class="op">(</span>
  navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_navbar.html">f7_navbar</a></span><span class="op">(</span><span class="st">"PWA App"</span><span class="op">)</span>,
  toolbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_toolbar.html">f7_toolbar</a></span><span class="op">(</span><span class="op">)</span>,
  title <span class="op">=</span> <span class="st">"shinyMobile"</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>Then we set the PWA configuration with <code><a href="https://rdrr.io/pkg/charpente/man/set_pwa.html">set_pwa()</a></code>. Overall, this function generates a <code>manifest.webmanifest</code> file, downloads the Google PWA compatibility script, adds a custom dependency pointing to the <code>manifest.webmanifest</code> file and a <code>144x144</code> icon file, copies a boilerplate <code>service-worker.js</code> with its <code>offline.html</code> page and optionally registers the service worker (whose code is borrowed from <a href="https://web.dev/offline-fallback-page/#registering-the-service-worker">web.dev</a>):</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb918-1"><a href="mobile-pwa.html#cb918-1" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'load'</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb918-2"><a href="mobile-pwa.html#cb918-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">'serviceWorker'</span> <span class="kw">in</span> <span class="bu">navigator</span>) {</span>
<span id="cb918-3"><a href="mobile-pwa.html#cb918-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> pathname <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">pathname</span><span class="op">;</span></span>
<span id="cb918-4"><a href="mobile-pwa.html#cb918-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">navigator</span><span class="op">.</span><span class="at">serviceWorker</span></span>
<span id="cb918-5"><a href="mobile-pwa.html#cb918-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">register</span>(</span>
<span id="cb918-6"><a href="mobile-pwa.html#cb918-6" aria-hidden="true" tabindex="-1"></a>        pathname <span class="op">+</span> </span>
<span id="cb918-7"><a href="mobile-pwa.html#cb918-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'service-worker.js'</span><span class="op">,</span> </span>
<span id="cb918-8"><a href="mobile-pwa.html#cb918-8" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">scope</span><span class="op">:</span> pathname}</span>
<span id="cb918-9"><a href="mobile-pwa.html#cb918-9" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb918-10"><a href="mobile-pwa.html#cb918-10" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>(<span class="kw">function</span>() { </span>
<span id="cb918-11"><a href="mobile-pwa.html#cb918-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Service Worker Registered'</span>)<span class="op">;</span> </span>
<span id="cb918-12"><a href="mobile-pwa.html#cb918-12" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb918-13"><a href="mobile-pwa.html#cb918-13" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb918-14"><a href="mobile-pwa.html#cb918-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>In the <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> case, as Framework7 already registers any provided <strong>service
worker</strong>, we don’t need that initialization script. Therefore, to skip the creation
of <code>sw-register.js</code> and importing it in <code>main.js</code>, we should actually call:</p>
<div class="sourceCode" id="cb919"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/set_pwa.html">set_pwa</a></span><span class="op">(</span><span class="st">"inst/examples/pwa-app"</span>, register_service_worker <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Importantly, this function does not handle icon creation. There are tools such as
<a href="https://appsco.pe/developer/splash-screens">appsco</a> and
<a href="https://app-manifest.firebaseapp.com">app-manifest</a>, to create
those custom icons and splash screens, if you need to.</p>
<p>In the following, we provide more detail about the mentioned steps.</p>
<div id="create-the-manifest" class="section level3" number="24.2.1">
<h3>
<span class="header-section-number">24.2.1</span> Create the manifest<a class="anchor" aria-label="anchor" href="#create-the-manifest"><i class="fas fa-link"></i></a>
</h3>
<p>We would like to create a <strong>JSON</strong> configuration file like this:</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb920-1"><a href="mobile-pwa.html#cb920-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb920-2"><a href="mobile-pwa.html#cb920-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"short_name"</span><span class="op">:</span> <span class="st">"My App"</span><span class="op">,</span></span>
<span id="cb920-3"><a href="mobile-pwa.html#cb920-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"name"</span><span class="op">:</span> <span class="st">"Super amazing app"</span><span class="op">,</span></span>
<span id="cb920-4"><a href="mobile-pwa.html#cb920-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"description"</span><span class="op">:</span> <span class="st">"This app is just mind blowing"</span><span class="op">,</span></span>
<span id="cb920-5"><a href="mobile-pwa.html#cb920-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"icons"</span><span class="op">:</span> [</span>
<span id="cb920-6"><a href="mobile-pwa.html#cb920-6" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb920-7"><a href="mobile-pwa.html#cb920-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"src"</span><span class="op">:</span> <span class="st">"icons/icon.png"</span><span class="op">,</span></span>
<span id="cb920-8"><a href="mobile-pwa.html#cb920-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"type"</span><span class="op">:</span> <span class="st">"image/png"</span><span class="op">,</span></span>
<span id="cb920-9"><a href="mobile-pwa.html#cb920-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sizes"</span><span class="op">:</span> <span class="st">"192x192"</span></span>
<span id="cb920-10"><a href="mobile-pwa.html#cb920-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb920-11"><a href="mobile-pwa.html#cb920-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb920-12"><a href="mobile-pwa.html#cb920-12" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb920-13"><a href="mobile-pwa.html#cb920-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"start_url"</span><span class="op">:</span> <span class="st">"&lt;APP_URL&gt;"</span><span class="op">,</span></span>
<span id="cb920-14"><a href="mobile-pwa.html#cb920-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"background_color"</span><span class="op">:</span> <span class="st">"#3367D6"</span><span class="op">,</span></span>
<span id="cb920-15"><a href="mobile-pwa.html#cb920-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"display"</span><span class="op">:</span> <span class="st">"standalone"</span><span class="op">,</span></span>
<span id="cb920-16"><a href="mobile-pwa.html#cb920-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"scope"</span><span class="op">:</span> <span class="st">"/"</span><span class="op">,</span></span>
<span id="cb920-17"><a href="mobile-pwa.html#cb920-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"theme_color"</span><span class="op">:</span> <span class="st">"#3367D6"</span><span class="op">,</span></span>
<span id="cb920-18"><a href="mobile-pwa.html#cb920-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"shortcuts"</span><span class="op">:</span> [</span>
<span id="cb920-19"><a href="mobile-pwa.html#cb920-19" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb920-20"><a href="mobile-pwa.html#cb920-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">"name"</span><span class="op">:</span> <span class="st">"Open toast"</span><span class="op">,</span></span>
<span id="cb920-21"><a href="mobile-pwa.html#cb920-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">"short_name"</span><span class="op">:</span> <span class="st">"Shortcut"</span><span class="op">,</span></span>
<span id="cb920-22"><a href="mobile-pwa.html#cb920-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">"description"</span><span class="op">:</span> <span class="st">"Do something"</span><span class="op">,</span></span>
<span id="cb920-23"><a href="mobile-pwa.html#cb920-23" aria-hidden="true" tabindex="-1"></a>      <span class="st">"url"</span><span class="op">:</span> <span class="st">"&lt;APP_URL&gt;/..."</span><span class="op">,</span></span>
<span id="cb920-24"><a href="mobile-pwa.html#cb920-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">"icons"</span><span class="op">:</span> [{ <span class="st">"src"</span><span class="op">:</span> <span class="st">"icons/.png"</span><span class="op">,</span> <span class="st">"sizes"</span><span class="op">:</span> <span class="st">"192x192"</span> }]</span>
<span id="cb920-25"><a href="mobile-pwa.html#cb920-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb920-26"><a href="mobile-pwa.html#cb920-26" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb920-27"><a href="mobile-pwa.html#cb920-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>All fields are following the official recommendation provided by Google regarding the PWA, I do not recommend removing any entry, except the <code>shortcuts</code>, described later. Since the state of the art may slightly change in the future, you are encouraged to regularly check this <a href="https://web.dev/add-manifest/">website</a> to get the latest features.</p>
<p>This file has to be accessible by the app, hence best practice is to put it in the <code>/www</code> folder,
icon images being hosted in the <code>/www/icons</code> sub-directory. The <a href="https://github.com/RinteRface/charpente">charpente</a> <code><a href="https://rinterface.github.io/shinyMobile/reference/f7-deprecated.html">create_manifest()</a></code> function writes a JSON file at the provided location.
Interestingly the <code>shortcuts</code> fields gives the ability to start the app in a specific state, so that end users save time. This feature is only supported by latest Android devices as well as up-to-date Windows 10 computers (no Apple support). In practice, the shortcut url can be processed by <code><a href="https://rdrr.io/pkg/shiny/man/parseQueryString.html">shiny::parseQueryString</a></code> on the server side. For instance, if the url contains a query string like <code>https://domain/path/?foo=1</code>, we could show a notification:</p>
<div class="sourceCode" id="cb921"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">session</span><span class="op">$</span><span class="va">clientData</span><span class="op">$</span><span class="va">url_search</span>, <span class="op">{</span>
  <span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/parseQueryString.html">parseQueryString</a></span><span class="op">(</span><span class="va">session</span><span class="op">$</span><span class="va">clientData</span><span class="op">$</span><span class="va">url_search</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html">req</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">query</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>
  <span class="co"># Ways of accessing the values</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">query</span><span class="op">$</span><span class="va">foo</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_notif.html">f7_notif</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"Plop"</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>The web manifest and icons have to be included in the <code>head</code> before the Google PWA compatibility script:</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb922-1"><a href="mobile-pwa.html#cb922-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;link</span> <span class="er">rel</span><span class="ot">=</span><span class="st">"manifest"</span> <span class="er">href</span><span class="ot">=</span><span class="st">"manifest.webmanifest"</span> <span class="kw">/&gt;</span></span>
<span id="cb922-2"><a href="mobile-pwa.html#cb922-2" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- include icon also from manifest --&gt;</span></span>
<span id="cb922-3"><a href="mobile-pwa.html#cb922-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;link</span> <span class="er">rel</span><span class="ot">=</span><span class="st">"icon"</span> <span class="er">type</span><span class="ot">=</span><span class="st">"image/png"</span> </span>
<span id="cb922-4"><a href="mobile-pwa.html#cb922-4" aria-hidden="true" tabindex="-1"></a><span class="ot">  href=</span><span class="st">"icons/icon-144.png"</span> <span class="er">sizes</span><span class="ot">=</span><span class="st">"144x144"</span> <span class="kw">/&gt;</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/pkg/charpente/man/set_pwa.html">set_pwa()</a></code> internally calls <code><a href="https://rdrr.io/pkg/charpente/man/create_pwa_dependency.html">create_pwa_dependency()</a></code>, which creates an HTML <strong>dependency</strong> containing all necessary resources:</p>
<div class="sourceCode" id="cb923"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' PWA dependencies utils</span>
<span class="co">#'</span>
<span class="co">#' @description This function attaches PWA manifest and </span>
<span class="co">#' icons to the given tag</span>
<span class="co">#'</span>
<span class="co">#' @param tag Element to attach the dependencies.</span>
<span class="co">#'</span>
<span class="co">#' @importFrom utils packageVersion</span>
<span class="co">#' @importFrom htmltools tagList htmlDependency</span>
<span class="co">#' @export</span>
<span class="va">add_pwa_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="op">{</span>
 <span class="va">pwa_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"pwa-utils"</span>,
  version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"shinyMobile"</span><span class="op">)</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"shinyMobile-0.0.0.9000"</span><span class="op">)</span>,
  head <span class="op">=</span> <span class="st">"&lt;link rel=\"manifest\" 
    href=\"manifest.webmanifest\"/&gt;
    &lt;link rel=\"icon\" type=\"image/png\" 
    href=\"icons/icon-144.png\" sizes=\"144x144\" /&gt;"</span>,
  package <span class="op">=</span> <span class="st">"mypkg2"</span>,
 <span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span><span class="va">tag</span>, <span class="va">pwa_deps</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>In practice, since the package already relies on other dependencies like Framework7, we will leverage the <code><a href="https://rdrr.io/pkg/OSUICode/man/add_dependencies.html">add_dependencies()</a></code> function to add all dependencies at once.</p>
<div class="noteblock">
<p>All provided icons must follow the convention <code>icon-&lt;size_in_px&gt;.png</code> like
<code>icon-144.png</code>, which is the default.</p>
</div>
</div>
<div id="google-pwa-compatibility" class="section level3" number="24.2.2">
<h3>
<span class="header-section-number">24.2.2</span> Google PWA compatibility<a class="anchor" aria-label="anchor" href="#google-pwa-compatibility"><i class="fas fa-link"></i></a>
</h3>
<p>As we use the Google PWA compatibility script, we have to include at least one icon
like <code>&lt;link rel="icon" type="image/png" href="res/icon-128.png" sizes="128x128" /&gt;</code>.
However, we found some discrepancies between the developer tools recommendations and the
PWA compatibility script. Therefore, we recommend following the developer tools prescriptions, that
is, to include at least one icon of size 144x144. All other elements are generated by the script itself,
which is convenient. Indeed, having to handle all possible screen sizes and different OS is particularly
tricky, repetitive, and not interesting.</p>
<p>The HTML dependency is downloaded with <code><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency("pwacompat", options = charpente_options(bundle = FALSE))</a></code>.
Don’t forget to update the <code><a href="https://rdrr.io/pkg/OSUICode/man/add_dependencies.html">add_dependencies()</a></code> call in <code><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page()</a></code> by including the two new dependencies, that is <code>pwa</code> and <code>pwacompat</code>:</p>
<div class="sourceCode" id="cb924"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f7_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">navbar</span>, <span class="va">toolbar</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, 
                    <span class="va">options</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>

  <span class="co"># Config tag (unchanged)</span>

  <span class="co"># Body tag (unchanged)</span>

  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span>
      <span class="co"># Head content (unchanged)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rinterface.github.io/shinyMobile/reference/add_dependencies.html">add_dependencies</a></span><span class="op">(</span>
      <span class="va">body_tag</span>,
      deps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"framework7"</span>, <span class="st">"shinyMobile"</span>, <span class="st">"pwa"</span>, <span class="st">"pwacompat"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Calling <code>devtools::load_all()</code> and running the app again, you should see the new dependencies
in the <code>head</code> (Figure <a href="mobile-pwa.html#fig:mobile-pwa-deps">24.4</a>).</p>
<div class="figure">
<span style="display:block;" id="fig:mobile-pwa-deps"></span>
<img src="images/mobile/mobile-pwa-deps.png" alt="New PWA dependencies in the head tag." width="100%"><p class="caption">
FIGURE 24.4: New PWA dependencies in the head tag.
</p>
</div>
<p>Yet, according to Figure <a href="mobile-pwa.html#fig:mobile-pwa-missing-sw">24.5</a>, we still miss the <strong>service worker</strong>,
as shown in the manifest diagnostic. This demonstrates how powerful the developer tools are as the end user is always guided step by step.</p>
<div class="figure">
<span style="display:block;" id="fig:mobile-pwa-missing-sw"></span>
<img src="images/mobile/mobile-pwa-missing-sw.png" alt="Missing service worker registration." width="100%"><p class="caption">
FIGURE 24.5: Missing service worker registration.
</p>
</div>
</div>
<div id="service-worker-and-offline-page" class="section level3" number="24.2.3">
<h3>
<span class="header-section-number">24.2.3</span> Service worker and offline page<a class="anchor" aria-label="anchor" href="#service-worker-and-offline-page"><i class="fas fa-link"></i></a>
</h3>
<p>The second mandatory step to make our app installable is the <strong>service worker</strong>.
We borrowed and modified the code from <a href="https://web.dev/offline-fallback-page/">web.dev</a>. <code><a href="https://rdrr.io/pkg/charpente/man/set_pwa.html">set_pwa()</a></code> copies this code in the the provided app <code>/www</code> folder:</p>
<div class="sourceCode" id="cb925"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb925-1"><a href="mobile-pwa.html#cb925-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Incrementing OFFLINE_VERSION will kick off the install </span></span>
<span id="cb925-2"><a href="mobile-pwa.html#cb925-2" aria-hidden="true" tabindex="-1"></a><span class="co">// event and force previously cached resources to be </span></span>
<span id="cb925-3"><a href="mobile-pwa.html#cb925-3" aria-hidden="true" tabindex="-1"></a><span class="co">// updated from the network.</span></span>
<span id="cb925-4"><a href="mobile-pwa.html#cb925-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> OFFLINE_VERSION <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb925-5"><a href="mobile-pwa.html#cb925-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> CACHE_NAME <span class="op">=</span> <span class="st">'offline'</span><span class="op">;</span></span>
<span id="cb925-6"><a href="mobile-pwa.html#cb925-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Customize this with a different URL if needed.</span></span>
<span id="cb925-7"><a href="mobile-pwa.html#cb925-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> OFFLINE_URL <span class="op">=</span> <span class="st">'offline.html'</span><span class="op">;</span></span>
<span id="cb925-8"><a href="mobile-pwa.html#cb925-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb925-9"><a href="mobile-pwa.html#cb925-9" aria-hidden="true" tabindex="-1"></a>self<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'install'</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb925-10"><a href="mobile-pwa.html#cb925-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Install logic</span></span>
<span id="cb925-11"><a href="mobile-pwa.html#cb925-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb925-12"><a href="mobile-pwa.html#cb925-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb925-13"><a href="mobile-pwa.html#cb925-13" aria-hidden="true" tabindex="-1"></a>self<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'activate'</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb925-14"><a href="mobile-pwa.html#cb925-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Activate logic</span></span>
<span id="cb925-15"><a href="mobile-pwa.html#cb925-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb925-16"><a href="mobile-pwa.html#cb925-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb925-17"><a href="mobile-pwa.html#cb925-17" aria-hidden="true" tabindex="-1"></a>self<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'fetch'</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb925-18"><a href="mobile-pwa.html#cb925-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Fetch logic</span></span>
<span id="cb925-19"><a href="mobile-pwa.html#cb925-19" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>This service worker is composed of three steps, which we succinctly describe below.</p>
<div id="installation" class="section level4" number="24.2.3.1">
<h4>
<span class="header-section-number">24.2.3.1</span> Installation<a class="anchor" aria-label="anchor" href="#installation"><i class="fas fa-link"></i></a>
</h4>
<p>During the <strong>installation</strong> step, the cache is initialized and assets like HTML page (<code>offline.html</code>), CSS, JS and images are asynchronously cached. Assets’s respective path is taken from the server location, for instance, Framework7 assets are located in <code>framework7-5.7.14/...</code> and jQuery assets in <code>shared/</code>. Best practice is to look at the developer tools <code>Source</code> tab, which provides the right location.</p>
<div class="sourceCode" id="cb926"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb926-1"><a href="mobile-pwa.html#cb926-1" aria-hidden="true" tabindex="-1"></a>self<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'install'</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb926-2"><a href="mobile-pwa.html#cb926-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">event</span><span class="op">.</span><span class="fu">waitUntil</span>(</span>
<span id="cb926-3"><a href="mobile-pwa.html#cb926-3" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb926-4"><a href="mobile-pwa.html#cb926-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cache <span class="op">=</span> <span class="cf">await</span> caches<span class="op">.</span><span class="fu">open</span>(CACHE_NAME)<span class="op">;</span></span>
<span id="cb926-5"><a href="mobile-pwa.html#cb926-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> cache<span class="op">.</span><span class="fu">add</span>(</span>
<span id="cb926-6"><a href="mobile-pwa.html#cb926-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">Request</span>(OFFLINE_URL<span class="op">,</span> { <span class="dt">cache</span><span class="op">:</span> <span class="st">'reload'</span> })</span>
<span id="cb926-7"><a href="mobile-pwa.html#cb926-7" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb926-8"><a href="mobile-pwa.html#cb926-8" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Cache other assets ...</span></span>
<span id="cb926-9"><a href="mobile-pwa.html#cb926-9" aria-hidden="true" tabindex="-1"></a>    })()</span>
<span id="cb926-10"><a href="mobile-pwa.html#cb926-10" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb926-11"><a href="mobile-pwa.html#cb926-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Force the waiting service worker to become </span></span>
<span id="cb926-12"><a href="mobile-pwa.html#cb926-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// the active service worker.</span></span>
<span id="cb926-13"><a href="mobile-pwa.html#cb926-13" aria-hidden="true" tabindex="-1"></a>  self<span class="op">.</span><span class="fu">skipWaiting</span>()<span class="op">;</span></span>
<span id="cb926-14"><a href="mobile-pwa.html#cb926-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
</div>
<div id="activation" class="section level4" number="24.2.3.2">
<h4>
<span class="header-section-number">24.2.3.2</span> Activation<a class="anchor" aria-label="anchor" href="#activation"><i class="fas fa-link"></i></a>
</h4>
<p>This step ensures that the service worker boots. As the service worker boot-up time may be delayed (until 0.5 s), the navigation preload <a href="https://developers.google.com/web/updates/2017/02/navigation-preload">feature</a> guaranties to have reasonable performances by making network requests in parallel of the booting process. In sum, don’t touch this code.</p>
<div class="sourceCode" id="cb927"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb927-1"><a href="mobile-pwa.html#cb927-1" aria-hidden="true" tabindex="-1"></a>self<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'activate'</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb927-2"><a href="mobile-pwa.html#cb927-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">event</span><span class="op">.</span><span class="fu">waitUntil</span>(</span>
<span id="cb927-3"><a href="mobile-pwa.html#cb927-3" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb927-4"><a href="mobile-pwa.html#cb927-4" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Enable navigation preload if it's supported.</span></span>
<span id="cb927-5"><a href="mobile-pwa.html#cb927-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Speeds up </span></span>
<span id="cb927-6"><a href="mobile-pwa.html#cb927-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="st">'navigationPreload'</span> <span class="kw">in</span> self<span class="op">.</span><span class="at">registration</span>) {</span>
<span id="cb927-7"><a href="mobile-pwa.html#cb927-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> self<span class="op">.</span><span class="at">registration</span><span class="op">.</span><span class="at">navigationPreload</span><span class="op">.</span><span class="fu">enable</span>()<span class="op">;</span></span>
<span id="cb927-8"><a href="mobile-pwa.html#cb927-8" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb927-9"><a href="mobile-pwa.html#cb927-9" aria-hidden="true" tabindex="-1"></a>    })()</span>
<span id="cb927-10"><a href="mobile-pwa.html#cb927-10" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb927-11"><a href="mobile-pwa.html#cb927-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb927-12"><a href="mobile-pwa.html#cb927-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Tell the active service worker to take control of </span></span>
<span id="cb927-13"><a href="mobile-pwa.html#cb927-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// the page immediately.</span></span>
<span id="cb927-14"><a href="mobile-pwa.html#cb927-14" aria-hidden="true" tabindex="-1"></a>  self<span class="op">.</span><span class="at">clients</span><span class="op">.</span><span class="fu">claim</span>()<span class="op">;</span></span>
<span id="cb927-15"><a href="mobile-pwa.html#cb927-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
</div>
<div id="fetch" class="section level4" number="24.2.3.3">
<h4>
<span class="header-section-number">24.2.3.3</span> Fetch<a class="anchor" aria-label="anchor" href="#fetch"><i class="fas fa-link"></i></a>
</h4>
<p>Once active, the service worker intercepts all network requests sent by the client and returns answers according to a predefined strategy. Here we set the “network first” strategy, meaning we always try to return an answer from the network and fall back to the cache if the request failed (for instance, in case of missing internet connection). In the above code, there are two kind of requests: <strong>navigation</strong>, which is related to an HTML page, and other requests corresponding to static assets like CSS or JS. Therefore, we have an <code>if</code> and <code>else</code> statement to consider those two cases. If you would like to know more about caching strategies please refer to the Google documentation: <a href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies" class="uri">https://developers.google.com/web/tools/workbox/modules/workbox-strategies</a>.</p>
<div class="sourceCode" id="cb928"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb928-1"><a href="mobile-pwa.html#cb928-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Fix service-worker bug</span></span>
<span id="cb928-2"><a href="mobile-pwa.html#cb928-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="bu">event</span><span class="op">.</span><span class="at">request</span><span class="op">.</span><span class="at">cache</span> <span class="op">===</span> <span class="st">'only-if-cached'</span>) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb928-3"><a href="mobile-pwa.html#cb928-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb928-4"><a href="mobile-pwa.html#cb928-4" aria-hidden="true" tabindex="-1"></a><span class="co">// We only want to call event.respondWith() if this </span></span>
<span id="cb928-5"><a href="mobile-pwa.html#cb928-5" aria-hidden="true" tabindex="-1"></a><span class="co">// is a navigation request for an HTML page ...</span></span>
<span id="cb928-6"><a href="mobile-pwa.html#cb928-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="bu">event</span><span class="op">.</span><span class="at">request</span><span class="op">.</span><span class="at">mode</span> <span class="op">===</span> <span class="st">'navigate'</span>) {</span>
<span id="cb928-7"><a href="mobile-pwa.html#cb928-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Navigation request</span></span>
<span id="cb928-8"><a href="mobile-pwa.html#cb928-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb928-9"><a href="mobile-pwa.html#cb928-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Other requests</span></span>
<span id="cb928-10"><a href="mobile-pwa.html#cb928-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Below is the navigation request logic, which is what will be triggered each time an end-user points to your app. As stated above, if the navigation preload is available, we return the preload response. If not, the request is fetched. In case of failure, we fall back to the offline HTML page, cached during the installation step.</p>
<div class="sourceCode" id="cb929"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb929-1"><a href="mobile-pwa.html#cb929-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Navigation request logic</span></span>
<span id="cb929-2"><a href="mobile-pwa.html#cb929-2" aria-hidden="true" tabindex="-1"></a><span class="bu">event</span><span class="op">.</span><span class="fu">respondWith</span>(</span>
<span id="cb929-3"><a href="mobile-pwa.html#cb929-3" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb929-4"><a href="mobile-pwa.html#cb929-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb929-5"><a href="mobile-pwa.html#cb929-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">// First, try to use the navigation preload response </span></span>
<span id="cb929-6"><a href="mobile-pwa.html#cb929-6" aria-hidden="true" tabindex="-1"></a>      <span class="co">// if it's supported.</span></span>
<span id="cb929-7"><a href="mobile-pwa.html#cb929-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> preloadResponse <span class="op">=</span> <span class="cf">await</span> <span class="bu">event</span><span class="op">.</span><span class="at">preloadResponse</span><span class="op">;</span></span>
<span id="cb929-8"><a href="mobile-pwa.html#cb929-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (preloadResponse) {</span>
<span id="cb929-9"><a href="mobile-pwa.html#cb929-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> preloadResponse<span class="op">;</span></span>
<span id="cb929-10"><a href="mobile-pwa.html#cb929-10" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb929-11"><a href="mobile-pwa.html#cb929-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb929-12"><a href="mobile-pwa.html#cb929-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Always try the network first.</span></span>
<span id="cb929-13"><a href="mobile-pwa.html#cb929-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> networkResponse <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="bu">event</span><span class="op">.</span><span class="at">request</span>)<span class="op">;</span></span>
<span id="cb929-14"><a href="mobile-pwa.html#cb929-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> networkResponse<span class="op">;</span></span>
<span id="cb929-15"><a href="mobile-pwa.html#cb929-15" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb929-16"><a href="mobile-pwa.html#cb929-16" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Returning offline page instead.'</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb929-17"><a href="mobile-pwa.html#cb929-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb929-18"><a href="mobile-pwa.html#cb929-18" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cache <span class="op">=</span> <span class="cf">await</span> caches<span class="op">.</span><span class="fu">open</span>(CACHE_NAME)<span class="op">;</span></span>
<span id="cb929-19"><a href="mobile-pwa.html#cb929-19" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cachedResponse <span class="op">=</span> <span class="cf">await</span> cache<span class="op">.</span><span class="fu">match</span>(OFFLINE_URL)<span class="op">;</span></span>
<span id="cb929-20"><a href="mobile-pwa.html#cb929-20" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> cachedResponse<span class="op">;</span></span>
<span id="cb929-21"><a href="mobile-pwa.html#cb929-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb929-22"><a href="mobile-pwa.html#cb929-22" aria-hidden="true" tabindex="-1"></a>  })()</span>
<span id="cb929-23"><a href="mobile-pwa.html#cb929-23" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div>
<p>All other requests are handled in the <code>else</code> statement. The logic remains the same. We first try to get assets from the network and fallback to the cache upon error, that is for instance in offline mode.</p>
<div class="sourceCode" id="cb930"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb930-1"><a href="mobile-pwa.html#cb930-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Other requests</span></span>
<span id="cb930-2"><a href="mobile-pwa.html#cb930-2" aria-hidden="true" tabindex="-1"></a><span class="bu">event</span><span class="op">.</span><span class="fu">respondWith</span>(</span>
<span id="cb930-3"><a href="mobile-pwa.html#cb930-3" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb930-4"><a href="mobile-pwa.html#cb930-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb930-5"><a href="mobile-pwa.html#cb930-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Always try the network first.</span></span>
<span id="cb930-6"><a href="mobile-pwa.html#cb930-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> networkResponse <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="bu">event</span><span class="op">.</span><span class="at">request</span>)<span class="op">;</span></span>
<span id="cb930-7"><a href="mobile-pwa.html#cb930-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> networkResponse<span class="op">;</span></span>
<span id="cb930-8"><a href="mobile-pwa.html#cb930-8" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb930-9"><a href="mobile-pwa.html#cb930-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb930-10"><a href="mobile-pwa.html#cb930-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb930-11"><a href="mobile-pwa.html#cb930-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cache <span class="op">=</span> <span class="cf">await</span> caches<span class="op">.</span><span class="fu">open</span>(CACHE_NAME)<span class="op">;</span></span>
<span id="cb930-12"><a href="mobile-pwa.html#cb930-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cachedResponse <span class="op">=</span> <span class="cf">await</span> cache<span class="op">.</span><span class="fu">match</span>(<span class="bu">event</span><span class="op">.</span><span class="at">request</span>)<span class="op">;</span></span>
<span id="cb930-13"><a href="mobile-pwa.html#cb930-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (cachedResponse) <span class="cf">return</span> cachedResponse<span class="op">;</span></span>
<span id="cb930-14"><a href="mobile-pwa.html#cb930-14" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb930-15"><a href="mobile-pwa.html#cb930-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb930-16"><a href="mobile-pwa.html#cb930-16" aria-hidden="true" tabindex="-1"></a>  })()</span>
<span id="cb930-17"><a href="mobile-pwa.html#cb930-17" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div>
<p>To sum up, this service worker redirects the end user to the offline cached page (<code>offline.html</code>) whenever the app is offline, thereby offering a better user experience. The full code is located <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/blob/5bc49eab9496696a06da3f62d6aaf8ef468cdad4/inst/shinyMobile/pwa/www/service-worker.js">here</a>.</p>
<div class="importantblock">
<p>We strongly advise keeping the same file names.</p>
</div>
</div>
<div id="registration" class="section level4" number="24.2.3.4">
<h4>
<span class="header-section-number">24.2.3.4</span> Registration<a class="anchor" aria-label="anchor" href="#registration"><i class="fas fa-link"></i></a>
</h4>
<p>The next step involves the service worker <strong>registration</strong>. Framework7 has a dedicated module in the app configuration. We modify the <code>config</code> in <code>helpers_config.js</code> before initializing the <code>app</code> and run <code><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js()</a></code> to update the minified file:</p>
<div class="sourceCode" id="cb931"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb931-1"><a href="mobile-pwa.html#cb931-1" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="at">serviceWorker</span> <span class="op">=</span> {</span>
<span id="cb931-2"><a href="mobile-pwa.html#cb931-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">path</span><span class="op">:</span> <span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">pathname</span> <span class="op">+</span> <span class="st">'service-worker.js'</span><span class="op">,</span></span>
<span id="cb931-3"><a href="mobile-pwa.html#cb931-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scope</span><span class="op">:</span> <span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">pathname</span></span>
<span id="cb931-4"><a href="mobile-pwa.html#cb931-4" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>If the process is successful, you get the result shown in Figure <a href="mobile-pwa.html#fig:mobile-pwa-registered-sw">24.6</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:mobile-pwa-registered-sw"></span>
<img src="images/mobile/mobile-pwa-registered-sw.png" alt="Registered service worker." width="100%"><p class="caption">
FIGURE 24.6: Registered service worker.
</p>
</div>
<p>At this point, you should also check whether the service worker was able to cache files by inspecting the cache storage section, as depicted by Figure <a href="mobile-pwa.html#fig:mobile-pwa-cache">24.7</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:mobile-pwa-cache"></span>
<img src="images/mobile/mobile-pwa-cache.png" alt="Service worker caches static assets to make them available offline." width="100%"><p class="caption">
FIGURE 24.7: Service worker caches static assets to make them available offline.
</p>
</div>
</div>
<div id="offline-fallback" class="section level4" number="24.2.3.5">
<h4>
<span class="header-section-number">24.2.3.5</span> Offline fallback<a class="anchor" aria-label="anchor" href="#offline-fallback"><i class="fas fa-link"></i></a>
</h4>
<p>The new PWA standard imposes returning a valid response when the app is <strong>offline</strong>. The offline page is also copied from <a href="https://github.com/RinteRface/charpente">charpente</a> and below is a summarized version:</p>
<div class="sourceCode" id="cb932"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb932-1"><a href="mobile-pwa.html#cb932-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb932-2"><a href="mobile-pwa.html#cb932-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;html&gt;</span></span>
<span id="cb932-3"><a href="mobile-pwa.html#cb932-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;head&gt;</span></span>
<span id="cb932-4"><a href="mobile-pwa.html#cb932-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- Required meta tags ... --&gt;</span></span>
<span id="cb932-5"><a href="mobile-pwa.html#cb932-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;link</span> </span>
<span id="cb932-6"><a href="mobile-pwa.html#cb932-6" aria-hidden="true" tabindex="-1"></a><span class="ot">      rel=</span><span class="st">"stylesheet"</span> </span>
<span id="cb932-7"><a href="mobile-pwa.html#cb932-7" aria-hidden="true" tabindex="-1"></a><span class="ot">      href=</span><span class="st">"framework7-5.7.14/css/framework7.bundle.min.css"</span><span class="kw">&gt;</span></span>
<span id="cb932-8"><a href="mobile-pwa.html#cb932-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/head&gt;</span></span>
<span id="cb932-9"><a href="mobile-pwa.html#cb932-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;body&gt;</span></span>
<span id="cb932-10"><a href="mobile-pwa.html#cb932-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;div</span> <span class="er">id</span><span class="ot">=</span><span class="st">"app"</span><span class="kw">&gt;</span></span>
<span id="cb932-11"><a href="mobile-pwa.html#cb932-11" aria-hidden="true" tabindex="-1"></a>      <span class="co">&lt;!-- App content (navbar, toolbar, page, ...) --&gt;</span></span>
<span id="cb932-12"><a href="mobile-pwa.html#cb932-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb932-13"><a href="mobile-pwa.html#cb932-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">"text/javascript"</span> <span class="er">src</span><span class="ot">=</span><span class="st">"shared/jquery.min.js"</span><span class="kw">&gt;</span></span>
<span id="cb932-14"><a href="mobile-pwa.html#cb932-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/script&gt;</span></span>
<span id="cb932-15"><a href="mobile-pwa.html#cb932-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;script</span> </span>
<span id="cb932-16"><a href="mobile-pwa.html#cb932-16" aria-hidden="true" tabindex="-1"></a><span class="ot">      type=</span><span class="st">"text/javascript"</span>     </span>
<span id="cb932-17"><a href="mobile-pwa.html#cb932-17" aria-hidden="true" tabindex="-1"></a><span class="ot">      src=</span><span class="st">"framework7-5.7.14/js/framework7.bundle.min.js"</span><span class="kw">&gt;</span></span>
<span id="cb932-18"><a href="mobile-pwa.html#cb932-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/script&gt;</span></span>
<span id="cb932-19"><a href="mobile-pwa.html#cb932-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- Path to your app js --&gt;</span></span>
<span id="cb932-20"><a href="mobile-pwa.html#cb932-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;script&gt;</span></span>
<span id="cb932-21"><a href="mobile-pwa.html#cb932-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> app <span class="op">=</span> <span class="kw">new</span> <span class="fu">Framework7</span>({ </span>
<span id="cb932-22"><a href="mobile-pwa.html#cb932-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ...</span></span>
<span id="cb932-23"><a href="mobile-pwa.html#cb932-23" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb932-24"><a href="mobile-pwa.html#cb932-24" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ...</span></span>
<span id="cb932-25"><a href="mobile-pwa.html#cb932-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/script&gt;</span></span>
<span id="cb932-26"><a href="mobile-pwa.html#cb932-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/body&gt;</span></span>
<span id="cb932-27"><a href="mobile-pwa.html#cb932-27" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>Notice that jQuery, required for easier DOM interactions, as well as Framework7 CSS and JS assets are cached in the above service worker script, thereby making them
available to <code>offline.html</code>. This offline fallback relies on Framework7 for consistency reasons but could be replaced by any other HTML page. The whole code is stored <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/blob/5bc49eab9496696a06da3f62d6aaf8ef468cdad4/inst/shinyMobile/pwa/www/offline.html">here</a>.</p>
<p>Now, let’s audit our app again: congrats! It is <strong>installable</strong> and reliable, although further PWA optimization may be provided.</p>
<div class="figure">
<span style="display:block;" id="fig:mobile-pwa-audit-final"></span>
<img src="images/mobile/mobile-pwa-audit-final.png" alt="Installable shinyMobile app." width="100%"><p class="caption">
FIGURE 24.8: Installable shinyMobile app.
</p>
</div>
<div class="importantblock">
<p>A common source of error is the <strong>browser cache</strong>. It is best practice to regularly empty it. Alternatively, you may run in incognito mode, which does not cache files.</p>
</div>
</div>
</div>
<div id="disable-pwa-for-the-end-user" class="section level3" number="24.2.4">
<h3>
<span class="header-section-number">24.2.4</span> Disable PWA for the end user<a class="anchor" aria-label="anchor" href="#disable-pwa-for-the-end-user"><i class="fas fa-link"></i></a>
</h3>
<p>With the above approach, <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> will always look for a service worker to register.
Particularly, this would raise an error in case no service worker is found on the server.
What if the user doesn’t want to create a PWA, let’s say for less important applications?
We may add a parameter to <code><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page()</a></code>, for instance <code>allowPWA</code>, that is either <code>TRUE</code> or <code>FALSE</code> and store its value in the <code>body</code> <code>data-pwa</code> attribute.</p>
<div class="sourceCode" id="cb933"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f7_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">navbar</span>, <span class="va">toolbar</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>,
                    <span class="va">options</span> <span class="op">=</span> <span class="va">shinyMobile_options</span>,
                    <span class="va">allowPWA</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>

  <span class="co"># ... unchanged</span>

  <span class="co"># create body_tag</span>
  <span class="va">body_tag</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span>
    `data-pwa` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">allowPWA</span><span class="op">)</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"app"</span>,
      <span class="co"># ... unchanged</span>
    <span class="op">)</span>
  <span class="op">)</span>
    
  <span class="co"># ... unchanged</span>
<span class="op">}</span></code></pre></div>
<p>We recover it on the JS side within <code>helpers_config.js</code>:</p>
<div class="sourceCode" id="cb934"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb934-1"><a href="mobile-pwa.html#cb934-1" aria-hidden="true" tabindex="-1"></a><span class="co">// check if the app is intended to be a PWA</span></span>
<span id="cb934-2"><a href="mobile-pwa.html#cb934-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> isPWA <span class="op">=</span> <span class="fu">$</span>(<span class="st">'body'</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">'data-pwa'</span>) <span class="op">===</span> <span class="st">'true'</span><span class="op">;</span></span>
<span id="cb934-3"><a href="mobile-pwa.html#cb934-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb934-4"><a href="mobile-pwa.html#cb934-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (isPWA) {</span>
<span id="cb934-5"><a href="mobile-pwa.html#cb934-5" aria-hidden="true" tabindex="-1"></a>  config<span class="op">.</span><span class="at">serviceWorker</span> <span class="op">=</span> {</span>
<span id="cb934-6"><a href="mobile-pwa.html#cb934-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">path</span><span class="op">:</span> <span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">pathname</span> <span class="op">+</span> <span class="st">'service-worker.js'</span><span class="op">,</span></span>
<span id="cb934-7"><a href="mobile-pwa.html#cb934-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scope</span><span class="op">:</span> <span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">pathname</span></span>
<span id="cb934-8"><a href="mobile-pwa.html#cb934-8" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb934-9"><a href="mobile-pwa.html#cb934-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>It <strong>only</strong> creates <code>config.serviceWorker</code> if the user specifies <code>allowPWA = TRUE</code>.</p>
</div>
</div>
<div id="handle-the-installation" class="section level2" number="24.3">
<h2>
<span class="header-section-number">24.3</span> Handle the installation<a class="anchor" aria-label="anchor" href="#handle-the-installation"><i class="fas fa-link"></i></a>
</h2>
<p>It is a great opportunity to propose a <a href="https://developers.google.com/web/fundamentals/app-install-banners/native">custom</a> installation experience.</p>
<div class="warningblock">
<p>To be able to install the app, make sure to replace <code>start_url</code> by the url
where the app is deployed like <code>https://dgranjon.shinyapps.io/installable-pwa-app/</code> for instance.
Missing that step would cause an issue during the service worker registration.</p>
</div>
<p>We create a new script with <code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_js("helpers_pwa")</a></code> and export the <code>setPWA</code> function:</p>
<div class="sourceCode" id="cb935"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb935-1"><a href="mobile-pwa.html#cb935-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> setPWA <span class="op">=</span> (app) <span class="kw">=&gt;</span> {</span>
<span id="cb935-2"><a href="mobile-pwa.html#cb935-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Install logic</span></span>
<span id="cb935-3"><a href="mobile-pwa.html#cb935-3" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Once the installation criteria are met, the web browser raises the <strong>beforeinstallprompt</strong> event (except
on the iOS platform, which is not compatible yet). We add an event listener inside <code>setPWA</code>:</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb936-1"><a href="mobile-pwa.html#cb936-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> deferredPrompt<span class="op">;</span></span>
<span id="cb936-2"><a href="mobile-pwa.html#cb936-2" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'beforeinstallprompt'</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb936-3"><a href="mobile-pwa.html#cb936-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Prevent the mini-infobar from appearing on mobile</span></span>
<span id="cb936-4"><a href="mobile-pwa.html#cb936-4" aria-hidden="true" tabindex="-1"></a>  e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb936-5"><a href="mobile-pwa.html#cb936-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stash the event so it can be triggered later.</span></span>
<span id="cb936-6"><a href="mobile-pwa.html#cb936-6" aria-hidden="true" tabindex="-1"></a>  deferredPrompt <span class="op">=</span> e<span class="op">;</span></span>
<span id="cb936-7"><a href="mobile-pwa.html#cb936-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>This code adds an event listener to the window, prevents it from showing at start with <code>e.preventDefault</code> and
captures it in an external variable called <code>deferredPrompt</code>.</p>
<p>The next step comprises the design of our custom piece of UI, which will trigger the <code>prompt</code> install. We can benefit from the rich Framework7 interface and display
a <a href="https://framework7.io/docs/toast.html">toast</a> containing an install button. The initialization
is fairly simple, following the pattern <code>app.&lt;COMPONENT&gt;.create(parameters)</code>:</p>
<div class="sourceCode" id="cb937"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb937-1"><a href="mobile-pwa.html#cb937-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create custom install UI</span></span>
<span id="cb937-2"><a href="mobile-pwa.html#cb937-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> installToast <span class="op">=</span> app<span class="op">.</span><span class="at">toast</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb937-3"><a href="mobile-pwa.html#cb937-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">position</span><span class="op">:</span> <span class="st">'center'</span><span class="op">,</span></span>
<span id="cb937-4"><a href="mobile-pwa.html#cb937-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">text</span><span class="op">:</span> <span class="vs">`&lt;button </span></span>
<span id="cb937-5"><a href="mobile-pwa.html#cb937-5" aria-hidden="true" tabindex="-1"></a><span class="vs">    id="install-button" </span></span>
<span id="cb937-6"><a href="mobile-pwa.html#cb937-6" aria-hidden="true" tabindex="-1"></a><span class="vs">    class="toast-button button color-green"&gt;</span></span>
<span id="cb937-7"><a href="mobile-pwa.html#cb937-7" aria-hidden="true" tabindex="-1"></a><span class="vs">    Install</span></span>
<span id="cb937-8"><a href="mobile-pwa.html#cb937-8" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/button&gt;`</span></span>
<span id="cb937-9"><a href="mobile-pwa.html#cb937-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>We give it an id so as to call it later and edit the <strong>beforeinstallprompt</strong> event listener to show the toast:</p>
<div class="sourceCode" id="cb938"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb938-1"><a href="mobile-pwa.html#cb938-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> deferredPrompt<span class="op">;</span></span>
<span id="cb938-2"><a href="mobile-pwa.html#cb938-2" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'beforeinstallprompt'</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb938-3"><a href="mobile-pwa.html#cb938-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Prevent the mini-infobar from appearing on mobile</span></span>
<span id="cb938-4"><a href="mobile-pwa.html#cb938-4" aria-hidden="true" tabindex="-1"></a>  e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb938-5"><a href="mobile-pwa.html#cb938-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stash the event so it can be triggered later.</span></span>
<span id="cb938-6"><a href="mobile-pwa.html#cb938-6" aria-hidden="true" tabindex="-1"></a>  deferredPrompt <span class="op">=</span> e<span class="op">;</span></span>
<span id="cb938-7"><a href="mobile-pwa.html#cb938-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Show install trigger</span></span>
<span id="cb938-8"><a href="mobile-pwa.html#cb938-8" aria-hidden="true" tabindex="-1"></a>  installToast<span class="op">.</span><span class="fu">open</span>()<span class="op">;</span></span>
<span id="cb938-9"><a href="mobile-pwa.html#cb938-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<div class="noteblock">
<p>With jQuery like <code>$(window).on('beforeinstallprompt', ...)</code>, we would capture the event with <code>e.originalEvent</code>.</p>
</div>
<p>We register a second event listener, which fires on the toast button click. We first close the
toast, call the <code>prompt</code> method on the deferred event and log the result:</p>
<div class="sourceCode" id="cb939"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb939-1"><a href="mobile-pwa.html#cb939-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="at">utils</span><span class="op">.</span><span class="fu">nextTick</span>(<span class="kw">function</span>() {</span>
<span id="cb939-2"><a href="mobile-pwa.html#cb939-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(<span class="st">'#install-button'</span>)<span class="op">.</span><span class="fu">on</span>(<span class="st">'click'</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb939-3"><a href="mobile-pwa.html#cb939-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// close install toast</span></span>
<span id="cb939-4"><a href="mobile-pwa.html#cb939-4" aria-hidden="true" tabindex="-1"></a>    installToast<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb939-5"><a href="mobile-pwa.html#cb939-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>deferredPrompt) {</span>
<span id="cb939-6"><a href="mobile-pwa.html#cb939-6" aria-hidden="true" tabindex="-1"></a>      <span class="co">// The deferred prompt isn't available.</span></span>
<span id="cb939-7"><a href="mobile-pwa.html#cb939-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb939-8"><a href="mobile-pwa.html#cb939-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb939-9"><a href="mobile-pwa.html#cb939-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Show the install prompt.</span></span>
<span id="cb939-10"><a href="mobile-pwa.html#cb939-10" aria-hidden="true" tabindex="-1"></a>    deferredPrompt<span class="op">.</span><span class="fu">prompt</span>()<span class="op">;</span></span>
<span id="cb939-11"><a href="mobile-pwa.html#cb939-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Log the result</span></span>
<span id="cb939-12"><a href="mobile-pwa.html#cb939-12" aria-hidden="true" tabindex="-1"></a>    deferredPrompt<span class="op">.</span><span class="at">userChoice</span><span class="op">.</span><span class="fu">then</span>((result) <span class="kw">=&gt;</span> {</span>
<span id="cb939-13"><a href="mobile-pwa.html#cb939-13" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'OK'</span><span class="op">,</span> <span class="st">'userChoice'</span><span class="op">,</span> result)<span class="op">;</span></span>
<span id="cb939-14"><a href="mobile-pwa.html#cb939-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Reset the deferred prompt variable, since</span></span>
<span id="cb939-15"><a href="mobile-pwa.html#cb939-15" aria-hidden="true" tabindex="-1"></a>      <span class="co">// prompt() can only be called once.</span></span>
<span id="cb939-16"><a href="mobile-pwa.html#cb939-16" aria-hidden="true" tabindex="-1"></a>      deferredPrompt <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb939-17"><a href="mobile-pwa.html#cb939-17" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb939-18"><a href="mobile-pwa.html#cb939-18" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb939-19"><a href="mobile-pwa.html#cb939-19" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> <span class="dv">500</span>)<span class="op">;</span></span></code></pre></div>
<p>Inside <code>init.js</code>, we add our brand new module:</p>
<div class="sourceCode" id="cb940"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb940-1"><a href="mobile-pwa.html#cb940-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { setConfig } <span class="im">from</span> <span class="st">'./helpers_config.js'</span><span class="op">;</span></span>
<span id="cb940-2"><a href="mobile-pwa.html#cb940-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { initTheme } <span class="im">from</span> <span class="st">'./helpers_theme.js'</span></span>
<span id="cb940-3"><a href="mobile-pwa.html#cb940-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { setPWA } <span class="im">from</span> <span class="st">'./helpers_pwa.js'</span></span>
<span id="cb940-4"><a href="mobile-pwa.html#cb940-4" aria-hidden="true" tabindex="-1"></a><span class="co">// other imports ...</span></span>
<span id="cb940-5"><a href="mobile-pwa.html#cb940-5" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>( <span class="bu">document</span> )<span class="op">.</span><span class="fu">ready</span>(<span class="kw">function</span>() {</span>
<span id="cb940-6"><a href="mobile-pwa.html#cb940-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> config <span class="op">=</span> <span class="fu">setConfig</span>()<span class="op">;</span></span>
<span id="cb940-7"><a href="mobile-pwa.html#cb940-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// create app instance</span></span>
<span id="cb940-8"><a href="mobile-pwa.html#cb940-8" aria-hidden="true" tabindex="-1"></a>  app <span class="op">=</span> <span class="kw">new</span> <span class="fu">Framework7</span>(config)<span class="op">;</span></span>
<span id="cb940-9"><a href="mobile-pwa.html#cb940-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Set theme: dark mode, touch, filled, color, taphold css</span></span>
<span id="cb940-10"><a href="mobile-pwa.html#cb940-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">initTheme</span>(config<span class="op">,</span> app)<span class="op">;</span></span>
<span id="cb940-11"><a href="mobile-pwa.html#cb940-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// PWA setup</span></span>
<span id="cb940-12"><a href="mobile-pwa.html#cb940-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setPWA</span>(app)<span class="op">;</span></span>
<span id="cb940-13"><a href="mobile-pwa.html#cb940-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>We run <code><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js()</a></code> and deploy the app to shinyapps.io (remember, we must serve the app under HTTPS). Figure <a href="mobile-pwa.html#fig:mobile-pwa-installable">24.9</a>
illustrates the install prompt window that appears to install the app. Once installed, the <strong>beforeinstallprompt</strong>
event does not fire anymore and the app may be launched as a standalone app, for instance on macOSX (Figure <a href="mobile-pwa.html#fig:mobile-pwa-installed">24.10</a>).</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mobile-pwa-installable"></span>
<img src="images/mobile/mobile-pwa-installable.png" alt="Install prompt window." width="50%"><p class="caption">
FIGURE 24.9: Install prompt window.
</p>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mobile-pwa-installed"></span>
<img src="images/mobile/mobile-pwa-installed.png" alt="Installed PWA on macOSX." width="50%"><p class="caption">
FIGURE 24.10: Installed PWA on macOSX.
</p>
</div>
<p>In Figure <a href="mobile-pwa.html#fig:mobile-pwa-installed">24.10</a>, the blue window color corresponds to the <code>tags$meta(name = "theme-color", content = "#2196f3")</code>, passed in the <code><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page()</a></code> layout element. To simulate a network issue and validate the offline mode, we selected the developer tools <strong>Network</strong> tab and changed the dropdown value to offline. As shown in Figure <a href="mobile-pwa.html#fig:mobile-pwa-offline">24.11</a>, the offline template shows and pulls static assets from the service worker (the failed network requests are shown in red).</p>
<div class="figure">
<span style="display:block;" id="fig:mobile-pwa-offline"></span>
<img src="images/mobile/mobile-pwa-offline.png" alt="Offline HTML template." width="100%"><p class="caption">
FIGURE 24.11: Offline HTML template.
</p>
</div>
<p>The final product may be run with:</p>
<div class="sourceCode" id="cb941"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "shinyMobile/pwa", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page</a></span><span class="op">(</span>
  navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_navbar.html">f7_navbar</a></span><span class="op">(</span><span class="st">"PWA App"</span><span class="op">)</span>,
  toolbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_toolbar.html">f7_toolbar</a></span><span class="op">(</span><span class="op">)</span>,
  title <span class="op">=</span> <span class="st">"shinyMobile"</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">session</span><span class="op">$</span><span class="fu">allowReconnect</span><span class="op">(</span><span class="st">"force"</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>This chapter was part of a workshop available <a href="https://github.com/RinteRface/rencontresR2021">here</a>.</p>
<!-- 
## Workbox
[Workbox](https://developers.google.com/web/tools/workbox) is a more robust alternative 
to the approach described above with boilerplate code to enable:

  - pre-caching of dependencies like CSS and JS but also images and Google fonts
  to improve performances.
  - Improve offline experience.
  - ...

::: {.importantblock data-latex=""}
This part does not work yet at the time of review submission. 
I'll probably remove it ...
:::

-->
</div>
<div id="other-resources" class="section level2" number="24.4">
<h2>
<span class="header-section-number">24.4</span> Other resources<a class="anchor" aria-label="anchor" href="#other-resources"><i class="fas fa-link"></i></a>
</h2>
<p>The process described above works perfectly for any Shiny template. The reader may also consider other packages like <a href="https://github.com/pedrocoutinhosilva/shiny.pwa">{shiny.pwa}</a>, that creates a PWA-compatible structure at run time, within the app <code>/www</code> folder.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="mobile-shinyMobile.html"><span class="header-section-number">23</span> Reconstruct {shinyMobile}</a></div>
<div class="next"><a href="mobile-widgets.html"><span class="header-section-number">25</span> Design widgets</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#mobile-pwa"><span class="header-section-number">24</span> {shinyMobile} and PWA</a></li>
<li><a class="nav-link" href="#introduction-6"><span class="header-section-number">24.1</span> Introduction</a></li>
<li>
<a class="nav-link" href="#charpente-and-pwa-tools"><span class="header-section-number">24.2</span> {charpente} and PWA tools</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#create-the-manifest"><span class="header-section-number">24.2.1</span> Create the manifest</a></li>
<li><a class="nav-link" href="#google-pwa-compatibility"><span class="header-section-number">24.2.2</span> Google PWA compatibility</a></li>
<li><a class="nav-link" href="#service-worker-and-offline-page"><span class="header-section-number">24.2.3</span> Service worker and offline page</a></li>
<li><a class="nav-link" href="#disable-pwa-for-the-end-user"><span class="header-section-number">24.2.4</span> Disable PWA for the end user</a></li>
</ul>
</li>
<li><a class="nav-link" href="#handle-the-installation"><span class="header-section-number">24.3</span> Handle the installation</a></li>
<li><a class="nav-link" href="#other-resources"><span class="header-section-number">24.4</span> Other resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/mobile-pwa.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/mobile-pwa.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It was last built on 2022-02-02.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
