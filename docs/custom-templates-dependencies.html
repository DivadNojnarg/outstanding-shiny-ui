<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 17 Define dependencies | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.9002/transition.js"></script><script src="libs/bs3compat-0.2.5.9002/tabs.js"></script><script src="libs/bs3compat-0.2.5.9002/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">2</span> Mastering {htmltools}</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">3</span> Discover Shiny dependencies</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Dependency utilities</a></li>
<li><a class="" href="web-applications.html"><span class="header-section-number">5</span> Web application concepts</a></li>
<li class="book-part">Beautify with CSS and Sass</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">6</span> CSS for Shiny</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">7</span> Introduction to Sass</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">8</span> Beautify with {fresh}</a></li>
<li><a class="" href="beautify-with-bootstraplib.html"><span class="header-section-number">9</span> Beautify with {bslib}</a></li>
<li class="book-part">Unleash interactivity with JavaScript</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> R and JS</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">12</span> Shiny’s input system</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Mastering Shiny’s events</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Dynamically manage content with handlers</a></li>
<li class="book-part">Practice 1: a dashboard template</li>
<li><a class="" href="custom-templates-selection.html"><span class="header-section-number">16</span> Template selection</a></li>
<li><a class="active" href="custom-templates-dependencies.html"><span class="header-section-number">17</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">18</span> Create template elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">19</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">20</span> Adding more interactivity</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">21</span> Testing and validating templates elements</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="" href="workflow-charpente.html"><span class="header-section-number">22</span> Introduction to {charpente}</a></li>
<li class="book-part">Case study 2: Mobile development with Shiny</li>
<li><a class="" href="mobile-shiny-intro.html"><span class="header-section-number">23</span> Introduction</a></li>
<li><a class="" href="mobile-shinyMobile.html"><span class="header-section-number">24</span> Reconstruct {shinyMobile}</a></li>
<li><a class="" href="mobile-pwa.html"><span class="header-section-number">25</span> {shinyMobile} and PWA</a></li>
<li><a class="" href="mobile-widgets.html"><span class="header-section-number">26</span> Design widgets</a></li>
<li><a class="" href="mobile-going-further.html"><span class="header-section-number">27</span> Fine tune {shinyMobile}</a></li>
<li class="book-part">Going further</li>
<li><a class="" href="going-further-reactR.html"><span class="header-section-number">28</span> R + Shiny + React: welcome {reactR}</a></li>
<li><a class="" href="going-further-where-to-go.html"><span class="header-section-number">29</span> What to do next?</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="code-outputs.html"><span class="header-section-number">A</span> Code outputs</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="custom-templates-dependencies" class="section level1">
<h1>
<span class="header-section-number">17</span> Define dependencies<a class="anchor" aria-label="anchor" href="#custom-templates-dependencies"><i class="fas fa-link"></i></a>
</h1>
<p>The Tabler template is a tiny <strong>Bootstrap 4</strong> dashboard template. In this chapter, we will describe how to create an R wrapper on top of it, thereby making it available for all shiny users.</p>
<div class="importantblock">
<p>This chapter was written about two years ago, on top of the <strong>1.0.0-alpha.7</strong> GitHub <a href="https://github.com/tabler/tabler/tree/14d0c001436b85d2a4533d63680d209affdf774b">release</a>.
If the Tabler library significantly evolved since that date, the way to incorporate it into
the shiny ecosystem remains <strong>unchanged</strong>. Hence, the methods we describe below may be <strong>generalized</strong> to other
templates. We recommend to read this chapter before the next part in <a href="workflow-charpente.html#workflow-charpente">22</a>, during
which we present a more automated workflow, if you want to grasp the main concepts.</p>
</div>
<div id="discover-the-project" class="section level2">
<h2>
<span class="header-section-number">17.1</span> Discover the project<a class="anchor" aria-label="anchor" href="#discover-the-project"><i class="fas fa-link"></i></a>
</h2>
<p>The first step of any template adaptation consists of <strong>exploring</strong> the underlying GitHub <a href="https://github.com/tabler/tabler/tree/14d0c001436b85d2a4533d63680d209affdf774b">repository</a>
and look for mandatory elements, like CSS/JS <strong>dependencies</strong>.
This is a similar strategy if you want to incorporate an htmlwidget as well.</p>
<p>As depicted by Figure <a href="custom-templates-dependencies.html#fig:tabler-github">17.1</a>, the most important folders are:</p>
<ul>
<li>
<strong>dist</strong>, which contains CSS and JS files as well as other libraries like Bootstrap and jQuery.
It is also a good moment to look at the version of each dependency that might conflict with Shiny.</li>
<li>
<strong>demo</strong> is the website folder used for demonstration purpose.
This is our source to explore the template capabilities in depth.</li>
</ul>
<p>The <strong>scss</strong> and <strong>build</strong> folder may be used to customize the tabler template directly. However as stated above, directions on how to do so are out of scope for this book.</p>
<div class="figure">
<span id="fig:tabler-github"></span>
<img src="images/practice/tabler-github.png" alt="GitHub project exploration" width="100%"><p class="caption">
FIGURE 17.1: GitHub project exploration
</p>
</div>
</div>
<div id="identify-mandatory-dependencies" class="section level2">
<h2>
<span class="header-section-number">17.2</span> Identify mandatory dependencies<a class="anchor" aria-label="anchor" href="#identify-mandatory-dependencies"><i class="fas fa-link"></i></a>
</h2>
<p><code>Bootstrap 4</code>, <code>jQuery</code>, <code>tabler.min.css</code> and <code>tabler.min.js</code> are key elements for the template,
contrary to flag icons which are optional (and take a lot of space).
If your goal is to release your template on CRAN, be mindful of the 5 Mb maximum size limit.
From personal experience, I can attest that this is quite challenging to manage.</p>
<p>To inspect dependencies, we proceed as follows:</p>
<ul>
<li>
<strong>Download</strong> or <strong>clone</strong> the GitHub repository.</li>
<li>Go to the <strong>demo folder</strong> and open the <code>layout-dark.html</code> file.</li>
<li>Open the <strong>HTML inspector</strong>.</li>
</ul>
<p>As shown on Figure <a href="custom-templates-dependencies.html#fig:tabler-deps">17.2</a> left-hand side, we need to include the <code>tabler.min.css</code> from the header. If you are not convinced, try to remove it from the DOM and see what happens. <a href="https://www.10bestdesign.com/jqvmap/">jqvmap</a> is actually related to an external visualization plugin used in the demo. Finally the <code>demo.min.css</code> file is for the demo purpose.
This will not prevent the template from working, so we will skip it for now. So far so good, we only need one file thus!</p>
<div class="figure">
<span id="fig:tabler-deps"></span>
<img src="images/practice/tabler-deps-1.png" alt="tabler dependencies overview" width="50%"><img src="images/practice/tabler-deps-2.png" alt="tabler dependencies overview" width="50%"><p class="caption">
FIGURE 17.2: tabler dependencies overview
</p>
</div>
<p>JavaScript dependencies are shown on the right-hand side and located at the end of the body tag. Because we will not need all chart-related dependencies like <code>apexcharts</code>, <code>jquery.vmap</code> and <code>vmap world</code>, we may safely ignore them. We only retain the Bootstrap 4, jQuery core and <code>tabler.min.js</code>, in the same order.</p>
</div>
<div id="bundle-dependencies" class="section level2">
<h2>
<span class="header-section-number">17.3</span> Bundle dependencies<a class="anchor" aria-label="anchor" href="#bundle-dependencies"><i class="fas fa-link"></i></a>
</h2>
<p>With the help of the <code><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency()</a></code> function, we are going to create our main Tabler HTML dependency containing all assets to allow our template to render properly. In this example, we are going to cheat a bit: instead of handling local files, we will use a CDN (content delivery network) that hosts all necessary Tabler <a href="https://www.jsdelivr.com/package/npm/tabler">assets</a>. This avoids to include all the necessary files in the R package, as well as in a GitHub repository.</p>
<div class="warningblock">
<p>For a <strong>production</strong> template, that is designed to go on CRAN,
we recommend to host files <strong>locally</strong>, as described in Chapter <a href="workflow-charpente.html#workflow-charpente">22</a>.</p>
</div>
<div class="sourceCode" id="cb568"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools">htmltools</a></span><span class="op">)</span>
<span class="va">tablers_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"tabler"</span>,
  version <span class="op">=</span> <span class="st">"1.0.7"</span>, <span class="co"># we take that of tabler,</span>
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>href <span class="op">=</span> <span class="st">"https://cdn.jsdelivr.net/npm/tabler@1.0.0-alpha.7/dist/"</span><span class="op">)</span>,
  script <span class="op">=</span> <span class="st">"js/tabler.min.js"</span>,
  stylesheet <span class="op">=</span> <span class="st">"css/tabler.min.css"</span>
<span class="op">)</span></code></pre></div>
<p>We advise the reader to create one HTML dependency per element. The Bootstrap version is <code>4.3.1</code> and jQuery is <code>3.6.0</code>. We can also use a CDN:</p>
<div class="sourceCode" id="cb569"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bs4_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"Bootstrap"</span>,
  version <span class="op">=</span> <span class="st">"4.3.1"</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>href <span class="op">=</span> <span class="st">"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/"</span><span class="op">)</span>,
  script <span class="op">=</span> <span class="st">"bootstrap.bundle.min.js"</span>
<span class="op">)</span>

<span class="va">jQuery_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"jquery"</span>,
  version <span class="op">=</span> <span class="st">"3.6.0"</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>href <span class="op">=</span> <span class="st">"https://code.jquery.com/"</span><span class="op">)</span>,
  script <span class="op">=</span> <span class="st">"jquery-3.6.0.slim.min.js"</span>
<span class="op">)</span></code></pre></div>
<p>We finally create our dependency manager:</p>
<div class="sourceCode" id="cb570"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add all dependencies to a tag. Don't forget to set append to TRUE to preserve any existing dependency</span>
<span class="va">add_tabler_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># below, the order is of critical importance!</span>
  <span class="va">deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">bs4_deps</span>, <span class="va">tablers_deps</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependencies.html">attachDependencies</a></span><span class="op">(</span><span class="va">tag</span>, <span class="va">deps</span>, append <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Notice the dependencies order in the <code>deps</code> list. This will be exactly the same order in the <code>head</code> of the HTML page. Some libraries require to be loaded at a specific place, like the Tabler dependencies which must come after Bootstrap.</p>
<p>Let’s see how to use <code><a href="https://rdrr.io/pkg/OSUICode/man/add_tabler_deps.html">add_tabler_deps()</a></code>. We consider a <code>&lt;div&gt;</code> placeholder and check for its dependencies with <code><a href="https://rdrr.io/pkg/htmltools/man/findDependencies.html">findDependencies()</a></code>.
Then, we wrap it with <code><a href="https://rdrr.io/pkg/OSUICode/man/add_tabler_deps.html">add_tabler_deps()</a></code>:</p>
<div class="sourceCode" id="cb571"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/findDependencies.html">findDependencies</a></span><span class="op">(</span><span class="va">tag</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; NULL</code></pre>
<div class="sourceCode" id="cb573"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/add_tabler_deps.html">add_tabler_deps</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/findDependencies.html">findDependencies</a></span><span class="op">(</span><span class="va">tag</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [[1]]
#&gt; List of 10
#&gt;  $ name      : chr "Bootstrap"
#&gt;  $ version   : chr "4.3.1"
#&gt;  $ src       :List of 1
#&gt;   ..$ href: chr "https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/"
#&gt;  $ meta      : NULL
#&gt;  $ script    : chr "bootstrap.bundle.min.js"
#&gt;  $ stylesheet: NULL
#&gt;  $ head      : NULL
#&gt;  $ attachment: NULL
#&gt;  $ package   : NULL
#&gt;  $ all_files : logi TRUE
#&gt;  - attr(*, "class")= chr "html_dependency"
#&gt; 
#&gt; [[2]]
#&gt; List of 10
#&gt;  $ name      : chr "tabler"
#&gt;  $ version   : chr "1.0.7"
#&gt;  $ src       :List of 1
#&gt;   ..$ href: chr "https://cdn.jsdelivr.net/npm/tabler@1.0.0-alpha.7/dist/"
#&gt;  $ meta      : NULL
#&gt;  $ script    : chr "js/tabler.min.js"
#&gt;  $ stylesheet: chr "css/tabler.min.css"
#&gt;  $ head      : NULL
#&gt;  $ attachment: NULL
#&gt;  $ package   : NULL
#&gt;  $ all_files : logi TRUE
#&gt;  - attr(*, "class")= chr "html_dependency"</code></pre>
<p>As shown above, our dependencies are applied to the div, in the correct order. This order is set by the list <code><a href="https://rdrr.io/r/base/list.html">list(bs4_deps, jQuery_deps, tablers_deps)</a></code> and allows use to avoid potential <strong>conflicts</strong>. If we try to run this simple tag in a shiny app, we notice that all dependencies are added to the <code>&lt;head&gt;</code> tag, whereas the original template loads JavaScript dependencies in the <code>&lt;body&gt;</code>.</p>
<div class="noteblock">
<p>Unfortunately, <a href="https://github.com/rstudio/htmltools">htmltools</a> does not allow developers to distribute dependencies in different places yet.</p>
</div>
<p>Here there is no impact, but this might be no-go for templates requiring JavaScript to be placed in the body. In practice, this is challenging to guess and may only be solved by manual testing.</p>
<div class="sourceCode" id="cb575"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span><span class="va">tag</span><span class="op">)</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>Even though the <code><a href="https://rdrr.io/pkg/OSUICode/man/add_tabler_deps.html">add_tabler_deps()</a></code> function may be applied to any tag, we will use it with the core HTML template, that remain to be designed!</p>
<p>Would you like to see if our dependency system works? Let’s meet in the next chapter to design the main dashboard layout.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="custom-templates-selection.html"><span class="header-section-number">16</span> Template selection</a></div>
<div class="next"><a href="custom-templates-skeleton.html"><span class="header-section-number">18</span> Create template elements</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#custom-templates-dependencies"><span class="header-section-number">17</span> Define dependencies</a></li>
<li><a class="nav-link" href="#discover-the-project"><span class="header-section-number">17.1</span> Discover the project</a></li>
<li><a class="nav-link" href="#identify-mandatory-dependencies"><span class="header-section-number">17.2</span> Identify mandatory dependencies</a></li>
<li><a class="nav-link" href="#bundle-dependencies"><span class="header-section-number">17.3</span> Bundle dependencies</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/custom-templates-dependencies.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/custom-templates-dependencies.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It was last built on 2021-08-25.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
