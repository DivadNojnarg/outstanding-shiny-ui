<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 12 Understand and develop new Shiny inputs | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<meta name="description" content="Shiny inputs are key elements of Shiny apps since they are a way for the end-user to interact with the app. You may know sliderInput(), numericInput(), checkboxInput() but sometimes you may need...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 12 Understand and develop new Shiny inputs | Outstanding User Interfaces with Shiny">
<meta property="og:type" content="book">
<meta property="og:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<meta property="og:description" content="Shiny inputs are key elements of Shiny apps since they are a way for the end-user to interact with the app. You may know sliderInput(), numericInput(), checkboxInput() but sometimes you may need...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 12 Understand and develop new Shiny inputs | Outstanding User Interfaces with Shiny">
<meta name="twitter:description" content="Shiny inputs are key elements of Shiny apps since they are a way for the end-user to interact with the app. You may know sliderInput(), numericInput(), checkboxInput() but sometimes you may need...">
<meta name="twitter:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">2</span> Manipulate HTML tags from R with {htmltools}</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">3</span> Discover Shiny dependencies</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Handle HTML dependencies with {htmltools}</a></li>
<li><a class="" href="web-applications.html"><span class="header-section-number">5</span> Web application concepts</a></li>
<li class="book-part">Beautify with CSS and Sass</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">6</span> CSS for Shiny</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">7</span> Tidy your CSS with Sass</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">8</span> Beautify with {fresh}</a></li>
<li><a class="" href="beautify-with-bootstraplib.html"><span class="header-section-number">9</span> Become a theming wizard with {bslib}</a></li>
<li class="book-part">Unleash interactivity with JavaScript</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> Communicate between R and JS</a></li>
<li><a class="active" href="shiny-input-system.html"><span class="header-section-number">12</span> Understand and develop new Shiny inputs</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Mastering Shiny’s events</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Optimize your apps with custom handlers</a></li>
<li class="book-part">Practice: A Bootstrap 4 dashboard template</li>
<li><a class="" href="custom-templates-dependencies.html"><span class="header-section-number">16</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">17</span> Create template elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">18</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">19</span> Adding more interactivity</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">20</span> Testing and validating templates elements</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="" href="workflow-charpente.html"><span class="header-section-number">21</span> Automate new template creation with {charpente}</a></li>
<li class="book-part">Case study: Mobile development for Shiny</li>
<li><a class="" href="mobile-shiny-intro.html"><span class="header-section-number">22</span> Introduction</a></li>
<li><a class="" href="mobile-shinyMobile.html"><span class="header-section-number">23</span> Reconstruct {shinyMobile}</a></li>
<li><a class="" href="mobile-pwa.html"><span class="header-section-number">24</span> {shinyMobile} and PWA</a></li>
<li><a class="" href="mobile-widgets.html"><span class="header-section-number">25</span> Design widgets</a></li>
<li><a class="" href="mobile-going-further.html"><span class="header-section-number">26</span> Fine tune {shinyMobile}</a></li>
<li class="book-part">Going further</li>
<li><a class="" href="going-further-reactR.html"><span class="header-section-number">27</span> Shiny and React with {reactR}</a></li>
<li><a class="" href="going-further-webdev.html"><span class="header-section-number">28</span> Divide and Conquere</a></li>
<li><a class="" href="going-further-where-to-go.html"><span class="header-section-number">29</span> What to do next?</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="code-outputs.html"><span class="header-section-number">A</span> Code outputs</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="shiny-input-system" class="section level1" number="12">
<h1>
<span class="header-section-number">12</span> Understand and develop new Shiny inputs<a class="anchor" aria-label="anchor" href="#shiny-input-system"><i class="fas fa-link"></i></a>
</h1>
<p>Shiny <strong>inputs</strong> are key elements of Shiny apps since they are a way for the end-user to <strong>interact</strong> with the app. You may know <code><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput()</a></code>, <code><a href="https://rdrr.io/pkg/shiny/man/numericInput.html">numericInput()</a></code>, <code><a href="https://rdrr.io/pkg/shiny/man/checkboxInput.html">checkboxInput()</a></code> but sometimes you may need fancier elements like <code><a href="https://rdrr.io/pkg/shinyWidgets/man/knobInput.html">knobInput()</a></code> from <a href="https://github.com/dreamRs/shinyWidgets/blob/5566202a4b9a0899eaafa36da23f076454bc9622/R/input-knob.R#L69">shinyWidgets</a>, as depicted on Figure <a href="shiny-input-system.html#fig:fancy-inputs">12.1</a> or even more sophisticated inputs like the <a href="https://github.com/RinteRface/shinyMobile/blob/93eaffee6a8941376802ae867add36407531e19d/R/f7-inputs.R">shinyMobile</a> <code>smartSelect()</code> (Figure <a href="shiny-input-system.html#fig:fancy-inputs">12.1</a>, right panel). Have you ever wondered what are the mechanisms behind inputs? Have you ever dreamt to develop your own?</p>
<p>The goal of this section is to understand how Shiny inputs work and how to create new ones.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:fancy-inputs"></span>
<img src="images/survival-kit/jquery-knobs.png" alt="Custom shiny inputs. left: knobInput from shinyWidgets; right: smart select from shinyMobile." width="50%"><img src="images/survival-kit/smart-select.png" alt="Custom shiny inputs. left: knobInput from shinyWidgets; right: smart select from shinyMobile." width="50%"><p class="caption">
FIGURE 12.1: Custom shiny inputs. left: knobInput from shinyWidgets; right: smart select from shinyMobile.
</p>
</div>
<p></p>
<div id="input-binding" class="section level2" number="12.1">
<h2>
<span class="header-section-number">12.1</span> Input bindings<a class="anchor" aria-label="anchor" href="#input-binding"><i class="fas fa-link"></i></a>
</h2>
<p>When we run our app, most of the time it works just fine. The question is, what is the magic behind? Upon initialization, Shiny runs several JavaScript functions. Some are accessible to the programmer, thought the <strong>Shiny</strong> JS object, already mentioned in section <a href="survival-kit-javascript.html#shiny-js-object">10.6.3</a>. To illustrate what they do, let’s run the app below:</p>
<p></p>
<div class="sourceCode" id="cb481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/dummy-app", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span></code></pre></div>
<p></p>
<p>We then open the HTML inspector and run <code>Shiny.unbindAll(document)</code>, document being the scope, that is where to search. Try to change the slider input. You will notice that nothing happens. Now let’s type <code>Shiny.bindAll(document)</code> and update the slider value. Moving the slider successfully update the plot. Magic isn’t it? This simply shows that when inputs are not bound, nothing happens so <strong>binding</strong> inputs is necessary.</p>
<p>We consider another example with multiple inputs and two buttons to bind/unbind inputs, respectively. Start it, change some input values, have a look at the corresponding text output. Click on unbind all and try to change some inputs. What happens? Click on bind and change another input value. What do you observe?</p>
<p></p>
<div class="sourceCode" id="cb482"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/bind-unbind", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span>
    <span class="st">"unbind"</span>,
    <span class="st">"Unbind inputs"</span>,
    onclick <span class="op">=</span> <span class="st">"Shiny.unbindAll();"</span>
  <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span>
    <span class="st">"bind"</span>,
    <span class="st">"Bind inputs"</span>,
    onclick <span class="op">=</span> <span class="st">"Shiny.bindAll();"</span>
  <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textInput.html">textInput</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"text_"</span>, <span class="va">i</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Text"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">uiOutput</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"val_"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">output</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"val_"</span>, <span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderPrint</a></span><span class="op">(</span><span class="op">{</span>
      <span class="va">input</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"text_"</span>, <span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>
    <span class="op">}</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p></p>
<p>Let’s see below what is an <strong>input binding</strong> and how it works.</p>
<div id="input-structure" class="section level3" number="12.1.1">
<h3>
<span class="header-section-number">12.1.1</span> Input structure<a class="anchor" aria-label="anchor" href="#input-structure"><i class="fas fa-link"></i></a>
</h3>
<p>In HTML, an input element is given by the <code>&lt;input&gt;</code> tag as well as several attributes.</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb483-1"><a href="shiny-input-system.html#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;input</span> <span class="er">id</span> <span class="ot">=</span> <span class="st">"id"</span> <span class="er">type</span> <span class="ot">=</span> <span class="st">"text"</span> <span class="er">class</span> <span class="ot">=</span> <span class="st">"..."</span> <span class="er">value</span> <span class="ot">=</span> <span class="st">value</span><span class="kw">&gt;</span></span></code></pre></div>
<ul>
<li>
<strong>id</strong> guarantees the input uniqueness and a way for shiny to recover it in the <code>input$&lt;id&gt;</code> element.</li>
<li>
<a href="https://www.w3schools.com/tags/att_input_type.asp">type</a> like <code>checkbox</code>, <code>button</code>,
<code>text</code> …<strong>type</strong> may also be a good target for the input binding find method, as explained below.</li>
<li>
<strong>class</strong> may be required to find the element in the DOM. It is more convenient for
an input binding to target a class (and all associated elements) rather than an id which corresponds to one element by definition. It is also used by CSS to apply styles.</li>
<li>
<strong>value</strong> holds the input value.</li>
</ul>
</div>
<div id="input-binding-steps" class="section level3" number="12.1.2">
<h3>
<span class="header-section-number">12.1.2</span> Binding Shiny inputs<a class="anchor" aria-label="anchor" href="#input-binding-steps"><i class="fas fa-link"></i></a>
</h3>
<p>An <strong>input binding</strong> allows Shiny to identify each <strong>instance</strong> of a given input and what you may do with this input. For instance, a slider input must update whenever the range is dragged or when the left and right arrows of the keyboard are pressed. It relies on a class defined in the <code>input_binding.js</code> <a href="https://github.com/rstudio/shiny/blob/60db1e02b03d8e6fb146c9bb1bbfbce269231add/srcjs/input_binding.js">file</a>.</p>
<p>Let’s describe each method chronologically. For better convenience, the book side package contains step by step demonstrations which may be found <a href="https://github.com/DivadNojnarg/OSUICode/blob/43911d32885e960d6f42c7bd7d92748109f29f00/R/inputs.R">here</a>. Each example is called by the <code><a href="https://rdrr.io/pkg/OSUICode/man/customTextInputExample.html">customTextInputExample()</a></code>, which takes the input binding step as only parameter. For instance <code><a href="https://rdrr.io/pkg/OSUICode/man/customTextInputExample.html">customTextInputExample(1)</a></code> will invoke the first step, while <code><a href="https://rdrr.io/pkg/OSUICode/man/customTextInputExample.html">customTextInputExample(4)</a></code> will include all steps from 1 to 4.</p>
<div id="find-the-input" class="section level4" number="12.1.2.1">
<h4>
<span class="header-section-number">12.1.2.1</span> Find the input<a class="anchor" aria-label="anchor" href="#find-the-input"><i class="fas fa-link"></i></a>
</h4>
<p>The first step, is critical which is to <strong>locate</strong> the input in the <strong>DOM</strong>. On the R side, we define an input, with a specific attribute that will serve as a <strong>receptor</strong> for the binding. For most of inputs, this may be handled by the <strong>type</strong> attribute. In other cases, this may be the <strong>class</strong>, like for the <code><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton()</a></code>. On the JS side, we need a method able to identify this receptor. Moreover, two different types of inputs (for instance <code>radioButton()</code> and <code><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput()</a></code>) cannot have the same receptor for conflict reasons, whereas two instances of the same input type can. If your app contains 10 sliders, they all share the same input binding, and this is where the thing is powerful since they are all bound in one step. The receptor identifier is provided by the <strong>find</strong> method of the <code>InputBinding</code> class. This method must be applied on a <strong>scope</strong>, that is the <code>document</code>. <code>find</code> accepts any valid jQuery selector:</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb484-1"><a href="shiny-input-system.html#cb484-1" aria-hidden="true" tabindex="-1"></a>find<span class="op">:</span> <span class="kw">function</span>(scope) {</span>
<span id="cb484-2"><a href="shiny-input-system.html#cb484-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">$</span>(scope)<span class="op">.</span><span class="fu">find</span>(<span class="st">'.input-text'</span>)<span class="op">;</span></span>
<span id="cb484-3"><a href="shiny-input-system.html#cb484-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="importantblock">
<p>Don’t forget the <code>return</code> statement. Omitting it would cause the binding step to fail, as well as all other downstream
steps.</p>
</div>
<p>Figure <a href="shiny-input-system.html#fig:shiny-find-inputs">12.2</a> summarizes this important step.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:shiny-find-inputs"></span>
<img src="images/survival-kit/shiny-find-inputs.png" alt="How to find inputs?" width="100%"><p class="caption">
FIGURE 12.2: How to find inputs?
</p>
</div>
<p></p>
<p>Below, we are going to re-create <code><a href="https://rdrr.io/pkg/shiny/man/textInput.html">textInput()</a></code> binding, step by step. As <a href="https://shiny.rstudio.com/">shiny</a> already provides bindings for the <code><a href="https://rdrr.io/pkg/shiny/man/textInput.html">textInput()</a></code>, we don’t want them to recognize our new input. Therefore, we add a new <code>input-text</code> class and make our own input binding pointing to that specific class:</p>
<p></p>
<div class="sourceCode" id="cb485"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">customTextInput</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span>
  <span class="va">inputId</span>, 
  <span class="va">label</span>, 
  <span class="va">value</span> <span class="op">=</span> <span class="st">""</span>, 
  <span class="va">width</span> <span class="op">=</span> <span class="cn">NULL</span>, 
  <span class="va">placeholder</span> <span class="op">=</span> <span class="cn">NULL</span>,
  <span class="va">binding_step</span>
<span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># this external wrapper ensure to control the input width</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"form-group shiny-input-container"</span>, 
    style <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"width: "</span>, <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/validateCssUnit.html">validateCssUnit</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>, <span class="st">";"</span><span class="op">)</span>
    <span class="op">}</span>,
    <span class="co"># input label</span>
    <span class="fu">shinyInputLabel</span><span class="op">(</span><span class="va">inputId</span>, <span class="va">label</span><span class="op">)</span>, 
    
    <span class="co"># input element + JS dependencies</span>
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/customTextInputDeps.html">customTextInputDeps</a></span><span class="op">(</span><span class="va">binding_step</span><span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">input</span><span class="op">(</span>
        id <span class="op">=</span> <span class="va">inputId</span>,
        type <span class="op">=</span> <span class="st">"text"</span>,
        class <span class="op">=</span> <span class="st">"form-control input-text"</span>,
        value <span class="op">=</span> <span class="va">value</span>,
        placeholder <span class="op">=</span> <span class="va">placeholder</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>The last part of the code contains a <code><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList()</a></code> with two elements:</p>
<ul>
<li>The element input binding, <code><a href="https://rdrr.io/pkg/OSUICode/man/customTextInputDeps.html">customTextInputDeps()</a></code>. <code>binding_step</code> allows us to review one step at a time, which is easier from a learning perspective.</li>
<li>The input tag.</li>
</ul>
<p>Below is an example of how we managed the dependency creation in the side package.
If we had multiple inputs, we would add more script to the dependency by passing a vector to the script parameter.</p>
<p></p>
<div class="sourceCode" id="cb486"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">customTextInputDeps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">binding_step</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"customTextBindings"</span>,
    version <span class="op">=</span> <span class="st">"1.0.0"</span>,
    src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span>
      <span class="st">"input-system/input-bindings"</span>, 
      package <span class="op">=</span> <span class="st">"OSUICode"</span>
    <span class="op">)</span><span class="op">)</span>,
    script <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span>
      <span class="st">"customTextInputBinding_"</span>, 
      <span class="va">binding_step</span>, 
      <span class="st">".js"</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>Figure <a href="shiny-input-system.html#fig:text-input">12.3</a> shows the main elements of the <code><a href="https://rdrr.io/pkg/shiny/man/textInput.html">textInput()</a></code> widget. In the above code, <code>shinyInputLabel</code> is a Shiny internal function that creates the numeric input label, or in other word the text displayed next to it. The core input element is wrapped by <code>tags$input</code>.</p>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:text-input"></span>
<img src="images/survival-kit/text-input.png" alt="Shiny's textInput elements." width="100%"><p class="caption">
FIGURE 12.3: Shiny’s textInput elements.
</p>
</div>
<p></p>
<p>We invite the reader to run the full working demonstration exposed below.</p>
<p></p>
<div class="sourceCode" id="cb487"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/binding-find", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/customTextInputExample.html">customTextInputExample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p></p>
<p>In short, this example consists in a simple text input and an output showing the current text input value:</p>
<p></p>
<div class="sourceCode" id="cb488"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">customTextInputExample</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">binding_step</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/customTextInput.html">customTextInput</a></span><span class="op">(</span>
      inputId <span class="op">=</span> <span class="st">"caption"</span>,
      label <span class="op">=</span> <span class="st">"Caption"</span>,
      value <span class="op">=</span> <span class="st">"Data Summary"</span>,
      binding_step <span class="op">=</span> <span class="va">binding_step</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">textOutput</a></span><span class="op">(</span><span class="st">"custom_text"</span><span class="op">)</span>
  <span class="op">)</span>
  <span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">output</span><span class="op">$</span><span class="va">custom_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderText</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">caption</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>We open the developer tools to inspect the <code>customTextInputBinding.js</code> script, put a breakpoints in the <code>find</code> method and reload the page. Upon reload, the JavaScript debugger opens, as shown Figure <a href="shiny-input-system.html#fig:binding-find">12.4</a>. Type <code>$(scope).find('.input-text')</code> in the console and see what is displayed. This is the DOM element which you may highlight when you hover over the JavaScript output.</p>
<p>Building input bindings like this significantly ease the debugging process and you’ll get more chances to be successful!</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:binding-find"></span>
<img src="images/survival-kit/binding-find.png" alt="Find is the first method triggered." width="100%"><p class="caption">
FIGURE 12.4: Find is the first method triggered.
</p>
</div>
<p></p>
<p>Now, let’s see why it is better to target elements by type or class. We run the below example.</p>
<p></p>
<div class="sourceCode" id="cb489"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/binding-find-2", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/customTextInputExampleBis.html">customTextInputExampleBis</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p></p>
<p>This is a demonstration app containing two text inputs. Moreover, the binding is modified so that it looks for element having a specific id:</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb490-1"><a href="shiny-input-system.html#cb490-1" aria-hidden="true" tabindex="-1"></a>find<span class="op">:</span> <span class="kw">function</span>(scope) {</span>
<span id="cb490-2"><a href="shiny-input-system.html#cb490-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">$</span>(scope)<span class="op">.</span><span class="fu">find</span>(<span class="st">'#mytextInput'</span>)<span class="op">;</span></span>
<span id="cb490-3"><a href="shiny-input-system.html#cb490-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>If you repeat the above debugging steps, <code>$(scope).find('.input-text')</code> only targets the
first text input, meaning that the second input will not be found and bound, as demonstrated in Figure <a href="shiny-input-system.html#fig:binding-find-by-id">12.5</a>.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:binding-find-by-id"></span>
<img src="images/survival-kit/binding-find-by-id.png" alt="Find by id is a rather bad idea." width="100%"><p class="caption">
FIGURE 12.5: Find by id is a rather bad idea.
</p>
</div>
<p></p>
<p>As a side note, you’ll also get an error in the binding (<code>Uncaught Not implemented</code>), indicating that the <code>getValue</code> method is not implemented yet. Fear not! We are going to add it very soon.</p>
</div>
<div id="initialize-inputs" class="section level4" number="12.1.2.2">
<h4>
<span class="header-section-number">12.1.2.2</span> Initialize inputs<a class="anchor" aria-label="anchor" href="#initialize-inputs"><i class="fas fa-link"></i></a>
</h4>
<p>Upon initialization, Shiny calls the <code>initializeInputs</code> function that takes all input bindings and call their <strong>initialize</strong> method before binding all inputs. Note that once an input has been initialized, it has a <code>_shiny_initialized</code> tag to avoid initializing it twice. The <code>initialize</code> method is not always defined but some elements require to be explicitly initialized or activated. For instance the <a href="https://framework7.io">Framework7</a> API, on top of which <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> <span class="citation">(<a href="references.html#ref-R-shinyMobile" role="doc-biblioref">Granjon, Perrier, and Rudolf 2021</a>)</span> is built, require to instantiate all elements. Below is an example for the <a href="https://framework7.io/docs/toggle.html">toggle</a> input:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb491-1"><a href="shiny-input-system.html#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="co">// what is expected</span></span>
<span id="cb491-2"><a href="shiny-input-system.html#cb491-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> toggle <span class="op">=</span> app<span class="op">.</span><span class="at">toggle</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb491-3"><a href="shiny-input-system.html#cb491-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">el</span><span class="op">:</span> <span class="st">'.toggle'</span><span class="op">,</span></span>
<span id="cb491-4"><a href="shiny-input-system.html#cb491-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">on</span><span class="op">:</span> {</span>
<span id="cb491-5"><a href="shiny-input-system.html#cb491-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">change</span><span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb491-6"><a href="shiny-input-system.html#cb491-6" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Toggle changed'</span>)</span>
<span id="cb491-7"><a href="shiny-input-system.html#cb491-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb491-8"><a href="shiny-input-system.html#cb491-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb491-9"><a href="shiny-input-system.html#cb491-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><code>el: '.toggle'</code> means that we are looking at the element(s) having the <code>toggle</code> class. <code>app.toggle.create</code> is internal to the Framework7 API. The corresponding <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> input binding starts as follows:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb492-1"><a href="shiny-input-system.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> f7ToggleBinding <span class="op">=</span> <span class="kw">new</span> Shiny<span class="op">.</span><span class="fu">InputBinding</span>()<span class="op">;</span></span>
<span id="cb492-2"><a href="shiny-input-system.html#cb492-2" aria-hidden="true" tabindex="-1"></a>  $<span class="op">.</span><span class="fu">extend</span>(f7ToggleBinding<span class="op">,</span> {</span>
<span id="cb492-3"><a href="shiny-input-system.html#cb492-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(el) {</span>
<span id="cb492-4"><a href="shiny-input-system.html#cb492-4" aria-hidden="true" tabindex="-1"></a>      app<span class="op">.</span><span class="at">toggle</span><span class="op">.</span><span class="fu">create</span>({<span class="dt">el</span><span class="op">:</span> el})<span class="op">;</span></span>
<span id="cb492-5"><a href="shiny-input-system.html#cb492-5" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb492-6"><a href="shiny-input-system.html#cb492-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// other methods</span></span>
<span id="cb492-7"><a href="shiny-input-system.html#cb492-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Once initialized, we may use all specific methods provided by the API. <a href="https://framework7.io">Framework7</a> is clearly a gold mine, as its API provides many possible options for many inputs/widgets. We provide more examples in Chapters <a href="mobile-shinyMobile.html#mobile-shinyMobile">23</a> and <a href="mobile-widgets.html#mobile-widgets">25</a>.</p>
</div>
<div id="get-the-value" class="section level4" number="12.1.2.3">
<h4>
<span class="header-section-number">12.1.2.3</span> Get the value<a class="anchor" aria-label="anchor" href="#get-the-value"><i class="fas fa-link"></i></a>
</h4>
<p>The <strong>getValue</strong> method returns the input value. The way to obtain the value is different for almost all inputs. For instance, the <code><a href="https://rdrr.io/pkg/shiny/man/textInput.html">textInput()</a></code> is pretty simple since the value is located in the <code>value</code> attribute. <strong>el</strong> refers to the element holding the id attribute and recognized by the <code>find</code> method. Figure <a href="shiny-input-system.html#fig:shiny-el">12.6</a> shows the result of a <code>console.log($(el));</code>.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:shiny-el"></span>
<img src="images/survival-kit/shiny-el.png" alt="About the el element." width="100%"><p class="caption">
FIGURE 12.6: About the el element.
</p>
</div>
<p></p>
<div class="sourceCode" id="cb493"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb493-1"><a href="shiny-input-system.html#cb493-1" aria-hidden="true" tabindex="-1"></a>getValue<span class="op">:</span> <span class="kw">function</span>(el) {</span>
<span id="cb493-2"><a href="shiny-input-system.html#cb493-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="fu">$</span>(el))<span class="op">;</span></span>
<span id="cb493-3"><a href="shiny-input-system.html#cb493-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">val</span>()<span class="op">;</span></span>
<span id="cb493-4"><a href="shiny-input-system.html#cb493-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>To get the value, we apply the jQuery method <code>val</code> on the <code>$(el)</code> element and return the result.</p>
<div class="importantblock">
<p>Don’t forget the <code>return</code> statement.</p>
</div>
<p>Similarly as in the find section, we run the below example and open the developer tools to inspect the <code>customTextInputBinding_2.js</code> script.</p>
<p></p>
<div class="sourceCode" id="cb494"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/binding-get", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/customTextInputExample.html">customTextInputExample</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p></p>
<p>We put a breakpoints in the <code>getValue</code> method and reload the page. Upon reload, the JavaScript debugger opens starts in <code>find</code>. You may click on the next blue arrow to jump to the next breakpoints that is <code>getValue</code>, as shown Figure <a href="shiny-input-system.html#fig:binding-getValue">12.7</a>. Typing <code>$(el).val()</code> in the console shows the current
text value.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:binding-getValue"></span>
<img src="images/survival-kit/binding-getValue.png" alt="getValue returns the current input value." width="100%"><p class="caption">
FIGURE 12.7: getValue returns the current input value.
</p>
</div>
<p></p>
<p>Clicking on next again exit the debugger. Interestingly, you’ll notice that a text appears below the input, meaning that the <code>input$caption</code> element exists and is internally tracked by shiny. Notice that when you try to change the text content, the output value does not update as we would normally expect. We are actually omitting a couple of methods so preventing the binding from being fully functional. We will introduce them in the following sections!</p>
</div>
<div id="set-and-update" class="section level4" number="12.1.2.4">
<h4>
<span class="header-section-number">12.1.2.4</span> Set and update<a class="anchor" aria-label="anchor" href="#set-and-update"><i class="fas fa-link"></i></a>
</h4>
<p><strong>setValue</strong> is used to set the value of the current input. This method is necessary so that the input value may be <strong>updated</strong>. It has to be used in combination with <strong>receiveMessage</strong>, which is the JavaScript part of all the R <strong>update<input_name>Input</input_name></strong> functions, like <code><a href="https://rdrr.io/pkg/shiny/man/updateTextInput.html">updateTextInput()</a></code>. We usually call the <code>setValue</code> method inside.</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb495-1"><a href="shiny-input-system.html#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="co">// el is the DOM element.</span></span>
<span id="cb495-2"><a href="shiny-input-system.html#cb495-2" aria-hidden="true" tabindex="-1"></a><span class="co">// value represents the new value.</span></span>
<span id="cb495-3"><a href="shiny-input-system.html#cb495-3" aria-hidden="true" tabindex="-1"></a>setValue<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> value) {</span>
<span id="cb495-4"><a href="shiny-input-system.html#cb495-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">val</span>(value)<span class="op">;</span></span>
<span id="cb495-5"><a href="shiny-input-system.html#cb495-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s create a function to update our custom text input. Call it <code>updateCustomTextInput</code>. It requires at least three parameters:</p>
<ul>
<li>
<strong>inputId</strong> tells which input to update.</li>
<li>
<strong>value</strong> is the new value. This will be taken by the <code>setValue</code> JS method in the input binding.</li>
<li>
<strong>session</strong> is the Shiny session object mentioned earlier in section <a href="shiny-intro.html#shiny-session">11.5.1</a>. We will use the <strong>sendInputMessage</strong> to send values from R to JavaScript. The <code>receiveMessage</code> method will apply <code>setValue</code> with the data received from R. The current session is recovered with <code><a href="https://rdrr.io/pkg/shiny/man/domains.html">getDefaultReactiveDomain()</a></code>.</li>
</ul>
<p></p>
<div class="sourceCode" id="cb496"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">updateCustomTextInput</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
  <span class="va">inputId</span>, 
  <span class="va">value</span> <span class="op">=</span> <span class="cn">NULL</span>, 
  <span class="va">session</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/domains.html">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span> <span class="op">{</span>
  <span class="va">session</span><span class="op">$</span><span class="fu">sendInputMessage</span><span class="op">(</span><span class="va">inputId</span>, message <span class="op">=</span> <span class="va">value</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>We add <code>setValue</code> and <code>receiveMessage</code> to custom input binding.</p>
<p>Figure <a href="shiny-input-system.html#fig:shiny-update-inputs">12.8</a> illustrates the main mechanisms.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:shiny-update-inputs"></span>
<img src="images/survival-kit/shiny-update-inputs.png" alt="Events following a click on the update button. This figure demonstrates how R and JS communicate, through the websocket." width="100%"><p class="caption">
FIGURE 12.8: Events following a click on the update button. This figure demonstrates how R and JS communicate, through the websocket.
</p>
</div>
<p></p>
<p>If we have to pass multiple elements to update, we would have to change the <code>updateCustomTextInput</code> function such as:</p>
<p></p>
<div class="sourceCode" id="cb497"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">updateCustomTextInput</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
  <span class="va">inputId</span>, 
  <span class="va">value</span> <span class="op">=</span> <span class="cn">NULL</span>, 
  <span class="va">placeholder</span> <span class="op">=</span> <span class="cn">NULL</span>, 
  <span class="va">session</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/domains.html">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span> <span class="op">{</span>
  <span class="va">message</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/dropNulls.html">dropNulls</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      value <span class="op">=</span> <span class="va">value</span>,
      placeholder <span class="op">=</span> <span class="va">placeholder</span>
    <span class="op">)</span>
  <span class="op">)</span>
  <span class="va">session</span><span class="op">$</span><span class="fu">sendInputMessage</span><span class="op">(</span><span class="va">inputId</span>, <span class="va">message</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p><code>shiny:::dropNulls</code> is an internal function ensuring that the list does not contain <code>NULL</code> elements. We send a list from R, which is then serialized to a JSON object. In the <code>receiveMessage</code> method, properties like <code>value</code> may be accessed using the <code>.</code> notation. It is good practice to add a <code>data.hasOwnProperty</code> check to avoid running code
if the specified property does not exist:</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb498-1"><a href="shiny-input-system.html#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="co">// data are received from R. </span></span>
<span id="cb498-2"><a href="shiny-input-system.html#cb498-2" aria-hidden="true" tabindex="-1"></a><span class="co">// It is a JS object. </span></span>
<span id="cb498-3"><a href="shiny-input-system.html#cb498-3" aria-hidden="true" tabindex="-1"></a>receiveMessage<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> data) {</span>
<span id="cb498-4"><a href="shiny-input-system.html#cb498-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(data)<span class="op">;</span></span>
<span id="cb498-5"><a href="shiny-input-system.html#cb498-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (data<span class="op">.</span><span class="fu">hasOwnProperty</span>(<span class="st">'value'</span>)) {</span>
<span id="cb498-6"><a href="shiny-input-system.html#cb498-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">setValue</span>(el<span class="op">,</span> data<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb498-7"><a href="shiny-input-system.html#cb498-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb498-8"><a href="shiny-input-system.html#cb498-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// other parameters to update...</span></span>
<span id="cb498-9"><a href="shiny-input-system.html#cb498-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="noteblock">
<p><strong>this</strong> refers to the custom text input binding class (which is an object), so that <code>this.setValue</code> allows to call
the <code>setValue</code> method …</p>
</div>
<p>Similarly as in the previous sections, we run <code><a href="https://rdrr.io/pkg/OSUICode/man/updateCustomTextInputExample.html">updateCustomTextInputExample(3)</a></code> and open the developer tools to inspect the <code>customTextInputBinding_3.js</code> script.</p>
<p></p>
<div class="sourceCode" id="cb499"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/binding-receive", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/updateCustomTextInputExample.html">updateCustomTextInputExample</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<p></p>
<p>We put a breakpoints in the <code>receiveMessage</code> and <code>setValue</code> methods and reload the page. Upon reload, the JavaScript debugger opens starts in <code>find</code>. You may click on the next blue arrow until you reach <code>receiveMessage</code>, as shown Figure <a href="shiny-input-system.html#fig:binding-receive">12.9</a>. Inspecting the <code>data</code> object, it contains only one property namely the value. In practice, there may be more complex structure. As an exercise, you may change the <code>data.value</code> to whatever value you want.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:binding-receive"></span>
<img src="images/survival-kit/binding-receive.png" alt="Receive a message from R." width="100%"><p class="caption">
FIGURE 12.9: Receive a message from R.
</p>
</div>
<p></p>
<p>Click on the next arrow makes us jump in the next call that is <code>setValue</code>, where we can print the value to check whether it is correct. Running <code>$(el).val(value);</code> in the debugger console instantaneously update the DOM element with the new text, as shown on Figure <a href="shiny-input-system.html#fig:binding-setValue">12.10</a>.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:binding-setValue"></span>
<img src="images/survival-kit/binding-setValue.png" alt="Set the new value." width="100%"><p class="caption">
FIGURE 12.10: Set the new value.
</p>
</div>
<p></p>
<p>So far so good. We managed to update the text input value on the client. Yet, after clicking the button, the output value still does not change. We are going to fix this missing step in the next section.</p>
</div>
<div id="subscribe" class="section level4" number="12.1.2.5">
<h4>
<span class="header-section-number">12.1.2.5</span> Subscribe<a class="anchor" aria-label="anchor" href="#subscribe"><i class="fas fa-link"></i></a>
</h4>
<p><strong>subscribe</strong> listens to <strong>events</strong> defining Shiny to update the input value and make it available in the app. Some API like Bootstrap explicitly mention those events (like <code>hide.bs.tab</code>, <code>shown.bs.tab</code>, …).
Going back to our custom text input, what event would make it change?</p>
<ul>
<li>After a key is release on the keyboard. We may listen to <code>keyup</code>.</li>
<li>After copying and pasting any text in the input field or dictating text. The <code>input</code> event may be helpful.</li>
</ul>
<p>We add those <a href="https://javascript.info/events-change-input">events</a> to our binding using an <strong>event listener</strong> seen in Chapter <a href="survival-kit-javascript.html#survival-kit-javascript">10</a>.</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb500-1"><a href="shiny-input-system.html#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(el)<span class="op">.</span><span class="fu">on</span>(</span>
<span id="cb500-2"><a href="shiny-input-system.html#cb500-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'keyup.customTextBinding input.customTextBinding'</span><span class="op">,</span> </span>
<span id="cb500-3"><a href="shiny-input-system.html#cb500-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb500-4"><a href="shiny-input-system.html#cb500-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">callback</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb500-5"><a href="shiny-input-system.html#cb500-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<div class="noteblock">
<p>Notice the event structure: <code>EVENT_NAME.BINDING_NAME</code>. It is best practice to follow this
convention.</p>
</div>
<p>The <strong>callback</strong> parameter ensures that the new value is captured by Shiny. Chapter <a href="shiny-input-lifecycle.html#shiny-input-lifecycle">13</a> provides more details, but this is quite technical.</p>
<p></p>
<div class="sourceCode" id="cb501"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/binding-subscribe", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/updateCustomTextInputExample.html">updateCustomTextInputExample</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></code></pre></div>
<p></p>
<p>We run the above example, open the HTML inspector, select the <code>customTextInputBinding_4.js</code> script and put a break point in the <code>getValue</code> as well as <code>subscribe</code> method. We enter a new text inside the input field, which triggers the debugger inside the <code>subscribe</code> call. Inspecting the event object, the type indicate the action, which is an input action and the target is the text input element itself, depicted on Figure <a href="shiny-input-system.html#fig:binding-subscribe-1">12.11</a>.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:binding-subscribe-1"></span>
<img src="images/survival-kit/binding-subscribe-1.png" alt="Subscribe method after the text input manual update." width="100%"><p class="caption">
FIGURE 12.11: Subscribe method after the text input manual update.
</p>
</div>
<p></p>
<p>We click on next and notice that we go back in the <code>getValue</code> method to get the new value.
You may check typing <code>$(el).val()</code> in the debugger console, like on Figure <a href="shiny-input-system.html#fig:binding-subscribe-2">12.12</a>. Clicking next again shows the updated output value.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:binding-subscribe-2"></span>
<img src="images/survival-kit/binding-subscribe-2.png" alt="Subscribe is followed by a new getValue." width="100%"><p class="caption">
FIGURE 12.12: Subscribe is followed by a new getValue.
</p>
</div>
<p></p>
<p>Hooray! The output result is successfully changed when the input value is manually updated. However, it is not modified when we click on the update button. What did we miss? Looking back at the <code>receiveMessage</code> method, we changed the input value but how does Shiny knows that this step was successful? To check that no event is raised, we put a <code>console.log(event);</code> in the <code>subscribe</code> method. Any action like removing the text content or adding new text triggers event but clicking on the action button does not. Therefore, we must trigger an event and add it to the <code>subscribe</code> method. We may choose the <code>change</code> event, that triggers when an element is updated. Notice the parameter passed to callback. We discuss it in the next part!</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb502-1"><a href="shiny-input-system.html#cb502-1" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(el)<span class="op">.</span><span class="fu">on</span>(<span class="st">'change.customTextBinding'</span><span class="op">,</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb502-2"><a href="shiny-input-system.html#cb502-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">callback</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb502-3"><a href="shiny-input-system.html#cb502-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Besides, in the <code>receiveMessage</code> we must trigger a <code>change</code> event to trigger the subscribe method:</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb503-1"><a href="shiny-input-system.html#cb503-1" aria-hidden="true" tabindex="-1"></a>receiveMessage<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> data) {</span>
<span id="cb503-2"><a href="shiny-input-system.html#cb503-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (data<span class="op">.</span><span class="fu">hasOwnProperty</span>(<span class="st">'value'</span>)) {</span>
<span id="cb503-3"><a href="shiny-input-system.html#cb503-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">setValue</span>(el<span class="op">,</span> data<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb503-4"><a href="shiny-input-system.html#cb503-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">trigger</span>(<span class="st">'change'</span>)<span class="op">;</span></span>
<span id="cb503-5"><a href="shiny-input-system.html#cb503-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb503-6"><a href="shiny-input-system.html#cb503-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s try again.</p>
<p></p>
<div class="sourceCode" id="cb504"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/binding-subscribe-2", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/updateCustomTextInputExample.html">updateCustomTextInputExample</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<p></p>
<p>We put a new break point in the second event listener, that is the one for the change event. Clicking on the button only triggers the change event, as shown Figure <a href="shiny-input-system.html#fig:binding-subscribe-3">12.13</a>.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:binding-subscribe-3"></span>
<img src="images/survival-kit/binding-subscribe-3.png" alt="Add multiple event listeners inside the subscribe method." width="100%"><p class="caption">
FIGURE 12.13: Add multiple event listeners inside the subscribe method.
</p>
</div>
<p></p>
<div class="warningblock">
<p>… In some situations, we have to be careful with the <strong>this</strong> element. Indeed, called in an event listener, <code>this</code> refers to the element that triggered the event and not to the input binding object. For instance below is an example where we need to trigger the <code>getValue</code> method inside an event listener located in the <code>subscribe</code> method. If you call <code>this.getValue(el)</code>, you’ll get an error. The trick consists in creating a variable namely <strong>self</strong> that take <code>this</code> as value, outside the event listener. In that case <code>self</code> refers to the binding itself and it make sens to call <code>self.getValue(el)</code>:</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb505-1"><a href="shiny-input-system.html#cb505-1" aria-hidden="true" tabindex="-1"></a>subscribe<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> callback) {</span>
<span id="cb505-2"><a href="shiny-input-system.html#cb505-2" aria-hidden="true" tabindex="-1"></a>  self <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb505-3"><a href="shiny-input-system.html#cb505-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">on</span>(<span class="st">'click.button'</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb505-4"><a href="shiny-input-system.html#cb505-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> currentVal <span class="op">=</span> self<span class="op">.</span><span class="fu">getValue</span>(el)<span class="op">;</span></span>
<span id="cb505-5"><a href="shiny-input-system.html#cb505-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">val</span>(currentVal <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb505-6"><a href="shiny-input-system.html#cb505-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">callback</span>()<span class="op">;</span></span>
<span id="cb505-7"><a href="shiny-input-system.html#cb505-7" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb505-8"><a href="shiny-input-system.html#cb505-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>Perfect? Not exactly.</p>
</div>
<div id="setting-rate-policies" class="section level4" number="12.1.2.6">
<h4>
<span class="header-section-number">12.1.2.6</span> Setting rate policies<a class="anchor" aria-label="anchor" href="#setting-rate-policies"><i class="fas fa-link"></i></a>
</h4>
<p>It would be better to only change the input value once the keyboard is completely released for some time (and not each time a key is released). This is what we call <strong>debouncing</strong>, which allows a <strong>delay</strong> before telling Shiny to read the new value, and is achieved using the <strong>getRatePolicy</strong> method. Additionally, we must also pass <code>true</code> to the <code>callback</code> in the subscribe method, in order to apply our specific rate policy (<a href="https://davidwalsh.name/javascript-debounce-function">debounce</a>, throttle). This is useful for instance when we don’t want to flood the server with useless update requests. For example when using a slider, we only want to send the value as soon as the range stops moving and not all intermediate values. Those elements are defined <a href="https://github.com/rstudio/shiny/blob/60db1e02b03d8e6fb146c9bb1bbfbce269231add/srcjs/input_rate.js">here</a>.</p>
<p>Run the below app and try to manually change the text input value by adding a couple of letters as fast as you can. What do you notice? We see the output value only updates when we release the keyboard.</p>
<p></p>
<div class="sourceCode" id="cb506"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/binding-rate-policies", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/updateCustomTextInputExample.html">updateCustomTextInputExample</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></code></pre></div>
<p></p>
<p>You may adjust the delay according to your needs, but we caution to not set the delay too long as this becomes problematic too (unnecessary lags).</p>
<p>If you want to get an overview of all binding steps, you may try the following <a href="https://rinterface.com/shiny/talks/RPharma2020/?panelset1=r-code2#45">slide</a> from the 2020 R in Pharma workshop.</p>
</div>
<div id="register-an-input-binding" class="section level4" number="12.1.2.7">
<h4>
<span class="header-section-number">12.1.2.7</span> Register an input binding<a class="anchor" aria-label="anchor" href="#register-an-input-binding"><i class="fas fa-link"></i></a>
</h4>
<p>At the end of the input binding definition, we register it for Shiny.</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb507-1"><a href="shiny-input-system.html#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> myBinding <span class="op">=</span> <span class="kw">new</span> Shiny<span class="op">.</span><span class="fu">inputBinding</span>()<span class="op">;</span></span>
<span id="cb507-2"><a href="shiny-input-system.html#cb507-2" aria-hidden="true" tabindex="-1"></a>  $<span class="op">.</span><span class="fu">extend</span>(myBinding<span class="op">,</span> {</span>
<span id="cb507-3"><a href="shiny-input-system.html#cb507-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// methods go here</span></span>
<span id="cb507-4"><a href="shiny-input-system.html#cb507-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb507-5"><a href="shiny-input-system.html#cb507-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb507-6"><a href="shiny-input-system.html#cb507-6" aria-hidden="true" tabindex="-1"></a>Shiny<span class="op">.</span><span class="at">inputBindings</span><span class="op">.</span><span class="fu">register</span>(</span>
<span id="cb507-7"><a href="shiny-input-system.html#cb507-7" aria-hidden="true" tabindex="-1"></a>  myBinding<span class="op">,</span> </span>
<span id="cb507-8"><a href="shiny-input-system.html#cb507-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">'PACKAGE_NAME.BINDING_NAME'</span></span>
<span id="cb507-9"><a href="shiny-input-system.html#cb507-9" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div>
<p>Best practice is to name it following <code>PACKAGE_NAME.BINDING_NAME</code>, to avoid conflicts.
Although the Shiny <a href="https://shiny.rstudio.com/articles/building-inputs.html">documentation</a> mentions a <code>Shiny.inputBindings.setPriority</code> method to handle conflicting bindings, if you respect the above convention, this case almost never happens.</p>
<p>As a side note, if you think that the binding name is useless, have a look at the <code>{shinytest}</code> internal structure.
Under the hood, it has a <a href="https://github.com/rstudio/shinytest/blob/dea2ecc9f9d87f98fa109a6959b07d3e6e3ff4f3/R/shiny-mapping.R#L56">file</a> which maps all input elements:</p>
<p></p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="shiny-input-system.html#cb508-1" aria-hidden="true" tabindex="-1"></a>widget_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb508-2"><a href="shiny-input-system.html#cb508-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"shiny.actionButtonInput"</span>  <span class="ot">=</span> <span class="st">"actionButton"</span>,</span>
<span id="cb508-3"><a href="shiny-input-system.html#cb508-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"shiny.checkboxInput"</span>      <span class="ot">=</span> <span class="st">"checkboxInput"</span>,</span>
<span id="cb508-4"><a href="shiny-input-system.html#cb508-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"shiny.checkboxGroupInput"</span> <span class="ot">=</span> <span class="st">"checkboxGroupInput"</span>,</span></code></pre></div>
<p></p>
<p>Guess what? Those names are the one given during the input binding registration!</p>
</div>
<div id="other-binding-methods" class="section level4" number="12.1.2.8">
<h4>
<span class="header-section-number">12.1.2.8</span> Other binding methods<a class="anchor" aria-label="anchor" href="#other-binding-methods"><i class="fas fa-link"></i></a>
</h4>
<p>There are a couple of methods not described above that are contained in the <code>InputBinding</code> class <strong>prototype</strong>. They were not described before since most of the time, we don’t need to change them and can rely on the defaults:</p>
<ul>
<li>
<strong>getId</strong> returns the object id (Figure <a href="shiny-input-system.html#fig:binding-getId">12.14</a>). If you don’t provide your own method, the binding falls back to the default one provided in the <code>InputBinding</code> class. This method is called after <code>find</code>. The next Chapter <a href="shiny-input-lifecycle.html#shiny-input-lifecycle">13</a> provides more details.</li>
<li>
<strong>getType</strong> required to handle custom data format. It is called after <code>getId</code>. An entire section <a href="shiny-input-system.html#custom-data-format">12.4</a> is dedicated.</li>
</ul>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:binding-getId"></span>
<img src="images/survival-kit/binding-getId.png" alt="The binding getId method." width="100%"><p class="caption">
FIGURE 12.14: The binding getId method.
</p>
</div>
<p></p>
</div>
</div>
<div id="edit-input-binding" class="section level3" number="12.1.3">
<h3>
<span class="header-section-number">12.1.3</span> Edit an input binding<a class="anchor" aria-label="anchor" href="#edit-input-binding"><i class="fas fa-link"></i></a>
</h3>
<p>In some cases, we would like to access the input binding and change its default behavior, even though not always recommended, since it will affect <strong>all</strong> related inputs. As bindings are contained in a registry, namely <code>Shiny.inputBindings</code>, one may seamlessly access and modify them. This is a five steps process:</p>
<ol style="list-style-type: decimal">
<li>Wait for the <code>shiny:connected</code> <a href="https://shiny.rstudio.com/articles/js-events.html">event</a>, so that the <code>Shiny</code> JS
object exists.</li>
<li>Unbind all inputs with <code>Shiny.unbindAll()</code>.</li>
<li>Access the binding registry, <code>Shiny.inputBindings</code>.</li>
<li>Extend the binding and edit its content with <code>$.extend(... {...})</code>
</li>
<li>Apply the new changes with <code>Shiny.bindAll()</code>.</li>
</ol>
<div class="sourceCode" id="cb509"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb509-1"><a href="shiny-input-system.html#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="kw">function</span>() {</span>
<span id="cb509-2"><a href="shiny-input-system.html#cb509-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(<span class="bu">document</span>)<span class="op">.</span><span class="fu">on</span>(<span class="st">'shiny:connected'</span><span class="op">,</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb509-3"><a href="shiny-input-system.html#cb509-3" aria-hidden="true" tabindex="-1"></a>    Shiny<span class="op">.</span><span class="fu">unbindAll</span>()<span class="op">;</span></span>
<span id="cb509-4"><a href="shiny-input-system.html#cb509-4" aria-hidden="true" tabindex="-1"></a>    $<span class="op">.</span><span class="fu">extend</span>(Shiny</span>
<span id="cb509-5"><a href="shiny-input-system.html#cb509-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="at">inputBindings</span></span>
<span id="cb509-6"><a href="shiny-input-system.html#cb509-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="at">bindingNames</span>[<span class="st">'shiny.actionButtonInput'</span>]</span>
<span id="cb509-7"><a href="shiny-input-system.html#cb509-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="at">binding</span><span class="op">,</span> {</span>
<span id="cb509-8"><a href="shiny-input-system.html#cb509-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// do whathever you want to edit existing methods</span></span>
<span id="cb509-9"><a href="shiny-input-system.html#cb509-9" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb509-10"><a href="shiny-input-system.html#cb509-10" aria-hidden="true" tabindex="-1"></a>    Shiny<span class="op">.</span><span class="fu">bindAll</span>()<span class="op">;</span></span>
<span id="cb509-11"><a href="shiny-input-system.html#cb509-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb509-12"><a href="shiny-input-system.html#cb509-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
</div>
<div id="update-binding-client" class="section level3" number="12.1.4">
<h3>
<span class="header-section-number">12.1.4</span> Update a binding from the client<a class="anchor" aria-label="anchor" href="#update-binding-client"><i class="fas fa-link"></i></a>
</h3>
<p>The interest of <code>receiveMessage</code> and <code>setValue</code> is to be able to update the input
from the server side, that is R, through the <code>session$sendInputMessage</code>. Yet,
this task might be done directly on the client, thereby lowering the load on the server.
We consider the following example: a shiny app contains two actions buttons, clicking on the first one
increases the value of the second by 10. This won’t be possible with the classic approach since a button click
only increases its value by 1. How do we proceed?</p>
<ol style="list-style-type: decimal">
<li>We first set an event listener on the first button.</li>
<li>We target the second button and get the input binding with <code>$obj.data('shiny-input-binding')</code>.</li>
<li>We recover the current value.</li>
<li>We call the <code>setValue</code> method, adding 10 to the current value.</li>
<li>Importantly, to let Shiny update the value on the R side, we must trigger an event that will be detected in the <code>subscribe</code> method. The action button only has one event listener but other may be added. Don’t forget that triggering a <code>click</code> event would also increment the button value by 1! In the following we have to customize the <code>subscribe</code> method to work around:</li>
</ol>
<div class="sourceCode" id="cb510"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb510-1"><a href="shiny-input-system.html#cb510-1" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="kw">function</span>() {</span>
<span id="cb510-2"><a href="shiny-input-system.html#cb510-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// each time we click on #test (a button)</span></span>
<span id="cb510-3"><a href="shiny-input-system.html#cb510-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(<span class="st">'#button1'</span>)<span class="op">.</span><span class="fu">on</span>(<span class="st">'click'</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb510-4"><a href="shiny-input-system.html#cb510-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> $obj <span class="op">=</span> <span class="fu">$</span>(<span class="st">'#button2'</span>)<span class="op">;</span></span>
<span id="cb510-5"><a href="shiny-input-system.html#cb510-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> inputBinding <span class="op">=</span> $obj<span class="op">.</span><span class="fu">data</span>(<span class="st">'shiny-input-binding'</span>)<span class="op">;</span></span>
<span id="cb510-6"><a href="shiny-input-system.html#cb510-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> val <span class="op">=</span> $obj<span class="op">.</span><span class="fu">data</span>(<span class="st">'val'</span>) <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb510-7"><a href="shiny-input-system.html#cb510-7" aria-hidden="true" tabindex="-1"></a>    inputBinding<span class="op">.</span><span class="fu">setValue</span>($obj<span class="op">,</span> val <span class="op">+</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb510-8"><a href="shiny-input-system.html#cb510-8" aria-hidden="true" tabindex="-1"></a>    $obj<span class="op">.</span><span class="fu">trigger</span>(<span class="st">'event'</span>)<span class="op">;</span></span>
<span id="cb510-9"><a href="shiny-input-system.html#cb510-9" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb510-10"><a href="shiny-input-system.html#cb510-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>If you click on the second button, the value increments only by 1 and the plot will be only visible after 10 clicks, while only 1 click is necessary on the first button. The reset button resets the second action button value to 0.</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb511-1"><a href="shiny-input-system.html#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="st">'#reset'</span>)<span class="op">.</span><span class="fu">on</span>(<span class="st">'click'</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb511-2"><a href="shiny-input-system.html#cb511-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> $obj <span class="op">=</span> <span class="fu">$</span>(<span class="st">'#button2'</span>)<span class="op">;</span></span>
<span id="cb511-3"><a href="shiny-input-system.html#cb511-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> inputBinding <span class="op">=</span> $obj<span class="op">.</span><span class="fu">data</span>(<span class="st">'shiny-input-binding'</span>)<span class="op">;</span></span>
<span id="cb511-4"><a href="shiny-input-system.html#cb511-4" aria-hidden="true" tabindex="-1"></a>  inputBinding<span class="op">.</span><span class="fu">reset</span>($obj)<span class="op">;</span></span>
<span id="cb511-5"><a href="shiny-input-system.html#cb511-5" aria-hidden="true" tabindex="-1"></a>  $obj<span class="op">.</span><span class="fu">trigger</span>(<span class="st">'change'</span>)<span class="op">;</span></span>
<span id="cb511-6"><a href="shiny-input-system.html#cb511-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>It implements the feature discussed in the previous part, where we extend the button binding to add a <code>reset</code> method and edit the <code>subscribe</code> method to add a <code>change</code> event listener, simply telling shiny to get the new value. Contrary to <code>click</code>, <code>change</code> does not increment the button value, which is exactly what we want.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb512-1"><a href="shiny-input-system.html#cb512-1" aria-hidden="true" tabindex="-1"></a>$<span class="op">.</span><span class="fu">extend</span>(</span>
<span id="cb512-2"><a href="shiny-input-system.html#cb512-2" aria-hidden="true" tabindex="-1"></a>  Shiny</span>
<span id="cb512-3"><a href="shiny-input-system.html#cb512-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="at">inputBindings</span></span>
<span id="cb512-4"><a href="shiny-input-system.html#cb512-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="at">bindingNames</span>[<span class="st">'shiny.actionButtonInput'</span>]</span>
<span id="cb512-5"><a href="shiny-input-system.html#cb512-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="at">binding</span><span class="op">,</span> {</span>
<span id="cb512-6"><a href="shiny-input-system.html#cb512-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reset</span><span class="op">:</span> <span class="kw">function</span>(el) {</span>
<span id="cb512-7"><a href="shiny-input-system.html#cb512-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">data</span>(<span class="st">'val'</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb512-8"><a href="shiny-input-system.html#cb512-8" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb512-9"><a href="shiny-input-system.html#cb512-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">subscribe</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> callback) {</span>
<span id="cb512-10"><a href="shiny-input-system.html#cb512-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">on</span>(<span class="st">'click.actionButtonInputBinding'</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb512-11"><a href="shiny-input-system.html#cb512-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> $el <span class="op">=</span> <span class="fu">$</span>(<span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb512-12"><a href="shiny-input-system.html#cb512-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> val <span class="op">=</span> $el<span class="op">.</span><span class="fu">data</span>(<span class="st">'val'</span>) <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb512-13"><a href="shiny-input-system.html#cb512-13" aria-hidden="true" tabindex="-1"></a>      $el<span class="op">.</span><span class="fu">data</span>(<span class="st">'val'</span><span class="op">,</span> val <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb512-14"><a href="shiny-input-system.html#cb512-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-15"><a href="shiny-input-system.html#cb512-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">callback</span>()<span class="op">;</span></span>
<span id="cb512-16"><a href="shiny-input-system.html#cb512-16" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb512-17"><a href="shiny-input-system.html#cb512-17" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb512-18"><a href="shiny-input-system.html#cb512-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// this does not trigger any click and won't change </span></span>
<span id="cb512-19"><a href="shiny-input-system.html#cb512-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// the button value            </span></span>
<span id="cb512-20"><a href="shiny-input-system.html#cb512-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">on</span>(<span class="st">'change.actionButtonInputBinding'</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb512-21"><a href="shiny-input-system.html#cb512-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">callback</span>()<span class="op">;</span></span>
<span id="cb512-22"><a href="shiny-input-system.html#cb512-22" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb512-23"><a href="shiny-input-system.html#cb512-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb512-24"><a href="shiny-input-system.html#cb512-24" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The whole JS code is found <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/blob/b95f656bce9de7600c05b5045a4e005f70c4f83d/inst/input-system/input-bindings/editBinding.js#L1">here</a> and below is the related app. It is available as an HTML dependency with <code><a href="https://rdrr.io/pkg/OSUICode/man/editBindingDeps.html">OSUICode::editBindingDeps()</a></code>.</p>
<p></p>
<div class="sourceCode" id="cb513"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/edit-binding-client", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span></code></pre></div>
<p></p>
<p>whose output is shown Figure <a href="shiny-input-system.html#fig:edit-binding-demo">12.15</a>.</p>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:edit-binding-demo"></span>
<img src="images/survival-kit/edit-binding-demo.png" alt="Edit and trigger an input binding from the client." width="75%"><p class="caption">
FIGURE 12.15: Edit and trigger an input binding from the client.
</p>
</div>
<p></p>
<p>This trick has been extensively used in the <a href="https://community.rstudio.com/t/shiny-contest-submission-a-virtual-lab-for-teaching-physiology/25348">virtual physiology simulator</a> to trigger <a href="https://dgranjon.shinyapps.io/entry_level/">animations</a>.</p>
<p>Another example of accessing a binding method from the client is found in the <a href="http://rstudio.github.io/shinydashboard/">shinydashboard</a> <a href="https://github.com/rstudio/shinydashboard/blob/dc1e15b39b7198286373643e8e4417867548c467/srcjs/sidebar.js#L29">package</a>.</p>
</div>
</div>
<div id="secondary-inputs" class="section level2" number="12.2">
<h2>
<span class="header-section-number">12.2</span> Secondary inputs<a class="anchor" aria-label="anchor" href="#secondary-inputs"><i class="fas fa-link"></i></a>
</h2>
<p>The Shiny input binding system is too convenient to be only used for <strong>primary</strong> input elements like <code><a href="https://rdrr.io/pkg/shiny/man/textInput.html">textInput()</a></code>, <code><a href="https://rdrr.io/pkg/shiny/man/numericInput.html">numericInput()</a></code>. It is a super powerful tool to unleash apps’s <strong>interactivity</strong>. In the following, we show how to add an input to an element that was not primarily designed to be a user input, also non officially denoted as <strong>secondary</strong> inputs.</p>
<div class="warningblock">
<p>By convention, we’ll not use <code>inputId</code> but <code>id</code> for secondary inputs, which is the case in all the new versions of RinteRface packages like <a href="https://rinterface.github.io/bs4Dash/index.html">bs4Dash</a>.</p>
</div>
<div id="boxes-on-steroids" class="section level3" number="12.2.1">
<h3>
<span class="header-section-number">12.2.1</span> Boxes on steroids<a class="anchor" aria-label="anchor" href="#boxes-on-steroids"><i class="fas fa-link"></i></a>
</h3>
<p>You may know the <a href="http://rstudio.github.io/shinydashboard/">shinydashboard</a> <code>box</code> function. Boxes are containers with a title, body, footer, as well as optional elements. Those box may also be collapsed. It would be nice to capture the state of the box in an input, so as to trigger other actions as soon as this input changes. Since an input value is unique, we must add an <code>id</code> parameter to the box function. Below is what we had to modify compared to the <code><a href="https://rdrr.io/pkg/shinydashboard/man/box.html">shinydashboard::box()</a></code> function.</p>
<p></p>
<div class="sourceCode" id="cb514"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">box</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">..</span>, <span class="va">id</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">footer</span> <span class="op">=</span> <span class="cn">NULL</span>,
                 <span class="va">background</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">width</span> <span class="op">=</span> <span class="fl">6</span>, <span class="va">height</span> <span class="op">=</span> <span class="cn">NULL</span>,
                 <span class="va">collapsible</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">collapsed</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># ....; Extra code removed</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/boxDeps.html">boxDeps</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># required to attach the binding</span>
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
      class <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"col-sm-"</span>, <span class="va">width</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
        id <span class="op">=</span> <span class="va">id</span>, <span class="co"># required to target the unique box</span>
        class <span class="op">=</span> <span class="va">boxClass</span>, <span class="co"># required to target all boxes</span>
        <span class="co"># ....; Extra code removed (box header, body, footer)</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p><code><a href="https://rdrr.io/pkg/OSUICode/man/boxDeps.html">boxDeps()</a></code> contains the JS dependencies to handle the box behavior.</p>
<p></p>
<div class="sourceCode" id="cb515"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boxDeps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"boxBinding"</span>,
    version <span class="op">=</span> <span class="st">"1.0.0"</span>,
    src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span>
      <span class="st">"input-system/input-bindings"</span>, 
      package <span class="op">=</span> <span class="st">"OSUICode"</span>
    <span class="op">)</span><span class="op">)</span>,
    script <span class="op">=</span> <span class="st">"boxBinding.js"</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>As we may collapse and uncollapse the box, we create the <code><a href="https://rdrr.io/pkg/OSUICode/man/updateBox.html">updateBox()</a></code> function, which will toggle it. In this example, it does not send any specific message since we’ll rely on internal AdminLTE JS methods to do the work.</p>
<p></p>
<div class="sourceCode" id="cb516"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">updateBox</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
  <span class="va">id</span>, 
  <span class="va">session</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/domains.html">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span> <span class="op">{</span>
  <span class="va">session</span><span class="op">$</span><span class="fu">sendInputMessage</span><span class="op">(</span><span class="va">id</span>, message <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>If you play with this <a href="https://adminlte.io/themes/AdminLTE/index2.html">example</a> and inspect a box as shown on Figure <a href="shiny-input-system.html#fig:inspect-adminlte-box">12.16</a>, you’ll notice that when collapsed, a box gets the <code>collapsed-box</code> class, which is useful to keep in mind for the input binding design.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:inspect-adminlte-box"></span>
<img src="images/survival-kit/inspect-adminlte-box.png" alt="Collapsed AdminLTE2 box." width="100%"><p class="caption">
FIGURE 12.16: Collapsed AdminLTE2 box.
</p>
</div>
<p></p>
<p>This is time to design the JS dependency, that is <code>boxBinding.js</code>. Like all input bindings, it start by instantiating a new object with <code>Shiny.InputBinding()</code>. At the end of the code, we register the binding so that Shiny knows it exists.</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb517-1"><a href="shiny-input-system.html#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> boxBinding <span class="op">=</span> <span class="kw">new</span> Shiny<span class="op">.</span><span class="fu">InputBinding</span>()<span class="op">;</span></span>
<span id="cb517-2"><a href="shiny-input-system.html#cb517-2" aria-hidden="true" tabindex="-1"></a>$<span class="op">.</span><span class="fu">extend</span>(boxBinding<span class="op">,</span> {</span>
<span id="cb517-3"><a href="shiny-input-system.html#cb517-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Methods go here</span></span>
<span id="cb517-4"><a href="shiny-input-system.html#cb517-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb517-5"><a href="shiny-input-system.html#cb517-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-6"><a href="shiny-input-system.html#cb517-6" aria-hidden="true" tabindex="-1"></a>Shiny<span class="op">.</span><span class="at">inputBindings</span><span class="op">.</span><span class="fu">register</span>(boxBinding<span class="op">,</span> <span class="st">'box-input'</span>)<span class="op">;</span></span></code></pre></div>
<p>Below are the main steps taken to design the binding.</p>
<ol style="list-style-type: decimal">
<li>
<code>find</code>: there is nothing special to say, we are looking for elements having the <code>box</code> class.</li>
</ol>
<div class="sourceCode" id="cb518"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb518-1"><a href="shiny-input-system.html#cb518-1" aria-hidden="true" tabindex="-1"></a>find<span class="op">:</span> <span class="kw">function</span>(scope) {</span>
<span id="cb518-2"><a href="shiny-input-system.html#cb518-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">$</span>(scope)<span class="op">.</span><span class="fu">find</span>(<span class="st">'.box'</span>)<span class="op">;</span></span>
<span id="cb518-3"><a href="shiny-input-system.html#cb518-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>
<code>getValue</code>: we check if the element has the <code>collapsed-box</code> class and return an object which will give a list in R. This is in case we add other elements like the remove action available in AdminLTE. We therefore access each input element with <code>input$&lt;box_id&gt;$&lt;property_name&gt;</code>.</li>
</ol>
<div class="sourceCode" id="cb519"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb519-1"><a href="shiny-input-system.html#cb519-1" aria-hidden="true" tabindex="-1"></a>getValue<span class="op">:</span> <span class="kw">function</span>(el) {</span>
<span id="cb519-2"><a href="shiny-input-system.html#cb519-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> isCollapsed <span class="op">=</span> <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">hasClass</span>(<span class="st">'collapsed-box'</span>)</span>
<span id="cb519-3"><a href="shiny-input-system.html#cb519-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {<span class="dt">collapsed</span><span class="op">:</span> isCollapsed}<span class="op">;</span> <span class="co">// this will be a list in R</span></span>
<span id="cb519-4"><a href="shiny-input-system.html#cb519-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>
<code>setValue</code>: we call the plug and play AdminLTE <code>toggleBox</code> method.</li>
</ol>
<div class="sourceCode" id="cb520"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb520-1"><a href="shiny-input-system.html#cb520-1" aria-hidden="true" tabindex="-1"></a>setValue<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> value) {</span>
<span id="cb520-2"><a href="shiny-input-system.html#cb520-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">toggleBox</span>()<span class="op">;</span></span>
<span id="cb520-3"><a href="shiny-input-system.html#cb520-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>
<code>receiveMessage</code>: we call the <code>setValue</code> method and trigger a change event so that Shiny knows when the value needs to be updated within <code>subscribe</code>.</li>
</ol>
<div class="sourceCode" id="cb521"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb521-1"><a href="shiny-input-system.html#cb521-1" aria-hidden="true" tabindex="-1"></a>receiveMessage<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> data) {</span>
<span id="cb521-2"><a href="shiny-input-system.html#cb521-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="fu">setValue</span>(el<span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb521-3"><a href="shiny-input-system.html#cb521-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">trigger</span>(<span class="st">'change'</span>)<span class="op">;</span></span>
<span id="cb521-4"><a href="shiny-input-system.html#cb521-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>
<code>subscribe</code>: as previously mentioned, it is necessary to know when to tell Shiny to update the value with the <code>subscribe</code> method. Most of the time, the change event might be sufficient, but as <a href="http://rstudio.github.io/shinydashboard/">shinydashboard</a> is built on top of <a href="https://adminlte.io/docs/2.4/js-box-widget">AdminLTE2</a>, it has an API to control the box behavior. We identify two events corresponding to the collapsible action:</li>
</ol>
<ul>
<li>expanded.boxwidget (Triggered after the box is expanded)</li>
<li>collapsed.boxwidget (Triggered after the box is collapsed)</li>
</ul>
<p>Unfortunately, after further investigations, those events are not possible to use since the AdminLTE library does not trigger them in the main JS <a href="https://github.com/rstudio/shinydashboard/blob/dc1e15b39b7198286373643e8e4417867548c467/srcjs/AdminLTE/app.js#L577">code</a> (see the collapse method). There are other solutions and we decided to listens to the <code>click</code> event on the <code>[data-widget="collapse"]</code> element and delays the <code>callback</code> call by a value which is slightly higher than the default AdminLTE2 animation to collapse the box (500ms). If you omit this part, the input will not have time to properly update!</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb522-1"><a href="shiny-input-system.html#cb522-1" aria-hidden="true" tabindex="-1"></a>subscribe<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> callback) {</span>
<span id="cb522-2"><a href="shiny-input-system.html#cb522-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">on</span>(</span>
<span id="cb522-3"><a href="shiny-input-system.html#cb522-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'click'</span><span class="op">,</span> </span>
<span id="cb522-4"><a href="shiny-input-system.html#cb522-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'[data-widget="collapse"]'</span><span class="op">,</span> </span>
<span id="cb522-5"><a href="shiny-input-system.html#cb522-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb522-6"><a href="shiny-input-system.html#cb522-6" aria-hidden="true" tabindex="-1"></a>      <span class="pp">setTimeout</span>(<span class="kw">function</span>() {</span>
<span id="cb522-7"><a href="shiny-input-system.html#cb522-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">callback</span>()<span class="op">;</span></span>
<span id="cb522-8"><a href="shiny-input-system.html#cb522-8" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> <span class="dv">50</span>)<span class="op">;</span></span>
<span id="cb522-9"><a href="shiny-input-system.html#cb522-9" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span> </span>
<span id="cb522-10"><a href="shiny-input-system.html#cb522-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb522-11"><a href="shiny-input-system.html#cb522-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">on</span>(<span class="st">'change'</span><span class="op">,</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb522-12"><a href="shiny-input-system.html#cb522-12" aria-hidden="true" tabindex="-1"></a>    <span class="pp">setTimeout</span>(<span class="kw">function</span>() {</span>
<span id="cb522-13"><a href="shiny-input-system.html#cb522-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">callback</span>()<span class="op">;</span></span>
<span id="cb522-14"><a href="shiny-input-system.html#cb522-14" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> <span class="dv">50</span>)<span class="op">;</span></span>
<span id="cb522-15"><a href="shiny-input-system.html#cb522-15" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb522-16"><a href="shiny-input-system.html#cb522-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Even though animations are nice, it might appears rather sub-optimal to wait 500 ms for a box to collapse. AdminLTE <a href="https://adminlte.io/themes/AdminLTE/documentation/index.html#adminlte-options">options</a> allow to change this through the <code>$.AdminLTE.boxWidget</code> object. We specify the <code>animationSpeed</code> property to 10 milliseconds and update the input binding script to reduce the delay in the <code>subscribe</code> method (50 ms seems reasonable).</li>
</ol>
<div class="sourceCode" id="cb523"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb523-1"><a href="shiny-input-system.html#cb523-1" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="kw">function</span>() {</span>
<span id="cb523-2"><a href="shiny-input-system.html#cb523-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// overwrite box animation speed. </span></span>
<span id="cb523-3"><a href="shiny-input-system.html#cb523-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Putting 500 ms add unnecessary delay for Shiny.</span></span>
<span id="cb523-4"><a href="shiny-input-system.html#cb523-4" aria-hidden="true" tabindex="-1"></a>  $<span class="op">.</span><span class="at">AdminLTE</span><span class="op">.</span><span class="at">boxWidget</span><span class="op">.</span><span class="at">animationSpeed</span> <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb523-5"><a href="shiny-input-system.html#cb523-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>We don’t need an extra listener for the <code><a href="https://rdrr.io/pkg/OSUICode/man/updateBox.html">updateBox()</a></code> function since it also triggers a click on the collapse button, thereby forwarding to the corresponding listener. The whole code may be found <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/blob/b95f656bce9de7600c05b5045a4e005f70c4f83d/inst/input-system/input-bindings/boxBinding.js#L1">here</a>.</p>
<p>Let’s try our new toy in a simple app. The output is depicted on Figure <a href="shiny-input-system.html#fig:toggle-shinydashboard-box">12.17</a>.</p>
<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:toggle-shinydashboard-box"></span>
<img src="images/survival-kit/toggle-shinydashboard-box.png" alt="{shinydashboard} box with custom input binding listening to the box collapse state." width="50%"><p class="caption">
FIGURE 12.17: {shinydashboard} box with custom input binding listening to the box collapse state.
</p>
</div>
<p></p>
<p></p>
<div class="sourceCode" id="cb524"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/boxes-on-steroids", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span></code></pre></div>
<p></p>
<p>The <a href="https://rinterface.github.io/bs4Dash/index.html">bs4Dash</a> box function follows the same principle, with extra features showed <a href="https://github.com/RinteRface/bs4Dash/blob/6fb8f8175e3672bbb65236d76285c6310197f10c/srcjs/bs4Dash-2.0.0/cards.js#L2">here</a>. We leave the reader to explore the code as an exercise.</p>
</div>
<div id="boxes-on-steroids-more" class="section level3" number="12.2.2">
<h3>
<span class="header-section-number">12.2.2</span> Further optimize boxes<a class="anchor" aria-label="anchor" href="#boxes-on-steroids-more"><i class="fas fa-link"></i></a>
</h3>
<p>We may imagine leveraging the input binding system to update any box property and get rid of the classic <code><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI()</a></code> approach. Indeed, until now, there would be only one way to update a box from the server. In the below code, we intentionally added a dummy task causing a five seconds delay in the card rendering. You’ll notice that nothing happens for some time, which is weird for the end user and might let it think about a possible app crash (Figure <a href="shiny-input-system.html#fig:update-shinydashboard-box">12.18</a>, left side).</p>
<p></p>
<div class="sourceCode" id="cb525"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/update-box-renderUI", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dreamRs/shinyWidgets">shinyWidgets</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="co"># import shinydashboard deps without the need of the</span>
  <span class="co"># dashboard template</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shinyWidgets/man/useShinydashboard.html">useShinydashboard</a></span><span class="op">(</span><span class="op">)</span>,

  <span class="va">tags</span><span class="op">$</span><span class="fu">style</span><span class="op">(</span><span class="st">"body { background-color: ghostwhite};"</span><span class="op">)</span>,

  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">uiOutput</a></span><span class="op">(</span><span class="st">"custom_box"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span>
    <span class="st">"background"</span>,
    <span class="st">"Background"</span>,
    choices <span class="op">=</span> <span class="fu">shinydashboard</span><span class="fu">:::</span><span class="va"><a href="https://rdrr.io/pkg/shinydashboard/man/validColors.html">validColors</a></span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">dummy_task</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
    <span class="fl">12</span>
  <span class="op">}</span><span class="op">)</span>

  <span class="va">output</span><span class="op">$</span><span class="va">custom_box</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu">dummy_task</span><span class="op">(</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/box.html">box</a></span><span class="op">(</span>
      title <span class="op">=</span> <span class="st">"Box"</span>,
      width <span class="op">=</span> <span class="fu">dummy_task</span><span class="op">(</span><span class="op">)</span>,
      <span class="st">"Box body"</span>,
      background <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">background</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p></p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:update-shinydashboard-box"></span>
<img src="images/survival-kit/update-shinydashboard-box-1.png" alt="Left: what the user sees when app starts. Right: what the users sees after five seconds." width="50%"><img src="images/survival-kit/update-shinydashboard-box-2.png" alt="Left: what the user sees when app starts. Right: what the users sees after five seconds." width="50%"><p class="caption">
FIGURE 12.18: Left: what the user sees when app starts. Right: what the users sees after five seconds.
</p>
</div>
<p></p>
<p>The whole piece of UI is re-rendered each time, while only the box class should be modified. As shown above, this does have substantial impact for a very complex app festooned with inputs/outputs, thereby altering the overall user experience.</p>
<p>Let’s provide some optimization and get rid of the <code><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI()</a></code>.
Figure <a href="shiny-input-system.html#fig:box-on-steroids-summary">12.19</a> summarizes the main idea and you may use it as a mind map to follow the remaining of this section.
We proceed in two steps. The first part consists in customizing the previously designed <code><a href="https://rdrr.io/pkg/OSUICode/man/box.html">box()</a></code> function from <a href="shiny-input-system.html#boxes-on-steroids">12.2.1</a> to gather as many parameters as possible in a list of options. For instance, we choose to extract <code>width</code> and <code>title</code>.</p>
<p><code>width</code> is expected to be numeric, while <code>title</code> might be any HTML tag, a list of HTML tags, justifying the use of slightly more sophisticated code (we can’t use <code><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">toJSON()</a></code> on a shiny tag … not yet). So that we don’t shoot ourselves in the foot, we create a specific object for the processed <code>title</code>, that is <code>processed_title</code>. Indeed, a common mistake would be to re-inject the processed title later in the HTML box tag, which would cause an error. It’s purpose is solely to be part of the configuration script required by JS.</p>
<p></p>
<div class="sourceCode" id="cb526"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">box2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">id</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">footer</span> <span class="op">=</span> <span class="cn">NULL</span>,
                 <span class="va">background</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">width</span> <span class="op">=</span> <span class="fl">6</span>, <span class="va">height</span> <span class="op">=</span> <span class="cn">NULL</span>,
                 <span class="va">collapsible</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">collapsed</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">processed_title</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">"shiny.tag.list"</span><span class="op">)</span> <span class="op">||</span>
      <span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">title</span>, <span class="st">"shiny.tag"</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
      <span class="va">title</span>
    <span class="op">}</span>
  <span class="op">}</span>
  
  <span class="va">props</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/dropNulls.html">dropNulls</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      title <span class="op">=</span> <span class="va">processed_title</span>,
      background <span class="op">=</span> <span class="va">background</span>,
      width <span class="op">=</span> <span class="va">width</span>
    <span class="op">)</span>
  <span class="op">)</span>
  
  <span class="co"># ....; Extra code removed</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>This properties list has to be treated on the JS side, the reason why we remove <code>NULL</code> elements with <code><a href="https://rdrr.io/pkg/OSUICode/man/dropNulls.html">dropNulls()</a></code>, since we don’t want to send empty arrays. We choose the following approach, where we convert our properties to a JSON with <code><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">toJSON()</a></code> and embed them in a script tag. Note the <code>data-for</code> attribute pointing to the unique <code>id</code> parameter. This will guarantee the uniqueness of our configuration script.</p>
<p></p>
<div class="sourceCode" id="cb527"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">box2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">id</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">footer</span> <span class="op">=</span> <span class="cn">NULL</span>,
                 <span class="va">background</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">width</span> <span class="op">=</span> <span class="fl">6</span>, <span class="va">height</span> <span class="op">=</span> <span class="cn">NULL</span>,
                 <span class="va">collapsible</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">collapsed</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># ....; Extra code removed</span>
  
  <span class="va">configTag</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">script</span><span class="op">(</span>
    type <span class="op">=</span> <span class="st">"application/json"</span>,
    `data-for` <span class="op">=</span> <span class="va">id</span>,
    <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">toJSON</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">props</span>,
      auto_unbox <span class="op">=</span> <span class="cn">TRUE</span>,
      json_verbatim <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>
  <span class="op">)</span>
  
<span class="op">}</span></code></pre></div>
<p></p>
<p>To create the box HTML tag, we leverage the <code><a href="https://rdrr.io/pkg/OSUICode/man/box.html">box()</a></code> function. The next step is to add it the configuration tag, which is achieved with the new <a href="https://github.com/rstudio/htmltools">htmltools</a> <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> API, extensively studied in <a href="htmltools-overview.html#htmltools-modern">2.6</a>. We finally attach the not yet designed JS dependencies with <code><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList()</a></code>.</p>
<p></p>
<div class="sourceCode" id="cb528"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">box2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">id</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">footer</span> <span class="op">=</span> <span class="cn">NULL</span>,
                 <span class="va">background</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">width</span> <span class="op">=</span> <span class="fl">6</span>, <span class="va">height</span> <span class="op">=</span> <span class="cn">NULL</span>,
                 <span class="va">collapsible</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">collapsed</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># ....; Extra code removed</span>
  
  <span class="va">boxTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/box.html">box</a></span><span class="op">(</span>
      <span class="va">...</span>, id <span class="op">=</span> <span class="va">id</span>, title <span class="op">=</span> <span class="va">title</span>, footer <span class="op">=</span> <span class="va">footer</span>,
      background <span class="op">=</span> <span class="va">background</span>, width <span class="op">=</span> <span class="va">width</span>, height <span class="op">=</span> <span class="va">height</span>,
      collapsible <span class="op">=</span> <span class="va">collapsible</span>, collapsed <span class="op">=</span> <span class="va">collapsed</span>
    <span class="op">)</span>
  <span class="op">)</span><span class="op">$</span>
    <span class="fu">append</span><span class="op">(</span><span class="va">configTag</span><span class="op">)</span><span class="op">$</span>
    <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/box2Deps.html">box2Deps</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">boxTag</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>Like in <a href="shiny-input-system.html#boxes-on-steroids">12.2.1</a>, we define the new dependencies, namely <code><a href="https://rdrr.io/pkg/OSUICode/man/box2Deps.html">box2Deps()</a></code>, referencing the <code>boxBindingEnhance.js</code> script, which we are going to design in few minutes.</p>
<p></p>
<div class="sourceCode" id="cb529"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">box2Deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="st">"boxBinding"</span>,
    version <span class="op">=</span> <span class="st">"1.0.0"</span>,
    src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span>
      <span class="st">"input-system/input-bindings"</span>, 
      package <span class="op">=</span> <span class="st">"OSUICode"</span>
    <span class="op">)</span><span class="op">)</span>,
    script <span class="op">=</span> <span class="st">"boxBindingEnhanced.js"</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>Then, we have to modify the <code><a href="https://rdrr.io/pkg/OSUICode/man/updateBox.html">updateBox()</a></code> function such that it handles both toggle and update possibilities. <code>options</code> contains all changeable properties like <code>title</code> and <code>width</code>.
We don’t describe the toggle case since it is quite similar to the previous implementations. When the action is <code>update</code>, we enter the <code>if</code> statement and options must be processed. If the option element is a shiny tag or a list of shiny tags (<code><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList()</a></code>), we convert it to character with <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code>. The returned message is a vector containing the action as well as the option list:</p>
<p></p>
<div class="sourceCode" id="cb530"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">updateBox2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
  <span class="va">id</span>, 
  <span class="va">action</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"toggle"</span>, <span class="st">"update"</span><span class="op">)</span>, 
  <span class="va">options</span> <span class="op">=</span> <span class="cn">NULL</span>,
  <span class="va">session</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/domains.html">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span> <span class="op">{</span>
  <span class="co"># for update, we take a list of options</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">action</span> <span class="op">==</span> <span class="st">"update"</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># handle case where options are shiny tag </span>
    <span class="co"># or a list of tags ...</span>
    <span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">options</span>, <span class="kw">function</span><span class="op">(</span><span class="va">o</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"shiny.tag"</span><span class="op">)</span> <span class="op">||</span> 
          <span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">o</span>, <span class="st">"shiny.tag.list"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span>
      <span class="op">}</span>
      <span class="va">o</span>
    <span class="op">}</span><span class="op">)</span>
    <span class="va">message</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/dropNulls.html">dropNulls</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        action <span class="op">=</span> <span class="va">action</span>, 
        options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">options</span><span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span>
    <span class="va">session</span><span class="op">$</span><span class="fu">sendInputMessage</span><span class="op">(</span><span class="va">id</span>, <span class="va">message</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">message</span> <span class="op">==</span> <span class="st">"toggle"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">session</span><span class="op">$</span><span class="fu">sendInputMessage</span><span class="op">(</span><span class="va">id</span>, message <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html">match.arg</a></span><span class="op">(</span><span class="va">action</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>Let’s define the new JS binding required by <code><a href="https://rdrr.io/pkg/OSUICode/man/box2Deps.html">box2Deps()</a></code>. We start from the previously defined binding in <code>boxBindings.js</code> and modify the <code>setValue</code> method to import our newly defined properties. The <code>boxTag</code> has two children, the box and the configuration script. <code>$(el)</code> refers to the box, therefore we have to look one level up to be able to use the <code>find</code> method (find always goes deeper in the DOM), namely <code>$(el).parent()</code>. From there, we only have to target the script tag <code>$(el).parent().find("script[data-for='" + el.id + "']")</code>. In practice, you may reuse this piece of code in multiple places, for instance in the <code>getValue</code> method. To avoid duplication, we create an internal function, <code>_getConfig</code>. Note the <code>_</code> prefix, which makes the difference between the default input binding methods (available for all bindings) and the user defined methods, local to a specific binding. This function just returns the config script:</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb531-1"><a href="shiny-input-system.html#cb531-1" aria-hidden="true" tabindex="-1"></a>_getConfigScript<span class="op">:</span> <span class="kw">function</span>(el) {</span>
<span id="cb531-2"><a href="shiny-input-system.html#cb531-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span>(</span>
<span id="cb531-3"><a href="shiny-input-system.html#cb531-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(el)</span>
<span id="cb531-4"><a href="shiny-input-system.html#cb531-4" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">parent</span>()</span>
<span id="cb531-5"><a href="shiny-input-system.html#cb531-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">find</span>(<span class="st">"script[data-for='"</span> <span class="op">+</span> el<span class="op">.</span><span class="at">id</span> <span class="op">+</span> <span class="st">"']"</span>)</span>
<span id="cb531-6"><a href="shiny-input-system.html#cb531-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb531-7"><a href="shiny-input-system.html#cb531-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We also extract the <code>_processConfig</code> method that calls <code>_getConfigScript</code> and converts the script content to a JS object that we can manipulate. Notice the <code>this</code> keyword: it represents the input binding instance as explained above in <a href="shiny-input-system.html#input-binding-steps">12.1.2</a>.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb532-1"><a href="shiny-input-system.html#cb532-1" aria-hidden="true" tabindex="-1"></a>_processConfig<span class="op">:</span> <span class="kw">function</span>(el) {</span>
<span id="cb532-2"><a href="shiny-input-system.html#cb532-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span>(</span>
<span id="cb532-3"><a href="shiny-input-system.html#cb532-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(</span>
<span id="cb532-4"><a href="shiny-input-system.html#cb532-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span></span>
<span id="cb532-5"><a href="shiny-input-system.html#cb532-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">_getConfigScript</span>(el)</span>
<span id="cb532-6"><a href="shiny-input-system.html#cb532-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">html</span>()</span>
<span id="cb532-7"><a href="shiny-input-system.html#cb532-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb532-8"><a href="shiny-input-system.html#cb532-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb532-9"><a href="shiny-input-system.html#cb532-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Then, we call <code>_processConfig</code> inside <code>setValue</code>:</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb533-1"><a href="shiny-input-system.html#cb533-1" aria-hidden="true" tabindex="-1"></a>setValue<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> value) {</span>
<span id="cb533-2"><a href="shiny-input-system.html#cb533-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> config <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">_processConfig</span>(el)<span class="op">;</span></span>
<span id="cb533-3"><a href="shiny-input-system.html#cb533-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>From the above code, <code>config.width</code> returns the initial width, while <code>value.options.width</code> contains the new width value provided in the <code>updateBox2</code> message output. As a security, we don’t want to change <code>config</code> if the action provided in <code>updateBox2</code> is not <code>update</code> (see if statement). Assuming <code>value.action === "update"</code>, we can continue to develop our JS logic. Good practice is to check whether <code>value.options.width</code> exists with <code>value.options.hasOwnProperty("width")</code>. If yes, we ensure whether its value and <code>config.width</code> are different. We always choose <code>===</code> which compares the type and the value (<code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code> only compares the value such that <code>"1" == 1</code> is <code>true</code>):</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb534-1"><a href="shiny-input-system.html#cb534-1" aria-hidden="true" tabindex="-1"></a>setValue<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> value) {</span>
<span id="cb534-2"><a href="shiny-input-system.html#cb534-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> config <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">_processConfig</span>(el)<span class="op">;</span></span>
<span id="cb534-3"><a href="shiny-input-system.html#cb534-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb534-4"><a href="shiny-input-system.html#cb534-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value<span class="op">.</span><span class="at">action</span> <span class="op">===</span> <span class="st">"update"</span>) {</span>
<span id="cb534-5"><a href="shiny-input-system.html#cb534-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (value<span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="fu">hasOwnProperty</span>(<span class="st">"width"</span>)) {</span>
<span id="cb534-6"><a href="shiny-input-system.html#cb534-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (value<span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">width</span> <span class="op">!==</span> config<span class="op">.</span><span class="at">width</span>) {</span>
<span id="cb534-7"><a href="shiny-input-system.html#cb534-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">_updateWidth</span>(</span>
<span id="cb534-8"><a href="shiny-input-system.html#cb534-8" aria-hidden="true" tabindex="-1"></a>          el<span class="op">,</span> </span>
<span id="cb534-9"><a href="shiny-input-system.html#cb534-9" aria-hidden="true" tabindex="-1"></a>          config<span class="op">.</span><span class="at">width</span><span class="op">,</span> </span>
<span id="cb534-10"><a href="shiny-input-system.html#cb534-10" aria-hidden="true" tabindex="-1"></a>          value<span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">width</span></span>
<span id="cb534-11"><a href="shiny-input-system.html#cb534-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb534-12"><a href="shiny-input-system.html#cb534-12" aria-hidden="true" tabindex="-1"></a>        config<span class="op">.</span><span class="at">width</span> <span class="op">=</span> value<span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">width</span><span class="op">;</span></span>
<span id="cb534-13"><a href="shiny-input-system.html#cb534-13" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb534-14"><a href="shiny-input-system.html#cb534-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb534-15"><a href="shiny-input-system.html#cb534-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// other items to update</span></span>
<span id="cb534-16"><a href="shiny-input-system.html#cb534-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb534-17"><a href="shiny-input-system.html#cb534-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code>_updateWidth</code> is a internal method defined in the input binding. It has three parameters, <code>el</code>, <code>o</code> and <code>n</code> (o and n being the old and new values, respectively):</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb535-1"><a href="shiny-input-system.html#cb535-1" aria-hidden="true" tabindex="-1"></a>_updateWidth<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> o<span class="op">,</span> n) {</span>
<span id="cb535-2"><a href="shiny-input-system.html#cb535-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// removes old class</span></span>
<span id="cb535-3"><a href="shiny-input-system.html#cb535-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">parent</span>()<span class="op">.</span><span class="fu">toggleClass</span>(<span class="st">"col-sm-"</span> <span class="op">+</span> o)<span class="op">;</span></span>
<span id="cb535-4"><a href="shiny-input-system.html#cb535-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">parent</span>()<span class="op">.</span><span class="fu">addClass</span>(<span class="st">"col-sm-"</span> <span class="op">+</span> n)<span class="op">;</span> </span>
<span id="cb535-5"><a href="shiny-input-system.html#cb535-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// trigger resize so that output resize</span></span>
<span id="cb535-6"><a href="shiny-input-system.html#cb535-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">trigger</span>(<span class="st">'resize'</span>)<span class="op">;</span></span>
<span id="cb535-7"><a href="shiny-input-system.html#cb535-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We must trigger a <code>resize</code> event so that output correctly scales. The internal method is identified by an underscore since it is not an inherited <code>Shiny.InputBinding</code> method. We finally update the config value by the newly set value and repeat the process for any other property. Don’t forget to update the config script attached to the card tag at the end of the update condition, otherwise the input value won’t be modified:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb536-1"><a href="shiny-input-system.html#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="co">// replace the old JSON config by the </span></span>
<span id="cb536-2"><a href="shiny-input-system.html#cb536-2" aria-hidden="true" tabindex="-1"></a><span class="co">// new one to update the input value </span></span>
<span id="cb536-3"><a href="shiny-input-system.html#cb536-3" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span></span>
<span id="cb536-4"><a href="shiny-input-system.html#cb536-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">_getConfigScript</span>(el)</span>
<span id="cb536-5"><a href="shiny-input-system.html#cb536-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">replaceWith</span>(</span>
<span id="cb536-6"><a href="shiny-input-system.html#cb536-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;script type="application/json" data-for="'</span> <span class="op">+</span> </span>
<span id="cb536-7"><a href="shiny-input-system.html#cb536-7" aria-hidden="true" tabindex="-1"></a>    el<span class="op">.</span><span class="at">id</span> <span class="op">+</span> </span>
<span id="cb536-8"><a href="shiny-input-system.html#cb536-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'"&gt;'</span> <span class="op">+</span> </span>
<span id="cb536-9"><a href="shiny-input-system.html#cb536-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(config) <span class="op">+</span> </span>
<span id="cb536-10"><a href="shiny-input-system.html#cb536-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;/script&gt;'</span></span>
<span id="cb536-11"><a href="shiny-input-system.html#cb536-11" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span></code></pre></div>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:box-on-steroids-summary"></span>
<img src="images/survival-kit/box-on-steroids.png" alt="Box config tag concept and application." width="100%"><p class="caption">
FIGURE 12.19: Box config tag concept and application.
</p>
</div>
<p></p>
<p>The whole JS code may be found <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/blob/b95f656bce9de7600c05b5045a4e005f70c4f83d/inst/input-system/input-bindings/boxBindingEnhanced.js#L1">here</a>. Below is the reworked version of the previously updated box without <code><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI()</a></code>. When app starts, the box is displayed as shown on Figure <a href="shiny-input-system.html#fig:update-shinydashboard-box-optimized">12.20</a>, which is better for the end user experience.</p>
<p></p>
<div class="sourceCode" id="cb537"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/boxes-on-steroids-2", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dreamRs/shinyWidgets">shinyWidgets</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="co"># import shinydashboard deps without the need of</span>
  <span class="co"># the dashboard template</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shinyWidgets/man/useShinydashboard.html">useShinydashboard</a></span><span class="op">(</span><span class="op">)</span>,

  <span class="va">tags</span><span class="op">$</span><span class="fu">style</span><span class="op">(</span><span class="st">"body { background-color: ghostwhite};"</span><span class="op">)</span>,

  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/box2.html">box2</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"My box"</span>,
    <span class="st">"Box body"</span>,
    id <span class="op">=</span> <span class="st">"mybox"</span>,
    height <span class="op">=</span> <span class="st">"400px"</span>,
    width <span class="op">=</span> <span class="fl">6</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">dummy_task</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
    <span class="fl">12</span>
  <span class="op">}</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="fu">dummy_task</span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/updateBox2.html">updateBox2</a></span><span class="op">(</span>
      <span class="st">"mybox"</span>,
      action <span class="op">=</span> <span class="st">"update"</span>,
      options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        width <span class="op">=</span> <span class="fu">dummy_task</span><span class="op">(</span><span class="op">)</span>,
        title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span>
          <span class="fu">shinydashboardPlus</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shinydashboardPlus/man/dashboardBadge.html">dashboardBadge</a></span><span class="op">(</span>
            <span class="st">"New"</span>,
            color <span class="op">=</span> <span class="st">"red"</span>
          <span class="op">)</span>,
          <span class="st">"New title"</span>
        <span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>

<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p></p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:update-shinydashboard-box-optimized"></span>
<img src="images/survival-kit/update-shinydashboard-box-optimized-1.png" alt="Left: what the user sees when app starts. Right: what the users sees after five seconds." width="50%"><img src="images/survival-kit/update-shinydashboard-box-optimized-2.png" alt="Left: what the user sees when app starts. Right: what the users sees after five seconds." width="50%"><p class="caption">
FIGURE 12.20: Left: what the user sees when app starts. Right: what the users sees after five seconds.
</p>
</div>
<p></p>
</div>
<div id="exercise-1" class="section level3" number="12.2.3">
<h3>
<span class="header-section-number">12.2.3</span> Exercise<a class="anchor" aria-label="anchor" href="#exercise-1"><i class="fas fa-link"></i></a>
</h3>
<p>In the above example, the title is also updated. In order to reproduce this behavior, you’ll have to update the <code>boxBindingEnhanced.js</code> to include the corresponding JS logic.</p>
<ol style="list-style-type: decimal">
<li>Inside <code>boxBindingEnhanced.js</code>, right after the update <code>width</code> logic,
add an <code>if</code> statement to check if <code>title</code> belongs to the update properties, sent through <code><a href="https://rdrr.io/pkg/OSUICode/man/updateBox2.html">updateBox2()</a></code>.
Fill in the blank.</li>
</ol>
<div class="sourceCode" id="cb538"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb538-1"><a href="shiny-input-system.html#cb538-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (value<span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="fu">hasOwnProperty</span>(<span class="op">...</span>)) {</span>
<span id="cb538-2"><a href="shiny-input-system.html#cb538-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb538-3"><a href="shiny-input-system.html#cb538-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Add a nested <code>if</code> statement to check whether the new title is different of the old one (needless to update if
both titles are the same).</li>
</ol>
<div class="sourceCode" id="cb539"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb539-1"><a href="shiny-input-system.html#cb539-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (value<span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="fu">hasOwnProperty</span>(<span class="op">...</span>)) {</span>
<span id="cb539-2"><a href="shiny-input-system.html#cb539-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">...</span> <span class="op">!==</span> <span class="op">...</span>) {</span>
<span id="cb539-3"><a href="shiny-input-system.html#cb539-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb539-4"><a href="shiny-input-system.html#cb539-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb539-5"><a href="shiny-input-system.html#cb539-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>On the R side, the new title will be provided as below:</li>
</ol>
<p></p>
<div class="sourceCode" id="cb540"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/updateBox2.html">updateBox2</a></span><span class="op">(</span>
  <span class="st">"mybox"</span>,
  action <span class="op">=</span> <span class="st">"update"</span>,
  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span>
      <span class="fu">shinydashboardPlus</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shinydashboardPlus/man/dashboardBadge.html">dashboardBadge</a></span><span class="op">(</span><span class="st">"New"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>,
      <span class="st">"New title"</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p></p>
<p>However, a valid AdminLTE box title has the following HTML structure:</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb541-1"><a href="shiny-input-system.html#cb541-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;h3</span> <span class="er">class</span><span class="ot">=</span><span class="st">"box-title"</span><span class="kw">&gt;</span></span>
<span id="cb541-2"><a href="shiny-input-system.html#cb541-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- TITLE CONTENT --&gt;</span></span>
<span id="cb541-3"><a href="shiny-input-system.html#cb541-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/h3&gt;</span></span></code></pre></div>
<p>Modify the below code to wrap the provided title in a <code>h3</code> tag with the <code>box-title</code> class.</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb542-1"><a href="shiny-input-system.html#cb542-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (value<span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="fu">hasOwnProperty</span>(<span class="op">...</span>)) {</span>
<span id="cb542-2"><a href="shiny-input-system.html#cb542-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">...</span> <span class="op">!==</span> <span class="op">...</span>) {</span>
<span id="cb542-3"><a href="shiny-input-system.html#cb542-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> newTitle<span class="op">;</span></span>
<span id="cb542-4"><a href="shiny-input-system.html#cb542-4" aria-hidden="true" tabindex="-1"></a>    newTitle <span class="op">=</span> <span class="vs">`&lt;h3 class="box-title"&gt;</span><span class="sc">${</span><span class="op">...</span><span class="sc">}</span><span class="vs">&lt;/h3&gt;`</span></span>
<span id="cb542-5"><a href="shiny-input-system.html#cb542-5" aria-hidden="true" tabindex="-1"></a>    newTitle <span class="op">=</span> $<span class="op">.</span><span class="fu">parseHTML</span>(<span class="op">...</span>)<span class="op">;</span></span>
<span id="cb542-6"><a href="shiny-input-system.html#cb542-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb542-7"><a href="shiny-input-system.html#cb542-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Locate the old title in the DOM and use replace it by the new one.</li>
</ol>
<div class="sourceCode" id="cb543"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb543-1"><a href="shiny-input-system.html#cb543-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (value<span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="fu">hasOwnProperty</span>(<span class="op">...</span>)) {</span>
<span id="cb543-2"><a href="shiny-input-system.html#cb543-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">...</span> <span class="op">!==</span> <span class="op">...</span>) {</span>
<span id="cb543-3"><a href="shiny-input-system.html#cb543-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> newTitle<span class="op">;</span></span>
<span id="cb543-4"><a href="shiny-input-system.html#cb543-4" aria-hidden="true" tabindex="-1"></a>    newTitle <span class="op">=</span> <span class="vs">`&lt;h3 class="box-title"&gt;</span><span class="sc">${</span><span class="op">...</span><span class="sc">}</span><span class="vs">&lt;/h3&gt;`</span></span>
<span id="cb543-5"><a href="shiny-input-system.html#cb543-5" aria-hidden="true" tabindex="-1"></a>    newTitle <span class="op">=</span> $<span class="op">.</span><span class="fu">parseHTML</span>(<span class="op">...</span>)<span class="op">;</span></span>
<span id="cb543-6"><a href="shiny-input-system.html#cb543-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb543-7"><a href="shiny-input-system.html#cb543-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(el)</span>
<span id="cb543-8"><a href="shiny-input-system.html#cb543-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">find</span>(<span class="op">...</span>)</span>
<span id="cb543-9"><a href="shiny-input-system.html#cb543-9" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">replaceWith</span>(<span class="fu">$</span>(<span class="op">...</span>))<span class="op">;</span></span>
<span id="cb543-10"><a href="shiny-input-system.html#cb543-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb543-11"><a href="shiny-input-system.html#cb543-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Update the current config <code>title</code> value with the new one.</li>
</ol>
<div class="sourceCode" id="cb544"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb544-1"><a href="shiny-input-system.html#cb544-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (value<span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="fu">hasOwnProperty</span>(<span class="op">...</span>)) {</span>
<span id="cb544-2"><a href="shiny-input-system.html#cb544-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">...</span> <span class="op">!==</span> <span class="op">...</span>) {</span>
<span id="cb544-3"><a href="shiny-input-system.html#cb544-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> newTitle<span class="op">;</span></span>
<span id="cb544-4"><a href="shiny-input-system.html#cb544-4" aria-hidden="true" tabindex="-1"></a>    newTitle <span class="op">=</span> <span class="vs">`&lt;h3 class="box-title"&gt;</span><span class="sc">${</span><span class="op">...</span><span class="sc">}</span><span class="vs">&lt;/h3&gt;`</span></span>
<span id="cb544-5"><a href="shiny-input-system.html#cb544-5" aria-hidden="true" tabindex="-1"></a>    newTitle <span class="op">=</span> $<span class="op">.</span><span class="fu">parseHTML</span>(<span class="op">...</span>)<span class="op">;</span></span>
<span id="cb544-6"><a href="shiny-input-system.html#cb544-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb544-7"><a href="shiny-input-system.html#cb544-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">$</span>(el)</span>
<span id="cb544-8"><a href="shiny-input-system.html#cb544-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">find</span>(<span class="op">...</span>)</span>
<span id="cb544-9"><a href="shiny-input-system.html#cb544-9" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">replaceWith</span>(<span class="fu">$</span>(<span class="op">...</span>))<span class="op">;</span></span>
<span id="cb544-10"><a href="shiny-input-system.html#cb544-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb544-11"><a href="shiny-input-system.html#cb544-11" aria-hidden="true" tabindex="-1"></a>    config<span class="op">.</span><span class="at">title</span> <span class="op">=</span> <span class="op">...;</span></span>
<span id="cb544-12"><a href="shiny-input-system.html#cb544-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb544-13"><a href="shiny-input-system.html#cb544-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Answers may be found <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/blob/a7a398c47a9f0ac5cd286da639514bbfcb4c0033/inst/input-system/input-bindings/boxBindingEnhanced.js#L53">here</a>.</p>
<p>If it represents a significant amount of work, it is also guarantees to lower the load on the server side, thereby offering a faster end-user experience. A full working prototype has been implemented in <a href="https://github.com/RinteRface/shinydashboardPlus">shinydashboardPlus</a> and <a href="https://rinterface.github.io/bs4Dash/index.html">bs4Dash</a> (including all box parameters).</p>
</div>
</div>
<div id="quick-inputs" class="section level2" number="12.3">
<h2>
<span class="header-section-number">12.3</span> Utilities to quickly define new inputs<a class="anchor" aria-label="anchor" href="#quick-inputs"><i class="fas fa-link"></i></a>
</h2>
<div id="introduction-2" class="section level3" number="12.3.1">
<h3>
<span class="header-section-number">12.3.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-2"><i class="fas fa-link"></i></a>
</h3>
<p>If you ever wondered where the <code>Shiny.onInputChange</code> or <code>Shiny.setInputValue</code> comes from (see <a href="https://shiny.rstudio.com/articles/communicating-with-js.html">article</a>), they are actually defined in the <code>initShiny</code> function.</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb545-1"><a href="shiny-input-system.html#cb545-1" aria-hidden="true" tabindex="-1"></a>exports<span class="op">.</span><span class="at">setInputValue</span> <span class="op">=</span> <span class="kw">function</span>(name<span class="op">,</span> value<span class="op">,</span> opts) {</span>
<span id="cb545-2"><a href="shiny-input-system.html#cb545-2" aria-hidden="true" tabindex="-1"></a>  opts <span class="op">=</span> <span class="fu">addDefaultInputOpts</span>(opts)<span class="op">;</span></span>
<span id="cb545-3"><a href="shiny-input-system.html#cb545-3" aria-hidden="true" tabindex="-1"></a>  inputs<span class="op">.</span><span class="fu">setInput</span>(name<span class="op">,</span> value<span class="op">,</span> opts)<span class="op">;</span></span>
<span id="cb545-4"><a href="shiny-input-system.html#cb545-4" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>We recommend using <code>Shiny.setInputValue</code> over <code>Shiny.onInputChange</code>, the latter being slightly misleading.
Briefly, this function avoids the creation an input binding and is faster to code but there is a price to pay: losing the ability to easily update the new input through R. Indeed, without an input binding, there is no R side <code>updateInput</code> function! By default, <code>Shiny.setInputValue</code> is able to cache the last set value from that input, so that if is is identical, no value is being assigned. If this behavior does not meet your expectations and you need to set the input even when the value did not change, be aware that you may specifify a <strong>priority</strong> option like:</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb546-1"><a href="shiny-input-system.html#cb546-1" aria-hidden="true" tabindex="-1"></a>Shiny<span class="op">.</span><span class="fu">setInputValue</span>(<span class="st">"myinput"</span><span class="op">,</span> value<span class="op">,</span> {<span class="dt">priority</span><span class="op">:</span> <span class="st">"event"</span>})<span class="op">;</span></span></code></pre></div>
</div>
<div id="examples-1" class="section level3" number="12.3.2">
<h3>
<span class="header-section-number">12.3.2</span> Examples<a class="anchor" aria-label="anchor" href="#examples-1"><i class="fas fa-link"></i></a>
</h3>
<p><code>Shiny.setInputValue</code> becomes powerful when combined to the numerous Shiny JavaScript events listed <a href="https://shiny.rstudio.com/articles/js-events.html">here</a>. To get access to the <code>Shiny</code> JS object, we have to wait for the <code>shiny:connected</code> event. In the following we create a custom input that stores whether the user has MacOS. On the R side, we’ll access it with <code>input$isMac</code>.</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb547-1"><a href="shiny-input-system.html#cb547-1" aria-hidden="true" tabindex="-1"></a><span class="fu">$</span>(<span class="bu">document</span>)<span class="op">.</span><span class="fu">on</span>(<span class="st">'shiny:connected'</span><span class="op">,</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb547-2"><a href="shiny-input-system.html#cb547-2" aria-hidden="true" tabindex="-1"></a>  Shiny<span class="op">.</span><span class="fu">setInputValue</span>(</span>
<span id="cb547-3"><a href="shiny-input-system.html#cb547-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'isMac'</span><span class="op">,</span> </span>
<span id="cb547-4"><a href="shiny-input-system.html#cb547-4" aria-hidden="true" tabindex="-1"></a>    (<span class="bu">navigator</span><span class="op">.</span><span class="at">appVersion</span><span class="op">.</span><span class="fu">indexOf</span>(<span class="st">'Mac'</span>) <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb547-5"><a href="shiny-input-system.html#cb547-5" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb547-6"><a href="shiny-input-system.html#cb547-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>This allows to conditionally display elements and deeply customize the interface.
In the following example, the card will show a different title if the user is browsing with MacOS.</p>
<p></p>
<div class="sourceCode" id="cb548"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/set-input-value", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dreamRs/shinyWidgets">shinyWidgets</a></span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shinyWidgets/man/useShinydashboard.html">useShinydashboard</a></span><span class="op">(</span><span class="op">)</span>,
  <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">script</span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/HTML.html">HTML</a></span><span class="op">(</span><span class="st">"$(function() {
        $(document).on('shiny:connected', function(event) {
          Shiny.setInputValue(
            'isMac',
            (navigator.appVersion.indexOf('Mac') != -1)
          );
        });
      });"</span>
    <span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">verbatimTextOutput</a></span><span class="op">(</span><span class="st">"info"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/box2.html">box2</a></span><span class="op">(</span>
    id <span class="op">=</span> <span class="st">"mybox"</span>,
    title <span class="op">=</span> <span class="st">"A box"</span>,
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">output</span><span class="op">$</span><span class="va">info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderPrint</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">isMac</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html">req</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">isMac</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>, <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/updateBox2.html">updateBox2</a></span><span class="op">(</span>
      <span class="st">"mybox"</span>,
      action <span class="op">=</span> <span class="st">"update"</span>,
      options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        title <span class="op">=</span> <span class="st">"Only visible for Mac users"</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p></p>
<p>This is what we leverage in the <a href="https://rinterface.github.io/shinyMobile/articles/shinyMobile_tools.html">shinyMobile</a> package to store the current device information in a shiny input. Briefly, Framework7 (on top of which is built shinyMobile) has a method <code>Framework7.device</code>, which gives many <a href="https://framework7.io/docs/device.html">details</a> related to the user device.</p>
</div>
</div>
<div id="custom-data-format" class="section level2" number="12.4">
<h2>
<span class="header-section-number">12.4</span> Custom data format<a class="anchor" aria-label="anchor" href="#custom-data-format"><i class="fas fa-link"></i></a>
</h2>
<p>In some cases, the automatic Shiny R to JS data management may not meet our needs.
We introduce <strong>input handlers</strong>, a tool to fine tune the deserialization of data from JS.</p>
<div id="the-dirty-way" class="section level3" number="12.4.1">
<h3>
<span class="header-section-number">12.4.1</span> The dirty way<a class="anchor" aria-label="anchor" href="#the-dirty-way"><i class="fas fa-link"></i></a>
</h3>
<p>For instance, assume we create a date in JS with <code>new Date()</code> and store it in a shiny input with <code>Shiny.setInputValue</code>. On the R side, we will not obtain a date but a character, which is not convenient. This is where <strong>input handlers</strong> are useful since they allow to manipulate data generated on the JS side before injecting them in R. Such handlers are created with <strong>registerInputHandler</strong> that takes two parameters:</p>
<ul>
<li>
<strong>type</strong> allows to connect the handler to <code>Shiny.setInputValue</code>. Note that the id is followed by the <strong>handler type</strong>, for instance <code>Shiny.setInputValue('test:handler', ...)</code> is connected to <code><a href="https://rdrr.io/pkg/shiny/man/registerInputHandler.html">shiny::registerInputHandler('handler', ...)</a></code>. As recommended by the Shiny documentation, if the input handler is part of a package, it is best practice to name it like <code>packageName.handlerName</code>.</li>
<li>a <strong>function</strong> to transform data, having data as main parameter.</li>
</ul>
<p>Below we directly include JS code in the shiny app snippet, which is not best practice but convenient for the demonstration. Only the second input will give the correct result thanks to the defined handler:</p>
<p></p>
<div class="sourceCode" id="cb549"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/dummy-input-handler", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/registerInputHandler.html">registerInputHandler</a></span><span class="op">(</span><span class="st">"myPKG.textDate"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="cn">NULL</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="va">res</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="st">"try-error"</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="st">"Failed to parse dates!"</span><span class="op">)</span>
      <span class="va">data</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
      <span class="va">res</span>
    <span class="op">}</span>
  <span class="op">}</span>
<span class="op">}</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="va">tags</span><span class="op">$</span><span class="fu">script</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/HTML.html">HTML</a></span><span class="op">(</span>
    <span class="st">"$(function(){
      $(document).on('shiny:connected', function() {
        var currentTime = new Date();
        Shiny.setInputValue('time1', currentTime);
        Shiny.setInputValue(
          'time2:myPKG.textDate',
          currentTime
        );
      });
    });
    "</span>
  <span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">verbatimTextOutput</a></span><span class="op">(</span><span class="st">"res1"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">verbatimTextOutput</a></span><span class="op">(</span><span class="st">"res2"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">output</span><span class="op">$</span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderPrint</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">time1</span><span class="op">)</span>, <span class="va">input</span><span class="op">$</span><span class="va">time1</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
  <span class="va">output</span><span class="op">$</span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderPrint</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">time2</span><span class="op">)</span>, <span class="va">input</span><span class="op">$</span><span class="va">time2</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p></p>
</div>
<div id="the-clean-way-leverage-gettype" class="section level3" number="12.4.2">
<h3>
<span class="header-section-number">12.4.2</span> The clean way: leverage <code>getType</code><a class="anchor" aria-label="anchor" href="#the-clean-way-leverage-gettype"><i class="fas fa-link"></i></a>
</h3>
<p>The cleanest way is to leverage the <strong>getType</strong> method from the <code>InputBinding</code> class.
Let’s refine our text input so that it handles dates. On the R side, in the <code><a href="https://rdrr.io/pkg/OSUICode/man/customTextInput.html">customTextInput()</a></code> function, we check the current value’s type:</p>
<p></p>
<div class="sourceCode" id="cb550"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">type</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"Date"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="st">"date"</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="cn">NULL</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>We add a custom data attribute to the input tag, which won’t be displayed if the value is not a date:</p>
<p></p>
<div class="sourceCode" id="cb551"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tags</span><span class="op">$</span><span class="fu">input</span><span class="op">(</span>
  id <span class="op">=</span> <span class="va">inputId</span>,
  type <span class="op">=</span> <span class="st">"text"</span>,
  class <span class="op">=</span> <span class="st">"form-control input-text"</span>,
  value <span class="op">=</span> <span class="va">value</span>,
  placeholder <span class="op">=</span> <span class="va">placeholder</span>,
  `data-data-type` <span class="op">=</span> <span class="va">type</span>
<span class="op">)</span></code></pre></div>
<p></p>
<p>We then define our custom handler. This code is run when the package is loaded and usually located in a <code>zzz.R</code> script:</p>
<p></p>
<div class="sourceCode" id="cb552"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">.onLoad</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/registerInputHandler.html">registerInputHandler</a></span><span class="op">(</span>
    <span class="st">"OSUICode.textDate"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="cn">NULL</span>
      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
        <span class="va">res</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="st">"try-error"</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
          <span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="st">"Failed to parse dates!"</span><span class="op">)</span>
          <span class="va">data</span>
        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
          <span class="va">res</span>
        <span class="op">}</span>
      <span class="op">}</span>
  <span class="op">}</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p></p>
<div class="noteblock">
<p><a href="https://shiny.rstudio.com/">shiny</a> already handles dates and we could use the built-in input handler.
The current handler was only designed to explain the underlying processes.</p>
</div>
<p>On the JavaScript side, we refer to the <code>OSUICode.textDate</code> defined input handler. We recover the <code>data-type</code> value passed from R and call the handler if the type is a date. We return <code>false</code> otherwise, which is the default behavior:</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb553-1"><a href="shiny-input-system.html#cb553-1" aria-hidden="true" tabindex="-1"></a>getType<span class="op">:</span> <span class="kw">function</span> <span class="fu">getType</span>(el) {</span>
<span id="cb553-2"><a href="shiny-input-system.html#cb553-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> dataType <span class="op">=</span> <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">data</span>(<span class="st">"data-type"</span>)<span class="op">;</span></span>
<span id="cb553-3"><a href="shiny-input-system.html#cb553-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (dataType <span class="op">===</span> <span class="st">"date"</span>) <span class="cf">return</span> <span class="st">"OSUICode.textDate"</span><span class="op">;</span></span>
<span id="cb553-4"><a href="shiny-input-system.html#cb553-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb553-5"><a href="shiny-input-system.html#cb553-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>To use the shiny built-in handler we could return <code>"shiny.date"</code> instead. We then run:</p>
<p></p>
<div class="sourceCode" id="cb554"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/input-handler-1", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/customTextInputHandlerExample.html">customTextInputHandlerExample</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></code></pre></div>
<p></p>
<p>which sets the value as text by default. After opening the HTML inspector and setting a break point in the <code>getType</code> method (Figure <a href="shiny-input-system.html#fig:binding-getType-1">12.21</a>), we check that the data type is not defined. Therefore the input handler will not apply.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:binding-getType-1"></span>
<img src="images/survival-kit/binding-getType-1.png" alt="Example where getType does not call the input handler." width="100%"><p class="caption">
FIGURE 12.21: Example where getType does not call the input handler.
</p>
</div>
<p></p>
<p>For the second example, we give a date value to the function:</p>
<p></p>
<div class="sourceCode" id="cb555"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/input-handler-2", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/customTextInputHandlerExample.html">customTextInputHandlerExample</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p></p>
<p>As illustrated Figure <a href="shiny-input-system.html#fig:binding-getType-2">12.22</a>, the date is properly processed. Moreover, if you type any other valid date in the text field like <code>2020-11-12</code>, it will be recognized as a date, while entering a text will return a character element. This is a way to obtain a slightly more clever text input widget.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:binding-getType-2"></span>
<img src="images/survival-kit/binding-getType-2.png" alt="Passing a date to a text input correctly processes it." width="100%"><p class="caption">
FIGURE 12.22: Passing a date to a text input correctly processes it.
</p>
</div>
<p></p>
<p>Importantly, since the <code>data-type</code> is set at app startup by checking the class of the value, it will never change later. For instance, if you start the app with the text input value to be a simple text, setting it to a date through the app does not convert it into a date since <code>$(el).data("data-type")</code> always return <code>undefined</code>! Therefore, if you want to be able to use both text and dates, be sure to wisely set the initial value.</p>
<p>To finish, we could seamlessly make our text input even more clever, by handling numbers. Even though shiny has a <code>shiny.number</code> input <a href="https://github.com/rstudio/shiny/blob/60db1e02b03d8e6fb146c9bb1bbfbce269231add/R/server-input-handlers.R#L144">handler</a>, it simply makes sure that whenever the input is missing a value, NA is returned instead of ““.
(Figure <a href="shiny-input-system.html#fig:shiny-getType-number">12.23</a>).</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:shiny-getType-number"></span>
<img src="images/survival-kit/shiny-getType-number.png" alt='shiny.number input handler ensures that an empty numericInput returns NA instead of "".' width="100%"><p class="caption">
FIGURE 12.23: shiny.number input handler ensures that an empty numericInput returns NA instead of ““.
</p>
</div>
<p></p>
<p>What we want is an handler that recognizes the string <code>"1"</code> and convert it to a number. In R, converting a string to a number gives <code>NA</code>:</p>
<p></p>
<div class="sourceCode" id="cb556"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="st">"test"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Warning: NAs introduced by coercion</code></pre>
<pre><code>#&gt; [1] NA</code></pre>
<p></p>
<p>Therefore, if we obtain <code>NA</code>, we return original data so that the input gives the correct type. In the <code>zzz.R</code> script, right after our previous handler, we can write:</p>
<p></p>
<div class="sourceCode" id="cb559"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/registerInputHandler.html">registerInputHandler</a></span><span class="op">(</span>
  <span class="st">"OSUICode.textNumber"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="cn">NULL</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
      <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>
      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">data</span>
      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
        <span class="va">res</span>
      <span class="op">}</span>
    <span class="op">}</span>
  <span class="op">}</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p></p>
<p>We also update the JavaScript <code>getType</code> method as follows:</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb560-1"><a href="shiny-input-system.html#cb560-1" aria-hidden="true" tabindex="-1"></a>getType<span class="op">:</span> <span class="kw">function</span> <span class="fu">getType</span>(el) {</span>
<span id="cb560-2"><a href="shiny-input-system.html#cb560-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> dataType <span class="op">=</span> <span class="fu">$</span>(el)<span class="op">.</span><span class="fu">data</span>(<span class="st">"data-type"</span>)<span class="op">;</span></span>
<span id="cb560-3"><a href="shiny-input-system.html#cb560-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (dataType <span class="op">===</span> <span class="st">"date"</span>) <span class="cf">return</span> <span class="st">"OSUICode.textDate"</span><span class="op">;</span></span>
<span id="cb560-4"><a href="shiny-input-system.html#cb560-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (dataType <span class="op">===</span> <span class="st">"number"</span>) <span class="cf">return</span> <span class="st">"OSUICode.textNumber"</span><span class="op">;</span></span>
<span id="cb560-5"><a href="shiny-input-system.html#cb560-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb560-6"><a href="shiny-input-system.html#cb560-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>On the R side, don’t forget to add an extra <code>else if</code> statement to the <code><a href="https://rdrr.io/pkg/OSUICode/man/customTextInput.html">customTextInput()</a></code> <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/blob/1b626e97738fd627097b57e21359b603e03d33eb/R/inputs.R#L35">function</a>:</p>
<p></p>
<div class="sourceCode" id="cb561"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">type</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"Date"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="st">"date"</span>
<span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"numeric"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="st">"number"</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="cn">NULL</span>
<span class="op">}</span></code></pre></div>
<p></p>
<p>If we run:</p>
<p></p>
<div class="sourceCode" id="cb562"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "input-system/input-handler-3", </span>
<span class="co">#   package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/customTextInputHandlerExample.html">customTextInputHandlerExample</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p></p>
<p>we obtain the desired behavior shown Figure <a href="shiny-input-system.html#fig:binding-getType-3">12.24</a>.</p>
<p></p>
<div class="figure">
<span style="display:block;" id="fig:binding-getType-3"></span>
<img src="images/survival-kit/binding-getType-3.png" alt="Passing a number to a text input correctly processes it." width="100%"><p class="caption">
FIGURE 12.24: Passing a number to a text input correctly processes it.
</p>
</div>
<p></p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="shiny-intro.html"><span class="header-section-number">11</span> Communicate between R and JS</a></div>
<div class="next"><a href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#shiny-input-system"><span class="header-section-number">12</span> Understand and develop new Shiny inputs</a></li>
<li>
<a class="nav-link" href="#input-binding"><span class="header-section-number">12.1</span> Input bindings</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#input-structure"><span class="header-section-number">12.1.1</span> Input structure</a></li>
<li><a class="nav-link" href="#input-binding-steps"><span class="header-section-number">12.1.2</span> Binding Shiny inputs</a></li>
<li><a class="nav-link" href="#edit-input-binding"><span class="header-section-number">12.1.3</span> Edit an input binding</a></li>
<li><a class="nav-link" href="#update-binding-client"><span class="header-section-number">12.1.4</span> Update a binding from the client</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#secondary-inputs"><span class="header-section-number">12.2</span> Secondary inputs</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#boxes-on-steroids"><span class="header-section-number">12.2.1</span> Boxes on steroids</a></li>
<li><a class="nav-link" href="#boxes-on-steroids-more"><span class="header-section-number">12.2.2</span> Further optimize boxes</a></li>
<li><a class="nav-link" href="#exercise-1"><span class="header-section-number">12.2.3</span> Exercise</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#quick-inputs"><span class="header-section-number">12.3</span> Utilities to quickly define new inputs</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#introduction-2"><span class="header-section-number">12.3.1</span> Introduction</a></li>
<li><a class="nav-link" href="#examples-1"><span class="header-section-number">12.3.2</span> Examples</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#custom-data-format"><span class="header-section-number">12.4</span> Custom data format</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#the-dirty-way"><span class="header-section-number">12.4.1</span> The dirty way</a></li>
<li><a class="nav-link" href="#the-clean-way-leverage-gettype"><span class="header-section-number">12.4.2</span> The clean way: leverage getType</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/shiny-input-system.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/shiny-input-system.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It was last built on 2021-11-11.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
