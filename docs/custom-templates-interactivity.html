<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 19 Adding more interactivity | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<meta name="description" content="In this part, we are going to bring even more life to the template element. We first see how to enhance an existing static HTML component, through a simple progress bar example. Then we explore...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 19 Adding more interactivity | Outstanding User Interfaces with Shiny">
<meta property="og:type" content="book">
<meta property="og:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<meta property="og:description" content="In this part, we are going to bring even more life to the template element. We first see how to enhance an existing static HTML component, through a simple progress bar example. Then we explore...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 19 Adding more interactivity | Outstanding User Interfaces with Shiny">
<meta name="twitter:description" content="In this part, we are going to bring even more life to the template element. We first see how to enhance an existing static HTML component, through a simple progress bar example. Then we explore...">
<meta name="twitter:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">2</span> Mastering {htmltools}</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">3</span> Discover Shiny dependencies</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Dependency utilities</a></li>
<li><a class="" href="web-applications.html"><span class="header-section-number">5</span> Web application concepts</a></li>
<li class="book-part">Beautify with CSS and Sass</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">6</span> CSS for Shiny</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">7</span> Introduction to Sass</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">8</span> Beautify with {fresh}</a></li>
<li><a class="" href="beautify-with-bootstraplib.html"><span class="header-section-number">9</span> Beautify with {bslib}</a></li>
<li class="book-part">Unleash interactivity with JavaScript</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> R and JS</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">12</span> Shiny’s input system</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Mastering Shiny’s events</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Dynamically manage content with handlers</a></li>
<li class="book-part">Practice 1: a dashboard template</li>
<li><a class="" href="custom-templates-dependencies.html"><span class="header-section-number">16</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">17</span> Create template elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">18</span> Develop custom input widgets</a></li>
<li><a class="active" href="custom-templates-interactivity.html"><span class="header-section-number">19</span> Adding more interactivity</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">20</span> Testing and validating templates elements</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="" href="workflow-charpente.html"><span class="header-section-number">21</span> Introduction to {charpente}</a></li>
<li class="book-part">Case study 2: Mobile development with Shiny</li>
<li><a class="" href="mobile-shiny-intro.html"><span class="header-section-number">22</span> Introduction</a></li>
<li><a class="" href="mobile-shinyMobile.html"><span class="header-section-number">23</span> Reconstruct {shinyMobile}</a></li>
<li><a class="" href="mobile-pwa.html"><span class="header-section-number">24</span> {shinyMobile} and PWA</a></li>
<li><a class="" href="mobile-widgets.html"><span class="header-section-number">25</span> Design widgets</a></li>
<li><a class="" href="mobile-going-further.html"><span class="header-section-number">26</span> Fine tune {shinyMobile}</a></li>
<li class="book-part">Going further</li>
<li><a class="" href="going-further-reactR.html"><span class="header-section-number">27</span> R + Shiny + React: welcome {reactR}</a></li>
<li><a class="" href="going-further-webdev.html"><span class="header-section-number">28</span> Divide and Conquere</a></li>
<li><a class="" href="going-further-where-to-go.html"><span class="header-section-number">29</span> What to do next?</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="code-outputs.html"><span class="header-section-number">A</span> Code outputs</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="custom-templates-interactivity" class="section level1">
<h1>
<span class="header-section-number">19</span> Adding more interactivity<a class="anchor" aria-label="anchor" href="#custom-templates-interactivity"><i class="fas fa-link"></i></a>
</h1>
<p>In this part, we are going to bring even more life to the template element.
We first see how to enhance an existing static HTML component, through a simple progress bar example.
Then we explore more complex elements involving specific Shiny patterns. By the end of the chapter, you will be able to implement components like the one showed on Figure <a href="custom-templates-interactivity.html#fig:tabler-progress-overview">19.1</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:tabler-progress-overview"></span>
<img src="images/practice/tabler-progress-overview.png" alt="Stacked progress bar inside a card" width="100%"><p class="caption">
FIGURE 19.1: Stacked progress bar inside a card
</p>
</div>
<p>All the JavaScript handlers described below are gathered in an HTML dependency, as well as an input binding(s):</p>
<div class="sourceCode" id="cb673"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># contains bindings and other JS code</span>
<span class="va">tabler_custom_js</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"tabler-custom-js"</span>,
  version <span class="op">=</span> <span class="st">"1.0.7"</span>,
  src <span class="op">=</span> <span class="st">"tabler"</span>,
  package <span class="op">=</span> <span class="st">"OSUICode"</span>,
  script <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">"tabler-update-navbar/navbarMenuBinding.js"</span>,
    <span class="st">"handlers/tabler_progress_handler.js"</span>,
    <span class="st">"handlers/tabler_toast_handler.js"</span>,
    <span class="st">"handlers/tabler_dropdown_handler.js"</span>,
    <span class="st">"handlers/tabler_insert_tab_handler.js"</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div id="custom-progress-bars" class="section level2">
<h2>
<span class="header-section-number">19.1</span> Custom progress bars<a class="anchor" aria-label="anchor" href="#custom-progress-bars"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Progress bars</strong> are a good way to display metric related to a progress, for instance tracking the number of remaining tasks for a project. In general, those elements are static HTML. Hence, it would be interesting to update the current value from the server side. Since it is not an proper input element, implementing an input binding is inappropriate and we decide to proceed with a custom handler. We first create the <code><a href="https://rdrr.io/pkg/OSUICode/man/tabler_progress.html">tabler_progress()</a></code> tag which is mainly composed of:</p>
<ul>
<li>
<code>style</code> gives the current progress value. This is the main element.</li>
<li>
<code>min</code> and <code>max</code> are bounds, in general between 0 and 100.</li>
<li>
<code>id</code> ensures the progress bar uniqueness, thereby avoiding conflicts.</li>
<li>
<code>aria-...</code> parameters are <a href="https://developer.mozilla.org/fr/docs/Web/Accessibility/ARIA">accessibility</a> elements.</li>
</ul>
<div class="sourceCode" id="cb674"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tabler_progress</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"progress"</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="va">id</span>, 
      class <span class="op">=</span> <span class="st">"progress-bar"</span>,
      style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"width: "</span>, <span class="va">value</span>, <span class="st">"%"</span><span class="op">)</span>,
      role <span class="op">=</span> <span class="st">"progressbar"</span>,
      `aria-valuenow` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,
      `aria-valuemin` <span class="op">=</span> <span class="st">"0"</span>,
      `aria-valuemax` <span class="op">=</span> <span class="st">"100"</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"sr-only"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">value</span>,<span class="st">"% complete"</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The next element is the <code><a href="https://rdrr.io/pkg/OSUICode/man/update_tabler_progress.html">update_tabler_progress()</a></code> function which sends two elements from R to JS.</p>
<div class="noteblock">
<p>How to handle custom messages in shiny modules? Well, it is pretty straightforward. We wrap any <strong>id</strong> with the module <strong>namespace</strong> given by __session<span class="math inline">\(ns()__ before sending it to JS. You may even do it by default since `session\)</span>ns()<code>returns</code>""`.</p>
</div>
<ul>
<li>The progress <strong>id</strong> wrapped in <code>session$ns</code>.</li>
<li>The new <strong>value</strong>.</li>
</ul>
<div class="sourceCode" id="cb675"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">update_tabler_progress</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
  <span class="va">id</span>, 
  <span class="va">value</span>, 
  <span class="va">session</span> <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/domains.html">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span> <span class="op">{</span>
  <span class="va">message</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">session</span><span class="op">$</span><span class="fu">ns</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>, value <span class="op">=</span> <span class="va">value</span><span class="op">)</span>
  <span class="va">session</span><span class="op">$</span><span class="fu">sendCustomMessage</span><span class="op">(</span>
    type <span class="op">=</span> <span class="st">"update-progress"</span>,
    <span class="va">message</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>On the JS side, we leverage the well known <code>Shiny.addCustomMessageHandler</code>. As mentioned in Chapter <a href="survival-kit-javascript.html#survival-kit-javascript">10</a>, <code>sendCustomMessage</code> and <code>addCustomMessageHandler</code> are connected by the <strong>type</strong> parameter. This is crucial! Moreover, as the sent message is a R list, it becomes an JSON, meaning that elements must be accessed with a <code>.</code> in JS:</p>
<div class="sourceCode" id="cb676"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb676-1"><a href="custom-templates-interactivity.html#cb676-1"></a><span class="at">$</span>(<span class="kw">function</span> () <span class="op">{</span></span>
<span id="cb676-2"><a href="custom-templates-interactivity.html#cb676-2"></a>  <span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(</span>
<span id="cb676-3"><a href="custom-templates-interactivity.html#cb676-3"></a>    <span class="st">'update-progress'</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb676-4"><a href="custom-templates-interactivity.html#cb676-4"></a>    <span class="at">$</span>(<span class="st">'#'</span> <span class="op">+</span> <span class="va">message</span>.<span class="at">id</span>).<span class="at">css</span>(<span class="st">'width'</span><span class="op">,</span> <span class="va">message</span>.<span class="at">value</span> <span class="op">+</span><span class="st">'%'</span>)<span class="op">;</span></span>
<span id="cb676-5"><a href="custom-templates-interactivity.html#cb676-5"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb676-6"><a href="custom-templates-interactivity.html#cb676-6"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>We finally test these components in a simple app, whom output is depicted in Figure <a href="custom-templates-interactivity.html#fig:tabler-progress">19.2</a>:</p>
<div class="sourceCode" id="cb677"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "tabler/update-progress" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dreamRs/shinyWidgets">shinyWidgets</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_page.html">tabler_page</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_body.html">tabler_body</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shinyWidgets/man/noUiSliderInput.html">noUiSliderInput</a></span><span class="op">(</span>
      inputId <span class="op">=</span> <span class="st">"progress_value"</span>,
      label <span class="op">=</span> <span class="st">"Progress value"</span>,
      min <span class="op">=</span> <span class="fl">0</span>,
      max <span class="op">=</span> <span class="fl">100</span>,
      value <span class="op">=</span> <span class="fl">20</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_progress.html">tabler_progress</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"progress1"</span>, <span class="fl">12</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">progress_value</span>, <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/update_tabler_progress.html">update_tabler_progress</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"progress1"</span>,
      <span class="va">input</span><span class="op">$</span><span class="va">progress_value</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:tabler-progress"></span>
<img src="images/practice/tabler-progress.png" alt="Progress bar component updated by a slider" width="100%"><p class="caption">
FIGURE 19.2: Progress bar component updated by a slider
</p>
</div>
<p>Is there a way to directly update the progress from the client which would avoid to exchange data between R and JS, thereby saving some time?</p>
<p>The idea is to get rid of the classic <code>session$sendCustomMessage</code> and <code>Shiny.addCustomMessageHandler</code> method. We could directly create a function that inserts a script in the UI taking a <strong>trigger</strong> and <strong>target</strong> as main parameters. This function would have to be inserted multiple times if multiple triggers had to update the same target. The JS logic is slightly different:</p>
<ul>
<li>We have to wait for shiny to be connected so that the JS <code>Shiny</code> object is ready.</li>
<li>We recover the trigger element with any JS/jQuery method.</li>
<li>We leverage the noUiSlider <a href="https://refreshless.com/nouislider/">API</a> to listen to any update in the range. It’s fine because the slider instance has already been initialized in the shinyWidget <a href="https://github.com/dreamRs/shinyWidgets/blob/55ec7eab9bcf18ceefee2e3714328fd09cfa6e06/inst/assets/nouislider/nouislider-bindings.js#L100">input binding</a>. This would not work if we were not waiting for shiny to be connected (you may try)! Notice the use of <code>this.get()</code> in the event listener, which avoids to repeat <code>slider.noUiSlider</code>
</li>
<li>We modify the <code>width</code> CSS property of the target like in the previous example.</li>
</ul>
<div class="sourceCode" id="cb678"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb678-1"><a href="custom-templates-interactivity.html#cb678-1"></a><span class="at">$</span>(document).<span class="at">on</span>(<span class="st">'shiny:connected'</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></span>
<span id="cb678-2"><a href="custom-templates-interactivity.html#cb678-2"></a>  <span class="kw">let</span> slider <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">'triggerId'</span>)<span class="op">;</span></span>
<span id="cb678-3"><a href="custom-templates-interactivity.html#cb678-3"></a>  <span class="va">slider</span>.<span class="va">noUiSlider</span>.<span class="at">on</span>(<span class="st">'update'</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></span>
<span id="cb678-4"><a href="custom-templates-interactivity.html#cb678-4"></a>    <span class="at">$</span>(<span class="st">'#targetId'</span>).<span class="at">css</span>(<span class="st">'width'</span><span class="op">,</span> <span class="kw">this</span>.<span class="at">get</span>() <span class="op">+</span> <span class="st">'%'</span>)<span class="op">;</span></span>
<span id="cb678-5"><a href="custom-templates-interactivity.html#cb678-5"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb678-6"><a href="custom-templates-interactivity.html#cb678-6"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>To insert this script in the app UI, we create <code>update_tabler_progress2</code> that just wraps it inside a <code>tags$script</code>.</p>
<div class="sourceCode" id="cb679"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">update_tabler_progress2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trigger</span>, <span class="va">target</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tags</span><span class="op">$</span><span class="fu">script</span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span>
      <span class="st">"$(document).on('shiny:connected', function(event) {
        let slider = document.getElementById('"</span>, <span class="va">trigger</span>, <span class="st">"');
        slider.noUiSlider.on('update', function(event) {
          $('#"</span>, <span class="va">target</span>, <span class="st">"').css('width', this.get() + '%');
        });
      });
      "</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb680"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "tabler/update-progress-2" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_page.html">tabler_page</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/update_tabler_progress2.html">update_tabler_progress2</a></span><span class="op">(</span><span class="st">"progress_value"</span>, <span class="st">"progress1"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/update_tabler_progress2.html">update_tabler_progress2</a></span><span class="op">(</span><span class="st">"progress_value2"</span>, <span class="st">"progress2"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_body.html">tabler_body</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidRow</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/pkg/shinyWidgets/man/noUiSliderInput.html">noUiSliderInput</a></span><span class="op">(</span>
        inputId <span class="op">=</span> <span class="st">"progress_value"</span>,
        label <span class="op">=</span> <span class="st">"Progress value 1"</span>,
        min <span class="op">=</span> <span class="fl">0</span>,
        max <span class="op">=</span> <span class="fl">100</span>,
        value <span class="op">=</span> <span class="fl">20</span>
      <span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/shinyWidgets/man/noUiSliderInput.html">noUiSliderInput</a></span><span class="op">(</span>
        inputId <span class="op">=</span> <span class="st">"progress_value2"</span>,
        label <span class="op">=</span> <span class="st">"Progress value 2"</span>,
        min <span class="op">=</span> <span class="fl">0</span>,
        max <span class="op">=</span> <span class="fl">100</span>,
        value <span class="op">=</span> <span class="fl">80</span>,
        color <span class="op">=</span> <span class="st">"red"</span>
      <span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_progress.html">tabler_progress</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"progress1"</span>, <span class="fl">12</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_progress.html">tabler_progress</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"progress2"</span>, <span class="fl">100</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p><strong>Question:</strong> Run the above example in an external web browser, then stop the app from RStudio. Try to move both sliders. What happens for the progress bars? Compare with a classic <code>update</code> function. How could you explain this? Answer: as we are not sending message through the websocket with <code>session$sendCustomMessage</code>, the progress bar still updates even though the websocket connection is closed).</p>
<p>Overall this way is a bit more complex. Yet, assuming an app with data manipulation, tons of inputs and visualizations, everything that can be done from the client (web browser) is less work for the R server part and a better end-user experience! Building outstanding shiny apps is not only designing amazing user interfaces, it’s also about <strong>optimization</strong> and speed as mentioned by Colin Fay et al. in their <a href="https://engineering-shiny.org/optimjs.html">book</a> <span class="citation">(Fay et al. <a href="references.html#ref-thinkrShiny" role="doc-biblioref">2020</a>)</span>.</p>
</div>
<div id="user-feedback-toasts" class="section level2">
<h2>
<span class="header-section-number">19.2</span> User feedback: toasts<a class="anchor" aria-label="anchor" href="#user-feedback-toasts"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Toasts</strong> are components to send discrete user feedback, contrary to modals which open in the middle of the page. Toasts may open on all sides of the window and are similar to the Shiny <strong>notifications</strong> (see <a href="https://shiny.rstudio.com/reference/shiny/0.14/showNotification.html">here</a>). The Tabler toast component is built on top of <a href="https://getbootstrap.com/docs/4.3/components/toasts/">Bootstrap 4</a>. Therefore, we rely on this documentation.</p>
<div id="toast-skeleton" class="section level3">
<h3>
<span class="header-section-number">19.2.1</span> Toast skeleton<a class="anchor" aria-label="anchor" href="#toast-skeleton"><i class="fas fa-link"></i></a>
</h3>
<p>The skeleton is the HTML structure of the toast:</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb681-1"><a href="custom-templates-interactivity.html#cb681-1"></a><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"toast show"</span><span class="ot"> role=</span><span class="st">"alert"</span><span class="ot"> aria-live=</span><span class="st">"assertive"</span> </span>
<span id="cb681-2"><a href="custom-templates-interactivity.html#cb681-2"></a><span class="ot">aria-atomic=</span><span class="st">"true"</span><span class="ot"> data-autohide=</span><span class="st">"false"</span><span class="ot"> data-toggle=</span><span class="st">"toast"</span><span class="kw">&gt;</span></span>
<span id="cb681-3"><a href="custom-templates-interactivity.html#cb681-3"></a>  <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"toast-header"</span><span class="kw">&gt;</span></span>
<span id="cb681-4"><a href="custom-templates-interactivity.html#cb681-4"></a>    <span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">"avatar mr-2"</span> </span>
<span id="cb681-5"><a href="custom-templates-interactivity.html#cb681-5"></a><span class="ot">    style=</span><span class="st">"background-image: url(...)"</span><span class="kw">&gt;&lt;/span&gt;</span></span>
<span id="cb681-6"><a href="custom-templates-interactivity.html#cb681-6"></a>    <span class="kw">&lt;strong</span><span class="ot"> class=</span><span class="st">"mr-auto"</span><span class="kw">&gt;</span>Mallory Hulme<span class="kw">&lt;/strong&gt;</span></span>
<span id="cb681-7"><a href="custom-templates-interactivity.html#cb681-7"></a>    <span class="kw">&lt;small&gt;</span>11 mins ago<span class="kw">&lt;/small&gt;</span></span>
<span id="cb681-8"><a href="custom-templates-interactivity.html#cb681-8"></a>    <span class="kw">&lt;button</span><span class="ot"> type=</span><span class="st">"button"</span><span class="ot"> class=</span><span class="st">"ml-2 close"</span> </span>
<span id="cb681-9"><a href="custom-templates-interactivity.html#cb681-9"></a><span class="ot">    data-dismiss=</span><span class="st">"toast"</span><span class="ot"> aria-label=</span><span class="st">"Close"</span><span class="kw">&gt;</span></span>
<span id="cb681-10"><a href="custom-templates-interactivity.html#cb681-10"></a>      <span class="kw">&lt;span</span><span class="ot"> aria-hidden=</span><span class="st">"true"</span><span class="kw">&gt;</span><span class="dv">&amp;times;</span><span class="kw">&lt;/span&gt;</span></span>
<span id="cb681-11"><a href="custom-templates-interactivity.html#cb681-11"></a>    <span class="kw">&lt;/button&gt;</span></span>
<span id="cb681-12"><a href="custom-templates-interactivity.html#cb681-12"></a>  <span class="kw">&lt;/div&gt;</span></span>
<span id="cb681-13"><a href="custom-templates-interactivity.html#cb681-13"></a>  <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"toast-body"</span><span class="kw">&gt;</span></span>
<span id="cb681-14"><a href="custom-templates-interactivity.html#cb681-14"></a>    Hello, world! This is a toast message.</span>
<span id="cb681-15"><a href="custom-templates-interactivity.html#cb681-15"></a>  <span class="kw">&lt;/div&gt;</span></span>
<span id="cb681-16"><a href="custom-templates-interactivity.html#cb681-16"></a><span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<p>Toasts are mainly composed of a header and a body. There might be a close button in case the toast does not hide itself after a period of time. If multiple toasts appear one after each others, they are stacked, the latest being at the bottom of the stack. The position is controlled with the style attribute like <code>style="position: absolute; top: 0; right: 0;"</code> for a top-right placement. Accessibility parameters like <code>aria-live</code> are detailed <a href="https://getbootstrap.com/docs/4.3/components/toasts/#accessibility">here</a>.</p>
</div>
<div id="the-toast-api" class="section level3">
<h3>
<span class="header-section-number">19.2.2</span> The toast API<a class="anchor" aria-label="anchor" href="#the-toast-api"><i class="fas fa-link"></i></a>
</h3>
<p>Toasts have a JS API to control their behavior, for instance <code>$('&lt;toast_selector&gt;').toast(option)</code>, where option is a <strong>JSON</strong> with the following fields:</p>
<ul>
<li>
<strong>animation</strong> applies a CSS fade transition to the toast and is TRUE by default.</li>
<li>
<strong>autohide</strong> automatically hides the toast (TRUE by default).</li>
<li>
<strong>delay</strong> is the delay to hide the toast (500 ms).</li>
</ul>
<p>There are three methods: <strong>hide</strong>, <strong>show</strong> and <strong>dispose</strong> (dispose ensures the toast does not appear anymore). Finally, we may fine tune the toast behavior with four events: <code>show.bs.toast</code>, <code>shown.bs.toast</code>, <code>hide.bs.toast</code>, <code>hidden.bs.toast</code> (like for tabs).</p>
</div>
<div id="r-implementation" class="section level3">
<h3>
<span class="header-section-number">19.2.3</span> R implementation<a class="anchor" aria-label="anchor" href="#r-implementation"><i class="fas fa-link"></i></a>
</h3>
<p>We first create the toast skeleton in a <code><a href="https://rdrr.io/pkg/OSUICode/man/tabler_toast.html">tabler_toast()</a></code> function. We assume our toast will eventually hide automatically, so we may remove the delete button as well as the <code>data-autohide="false</code> attribute. All parameters are optional except the toast id, which is required to toggle the toast:</p>
<div class="sourceCode" id="cb682"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tabler_toast</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">subtitle</span> <span class="op">=</span> <span class="cn">NULL</span>, 
                         <span class="va">...</span>, <span class="va">img</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># SEE BELOW</span>
<span class="op">}</span></code></pre></div>
<p>The first part of is the toast header, which is a direct translation of the above HTML structure. Notice how we handle optional parameters with <code>if (!is.null(&lt;PARAM&gt;))</code> so that the tag is not included if no value is given:</p>
<div class="sourceCode" id="cb683"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toast_header</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
  class <span class="op">=</span> <span class="st">"toast-header"</span>,
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span>
      class <span class="op">=</span> <span class="st">"avatar mr-2"</span>, 
      style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"background-image: url(%s)"</span>, <span class="va">img</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span>,
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">strong</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"mr-2"</span>, <span class="va">title</span><span class="op">)</span>,
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">subtitle</span><span class="op">)</span><span class="op">)</span> <span class="va">tags</span><span class="op">$</span><span class="fu">small</span><span class="op">(</span><span class="va">subtitle</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>The body is the simplest part, it receives the main content in <code>...</code>:</p>
<div class="sourceCode" id="cb684"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toast_body</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"toast-body"</span>, <span class="va">...</span><span class="op">)</span></code></pre></div>
<p>The wrapper is the external toast tag that will received both body and header elements, owing to <code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChildren()</a></code>:</p>
<div class="sourceCode" id="cb685"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toast_wrapper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="va">id</span>,
  class <span class="op">=</span> <span class="st">"toast"</span>,
  role <span class="op">=</span> <span class="st">"alert"</span>,
  style <span class="op">=</span> <span class="st">"position: absolute; top: 0; right: 0;"</span>,
  `aria-live` <span class="op">=</span> <span class="st">"assertive"</span>,
  `aria-atomic` <span class="op">=</span> <span class="st">"true"</span>,
  `data-toggle` <span class="op">=</span> <span class="st">"toast"</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChildren</a></span><span class="op">(</span><span class="va">toast_wrapper</span>, <span class="va">toast_header</span>, <span class="va">toast_body</span><span class="op">)</span></code></pre></div>
<p>The whole code may be found <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/blob/101248eabda2bd2682c73c2998dbe7d53cb5eb78/R/tabler.R#L820">here</a>.</p>
<p>We create the <code><a href="https://rdrr.io/pkg/OSUICode/man/show_tabler_toast.html">show_tabler_toast()</a></code> function. Since the toast automatically hides, it does not make sense to create the hide function, as well as the dispose:</p>
<div class="sourceCode" id="cb686"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">show_tabler_toast</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
  <span class="va">id</span>, 
  <span class="va">options</span> <span class="op">=</span> <span class="cn">NULL</span>, 
  <span class="va">session</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/domains.html">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span> <span class="op">{</span>
  <span class="va">message</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/dropNulls.html">dropNulls</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="va">session</span><span class="op">$</span><span class="fu">ns</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,
      options <span class="op">=</span> <span class="va">options</span>
    <span class="op">)</span>
  <span class="op">)</span>
  <span class="va">session</span><span class="op">$</span><span class="fu">sendCustomMessage</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"tabler-toast"</span>, <span class="va">message</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Let’s design the corresponding JS handler. We first configure the toast and show it. Notice how we chained jQuery methods (see Chapter <a href="survival-kit-javascript.html#survival-kit-javascript">10</a>). We optionally add an <strong>event listener</strong> to capture the <code>hidden.bs.toast</code> event, so that we may trigger an action when the toast is closed. The <code>input$id</code> is used for that purpose in combination with the <code>Shiny.setInputValue</code>. Notice the extra parameter <code>{priority: 'event'}</code>: basically, once the toast is closed, <code>input$id</code> is always <code>TRUE</code>, thereby breaking the <strong>reactivity</strong>. Adding this extra parameter <strong>forces</strong> the evaluation of the input, although constant over time.</p>
<div class="sourceCode" id="cb687"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb687-1"><a href="custom-templates-interactivity.html#cb687-1"></a><span class="at">$</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb687-2"><a href="custom-templates-interactivity.html#cb687-2"></a>  <span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(</span>
<span id="cb687-3"><a href="custom-templates-interactivity.html#cb687-3"></a>    <span class="st">'tabler-toast'</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb687-4"><a href="custom-templates-interactivity.html#cb687-4"></a>      <span class="at">$</span>(<span class="vs">`#</span><span class="sc">${</span><span class="va">message</span>.<span class="at">id</span><span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb687-5"><a href="custom-templates-interactivity.html#cb687-5"></a>        .<span class="at">toast</span>(<span class="va">message</span>.<span class="at">options</span>)</span>
<span id="cb687-6"><a href="custom-templates-interactivity.html#cb687-6"></a>        .<span class="at">toast</span>(<span class="st">'show'</span>)<span class="op">;</span></span>
<span id="cb687-7"><a href="custom-templates-interactivity.html#cb687-7"></a></span>
<span id="cb687-8"><a href="custom-templates-interactivity.html#cb687-8"></a>      <span class="co">// add custom Shiny input to listen to the toast state</span></span>
<span id="cb687-9"><a href="custom-templates-interactivity.html#cb687-9"></a>      <span class="at">$</span>(<span class="vs">`#</span><span class="sc">${</span><span class="va">message</span>.<span class="at">id</span><span class="sc">}</span><span class="vs">`</span>).<span class="at">one</span>(<span class="st">'hidden.bs.toast'</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb687-10"><a href="custom-templates-interactivity.html#cb687-10"></a>        <span class="va">Shiny</span>.<span class="at">setInputValue</span>(</span>
<span id="cb687-11"><a href="custom-templates-interactivity.html#cb687-11"></a>          <span class="va">message</span>.<span class="at">id</span><span class="op">,</span> </span>
<span id="cb687-12"><a href="custom-templates-interactivity.html#cb687-12"></a>          <span class="kw">true</span><span class="op">,</span> </span>
<span id="cb687-13"><a href="custom-templates-interactivity.html#cb687-13"></a>          <span class="op">{</span><span class="dt">priority</span><span class="op">:</span> <span class="st">'event'</span><span class="op">}</span></span>
<span id="cb687-14"><a href="custom-templates-interactivity.html#cb687-14"></a>        )<span class="op">;</span></span>
<span id="cb687-15"><a href="custom-templates-interactivity.html#cb687-15"></a>      <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb687-16"><a href="custom-templates-interactivity.html#cb687-16"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb687-17"><a href="custom-templates-interactivity.html#cb687-17"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb688"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "tabler/toast" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_page.html">tabler_page</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_toast.html">tabler_toast</a></span><span class="op">(</span>
    id <span class="op">=</span> <span class="st">"toast"</span>,
    title <span class="op">=</span> <span class="st">"Hello"</span>,
    subtitle <span class="op">=</span> <span class="st">"now"</span>,
    <span class="st">"Toast body"</span>,
    img <span class="op">=</span> <span class="st">"https://preview-dev.tabler.io/static/logo.svg"</span>
  <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_button.html">tabler_button</a></span><span class="op">(</span><span class="st">"launch"</span>, <span class="st">"Go!"</span>, width <span class="op">=</span> <span class="st">"25%"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observe.html">observe</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">toast</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">launch</span>, <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">removeNotification</a></span><span class="op">(</span><span class="st">"notif"</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/show_tabler_toast.html">show_tabler_toast</a></span><span class="op">(</span>
      <span class="st">"toast"</span>,
      options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        animation <span class="op">=</span> <span class="cn">FALSE</span>,
        delay <span class="op">=</span> <span class="fl">3000</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">toast</span>, <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"notif"</span>,
      <span class="st">"Toast was closed"</span>,
      type <span class="op">=</span> <span class="st">"warning"</span>,
      duration <span class="op">=</span> <span class="fl">1</span>,

    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:tabler-toast"></span>
<img src="images/practice/tabler-toast.png" alt="Tabler toast element" width="100%"><p class="caption">
FIGURE 19.3: Tabler toast element
</p>
</div>
</div>
<div id="exercise-2" class="section level3">
<h3>
<span class="header-section-number">19.2.4</span> Exercise<a class="anchor" aria-label="anchor" href="#exercise-2"><i class="fas fa-link"></i></a>
</h3>
<p>Based on the Tabler <a href="https://preview-dev.tabler.io/docs/tooltips.html">documentation</a>, add the <code>tabler_tooltip()</code> function. Hint: you may also check the corresponding Bootstrap 4 help.</p>
</div>
</div>
<div id="transform-an-element-in-a-custom-action-button" class="section level2">
<h2>
<span class="header-section-number">19.3</span> Transform an element in a custom action button<a class="anchor" aria-label="anchor" href="#transform-an-element-in-a-custom-action-button"><i class="fas fa-link"></i></a>
</h2>
<p>As seen in Chapter <a href="custom-templates-inputs.html#custom-templates-inputs">18</a>, any <code>&lt;button&gt;</code>, <code>&lt;a&gt;</code> element holding the <code>action-button</code> class may eventually become an action button. The Tabler template has dropdown menus in the navbar and we would like to transform those dropdown items in action buttons. The <code><a href="https://rdrr.io/pkg/OSUICode/man/tabler_dropdown.html">tabler_dropdown()</a></code> function takes the following parameters:</p>
<ul>
<li>
<strong>id</strong> is required by the <code><a href="https://rdrr.io/pkg/OSUICode/man/show_tabler_dropdown.html">show_tabler_dropdown()</a></code> (see below) function which opens the menu.</li>
<li>
<strong>title</strong> is the dropdown menu name.</li>
<li>
<strong>subtitle</strong> is optional text.</li>
<li>
<strong>img</strong> is an optional image.</li>
<li>
<strong>…</strong> hosts the <code><a href="https://rdrr.io/pkg/OSUICode/man/tabler_dropdown_item.html">tabler_dropdown_item()</a></code> (see below).</li>
</ul>
<div class="sourceCode" id="cb689"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tabler_dropdown</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">id</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">title</span>, 
                            <span class="va">subtitle</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">img</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># SEE BELOW</span>
<span class="op">}</span></code></pre></div>
<p>We proceed step by step. The image tag is:</p>
<div class="sourceCode" id="cb690"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">img_tag</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"avatar"</span>, 
    style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"background-image: url(%s)"</span>, <span class="va">img</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The title tag accepts both <code>title</code> and <code>subtitle</code> parameters. It is given by:</p>
<div class="sourceCode" id="cb691"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">title_tag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
  class <span class="op">=</span> <span class="st">"d-none d-xl-block pl-2"</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>,
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">subtitle</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"mt-1 small text-muted"</span>, <span class="va">subtitle</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">)</span></code></pre></div>
<p>The link tag contains both image tag and title tag:</p>
<div class="sourceCode" id="cb692"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">link_tag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChildren</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">a</a></span><span class="op">(</span>
    href <span class="op">=</span> <span class="st">"#"</span>,
    id <span class="op">=</span> <span class="va">id</span>, 
    class <span class="op">=</span> <span class="st">"nav-link d-flex lh-1 text-reset p-0"</span>,
    `data-toggle` <span class="op">=</span> <span class="st">"dropdown"</span>,
    `aria-expanded` <span class="op">=</span> <span class="st">"false"</span>
  <span class="op">)</span>,
  <span class="va">img_tag</span>, 
  <span class="va">title_tag</span>
<span class="op">)</span></code></pre></div>
<p>The dropdown tag receives the main content:</p>
<div class="sourceCode" id="cb693"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dropdown_tag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
  class <span class="op">=</span> <span class="st">"dropdown-menu dropdown-menu-right"</span>, 
  `aria-labelledby` <span class="op">=</span> <span class="va">id</span>, 
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
<p>Both link tag and dropdown tag are wrapped in an external tag:</p>
<div class="sourceCode" id="cb694"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChildren</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"nav-item dropdown"</span><span class="op">)</span>, 
  <span class="va">link_tag</span>,
  <span class="va">dropdown_tag</span>
<span class="op">)</span></code></pre></div>
<p>The whole code is located <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/blob/101248eabda2bd2682c73c2998dbe7d53cb5eb78/R/tabler.R#L926">here</a>.</p>
<p>To convert a dropdown item in an action button, we add the <code>action-button</code> class as well as the <code>id</code> parameter to recover the corresponding input id.</p>
<div class="sourceCode" id="cb695"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tabler_dropdown_item</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">id</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">a</a></span><span class="op">(</span>
    id <span class="op">=</span> <span class="va">id</span>, 
    class <span class="op">=</span> <span class="st">"dropdown-item action-button"</span>, 
    href <span class="op">=</span> <span class="st">"#"</span>, 
    <span class="va">...</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We finally create the <code><a href="https://rdrr.io/pkg/OSUICode/man/show_tabler_dropdown.html">show_tabler_dropdown()</a></code> as well as the corresponding Shiny message handler.</p>
<div class="sourceCode" id="cb696"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">show_tabler_dropdown</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
  <span class="va">id</span>, 
  <span class="va">session</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/domains.html">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span> <span class="op">{</span>
  <span class="va">session</span><span class="op">$</span><span class="fu">sendCustomMessage</span><span class="op">(</span>
    type <span class="op">=</span> <span class="st">"show-dropdown"</span>, 
    message <span class="op">=</span> <span class="va">session</span><span class="op">$</span><span class="fu">ns</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>To show the dropdown, we use the <strong>dropdown</strong> method which is linked to the <code>data-toggle="dropdown"</code> of <code><a href="https://rdrr.io/pkg/OSUICode/man/tabler_dropdown.html">tabler_dropdown()</a></code>.</p>
<div class="sourceCode" id="cb697"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb697-1"><a href="custom-templates-interactivity.html#cb697-1"></a><span class="at">$</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb697-2"><a href="custom-templates-interactivity.html#cb697-2"></a>  <span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(</span>
<span id="cb697-3"><a href="custom-templates-interactivity.html#cb697-3"></a>   <span class="st">'show-dropdown'</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb697-4"><a href="custom-templates-interactivity.html#cb697-4"></a>      <span class="at">$</span>(<span class="vs">`#</span><span class="sc">${</span>message<span class="sc">}</span><span class="vs">`</span>).<span class="at">dropdown</span>(<span class="st">'show'</span>)<span class="op">;</span></span>
<span id="cb697-5"><a href="custom-templates-interactivity.html#cb697-5"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb697-6"><a href="custom-templates-interactivity.html#cb697-6"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Let’s play with it (Figure <a href="custom-templates-interactivity.html#fig:tabler-dropdown">19.4</a>).</p>
<div class="sourceCode" id="cb698"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "tabler/dropdown" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_page.html">tabler_page</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_navbar.html">tabler_navbar</a></span><span class="op">(</span>
    brand_url <span class="op">=</span> <span class="st">"https://preview-dev.tabler.io"</span>,
    brand_image <span class="op">=</span> <span class="st">"https://preview-dev.tabler.io/static/logo.svg"</span>,
    nav_menu <span class="op">=</span> <span class="cn">NULL</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_dropdown.html">tabler_dropdown</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"mydropdown"</span>,
      title <span class="op">=</span> <span class="st">"Dropdown"</span>,
      subtitle <span class="op">=</span> <span class="st">"click me"</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_dropdown_item.html">tabler_dropdown_item</a></span><span class="op">(</span>
        id <span class="op">=</span> <span class="st">"item1"</span>,
        <span class="st">"Show Notification"</span>
      <span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_dropdown_item.html">tabler_dropdown_item</a></span><span class="op">(</span>
        <span class="st">"Do nothing"</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_body.html">tabler_body</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_button.html">tabler_button</a></span><span class="op">(</span><span class="st">"show"</span>, <span class="st">"Open dropdown"</span>, width <span class="op">=</span> <span class="st">"25%"</span><span class="op">)</span>,
    footer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/tabler_footer.html">tabler_footer</a></span><span class="op">(</span>
      left <span class="op">=</span> <span class="st">"Rstats, 2020"</span>,
      right <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">a</a></span><span class="op">(</span>href <span class="op">=</span> <span class="st">"https://www.google.com"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>

  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">show</span>, <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/show_tabler_dropdown.html">show_tabler_dropdown</a></span><span class="op">(</span><span class="st">"mydropdown"</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">item1</span>, <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span>
      <span class="st">"Success"</span>,
      type <span class="op">=</span> <span class="st">"message"</span>,
      duration <span class="op">=</span> <span class="fl">2</span>,

    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:tabler-dropdown"></span>
<img src="images/practice/tabler-dropdown.png" alt="Tabler dropdown element" width="100%"><p class="caption">
FIGURE 19.4: Tabler dropdown element
</p>
</div>
</div>
<div id="tab-events" class="section level2">
<h2>
<span class="header-section-number">19.4</span> Tab events<a class="anchor" aria-label="anchor" href="#tab-events"><i class="fas fa-link"></i></a>
</h2>
<p>Do you remember about the navbar element and the <strong>tabsetpanel</strong> system of Chapter <a href="custom-templates-skeleton.html#custom-templates-skeleton">17</a>? <strong>Navs</strong> allow to organize any app into several tabs, acting like a multi pages application. This is a powerful tool for Shiny since it is currently not straightforward to create <a href="https://community.rstudio.com/t/shiny-app-composed-of-many-many-pages/7698">multi-pages</a> Shiny apps like anyone would do in a standard website. Navs rely on the Bootstrap 4 API but we only use a few JS functions.</p>
<div id="insert-tabs" class="section level3">
<h3>
<span class="header-section-number">19.4.1</span> Insert/Remove tabs in tabsetpanel<a class="anchor" aria-label="anchor" href="#insert-tabs"><i class="fas fa-link"></i></a>
</h3>
<p>How about dynamically inserting/removing tabs from a <code><a href="https://rdrr.io/pkg/OSUICode/man/tabler_navbar.html">tabler_navbar()</a></code>? We chose this example since it involves extra technical details about Shiny, especially process extra dependencies at render time.</p>
<p>How do we proceed? If you recall about the <code><a href="https://rdrr.io/pkg/OSUICode/man/tabler_navbar_menu_item.html">tabler_navbar_menu_item()</a></code> and <code><a href="https://rdrr.io/pkg/OSUICode/man/tabler_tab_item.html">tabler_tab_item()</a></code> coupling, inserting a tab implies to insert the trigger in the navigation menu as well as the content in the dashboard body. Therefore, we need to know the structure of what we insert. Below is a reminder:</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/OSUICode/man/tabler_navbar_menu_item.html">tabler_navbar_menu_item()</a></code> are <code>&lt;li&gt;</code> elements.</li>
<li>
<code><a href="https://rdrr.io/pkg/OSUICode/man/tabler_tab_item.html">tabler_tab_item()</a></code> is a <code>&lt;div&gt;</code> element with specific classes.</li>
</ul>
<div class="sourceCode" id="cb699"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb699-1"><a href="custom-templates-interactivity.html#cb699-1"></a><span class="kw">&lt;li</span><span class="ot"> class=</span><span class="st">"nav-item"</span><span class="kw">&gt;</span></span>
<span id="cb699-2"><a href="custom-templates-interactivity.html#cb699-2"></a>  <span class="kw">&lt;a</span><span class="ot"> class=</span><span class="st">"nav-link"</span><span class="ot"> href=</span><span class="st">"#ww"</span><span class="ot"> data-toggle=</span><span class="st">"pill"</span><span class="ot"> data-value=</span><span class="st">"ww"</span><span class="ot"> role=</span><span class="st">"tab"</span><span class="kw">&gt;</span></span>
<span id="cb699-3"><a href="custom-templates-interactivity.html#cb699-3"></a>    <span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">"nav-link-icon d-md-none d-lg-inline-block"</span><span class="kw">&gt;&lt;/span&gt;</span></span>
<span id="cb699-4"><a href="custom-templates-interactivity.html#cb699-4"></a>    <span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">"nav-link-title"</span><span class="kw">&gt;</span>ww<span class="kw">&lt;/span&gt;</span></span>
<span id="cb699-5"><a href="custom-templates-interactivity.html#cb699-5"></a>  <span class="kw">&lt;/a&gt;</span></span>
<span id="cb699-6"><a href="custom-templates-interactivity.html#cb699-6"></a><span class="kw">&lt;/li&gt;</span></span>
<span id="cb699-7"><a href="custom-templates-interactivity.html#cb699-7"></a></span>
<span id="cb699-8"><a href="custom-templates-interactivity.html#cb699-8"></a><span class="kw">&lt;div</span><span class="ot"> role=</span><span class="st">"tabpanel"</span><span class="ot"> class=</span><span class="st">"tab-pane fade container-fluid"</span><span class="ot"> id=</span><span class="st">"ww"</span><span class="kw">&gt;&lt;/div&gt;</span></span></code></pre></div>
<p>We design the <code><a href="https://rdrr.io/pkg/OSUICode/man/insert_tabler_tab.html">insert_tabler_tab()</a></code> function similar to the Shiny <code><a href="https://rdrr.io/pkg/shiny/man/insertTab.html">insertTab()</a></code>.</p>
<div class="sourceCode" id="cb700"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">insert_tabler_tab</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
  <span class="va">inputId</span>, 
  <span class="va">tab</span>, 
  <span class="va">target</span>, 
  <span class="va">position</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"before"</span>, <span class="st">"after"</span><span class="op">)</span>,
  <span class="va">select</span> <span class="op">=</span> <span class="cn">FALSE</span>, 
  <span class="va">session</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/domains.html">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span> <span class="op">{</span>
  <span class="co"># SEE BELOW</span>
<span class="op">}</span></code></pre></div>
<p>To handle shiny modules, we wrap the <strong>inputId</strong> in the session namespace <strong>session$ns</strong>.</p>
<div class="sourceCode" id="cb701"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inputId</span> <span class="op">&lt;-</span> <span class="va">session</span><span class="op">$</span><span class="fu">ns</span><span class="op">(</span><span class="va">inputId</span><span class="op">)</span></code></pre></div>
<p>We recover the provided new tab position, leveraging <code><a href="https://rdrr.io/r/base/match.arg.html">match.arg()</a></code>:</p>
<div class="sourceCode" id="cb702"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">position</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html">match.arg</a></span><span class="op">(</span><span class="va">position</span><span class="op">)</span></code></pre></div>
<p>We create the menu item element based on the new tab and the above HTML structure:</p>
<div class="sourceCode" id="cb703"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">navbar_menu_item</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span>
  class <span class="op">=</span> <span class="st">"nav-item"</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">a</a></span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"nav-link"</span>,
    href <span class="op">=</span> <span class="st">"#"</span>,
    `data-target` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"#"</span>, <span class="va">session</span><span class="op">$</span><span class="fu">ns</span><span class="op">(</span><span class="va">tab</span><span class="op">$</span><span class="va">attribs</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>,
    `data-toggle` <span class="op">=</span> <span class="st">"pill"</span>,
    `data-value` <span class="op">=</span> <span class="va">tab</span><span class="op">$</span><span class="va">attribs</span><span class="op">$</span><span class="va">id</span>,
    role <span class="op">=</span> <span class="st">"tab"</span>,
    <span class="va">tab</span><span class="op">$</span><span class="va">attribs</span><span class="op">$</span><span class="va">id</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Since JS does not understand Shiny tags, we have to convert both tab and the nav link to character:</p>
<div class="sourceCode" id="cb704"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span>
<span class="va">navbar_menu_item</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">navbar_menu_item</span><span class="op">)</span></code></pre></div>
<p>We finally, build our message as a list, whose <code>NULL</code> elements are handled by <code><a href="https://rdrr.io/pkg/OSUICode/man/dropNulls.html">dropNulls()</a></code> and send it to JS with <code>session$sendCustomMessage</code>.</p>
<div class="sourceCode" id="cb705"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">message</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/dropNulls.html">dropNulls</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      inputId <span class="op">=</span> <span class="va">inputId</span>,
      content <span class="op">=</span> <span class="va">tab</span>,
      link <span class="op">=</span> <span class="va">navbar_menu_item</span>,
      target <span class="op">=</span> <span class="va">target</span>,
      position <span class="op">=</span> <span class="va">position</span>,
      select <span class="op">=</span> <span class="va">select</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="va">session</span><span class="op">$</span><span class="fu">sendCustomMessage</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"insert-tab-1"</span>, <span class="va">message</span><span class="op">)</span></code></pre></div>
<p>On the JS side, we capture the R message (list) in two elements:</p>
<ul>
<li>
<code>$divTag</code> contains the tab <strong>content</strong>.</li>
<li>
<code>$liTag</code> contains the tab link, ie the <strong>navigation</strong> part.</li>
</ul>
<p>Depending on the position parameter, we use the <code>insertAfter()</code> and <code>insertBefore()</code> jQuery methods. Finally, if the newly inserted tab has to be selected, we activate the corresponding tab element with <code>$(tablink).tab('show')</code>.</p>
<div class="sourceCode" id="cb706"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb706-1"><a href="custom-templates-interactivity.html#cb706-1"></a><span class="at">$</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb706-2"><a href="custom-templates-interactivity.html#cb706-2"></a>  <span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(</span>
<span id="cb706-3"><a href="custom-templates-interactivity.html#cb706-3"></a>    <span class="st">'insert-tab-1'</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb706-4"><a href="custom-templates-interactivity.html#cb706-4"></a>      <span class="co">// define div and li targets</span></span>
<span id="cb706-5"><a href="custom-templates-interactivity.html#cb706-5"></a>      <span class="kw">let</span> $divTag <span class="op">=</span> <span class="at">$</span>(<span class="va">message</span>.<span class="at">content</span>)<span class="op">;</span></span>
<span id="cb706-6"><a href="custom-templates-interactivity.html#cb706-6"></a>      <span class="kw">let</span> $liTag <span class="op">=</span> <span class="at">$</span>(<span class="va">message</span>.<span class="at">link</span>)<span class="op">;</span></span>
<span id="cb706-7"><a href="custom-templates-interactivity.html#cb706-7"></a>      <span class="kw">let</span> targetId <span class="op">=</span> <span class="st">'#'</span> <span class="op">+</span> <span class="va">message</span>.<span class="at">target</span><span class="op">;</span></span>
<span id="cb706-8"><a href="custom-templates-interactivity.html#cb706-8"></a>      <span class="cf">if</span> (<span class="va">message</span>.<span class="at">position</span> <span class="op">===</span> <span class="st">'after'</span>) <span class="op">{</span></span>
<span id="cb706-9"><a href="custom-templates-interactivity.html#cb706-9"></a>        <span class="va">$divTag</span>.<span class="at">insertAfter</span>(<span class="at">$</span>(targetId))<span class="op">;</span></span>
<span id="cb706-10"><a href="custom-templates-interactivity.html#cb706-10"></a>        <span class="va">$liTag</span>.<span class="at">insertAfter</span>(</span>
<span id="cb706-11"><a href="custom-templates-interactivity.html#cb706-11"></a>          <span class="at">$</span>(<span class="st">'[data-target="'</span> <span class="op">+</span> targetId <span class="op">+</span> <span class="st">'"]'</span>)</span>
<span id="cb706-12"><a href="custom-templates-interactivity.html#cb706-12"></a>            .<span class="at">parent</span>()</span>
<span id="cb706-13"><a href="custom-templates-interactivity.html#cb706-13"></a>        )<span class="op">;</span></span>
<span id="cb706-14"><a href="custom-templates-interactivity.html#cb706-14"></a>      <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (<span class="va">message</span>.<span class="at">position</span> <span class="op">===</span> <span class="st">'before'</span>) <span class="op">{</span></span>
<span id="cb706-15"><a href="custom-templates-interactivity.html#cb706-15"></a>        <span class="va">$divTag</span>.<span class="at">insertBefore</span>(<span class="at">$</span>(targetId))<span class="op">;</span></span>
<span id="cb706-16"><a href="custom-templates-interactivity.html#cb706-16"></a>        <span class="va">$liTag</span>.<span class="at">insertBefore</span>(</span>
<span id="cb706-17"><a href="custom-templates-interactivity.html#cb706-17"></a>          <span class="at">$</span>(<span class="st">'[data-target="'</span> <span class="op">+</span> targetId <span class="op">+</span> <span class="st">'"]'</span>)</span>
<span id="cb706-18"><a href="custom-templates-interactivity.html#cb706-18"></a>            .<span class="at">parent</span>()</span>
<span id="cb706-19"><a href="custom-templates-interactivity.html#cb706-19"></a>        )<span class="op">;</span></span>
<span id="cb706-20"><a href="custom-templates-interactivity.html#cb706-20"></a>      <span class="op">}</span></span>
<span id="cb706-21"><a href="custom-templates-interactivity.html#cb706-21"></a>      </span>
<span id="cb706-22"><a href="custom-templates-interactivity.html#cb706-22"></a>      <span class="cf">if</span> (<span class="va">message</span>.<span class="at">select</span>) <span class="op">{</span></span>
<span id="cb706-23"><a href="custom-templates-interactivity.html#cb706-23"></a>        <span class="co">// trigger a click on corresponding the new tab button. </span></span>
<span id="cb706-24"><a href="custom-templates-interactivity.html#cb706-24"></a>        <span class="kw">let</span> newTabId <span class="op">=</span> <span class="va">$divTag</span>.<span class="at">attr</span>(<span class="st">'id'</span>)<span class="op">;</span></span>
<span id="cb706-25"><a href="custom-templates-interactivity.html#cb706-25"></a>        <span class="at">$</span>(<span class="st">'#'</span> <span class="op">+</span> </span>
<span id="cb706-26"><a href="custom-templates-interactivity.html#cb706-26"></a>          <span class="va">message</span>.<span class="at">inputId</span> <span class="op">+</span> </span>
<span id="cb706-27"><a href="custom-templates-interactivity.html#cb706-27"></a>          <span class="st">' a[data-target="#'</span> <span class="op">+</span> </span>
<span id="cb706-28"><a href="custom-templates-interactivity.html#cb706-28"></a>          newTabId <span class="op">+</span><span class="st">'"]'</span>).<span class="at">tab</span>(<span class="st">'show'</span>)<span class="op">;</span></span>
<span id="cb706-29"><a href="custom-templates-interactivity.html#cb706-29"></a>      <span class="op">}</span></span>
<span id="cb706-30"><a href="custom-templates-interactivity.html#cb706-30"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb706-31"><a href="custom-templates-interactivity.html#cb706-31"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb707"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "tabler/insert-tab-1" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span></code></pre></div>
<p>If the tab is well inserted, we notice that the slider and the plot are not properly shown, as illustrated in Figure <a href="custom-templates-interactivity.html#fig:tabler-insert-tab-fail">19.5</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:tabler-insert-tab-fail"></span>
<img src="images/practice/tabler-insert-tab-fail.png" alt="The newly inserted tab fails to render its content!" width="100%"><p class="caption">
FIGURE 19.5: The newly inserted tab fails to render its content!
</p>
</div>
<p>How could we explain that? It is a <strong>dependency</strong> issue: the slider input relies on a specific JS <a href="http://ionden.com/a/plugins/ion.rangeSlider/">library</a>, namely ionRangesSlider, as depicted in Figure <a href="custom-templates-interactivity.html#fig:slider-deps">19.6</a>. In our previous example, if you open the HTML inspector, the dependency is not included in the page.</p>
<div class="figure">
<span style="display:block;" id="fig:slider-deps"></span>
<img src="images/practice/slider-deps.png" alt="Slider dependencies." width="100%"><p class="caption">
FIGURE 19.6: Slider dependencies.
</p>
</div>
<p>Even stranger, when we use <code><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI()</a></code> to conditionally render the slider, the dependency is only included when the go button is pressed. How does Shiny include them?</p>
<div class="sourceCode" id="cb708"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "tabler/renderUI" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"go"</span>, <span class="st">"Go!"</span>, class <span class="op">=</span> <span class="st">"btn-success"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">uiOutput</a></span><span class="op">(</span><span class="st">"slider"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"distPlot"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Server logic</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">output</span><span class="op">$</span><span class="va">slider</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span>
      <span class="st">"obs"</span>,
      <span class="st">"Number of observations:"</span>,
      min <span class="op">=</span> <span class="fl">0</span>,
      max <span class="op">=</span> <span class="fl">1000</span>,
      value <span class="op">=</span> <span class="fl">500</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>

  <span class="va">output</span><span class="op">$</span><span class="va">distPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Complete app with UI and server components</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>Let’s look at <code><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI()</a></code>:</p>
<div class="sourceCode" id="cb709"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">renderUI</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span>
  <span class="va">expr</span>, 
  <span class="va">env</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="op">)</span>, 
  <span class="va">quoted</span> <span class="op">=</span> <span class="cn">FALSE</span>, 
  <span class="va">outputArgs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/installExprFunction.html">installExprFunction</a></span><span class="op">(</span><span class="va">expr</span>, <span class="st">"func"</span>, <span class="va">env</span>, <span class="va">quoted</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/createRenderFunction.html">createRenderFunction</a></span><span class="op">(</span><span class="va">func</span>, <span class="kw">function</span><span class="op">(</span><span class="va">result</span>, <span class="va">shinysession</span>, 
                                      <span class="va">name</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> 
      <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span>
    <span class="fu">processDeps</span><span class="op">(</span><span class="va">result</span>, <span class="va">shinysession</span><span class="op">)</span>
  <span class="op">}</span>, <span class="va">uiOutput</span>, <span class="va">outputArgs</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The last line returned is <code>processDeps(result, shinysession)</code>. As stated in section <a href="shiny-custom-handler.html#insert-ui">15.3</a>, this function is responsible to handle dependencies during run time. <code>shiny:::processDeps</code> (R side) works with <code>Shiny.renderContent</code> (JS side), as already mentioned in part 15.3. The latter takes a tag element as well as an object containing its HTML code and dependencies, for instance:</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb710-1"><a href="custom-templates-interactivity.html#cb710-1"></a><span class="va">exports</span>.<span class="at">renderContent</span>($tag[<span class="dv">0</span>]<span class="op">,</span> <span class="op">{</span></span>
<span id="cb710-2"><a href="custom-templates-interactivity.html#cb710-2"></a>  <span class="dt">html</span><span class="op">:</span> <span class="va">$tag</span>.<span class="at">html</span>()<span class="op">,</span></span>
<span id="cb710-3"><a href="custom-templates-interactivity.html#cb710-3"></a>  <span class="dt">deps</span><span class="op">:</span> <span class="va">message</span>.<span class="va">tag</span>.<span class="at">deps</span></span>
<span id="cb710-4"><a href="custom-templates-interactivity.html#cb710-4"></a><span class="op">}</span>)<span class="op">;</span>  </span></code></pre></div>
<p>Note that, as it is bad practice to rely on other packages internal functions, we’ll rely on <code><a href="https://rdrr.io/pkg/htmltools/man/renderTags.html">htmltools::renderTags</a></code> instead of <code>shiny:::processDeps</code>, being very similar.</p>
<p>In the following, we modify the <code><a href="https://rdrr.io/pkg/OSUICode/man/insert_tabler_tab.html">insert_tabler_tab()</a></code> to include the dependencies processing step. This actually requires to change only three lines of code (the last one consists in pointing to the new JS handler):</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="custom-templates-interactivity.html#cb711-1"></a>insert_tabler_tab_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb711-2"><a href="custom-templates-interactivity.html#cb711-2"></a>  inputId, </span>
<span id="cb711-3"><a href="custom-templates-interactivity.html#cb711-3"></a>  tab, </span>
<span id="cb711-4"><a href="custom-templates-interactivity.html#cb711-4"></a>  target, </span>
<span id="cb711-5"><a href="custom-templates-interactivity.html#cb711-5"></a>  <span class="dt">position =</span> <span class="kw">c</span>(<span class="st">"before"</span>, <span class="st">"after"</span>),</span>
<span id="cb711-6"><a href="custom-templates-interactivity.html#cb711-6"></a>  <span class="dt">select =</span> <span class="ot">FALSE</span>, </span>
<span id="cb711-7"><a href="custom-templates-interactivity.html#cb711-7"></a>  <span class="dt">session =</span> <span class="kw">getDefaultReactiveDomain</span>()</span>
<span id="cb711-8"><a href="custom-templates-interactivity.html#cb711-8"></a>) {</span>
<span id="cb711-9"><a href="custom-templates-interactivity.html#cb711-9"></a>  </span>
<span id="cb711-10"><a href="custom-templates-interactivity.html#cb711-10"></a>  <span class="co"># ... Unchanged</span></span>
<span id="cb711-11"><a href="custom-templates-interactivity.html#cb711-11"></a>  </span>
<span id="cb711-12"><a href="custom-templates-interactivity.html#cb711-12"></a>  content &lt;-<span class="st"> </span>htmltools<span class="op">::</span><span class="kw">renderTags</span>(tab),</span>
<span id="cb711-13"><a href="custom-templates-interactivity.html#cb711-13"></a>  link &lt;-<span class="st"> </span>htmltools<span class="op">::</span><span class="kw">renderTags</span>(navbar_menu_item),</span>
<span id="cb711-14"><a href="custom-templates-interactivity.html#cb711-14"></a>  </span>
<span id="cb711-15"><a href="custom-templates-interactivity.html#cb711-15"></a>  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="st">"insert-tab-2"</span>, message)</span>
<span id="cb711-16"><a href="custom-templates-interactivity.html#cb711-16"></a>}</span></code></pre></div>
<p>We then apply the <code>Shiny.renderContent</code> method to the tab content and navigation item. Below, we only show what changed compared to the first handler defined earlier:</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb712-1"><a href="custom-templates-interactivity.html#cb712-1"></a><span class="at">$</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb712-2"><a href="custom-templates-interactivity.html#cb712-2"></a>  <span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(<span class="st">'insert-tab-2'</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb712-3"><a href="custom-templates-interactivity.html#cb712-3"></a>    <span class="co">// message.content and message.link are objects</span></span>
<span id="cb712-4"><a href="custom-templates-interactivity.html#cb712-4"></a>    <span class="co">// with 2 fields: html (tag) and deps (dependencies)</span></span>
<span id="cb712-5"><a href="custom-templates-interactivity.html#cb712-5"></a>    <span class="co">// We only need HTML for now.</span></span>
<span id="cb712-6"><a href="custom-templates-interactivity.html#cb712-6"></a>    <span class="kw">let</span> $divTag <span class="op">=</span> <span class="at">$</span>(<span class="va">message</span>.<span class="va">content</span>.<span class="at">html</span>)<span class="op">;</span></span>
<span id="cb712-7"><a href="custom-templates-interactivity.html#cb712-7"></a>    <span class="kw">let</span> $liTag <span class="op">=</span> <span class="at">$</span>(<span class="va">message</span>.<span class="va">link</span>.<span class="at">html</span>)<span class="op">;</span></span>
<span id="cb712-8"><a href="custom-templates-interactivity.html#cb712-8"></a>    </span>
<span id="cb712-9"><a href="custom-templates-interactivity.html#cb712-9"></a>    <span class="co">// Unchanged</span></span>
<span id="cb712-10"><a href="custom-templates-interactivity.html#cb712-10"></a>    </span>
<span id="cb712-11"><a href="custom-templates-interactivity.html#cb712-11"></a>    <span class="co">// Render input/output in newly added tab.</span></span>
<span id="cb712-12"><a href="custom-templates-interactivity.html#cb712-12"></a>    <span class="co">// It takes the possible deps and add them to the tag. </span></span>
<span id="cb712-13"><a href="custom-templates-interactivity.html#cb712-13"></a>    <span class="va">Shiny</span>.<span class="at">renderContent</span>(</span>
<span id="cb712-14"><a href="custom-templates-interactivity.html#cb712-14"></a>      $liTag[<span class="dv">0</span>]<span class="op">,</span> </span>
<span id="cb712-15"><a href="custom-templates-interactivity.html#cb712-15"></a>      <span class="op">{</span><span class="dt">html</span><span class="op">:</span> <span class="va">$liTag</span>.<span class="at">html</span>()<span class="op">,</span> <span class="dt">deps</span><span class="op">:</span> <span class="va">message</span>.<span class="va">link</span>.<span class="at">dependencies</span><span class="op">}</span></span>
<span id="cb712-16"><a href="custom-templates-interactivity.html#cb712-16"></a>    )<span class="op">;</span></span>
<span id="cb712-17"><a href="custom-templates-interactivity.html#cb712-17"></a>    <span class="va">Shiny</span>.<span class="at">renderContent</span>(</span>
<span id="cb712-18"><a href="custom-templates-interactivity.html#cb712-18"></a>      $divTag[<span class="dv">0</span>]<span class="op">,</span> </span>
<span id="cb712-19"><a href="custom-templates-interactivity.html#cb712-19"></a>      <span class="op">{</span><span class="dt">html</span><span class="op">:</span> <span class="va">$divTag</span>.<span class="at">html</span>()<span class="op">,</span> <span class="dt">deps</span><span class="op">:</span> <span class="va">message</span>.<span class="va">content</span>.<span class="at">dependencies</span><span class="op">}</span></span>
<span id="cb712-20"><a href="custom-templates-interactivity.html#cb712-20"></a>    )<span class="op">;</span></span>
<span id="cb712-21"><a href="custom-templates-interactivity.html#cb712-21"></a>    </span>
<span id="cb712-22"><a href="custom-templates-interactivity.html#cb712-22"></a>    <span class="co">// Trigger show: unchanged</span></span>
<span id="cb712-23"><a href="custom-templates-interactivity.html#cb712-23"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb712-24"><a href="custom-templates-interactivity.html#cb712-24"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>We check if our approach works as expected.</p>
<div class="sourceCode" id="cb713"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "tabler/insert-tab-2" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:process-deps"></span>
<img src="images/practice/process-deps.png" alt="htmltools::renderTags and Shiny.renderContent in action." width="100%"><p class="caption">
FIGURE 19.7: htmltools::renderTags and Shiny.renderContent in action.
</p>
</div>
<p>Et voila! As shown in Figure <a href="custom-templates-interactivity.html#fig:process-deps">19.7</a>, everything is properly displayed.</p>
</div>
<div id="exercise-3" class="section level3">
<h3>
<span class="header-section-number">19.4.2</span> Exercise<a class="anchor" aria-label="anchor" href="#exercise-3"><i class="fas fa-link"></i></a>
</h3>
<p>Taking inspiration on the <code><a href="https://rdrr.io/pkg/OSUICode/man/insert_tabler_tab.html">insert_tabler_tab()</a></code> function, write the <code>remove_tabler_tab()</code> function.</p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="custom-templates-inputs.html"><span class="header-section-number">18</span> Develop custom input widgets</a></div>
<div class="next"><a href="custom-templates-testing.html"><span class="header-section-number">20</span> Testing and validating templates elements</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#custom-templates-interactivity"><span class="header-section-number">19</span> Adding more interactivity</a></li>
<li><a class="nav-link" href="#custom-progress-bars"><span class="header-section-number">19.1</span> Custom progress bars</a></li>
<li>
<a class="nav-link" href="#user-feedback-toasts"><span class="header-section-number">19.2</span> User feedback: toasts</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#toast-skeleton"><span class="header-section-number">19.2.1</span> Toast skeleton</a></li>
<li><a class="nav-link" href="#the-toast-api"><span class="header-section-number">19.2.2</span> The toast API</a></li>
<li><a class="nav-link" href="#r-implementation"><span class="header-section-number">19.2.3</span> R implementation</a></li>
<li><a class="nav-link" href="#exercise-2"><span class="header-section-number">19.2.4</span> Exercise</a></li>
</ul>
</li>
<li><a class="nav-link" href="#transform-an-element-in-a-custom-action-button"><span class="header-section-number">19.3</span> Transform an element in a custom action button</a></li>
<li>
<a class="nav-link" href="#tab-events"><span class="header-section-number">19.4</span> Tab events</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#insert-tabs"><span class="header-section-number">19.4.1</span> Insert/Remove tabs in tabsetpanel</a></li>
<li><a class="nav-link" href="#exercise-3"><span class="header-section-number">19.4.2</span> Exercise</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/custom-templates-interactivity.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/custom-templates-interactivity.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It was last built on 2021-09-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
