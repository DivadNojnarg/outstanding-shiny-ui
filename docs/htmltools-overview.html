<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 2 Manipulate HTML tags from R with {htmltools} | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<meta name="description" content="{htmltools} (Cheng, Sievert, et al. 2021) is a R package designed to: Generate HTML tags from R. Handle web dependencies (see Chapter 4). Historically, {htmltools} was extracted out of {shiny}...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 2 Manipulate HTML tags from R with {htmltools} | Outstanding User Interfaces with Shiny">
<meta property="og:type" content="book">
<meta property="og:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<meta property="og:description" content="{htmltools} (Cheng, Sievert, et al. 2021) is a R package designed to: Generate HTML tags from R. Handle web dependencies (see Chapter 4). Historically, {htmltools} was extracted out of {shiny}...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 2 Manipulate HTML tags from R with {htmltools} | Outstanding User Interfaces with Shiny">
<meta name="twitter:description" content="{htmltools} (Cheng, Sievert, et al. 2021) is a R package designed to: Generate HTML tags from R. Handle web dependencies (see Chapter 4). Historically, {htmltools} was extracted out of {shiny}...">
<meta name="twitter:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Foreword</a></li>
<li><a class="" href="welcome.html">Welcome</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="active" href="htmltools-overview.html"><span class="header-section-number">2</span> Manipulate HTML tags from R with {htmltools}</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">3</span> Discover Shiny dependencies</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Handle HTML dependencies with {htmltools}</a></li>
<li><a class="" href="web-applications.html"><span class="header-section-number">5</span> Web application concepts</a></li>
<li class="book-part">Beautify with CSS and Sass</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">6</span> CSS for Shiny</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">7</span> Tidy your CSS with Sass</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">8</span> Beautify with {fresh}</a></li>
<li><a class="" href="beautify-with-bootstraplib.html"><span class="header-section-number">9</span> Become a theming wizard with {bslib}</a></li>
<li class="book-part">Unleash interactivity with JavaScript</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> Communicate between R and JS</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">12</span> Understand and develop new Shiny inputs</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Mastering Shiny’s events</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Optimize your apps with custom handlers</a></li>
<li class="book-part">Practice: A Bootstrap 4 dashboard template</li>
<li><a class="" href="custom-templates-dependencies.html"><span class="header-section-number">16</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">17</span> Create template elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">18</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">19</span> Adding more interactivity</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">20</span> Testing and validating template elements</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="" href="workflow-charpente.html"><span class="header-section-number">21</span> Automate new template creation with {charpente}</a></li>
<li class="book-part">Case study: Mobile development for Shiny</li>
<li><a class="" href="mobile-shiny-intro.html"><span class="header-section-number">22</span> Introduction</a></li>
<li><a class="" href="mobile-shinyMobile.html"><span class="header-section-number">23</span> Reconstruct {shinyMobile}</a></li>
<li><a class="" href="mobile-pwa.html"><span class="header-section-number">24</span> {shinyMobile} and PWA</a></li>
<li><a class="" href="mobile-widgets.html"><span class="header-section-number">25</span> Design widgets</a></li>
<li><a class="" href="mobile-going-further.html"><span class="header-section-number">26</span> Fine-tune {shinyMobile}</a></li>
<li class="book-part">Going further</li>
<li><a class="" href="going-further-reactR.html"><span class="header-section-number">27</span> Shiny and React with {reactR}</a></li>
<li><a class="" href="going-further-webdev.html"><span class="header-section-number">28</span> Shiny and modern web development</a></li>
<li><a class="" href="going-further-where-to-go.html"><span class="header-section-number">29</span> What to do next?</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="code-outputs.html"><span class="header-section-number">A</span> Code outputs</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="htmltools-overview" class="section level1" number="2">
<h1>
<span class="header-section-number">2</span> Manipulate HTML tags from R with {htmltools}<a class="anchor" aria-label="anchor" href="#htmltools-overview"><i class="fas fa-link"></i></a>
</h1>
<p><a href="https://github.com/rstudio/htmltools">htmltools</a> <span class="citation">(<a href="references.html#ref-R-htmltools" role="doc-biblioref">Cheng, Sievert, et al. 2021</a>)</span> is a R package designed to:</p>
<ul>
<li>Generate HTML <strong>tags</strong> from R.</li>
<li>Handle web <strong>dependencies</strong> (see Chapter <a href="htmltools-dependencies.html#htmltools-dependencies">4</a>).</li>
</ul>
<p>Historically, <a href="https://github.com/rstudio/htmltools">htmltools</a> was extracted out of <a href="https://shiny.rstudio.com/">shiny</a> <span class="citation">(<a href="references.html#ref-R-shiny" role="doc-biblioref">Chang et al. 2021</a>)</span> to be able to extend it, that is, develop custom HTML tags, import extra dependencies from the web. That’s why both packages have many common functions!</p>
<p>The ultimate goal of <a href="https://github.com/rstudio/htmltools">htmltools</a> is to <strong>manipulate</strong>, <strong>combine</strong> and <strong>rearrange</strong> tags in order to create flexible and rich HTML structures from R. Would you believe that the below example heavily relies on <a href="https://github.com/rstudio/htmltools">htmltools</a> (Figure <a href="htmltools-overview.html#fig:shinyRPG">2.1</a>)?</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:shinyRPG"></span>
<img src="images/htmltools/shinyRPG.png" alt="{shinyRPG} was built with {htmltools}." width="25%"><p class="caption">
FIGURE 2.1: {shinyRPG} was built with {htmltools}.
</p>
</div>
<p>If you want to try out this example, below is the showcase code:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"RinteRface/shinyRPG"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">shinyRPG</span><span class="op">)</span>
<span class="fu">shinyRPGDemo</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div id="writing-html-tags-from-r" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> Writing HTML Tags from R<a class="anchor" aria-label="anchor" href="#writing-html-tags-from-r"><i class="fas fa-link"></i></a>
</h2>
<p>To install <a href="https://github.com/rstudio/htmltools">htmltools</a>, we run:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CRAN</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"htmltools"</span><span class="op">)</span>
<span class="co"># development version</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"rstudio/htmltools"</span><span class="op">)</span></code></pre></div>
<p><a href="https://github.com/rstudio/htmltools">htmltools</a> provides the necessary functions to write HTML tags that were introduced in Chapter <a href="web-intro.html#web-intro-html">1.3</a>. In R, it is even more convenient than raw HTML since there is no opening/closing tag, a simple function call instead:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools">htmltools</a></span><span class="op">)</span>
<span class="va">tag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="st">"Hello World"</span><span class="op">)</span>
<span class="va">tag</span></code></pre></div>
<pre><code>#&gt; &lt;div&gt;Hello World&lt;/div&gt;</code></pre>
<p>Inside the function call, all named elements become <strong>attributes</strong>, whereas unnamed elements become <strong>children</strong>. In some cases, tags may have empty attributes like <code>&lt;input disabled&gt;</code>. In that case,
the corresponding R code is <code>input(disabled = NA)</code>.</p>
<div class="noteblock">
<p>Pro tip: Since tag functions produce Shiny tags, that is, HTML elements, calling <code>tag</code> inside a document will render the tag instead of printing its code. Sometimes, particularly in this book, you want to see the code output. In that case, use the code below.
You may find another example <a href="https://github.com/rstudio/htmltools/blob/6a03c3f35fbe6bfd0f91ba0607808a2b9127c5e5/vignettes/tagQuery.Rmd#L16">here</a>.</p>
</div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Render the tag instead of printing its code</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools">htmltools</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html">registerS3method</a></span><span class="op">(</span>
  <span class="st">"knit_print"</span>, <span class="st">"shiny.tag"</span>,
  <span class="fu"><a href="https://rdrr.io/r/utils/getS3method.html">getS3method</a></span><span class="op">(</span><span class="st">"print"</span>, <span class="st">"shiny.tag"</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html">registerS3method</a></span><span class="op">(</span>
  <span class="st">"knit_print"</span>, <span class="st">"shiny.tag.list"</span>,
  <span class="fu"><a href="https://rdrr.io/r/utils/getS3method.html">getS3method</a></span><span class="op">(</span><span class="st">"print"</span>, <span class="st">"shiny.tag.list"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="notations" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> Notations<a class="anchor" aria-label="anchor" href="#notations"><i class="fas fa-link"></i></a>
</h2>
<p>If you type <code>htmltools::tags$</code> in the R console, you should be suggested the most common available HTML tags, thereby making it fairly easy to switch between HTML and R, as shown Figure <a href="htmltools-overview.html#fig:htmltools-tags">2.2</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:htmltools-tags"></span>
<img src="images/htmltools/htmltools-tags.png" alt="htmltools tags builder." width="100%"><p class="caption">
FIGURE 2.2: htmltools tags builder.
</p>
</div>
<p>For convenience, the most commonly used tags like <code>p</code>, <code>h1</code>, <code>h2</code>, <code>h3</code>, <code>h4</code>, <code>h5</code>, <code>h6</code>, <code>a</code>, <code>br</code>, <code>div</code>, <code>span</code>, <code>pre</code>, <code>code</code>, <code>img</code>, <code>strong</code>, <code>em</code>, <code>hr</code>, …
are accessible by a simple function call like:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># good</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">h1</a></span><span class="op">(</span><span class="st">"This is a title"</span><span class="op">)</span>

<span class="co"># correct but not necessary</span>
<span class="va">tags</span><span class="op">$</span><span class="fu">h1</span><span class="op">(</span><span class="st">"This is a title"</span><span class="op">)</span></code></pre></div>
<p>Therefore, whether to use <code>tags$&lt;TAG_NAME</code> or <code>&lt;TAG_NAME&gt;</code> depends if the tag is exported by default. Since <code>nav</code> is not exported, we write:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># correct</span>
<span class="va">tags</span><span class="op">$</span><span class="fu">nav</span><span class="op">(</span><span class="st">"This is the navigation"</span><span class="op">)</span>

<span class="co"># fail</span>
<span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">nav</span><span class="op">(</span><span class="st">"This is the navigation"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>When building custom templates, you will be writing a lot of tags. It might seem
too much work to always write <code>tags$&lt;TAG_NAME&gt;</code>. There exists a function called <code><a href="https://rdrr.io/pkg/htmltools/man/withTags.html">withTags()</a></code>, which allows you to get rid of all <code>tags$</code>. Hence, the whole code is much easier to write and read:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Better</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/withTags.html">withTags</a></span><span class="op">(</span>
  <span class="fu">nav</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu">ul</span><span class="op">(</span><span class="fu">li</span><span class="op">(</span><span class="op">)</span>, <span class="fu">li</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># instead of </span>
<span class="va">tags</span><span class="op">$</span><span class="fu">nav</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="op">)</span>, <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>If you had to gather multiple tags together, choose <code><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList()</a></code> over <code><a href="https://rdrr.io/r/base/list.html">list()</a></code>, although the HTML output is the same:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># good</span>
<span class="va">tag_list_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">p</a></span><span class="op">(</span><span class="st">"Some text"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="st">"Content"</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">tag_list_1</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; List of 2
#&gt;  $ :List of 3
#&gt;   ..$ name    : chr "p"
#&gt;   ..$ attribs : Named list()
#&gt;   ..$ children:List of 1
#&gt;   .. ..$ : chr "Some text"
#&gt;   ..- attr(*, "class")= chr "shiny.tag"
#&gt;  $ :List of 3
#&gt;   ..$ name    : chr "div"
#&gt;   ..$ attribs : Named list()
#&gt;   ..$ children:List of 1
#&gt;   .. ..$ : chr "Content"
#&gt;   ..- attr(*, "class")= chr "shiny.tag"
#&gt;  - attr(*, "class")= chr [1:2] "shiny.tag.list" "list"</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tag_list_1</span></code></pre></div>
<pre><code>#&gt; &lt;p&gt;Some text&lt;/p&gt;
#&gt; &lt;div&gt;Content&lt;/div&gt;</code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># correct but not optimal</span>
<span class="va">tag_list_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">p</a></span><span class="op">(</span><span class="st">"Some text"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="st">"Content"</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">tag_list_2</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; List of 2
#&gt;  $ :List of 3
#&gt;   ..$ name    : chr "p"
#&gt;   ..$ attribs : Named list()
#&gt;   ..$ children:List of 1
#&gt;   .. ..$ : chr "Some text"
#&gt;   ..- attr(*, "class")= chr "shiny.tag"
#&gt;  $ :List of 3
#&gt;   ..$ name    : chr "div"
#&gt;   ..$ attribs : Named list()
#&gt;   ..$ children:List of 1
#&gt;   .. ..$ : chr "Content"
#&gt;   ..- attr(*, "class")= chr "shiny.tag"</code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tag_list_2</span></code></pre></div>
<pre><code>#&gt; [[1]]
#&gt; &lt;p&gt;Some text&lt;/p&gt;
#&gt; 
#&gt; [[2]]
#&gt; &lt;div&gt;Content&lt;/div&gt;</code></pre>
<p>The first has the <code>shiny.tag.list</code> class in addition to <code>list</code>. You may see it as a detail, but this has noticeable consequences. For instance, <code>tag_list_1</code> prints as HTML content, whereas <code>tag_list_2</code> prints as a list. If we try to apply <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code> on both elements, we obtain very different outputs:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># tag_list_1</span>
<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tag_list_1</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] "&lt;p&gt;Some text&lt;/p&gt;\n&lt;div&gt;Content&lt;/div&gt;"</code></pre>
<!-- This is to trim the output too large for pdf -->
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># tag_list_2</span>
<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tag_list_2</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] "list(name = \"p\", attribs = list(), children = list(\"Some text\"))"
#&gt; [2] "list(name = \"div\", attribs = list(), children = list(\"Content\"))"</code></pre>
<p>Besides, packages like <a href="https://github.com/ThinkR-open/golem">golem</a> <span class="citation">(<a href="references.html#ref-R-golem" role="doc-biblioref">Fay et al. 2021</a>)</span> allow us to test if an R object is a tag list. In this case, using a simple list would cause the test to fail.</p>
</div>
<div id="adding-new-tags" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> Adding new tags<a class="anchor" aria-label="anchor" href="#adding-new-tags"><i class="fas fa-link"></i></a>
</h2>
<p>You may define extra HTML tags with the <code><a href="https://rdrr.io/pkg/htmltools/man/builder.html">tag()</a></code> function:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">customTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">tag</a></span><span class="op">(</span>
  <span class="st">"test"</span>, 
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"test"</span>, <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">p</a></span><span class="op">(</span><span class="st">"Custom Tag"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">customTag</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; List of 3
#&gt;  $ name    : chr "test"
#&gt;  $ attribs :List of 1
#&gt;   ..$ class: chr "test"
#&gt;  $ children:List of 1
#&gt;   ..$ :List of 3
#&gt;   .. ..$ name    : chr "p"
#&gt;   .. ..$ attribs : Named list()
#&gt;   .. ..$ children:List of 1
#&gt;   .. .. ..$ : chr "Custom Tag"
#&gt;   .. ..- attr(*, "class")= chr "shiny.tag"
#&gt;  - attr(*, "class")= chr "shiny.tag"</code></pre>
<pre><code>#&gt; &lt;test class="test"&gt;
#&gt;   &lt;p&gt;Custom Tag&lt;/p&gt;
#&gt; &lt;/test&gt;</code></pre>
<p>Good practice is to check whether the created tag is in line with the HTML validation rules. If you want to check a web page, particularly a Shiny-generated HTML page, W3C has an online validation <a href="https://validator.w3.org/">tool</a>. Be careful, as not following this rule will cause the HTML code to be invalid. By default, Shiny complies with all the recommendations, but we suggest you be careful with any exotic template.</p>
</div>
<div id="alternative-way-to-write-tags" class="section level2" number="2.4">
<h2>
<span class="header-section-number">2.4</span> Alternative way to write tags<a class="anchor" aria-label="anchor" href="#alternative-way-to-write-tags"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://github.com/rstudio/htmltools">htmltools</a> comes with the <code><a href="https://rdrr.io/pkg/htmltools/man/HTML.html">HTML()</a></code> function that you can feed with raw HTML. It prevents HTML escaping on the provided content, which is convenient, for instance, when using formatting tags inside a string:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="st">"Hello &lt;u&gt;World&lt;/u&gt;"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; &lt;div&gt;Hello &amp;lt;u&amp;gt;World&amp;lt;/u&amp;gt;&lt;/div&gt;</code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/HTML.html">HTML</a></span><span class="op">(</span><span class="st">"Hello &lt;u&gt;World&lt;/u&gt;"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; &lt;div&gt;Hello &lt;u&gt;World&lt;/u&gt;&lt;/div&gt;</code></pre>
<p>Below, both codes give exactly the same output:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/HTML.html">HTML</a></span><span class="op">(</span><span class="st">"&lt;div&gt;Blabla&lt;/div&gt;"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="st">"Blabla"</span><span class="op">)</span></code></pre></div>
<p>Internally, their classes are different, which has consequences:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/HTML.html">HTML</a></span><span class="op">(</span><span class="st">"&lt;div&gt;Blabla&lt;/div&gt;"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] "html"      "character"</code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="st">"Blabla"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] "shiny.tag"</code></pre>
<p>Doing so, you will not be able to use tag-related functions, as in the next parts.</p>
<div class="importantblock">
<p>We strongly recommend using R as much as possible and avoid mixing HTML with R.</p>
</div>
<p>Interestingly, if you want to convert raw HTML to R code, there is a Shiny App developed by Alan
Dipert from RStudio, namely <a href="https://github.com/alandipert/html2r/tree/4217b5430e2bfc3af0d841cbefcd94bc1aadbcdf">html2R</a>, shown Figure <a href="htmltools-overview.html#fig:htmltools-html2R">2.3</a>. Non-standard attributes (like <code>data-toggle</code>) are not correctly processed, but there are <a href="https://github.com/alandipert/html2r/issues/2">solutions</a>. This will save you precious time! A more recent approach is developed in Chapter <a href="workflow-charpente.html#workflow-charpente">21</a> and has been used internally to develop some of the RinteRface <a href="https://github.com/RinteRface">templates</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:htmltools-html2R"></span>
<img src="images/htmltools/htmltools-html2R.png" alt="Illustration of the html2R app." width="100%"><p class="caption">
FIGURE 2.3: Illustration of the html2R app.
</p>
</div>
<p>By converting HTML to R functions, it’s easy to parameterize the generated tag and reuse it later in the code. It also allows you to maintain a single code base (only R), which is much simpler in the long run if the code has to be reviewed by people non-familiar with HTML.</p>
</div>
<div id="playing-with-tags" class="section level2" number="2.5">
<h2>
<span class="header-section-number">2.5</span> Playing with tags<a class="anchor" aria-label="anchor" href="#playing-with-tags"><i class="fas fa-link"></i></a>
</h2>
<p>Before becoming an <a href="https://github.com/rstudio/htmltools">htmltools</a> wizard, let’s learn the Shiny tags fundamentals.</p>
<div id="tags-structure" class="section level3" number="2.5.1">
<h3>
<span class="header-section-number">2.5.1</span> Tags structure<a class="anchor" aria-label="anchor" href="#tags-structure"><i class="fas fa-link"></i></a>
</h3>
<p>A <strong>shiny tag</strong> is defined by:</p>
<ul>
<li>A <strong>name</strong> such as <code>span</code>, <code>div</code>, <code>h1</code> …, accessed with <code>tag$name</code>.</li>
<li>Some <strong>attributes</strong>, which can be accessed with <code>tag$attribs</code>.</li>
<li>
<strong>Children</strong>, which can be accessed with <code>tag$children</code>.</li>
<li>A <strong>class</strong>, namely <code>shiny.tag</code>.</li>
</ul>
<p>For instance, the tag below has the following structure:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create the tag</span>
<span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
  class <span class="op">=</span> <span class="st">"divclass"</span>, 
  id <span class="op">=</span> <span class="st">"first"</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">h1</a></span><span class="op">(</span><span class="st">"My first child!"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"child"</span>, id <span class="op">=</span> <span class="st">"baby"</span>, <span class="st">"Crying"</span><span class="op">)</span>
<span class="op">)</span>
<span class="co"># access its name</span>
<span class="co"># myTag$name</span>
<span class="co"># access its attributes (id and class)</span>
<span class="co"># myTag$attribs</span>
<span class="co"># access children (returns a list of 2 elements)</span>
<span class="co"># myTag$children</span>
<span class="co"># access its class</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">myTag</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; List of 3
#&gt;  $ name    : chr "div"
#&gt;  $ attribs :List of 2
#&gt;   ..$ class: chr "divclass"
#&gt;   ..$ id   : chr "first"
#&gt;  $ children:List of 2
#&gt;   ..$ :List of 3
#&gt;   .. ..$ name    : chr "h1"
#&gt;   .. ..$ attribs : Named list()
#&gt;   .. ..$ children:List of 1
#&gt;   .. .. ..$ : chr "My first child!"
#&gt;   .. ..- attr(*, "class")= chr "shiny.tag"
#&gt;   ..$ :List of 3
#&gt;   .. ..$ name    : chr "span"
#&gt;   .. ..$ attribs :List of 2
#&gt;   .. .. ..$ class: chr "child"
#&gt;   .. .. ..$ id   : chr "baby"
#&gt;   .. ..$ children:List of 1
#&gt;   .. .. ..$ : chr "Crying"
#&gt;   .. ..- attr(*, "class")= chr "shiny.tag"
#&gt;  - attr(*, "class")= chr "shiny.tag"</code></pre>
<p>and the output is:</p>
<pre><code>#&gt; &lt;div class="divclass" id="first"&gt;
#&gt;   &lt;h1&gt;My first child!&lt;/h1&gt;
#&gt;   &lt;span class="child" id="baby"&gt;Crying&lt;/span&gt;
#&gt; &lt;/div&gt;</code></pre>
<p>How to modify the class of the second child?</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">second_children</span> <span class="op">&lt;-</span> <span class="va">myTag</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
<span class="va">second_children</span><span class="op">$</span><span class="va">attribs</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="st">"adult"</span>
<span class="va">myTag</span></code></pre></div>
<pre><code>#&gt; &lt;div class="divclass" id="first"&gt;
#&gt;   &lt;h1&gt;My first child!&lt;/h1&gt;
#&gt;   &lt;span class="child" id="baby"&gt;Crying&lt;/span&gt;
#&gt; &lt;/div&gt;</code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This is not working ...</span></code></pre></div>
<p>Why is this not working? By assigning <code>myTag$children[[2]]</code> to second_children, <code>second_children$attribs$class &lt;- "adult"</code> modifies the class of the copy and not the original object. Thus we do:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myTag</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">attribs</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="st">"adult"</span>
<span class="va">myTag</span></code></pre></div>
<pre><code>#&gt; &lt;div class="divclass" id="first"&gt;
#&gt;   &lt;h1&gt;My first child!&lt;/h1&gt;
#&gt;   &lt;span class="adult" id="baby"&gt;Crying&lt;/span&gt;
#&gt; &lt;/div&gt;</code></pre>
</div>
<div id="htmltools-shinyRPG" class="section level3" number="2.5.2">
<h3>
<span class="header-section-number">2.5.2</span> Practical examples: shinyRPG<a class="anchor" aria-label="anchor" href="#htmltools-shinyRPG"><i class="fas fa-link"></i></a>
</h3>
<p>Below we give concrete example on how to customize tags in real life. There exists a
nice RPG HTML template, that is, <a href="http://ronenness.github.io/RPGUI/">rpgui</a>. It provides
the necessary elements to get started developing nice RPG-looking user interfaces, as depicted by Figure <a href="htmltools-overview.html#fig:rpgui-select">2.4</a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:rpgui-select"></span>
<img src="images/htmltools/rpgui-select.png" alt="rpgui select input with two displays: dropdown or list." width="75%"><p class="caption">
FIGURE 2.4: rpgui select input with two displays: dropdown or list.
</p>
</div>
<p>In the following, we consider the select input, which does not have exactly the same
structure as the original Shiny tag. However, it is convenient to reuse the Shiny functions
to limit our amount of work. We therefore start to write our custom input:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rpgSelect</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">inputId</span>, <span class="va">label</span>, <span class="va">choices</span>, <span class="va">selected</span> <span class="op">=</span> <span class="cn">NULL</span>,
                      <span class="va">multiple</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">size</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html">selectInput</a></span><span class="op">(</span>
    <span class="va">inputId</span>,
    <span class="va">label</span>,
    <span class="va">choices</span>,
    <span class="va">selected</span>,
    <span class="va">multiple</span>,
    selectize <span class="op">=</span> <span class="cn">FALSE</span>,
    width <span class="op">=</span> <span class="cn">NULL</span>,
    <span class="va">size</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>According to the rpgui documentation, a select tag is composed of the following HTML elements:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb57-1"><a href="htmltools-overview.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;select</span> <span class="er">class</span><span class="ot">=</span><span class="st">"rpgui-dropdown"</span><span class="kw">&gt;</span></span>
<span id="cb57-2"><a href="htmltools-overview.html#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;option</span> <span class="er">value</span><span class="ot">=</span><span class="st">"option1"</span><span class="kw">&gt;</span>option1<span class="kw">&lt;/option&gt;</span></span>
<span id="cb57-3"><a href="htmltools-overview.html#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;option</span> <span class="er">value</span><span class="ot">=</span><span class="st">"option2"</span><span class="kw">&gt;</span>option2<span class="kw">&lt;/option&gt;</span></span>
<span id="cb57-4"><a href="htmltools-overview.html#cb57-4" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb57-5"><a href="htmltools-overview.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/select&gt;</span></span></code></pre></div>
<p>Adding a label tag on top of the slider, this is what we would like to get:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb58-1"><a href="htmltools-overview.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;div&gt;</span></span>
<span id="cb58-2"><a href="htmltools-overview.html#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;label</span> <span class="er">id</span><span class="ot">=</span><span class="st">"variable-label"</span> <span class="er">for</span><span class="ot">=</span><span class="st">"variable"</span><span class="kw">&gt;</span>Variable:<span class="kw">&lt;/label&gt;</span></span>
<span id="cb58-3"><a href="htmltools-overview.html#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;select</span> </span>
<span id="cb58-4"><a href="htmltools-overview.html#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="ot">    id=</span><span class="st">"variable"</span> </span>
<span id="cb58-5"><a href="htmltools-overview.html#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="ot">    class=</span><span class="st">"rpgui-dropdown"</span><span class="kw">&gt;</span></span>
<span id="cb58-6"><a href="htmltools-overview.html#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;option</span> <span class="er">value</span><span class="ot">=</span><span class="st">"cyl"</span> <span class="er">selected</span><span class="kw">&gt;</span>Cylinders<span class="kw">&lt;/option&gt;</span></span>
<span id="cb58-7"><a href="htmltools-overview.html#cb58-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;option</span> <span class="er">value</span><span class="ot">=</span><span class="st">"am"</span><span class="kw">&gt;</span>Transmission<span class="kw">&lt;/option&gt;</span></span>
<span id="cb58-8"><a href="htmltools-overview.html#cb58-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;option</span> <span class="er">value</span><span class="ot">=</span><span class="st">"gear"</span><span class="kw">&gt;</span>Gears<span class="kw">&lt;/option&gt;</span></span>
<span id="cb58-9"><a href="htmltools-overview.html#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/select&gt;</span></span>
<span id="cb58-10"><a href="htmltools-overview.html#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<p>We compare with our own <code>rpgSelect()</code> function:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rpgSelect</span><span class="op">(</span>
  <span class="st">"variable"</span>, 
  <span class="st">"Variable:"</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cylinders"</span> <span class="op">=</span> <span class="st">"cyl"</span>,
    <span class="st">"Transmission"</span> <span class="op">=</span> <span class="st">"am"</span>,
    <span class="st">"Gears"</span> <span class="op">=</span> <span class="st">"gear"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<!-- This is to trim the output too large for pdf -->
<pre><code>#&gt; &lt;div class="form-group shiny-input-container"&gt;
#&gt;   &lt;label class="control-label" id="variable-label" for="variable"&gt;Variable:&lt;/label&gt;
#&gt;   &lt;div&gt;
#&gt;     &lt;select id="variable" class="form-control"&gt;&lt;option value="cyl" selected&gt;Cylinders&lt;/option&gt;
#&gt; &lt;option value="am"&gt;Transmission&lt;/option&gt;
#&gt; &lt;option value="gear"&gt;Gears&lt;/option&gt;&lt;/select&gt;
#&gt;   &lt;/div&gt;
#&gt; &lt;/div&gt;</code></pre>
<p>As shown in the above output, this is not exactly matching:</p>
<ul>
<li>The outer div should not have any class.</li>
<li>The label should not have any class.</li>
<li>The input tag is wrapped inside a div container. It should not.</li>
<li>The input tag should have the <code>rpgui-dropdown</code> or <code>rpgui-list</code> class,
depending on the size value.</li>
</ul>
<p>To fix the first problem we target the outer tag (<code>selectTag</code>), that is, the tag returned by our <code>rpgSelect()</code> function. The second row cleans the label class. The third row removes the extra outer div and only keeps its children, corresponding to the input tag. The last instruction ensures we set the appropriate class, depending on the size value:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Modify tag</span>
<span class="va">selectTag</span><span class="op">$</span><span class="va">attribs</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="co"># Clean extra label class</span>
<span class="va">selectTag</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">attribs</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="co"># Remove extra outer div</span>
<span class="va">selectTag</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">selectTag</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

<span class="co"># Add good class for rppgui binding</span>
<span class="va">selectTag</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">attribs</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="st">"rpgui-dropdown"</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="st">"rpgui-list"</span>
<span class="op">}</span></code></pre></div>
<p>The complete code is given <a href="https://github.com/RinteRface/shinyRPG/blob/a1fe30761ffd6469f28a0f92107d9613e9eccbe7/R/inputs.R#L180">here</a>, which yields:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rpgSelect</span><span class="op">(</span>
  <span class="st">"variable"</span>, 
  <span class="st">"Variable:"</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cylinders"</span> <span class="op">=</span> <span class="st">"cyl"</span>,
    <span class="st">"Transmission"</span> <span class="op">=</span> <span class="st">"am"</span>,
    <span class="st">"Gears"</span> <span class="op">=</span> <span class="st">"gear"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<!-- This is to trim the output too large for pdf -->
<pre><code>#&gt; &lt;div&gt;
#&gt;   &lt;label id="variable-label" for="variable"&gt;Variable:&lt;/label&gt;
#&gt;   &lt;select id="variable" class="rpgui-dropdown"&gt;&lt;option value="cyl" selected&gt;Cylinders&lt;/option&gt;
#&gt; &lt;option value="am"&gt;Transmission&lt;/option&gt;
#&gt; &lt;option value="gear"&gt;Gears&lt;/option&gt;&lt;/select&gt;
#&gt; &lt;/div&gt;</code></pre>
</div>
<div id="useful-functions-for-tags" class="section level3" number="2.5.3">
<h3>
<span class="header-section-number">2.5.3</span> Useful functions for tags<a class="anchor" aria-label="anchor" href="#useful-functions-for-tags"><i class="fas fa-link"></i></a>
</h3>
<p>As shown in the previous shinyRPG example, adding a class and an id to a tag may be done with:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tag</span><span class="op">$</span><span class="va">attribs</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="st">"class"</span>
<span class="va">tag</span><span class="op">$</span><span class="va">attribs</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"id"</span></code></pre></div>
<p>These are two lines of code, and believe me, for complex examples, it might be much worse, thereby significantly impairing code readability.
Fortunately, <a href="https://github.com/rstudio/htmltools">htmltools</a> provides powerful functions to overcome this issue, the most significant being reviewed below.</p>
<div id="add-attributes" class="section level4" number="2.5.3.1">
<h4>
<span class="header-section-number">2.5.3.1</span> Add attributes<a class="anchor" aria-label="anchor" href="#add-attributes"><i class="fas fa-link"></i></a>
</h4>
<p><code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagAppendAttributes()</a></code> adds a new attribute to the current tag. For instance, assuming we created a <code>div</code> without any id attribute:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="st">"A tag"</span><span class="op">)</span>
<span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagAppendAttributes</a></span><span class="op">(</span><span class="va">myTag</span>, id <span class="op">=</span> <span class="st">"myid"</span><span class="op">)</span>
<span class="va">myTag</span></code></pre></div>
<pre><code>#&gt; &lt;div id="myid"&gt;A tag&lt;/div&gt;</code></pre>
<p>You can pass as many attributes as you want, including <strong>non-standard</strong> attributes such as <code>data-toggle</code> (see Bootstrap 3 <a href="https://www.w3schools.com/bootstrap/bootstrap_ref_js_collapse.asp">tabs</a> for instance):</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagAppendAttributes</a></span><span class="op">(</span>
  <span class="va">myTag</span>, 
  `data-toggle` <span class="op">=</span> <span class="st">"tabs"</span>, 
  class <span class="op">=</span> <span class="st">"myclass"</span>
<span class="op">)</span>
<span class="va">myTag</span></code></pre></div>
<pre><code>#&gt; &lt;div id="myid" data-toggle="tabs" class="myclass"&gt;A tag&lt;/div&gt;</code></pre>
<p>As a reminder, even though correct, the classic approach would require two steps:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myTag</span><span class="op">$</span><span class="va">attribs</span><span class="op">[[</span><span class="st">"data-toggle"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"newValue"</span>
<span class="va">myTag</span><span class="op">$</span><span class="va">attribs</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="st">"newClass"</span>

<span class="va">myTag</span></code></pre></div>
<!-- This is to trim the output too large for pdf -->
<pre><code>#&gt; &lt;div id="myid" data-toggle="newValue" class="newClass"&gt;A tag&lt;/div&gt;</code></pre>
</div>
<div id="check-if-tag-has-specific-attribute" class="section level4" number="2.5.3.2">
<h4>
<span class="header-section-number">2.5.3.2</span> Check if tag has specific attribute<a class="anchor" aria-label="anchor" href="#check-if-tag-has-specific-attribute"><i class="fas fa-link"></i></a>
</h4>
<p><code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagHasAttribute()</a></code> checks if a tag has a specific attribute:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># I want to know if div has a class</span>
<span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"myclass"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagHasAttribute</a></span><span class="op">(</span><span class="va">myTag</span>, <span class="st">"class"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] TRUE</code></pre>
<p>In practice, this function is suitable for testing tag elements as shown in Chapter <a href="custom-templates-testing.html#custom-templates-testing">20</a>.</p>
</div>
<div id="get-all-attributes" class="section level4" number="2.5.3.3">
<h4>
<span class="header-section-number">2.5.3.3</span> Get all attributes<a class="anchor" aria-label="anchor" href="#get-all-attributes"><i class="fas fa-link"></i></a>
</h4>
<p><code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagGetAttribute()</a></code> gets the targeted attribute’s value, if it exists, otherwise NULL:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span>
<span class="co"># returns the class</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagGetAttribute</a></span><span class="op">(</span><span class="va">myTag</span>, <span class="st">"class"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] "test"</code></pre>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># returns NULL</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagGetAttribute</a></span><span class="op">(</span><span class="va">myTag</span>, <span class="st">"id"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; NULL</code></pre>
</div>
<div id="set-childchildren" class="section level4" number="2.5.3.4">
<h4>
<span class="header-section-number">2.5.3.4</span> Set child/children<a class="anchor" aria-label="anchor" href="#set-childchildren"><i class="fas fa-link"></i></a>
</h4>
<p><code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagSetChildren()</a></code> creates children for a given tag. For instance:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
  class <span class="op">=</span> <span class="st">"parent"</span>, 
  id <span class="op">=</span> <span class="st">"father"</span>, 
  <span class="st">"Father!"</span>
<span class="op">)</span>
<span class="va">child</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="st">"Daughter"</span><span class="op">)</span>
<span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagSetChildren</a></span><span class="op">(</span><span class="va">myTag</span>, <span class="va">child</span><span class="op">)</span>

<span class="va">myTag</span></code></pre></div>
<pre><code>#&gt; &lt;div class="parent" id="father"&gt;
#&gt;   &lt;span&gt;Daughter&lt;/span&gt;
#&gt; &lt;/div&gt;</code></pre>
<div class="warningblock">
<p><code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagSetChildren()</a></code> <strong>removes</strong> all existing children. Below we see another set of functions to add children while conserving existing ones.</p>
</div>
</div>
<div id="add-child-or-children" class="section level4" number="2.5.3.5">
<h4>
<span class="header-section-number">2.5.3.5</span> Add child or children<a class="anchor" aria-label="anchor" href="#add-child-or-children"><i class="fas fa-link"></i></a>
</h4>
<p><code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChild()</a></code> and <code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChildren()</a></code> add other tags to an existing tag.
Whereas <code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChild()</a></code> only takes one tag, you can pass a list of tags to <code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChildren()</a></code>.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"parent"</span>, <span class="st">"A tag"</span>, <span class="st">"Child 1"</span><span class="op">)</span>
<span class="va">otherTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="st">"Child 2"</span><span class="op">)</span>
<span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChild</a></span><span class="op">(</span><span class="va">myTag</span>, <span class="va">otherTag</span><span class="op">)</span>

<span class="va">myTag</span></code></pre></div>
<pre><code>#&gt; &lt;div class="parent"&gt;
#&gt;   A tag
#&gt;   Child 1
#&gt;   &lt;span&gt;Child 2&lt;/span&gt;
#&gt; &lt;/div&gt;</code></pre>
</div>
<div id="build-your-own-functions" class="section level4" number="2.5.3.6">
<h4>
<span class="header-section-number">2.5.3.6</span> Build your own functions<a class="anchor" aria-label="anchor" href="#build-your-own-functions"><i class="fas fa-link"></i></a>
</h4>
<p>You might wonder why there is no <code>tagRemoveChild()</code> or <code>tagRemoveAttributes()</code>.
Let’s look at the <code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChild()</a></code>:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tagAppendChild</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">tag</span>, <span class="va">child</span>, <span class="va">.cssSelector</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">.cssSelector</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChildren</a></span><span class="op">(</span>
        <span class="va">tag</span>, 
        <span class="va">child</span>, 
        .cssSelector <span class="op">=</span> <span class="va">.cssSelector</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span>
  <span class="va">tag</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">tag</span><span class="op">$</span><span class="va">children</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">child</span>
  <span class="va">tag</span>
<span class="op">}</span></code></pre></div>
<p>Below we write the <code>tagRemoveChild()</code>, where tag is the target and n is the position to remove in the list of children:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"parent"</span>, <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="st">"Hey!"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># we create the tagRemoveChild function</span>
<span class="va">tagRemoveChild</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span>, <span class="va">n</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># check if the list is empty</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">tag</span><span class="op">$</span><span class="va">children</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tag</span><span class="op">$</span><span class="va">name</span>, <span class="st">"does not have any children!"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">tag</span><span class="op">$</span><span class="va">children</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  <span class="va">tag</span>
<span class="op">}</span>
<span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu">tagRemoveChild</span><span class="op">(</span><span class="va">myTag</span>, <span class="fl">1</span><span class="op">)</span>

<span class="va">myTag</span></code></pre></div>
<pre><code>#&gt; &lt;div class="parent"&gt;&lt;/div&gt;</code></pre>
<p>When defining the <code>tagRemoveChild()</code>, we choose <code><a href="https://rdrr.io/r/base/Extract.html">[</a></code> instead of <code><a href="https://rdrr.io/r/base/Extract.html">[[</a></code> to allow to select multiple list elements. Also notice that the function raises an error if the provided tag does not have children.</p>
<p>The <code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChild()</a></code> is not able to insert at a specific position. We could draft the <code>tagInsertChild()</code> building on top of the base R <code>append</code> function:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tagInsertChild</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span>, <span class="va">child</span>, <span class="va">position</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tag</span><span class="op">$</span><span class="va">children</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tag</span><span class="op">$</span><span class="va">children</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">child</span><span class="op">)</span>, <span class="va">position</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">tag</span>
<span class="op">}</span>

<span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu">tagInsertChild</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">p</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">a</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu">tagInsertChild</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">p</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">a</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>

<span class="va">res1</span></code></pre></div>
<pre><code>#&gt; &lt;p&gt;
#&gt;   &lt;a&gt;&lt;/a&gt;
#&gt;   &lt;span&gt;hello&lt;/span&gt;
#&gt; &lt;/p&gt;</code></pre>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res2</span></code></pre></div>
<pre><code>#&gt; &lt;p&gt;
#&gt;   &lt;span&gt;hello&lt;/span&gt;
#&gt;   &lt;a&gt;&lt;/a&gt;
#&gt; &lt;/p&gt;</code></pre>
<div class="noteblock">
<p>As of <a href="https://github.com/rstudio/htmltools">htmltools</a> 0.5.2, there is a new <code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagInsertChildren()</a></code> <a href="https://rstudio.github.io/htmltools/reference/tagAppendChild.html">function</a>.</p>
</div>
</div>
</div>
<div id="other-functions" class="section level3" number="2.5.4">
<h3>
<span class="header-section-number">2.5.4</span> Other functions<a class="anchor" aria-label="anchor" href="#other-functions"><i class="fas fa-link"></i></a>
</h3>
<p>The <a href="https://github.com/ThinkR-open/golem/blob/dev/inst/utils/golem_utils_ui.R">golem</a> package written by <a href="https://thinkr.fr">thinkr</a> contains neat functions to edit your tags.</p>
<p>Particularly, the <code>tagRemoveAttributes()</code>:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tagRemoveAttributes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">attrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">attrs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tag</span><span class="op">$</span><span class="va">attribs</span><span class="op">[[</span> <span class="va">attrs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  <span class="op">}</span>
  <span class="va">tag</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"test"</span>, id <span class="op">=</span> <span class="st">"coucou"</span>, <span class="st">"Hello"</span><span class="op">)</span>
<span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu">tagRemoveAttributes</span><span class="op">(</span><span class="va">myTag</span>, <span class="st">"class"</span>, <span class="st">"id"</span><span class="op">)</span>

<span class="va">myTag</span></code></pre></div>
<pre><code>#&gt; &lt;div&gt;Hello&lt;/div&gt;</code></pre>
</div>
<div id="conditionally-set-attributes" class="section level3" number="2.5.5">
<h3>
<span class="header-section-number">2.5.5</span> Conditionally set attributes<a class="anchor" aria-label="anchor" href="#conditionally-set-attributes"><i class="fas fa-link"></i></a>
</h3>
<p>Sometimes, you only want to set attributes under specific conditions.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_button</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">color</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tags</span><span class="op">$</span><span class="fu">button</span><span class="op">(</span> 
    style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"color:"</span>, <span class="va">color</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">p</a></span><span class="op">(</span><span class="st">"Hello"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Calling <code>my_button()</code> would give:</p>
<pre><code>#&gt; &lt;button style="color: "&gt;
#&gt;   &lt;p&gt;Hello&lt;/p&gt;
#&gt; &lt;/button&gt;</code></pre>
<p>This example will not fail but having <code>style="color: "</code> is not clean. We may use conditions:</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_button</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">color</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tags</span><span class="op">$</span><span class="fu">button</span><span class="op">(</span> 
    style <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">color</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"color:"</span>, <span class="va">color</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">p</a></span><span class="op">(</span><span class="st">"Hello"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Below, we call <code>my_button("blue")</code> and <code>my_button()</code>:</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">my_button</span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; &lt;button style="color: blue"&gt;
#&gt;   &lt;p&gt;Hello&lt;/p&gt;
#&gt; &lt;/button&gt;</code></pre>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">my_button</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; &lt;button&gt;
#&gt;   &lt;p&gt;Hello&lt;/p&gt;
#&gt; &lt;/button&gt;</code></pre>
<p>In this example, style won’t be available if color is not specified.</p>
</div>
<div id="using" class="section level3" number="2.5.6">
<h3>
<span class="header-section-number">2.5.6</span> Using %&gt;%<a class="anchor" aria-label="anchor" href="#using"><i class="fas fa-link"></i></a>
</h3>
<p>While doing a lot of manipulation for a tag, if you don’t need to create intermediate
objects, it is a good idea to use <code><a href="https://rdrr.io/pkg/OSUICode/man/pipe.html">%&gt;%</a></code> from <a href="https://magrittr.tidyverse.org">magrittr</a>:</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"cl"</span>, <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">h1</a></span><span class="op">(</span><span class="st">"Hello"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagAppendAttributes</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"myid"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChild</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">p</a></span><span class="op">(</span><span class="st">"some extra text here!"</span><span class="op">)</span><span class="op">)</span>

<span class="va">myTag</span></code></pre></div>
<p>This is overall easier to follow and read.</p>
</div>
<div id="htmltools-programmatic-children" class="section level3" number="2.5.7">
<h3>
<span class="header-section-number">2.5.7</span> Programmatically create children elements<a class="anchor" aria-label="anchor" href="#htmltools-programmatic-children"><i class="fas fa-link"></i></a>
</h3>
<p>Assume you want to create a tag with five children inside:</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">myTag</span></code></pre></div>
<p>The structure is correct, but imagine if you had to create 1000 <code><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span()</a></code> or a fancier tag. The previous approach is not consistent with the <strong>DRY</strong> programming concept. <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> function will be useful here (or the purrr <code>map()</code> family):</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># base R</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co"># purrr + %&gt;%</span>
<span class="fu">map</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; &lt;div&gt;
#&gt;   &lt;span&gt;1&lt;/span&gt;
#&gt;   &lt;span&gt;2&lt;/span&gt;
#&gt;   &lt;span&gt;3&lt;/span&gt;
#&gt;   &lt;span&gt;4&lt;/span&gt;
#&gt;   &lt;span&gt;5&lt;/span&gt;
#&gt; &lt;/div&gt;</code></pre>
</div>
</div>
<div id="htmltools-modern" class="section level2" number="2.6">
<h2>
<span class="header-section-number">2.6</span> Modern {htmltools}<a class="anchor" aria-label="anchor" href="#htmltools-modern"><i class="fas fa-link"></i></a>
</h2>
<div class="importantblock">
<p>This section requires basic CSS knowledge, particularly CSS selectors. Please read Chapter <a href="beautify-css.html#beautify-css">6</a> before going further.</p>
</div>
<p>As of <a href="https://github.com/rstudio/htmltools">htmltools</a> 0.5.2, the new <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> function makes manipulating Shiny tags a real pleasure, in addition to being more efficient. If you know and like <strong>jQuery</strong> (Chapter <a href="survival-kit-javascript.html#intro-jquery">10.5</a>), the API is really similar. If you don’t know jQuery yet, no problem, we’ll see it later in the book!</p>
<p>As a preliminary example, we want to modify the third <code>span</code> element from the above example in section <a href="htmltools-overview.html#htmltools-programmatic-children">2.5.7</a>:</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">p</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">spans</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">attribs</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="st">"test"</span> 

<span class="va">spans</span></code></pre></div>
<pre><code>#&gt; &lt;div&gt;
#&gt;   &lt;div&gt;
#&gt;     &lt;p&gt;&lt;/p&gt;
#&gt;     &lt;span&gt;1&lt;/span&gt;
#&gt;     &lt;span&gt;2&lt;/span&gt;
#&gt;     &lt;span class="test"&gt;3&lt;/span&gt;
#&gt;     &lt;span&gt;4&lt;/span&gt;
#&gt;     &lt;span&gt;5&lt;/span&gt;
#&gt;   &lt;/div&gt;
#&gt; &lt;/div&gt;</code></pre>
<p>Below is the new <a href="https://github.com/rstudio/htmltools">htmltools</a> approach, which leverages <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code>:</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">p</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">spans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">spans</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">find</span><span class="op">(</span><span class="st">"span"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">filter</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span><span class="op">)</span> <span class="va">i</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">addAttrs</span><span class="op">(</span><span class="st">"class"</span> <span class="op">=</span> <span class="st">"amazing-tag"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span>

<span class="va">spans</span></code></pre></div>
<pre><code>#&gt; &lt;div&gt;
#&gt;   &lt;div&gt;
#&gt;     &lt;p&gt;&lt;/p&gt;
#&gt;     &lt;span&gt;1&lt;/span&gt;
#&gt;     &lt;span&gt;2&lt;/span&gt;
#&gt;     &lt;span class="amazing-tag"&gt;3&lt;/span&gt;
#&gt;     &lt;span&gt;4&lt;/span&gt;
#&gt;     &lt;span&gt;5&lt;/span&gt;
#&gt;   &lt;/div&gt;
#&gt; &lt;/div&gt;</code></pre>
<p>As you may notice, the first approach may lead to <strong>poorly</strong> written code as soon as the
tag structure gets more complex. You may easily end up with things like <code>tag$children[[1]]$children[[2]]$children[[1]]$attribs$class</code>, which is nearly impossible to maintain.
The second approach is much more human <strong>readable</strong>, even though not necessarily shorter in this example.
The biggest advantage is that is does not always depend on the overall tag structure. As an exercise, you may wrap the <code>span</code> elements inside another <code>div</code> parent:</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">p</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">spans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">spans</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">find</span><span class="op">(</span><span class="st">"span"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">filter</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span><span class="op">)</span> <span class="va">i</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">addAttrs</span><span class="op">(</span><span class="st">"class"</span> <span class="op">=</span> <span class="st">"amazing-tag"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span>

<span class="va">spans</span></code></pre></div>
<pre><code>#&gt; &lt;div&gt;
#&gt;   &lt;div&gt;
#&gt;     &lt;p&gt;&lt;/p&gt;
#&gt;     &lt;div&gt;
#&gt;       &lt;span&gt;1&lt;/span&gt;
#&gt;       &lt;span&gt;2&lt;/span&gt;
#&gt;       &lt;span class="amazing-tag"&gt;3&lt;/span&gt;
#&gt;       &lt;span&gt;4&lt;/span&gt;
#&gt;       &lt;span&gt;5&lt;/span&gt;
#&gt;     &lt;/div&gt;
#&gt;   &lt;/div&gt;
#&gt; &lt;/div&gt;</code></pre>
<p>The above code still works, while the previous one would require being updated.</p>
<p>Another reason to prefer the new <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> API is the substantial performance <a href="https://rstudio.github.io/htmltools/articles/tagQuery.html#performance-1">gains</a>. Interestingly, under the hood, most if not all older <a href="https://github.com/rstudio/htmltools">htmltools</a> functions like <code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChildren()</a></code> or <code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagAppendAttributes()</a></code> call the <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> API when <code>.cssSelector</code> is provided. In practice,
while we can achieve multiple modifications at once with a single <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> call, it requires a combination of multiple <code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChildren()</a></code>/<code><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagAppendAttributes()</a></code> to reach the same result, thereby leading to less performance.
Are you ready to become a tag witcher [^tag-witcher]?</p>
<p><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;tag-witcher&lt;/p&gt;"><sup>1</sup></a>: I hope you’ll realize that it is easier than killing weird monsters, drinking dangerous potions made of deadly mutagens and not taking any bath for weeks…but one never knows!].</p>
<div id="basics" class="section level3" number="2.6.1">
<h3>
<span class="header-section-number">2.6.1</span> Basics<a class="anchor" aria-label="anchor" href="#basics"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> accepts a tag or list of tags as input and returns a data structure containing:</p>
<ul>
<li>
<code>$allTags()</code>: all tags.</li>
<li>
<code>$selectedTags()</code>: selected tags, default to <code>$allTags()</code>.</li>
</ul>
<p>As an example:</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tag_query</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">p</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">tag_query</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] "shiny.tag.query"</code></pre>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tag_query</span></code></pre></div>
<pre><code>#&gt; `$allTags()`:
#&gt; &lt;div&gt;
#&gt;   &lt;p&gt;&lt;/p&gt;
#&gt; &lt;/div&gt;
#&gt; 
#&gt; `$selectedTags()`: `$allTags()`</code></pre>
<p>As shown above, the returned result is not a Shiny tag. Instead, it is a <a href="https://r6.r-lib.org/articles/Introduction.html">R6</a> class having methods to handle those tags.</p>
</div>
<div id="query-tags" class="section level3" number="2.6.2">
<h3>
<span class="header-section-number">2.6.2</span> Query tags<a class="anchor" aria-label="anchor" href="#query-tags"><i class="fas fa-link"></i></a>
</h3>
<p>Below is a table summarizing all available query methods. Note that at the time of writing, <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> only supports simple CSS selectors. For instance, <code>data-...</code> selectors are not covered, as well as <code>,</code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> and <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>. However, we’ll see below there are many options to work around.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">children</td>
<td align="center">Get all the direct descendants of each selected tag</td>
</tr>
<tr class="even">
<td align="center">find</td>
<td align="center">Get all descendants of each selected tag</td>
</tr>
<tr class="odd">
<td align="center">parent</td>
<td align="center">Get the direct ancestors of each selected tag</td>
</tr>
<tr class="even">
<td align="center">parents</td>
<td align="center">Get all parents of each selected tag</td>
</tr>
<tr class="odd">
<td align="center">siblings</td>
<td align="center">Get all siblings of each selected tag</td>
</tr>
<tr class="even">
<td align="center">filter</td>
<td align="center">Subset selected tags with CSS selectors or R function</td>
</tr>
<tr class="odd">
<td align="center">resetSelected</td>
<td align="center">Reset set of selected tags to the root tag</td>
</tr>
</tbody>
</table></div>
<p>According to Figure <a href="htmltools-overview.html#fig:htmltools-query-tags">2.5</a>, while <code>$children()</code> selects only direct descendants, <code>$find()</code> is slightly more powerful and drills down to any level deeper. <code>$filter()</code> is convenient to subset selected tags, for instance, depending on a specific attribute. A dedicated section (<a href="htmltools-overview.html#htmtools-chain-queries">2.6.4</a>) covers <code>$resetSelected()</code>, which essentially resets the current selection to the root tag. Whereas <code>$parent()</code> allows going up step by step, returning each time the direct ancestor, <code>$parents()</code> returns all ancestors. If you need to be even more specific, <code>$closest(cssSelector)</code> goes up until it finds the matching <code>cssSelector</code>. Note that, if <code>cssSelector = NULL</code>, <code>$closest()</code> is equivalent to call <code>$selectedTags()</code>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:htmltools-query-tags"></span>
<img src="images/htmltools/htmltools-query-tags.png" alt="tagQuery API: overview of query methods." width="100%"><p class="caption">
FIGURE 2.5: tagQuery API: overview of query methods.
</p>
</div>
<p>Let’s consider an example consisting of a <a href="https://mastering-shiny.org/action-layout.html#tabsets">tabset</a> panel with three tabs. Those menu items are one of the most challenging elements to handle when building a custom Shiny template and the new <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> literally make it a breeze to handle. A detailed case study is available section <a href="custom-templates-skeleton.html#tabler-navbar-navigation">17.2.4.1</a>.</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp_tabs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Tab"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="va">tabs</span> <span class="op">&lt;-</span> <span class="fu">bs4Dash</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/tabsetPanel.html">tabsetPanel</a></span><span class="op">(</span>.list <span class="op">=</span> <span class="va">temp_tabs</span><span class="op">)</span>

<span class="va">tabs</span></code></pre></div>
<!-- This is to trim the output too large for pdf -->
<pre><code>#&gt; &lt;div class="tabbable"&gt;
#&gt;   &lt;ul class="nav nav-tabs" data-tabsetid="6315"&gt;
#&gt;     &lt;li class="nav-item"&gt;
#&gt;       &lt;a href="#" data-toggle="tab" data-value="1" class="nav-link active" data-target="#tab-6315-1"&gt;1&lt;/a&gt;
#&gt;     &lt;/li&gt;
#&gt;     &lt;li class="nav-item"&gt;
#&gt;       &lt;a href="#" data-toggle="tab" data-value="2" class="nav-link" data-target="#tab-6315-2"&gt;2&lt;/a&gt;
#&gt;     &lt;/li&gt;
#&gt;     &lt;li class="nav-item"&gt;
#&gt;       &lt;a href="#" data-toggle="tab" data-value="3" class="nav-link" data-target="#tab-6315-3"&gt;3&lt;/a&gt;
#&gt;     &lt;/li&gt;
#&gt;   &lt;/ul&gt;
#&gt;   &lt;div class="tab-content" data-tabsetid="6315"&gt;
#&gt;     &lt;div class="tab-pane active" data-value="1" id="tab-6315-1"&gt;Tab 1&lt;/div&gt;
#&gt;     &lt;div class="tab-pane" data-value="2" id="tab-6315-2"&gt;Tab 2&lt;/div&gt;
#&gt;     &lt;div class="tab-pane" data-value="3" id="tab-6315-3"&gt;Tab 3&lt;/div&gt;
#&gt;   &lt;/div&gt;
#&gt; &lt;/div&gt;</code></pre>
<p>How would you select the third tab content element?</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">tabs</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">find</span><span class="op">(</span><span class="st">"div.tab-pane"</span><span class="op">)</span><span class="op">$</span> <span class="co"># div element with tab-pane class</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagGetAttribute</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"data-value"</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [[1]]
#&gt; &lt;div class="tab-pane" data-value="3" id="tab-6315-3"&gt;Tab 3&lt;/div&gt;</code></pre>
<p>Note that we provided an anonymous R function to <code>$filter()</code>, where x is the tag and i the index, allowing us to drill down to the third tab, which has <code>data-value = 3</code>.</p>
<p>As an exercise, I give you two minutes to find the classic <a href="https://github.com/rstudio/htmltools">htmltools</a> equivalent. If you don’t manage, it means the new <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> system is rather convenient.</p>
</div>
<div id="modify-tags" class="section level3" number="2.6.3">
<h3>
<span class="header-section-number">2.6.3</span> Modify tags<a class="anchor" aria-label="anchor" href="#modify-tags"><i class="fas fa-link"></i></a>
</h3>
<p>As shown in the preliminary example, the main interest of querying tags is to ultimately modify them. <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> exposes methods to modify <strong>attributes</strong>, <strong>children</strong> of the query selection.</p>
<div id="playing-with-attributes" class="section level4" number="2.6.3.1">
<h4>
<span class="header-section-number">2.6.3.1</span> Playing with attributes<a class="anchor" aria-label="anchor" href="#playing-with-attributes"><i class="fas fa-link"></i></a>
</h4>
<p>As shown Figure <a href="htmltools-overview.html#fig:htmltools-modify-attributes">2.6</a>, there are currently two main methods to alter tag attributes, namely <code>$addAttrs()</code> (equivalent of <code>tagAppendAttributes</code>) and <code>$removeAttrs()</code>, even though more specific methods exists, for instance <code>$addClass()</code>, <code>$removeClass()</code> and <code>$toggleClass()</code>.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">addAttrs</td>
<td align="center">Add any number of attributes to each selected tag</td>
</tr>
<tr class="even">
<td align="center">removeAttrs</td>
<td align="center">Remove any number of attributes to each selected tag</td>
</tr>
<tr class="odd">
<td align="center">hasAttrs</td>
<td align="center">Check if the selected tag has the specified attribute(s)</td>
</tr>
<tr class="even">
<td align="center">addClass</td>
<td align="center">Add any number of new classes to each selected tag</td>
</tr>
<tr class="odd">
<td align="center">removeClass</td>
<td align="center">Remove any number of classes to each selected tag</td>
</tr>
<tr class="even">
<td align="center">hasClass</td>
<td align="center">Check if the selected tag has the specified classe(s)</td>
</tr>
</tbody>
</table></div>
<div class="figure">
<span style="display:block;" id="fig:htmltools-modify-attributes"></span>
<img src="images/htmltools/htmltools-modify-attributes.png" alt="tagQuery API: modify tag attributes." width="100%"><p class="caption">
FIGURE 2.6: tagQuery API: modify tag attributes.
</p>
</div>
<p>Bootstrap 4 allows us to apply a fade <a href="https://getbootstrap.com/docs/4.6/components/navs/#fade-effect">transition</a> between tabs, provided that those tabs have the <code>fade</code> class. Below is how to seamlessly do it with <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code>:</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">tabs</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">find</span><span class="op">(</span><span class="st">".tab-pane"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">addClass</span><span class="op">(</span><span class="st">"fade"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [[1]]
#&gt; &lt;div class="tab-pane active fade" data-value="1" id="tab-6315-1"&gt;Tab 1&lt;/div&gt;
#&gt; 
#&gt; [[2]]
#&gt; &lt;div class="tab-pane fade" data-value="2" id="tab-6315-2"&gt;Tab 2&lt;/div&gt;
#&gt; 
#&gt; [[3]]
#&gt; &lt;div class="tab-pane fade" data-value="3" id="tab-6315-3"&gt;Tab 3&lt;/div&gt;</code></pre>
</div>
<div id="altering-tagchildrensiblings" class="section level4" number="2.6.3.2">
<h4>
<span class="header-section-number">2.6.3.2</span> Altering tag/children/siblings<a class="anchor" aria-label="anchor" href="#altering-tagchildrensiblings"><i class="fas fa-link"></i></a>
</h4>
<p>Below are listed some methods to alter the current tag or its children, as depicted Figure <a href="htmltools-overview.html#fig:htmltools-alter-tags">2.7</a>.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="center">Method</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">append</td>
<td align="center">Insert content after the children of each selected tag</td>
</tr>
<tr class="even">
<td align="center">prepend</td>
<td align="center">Insert content before the children of each selected tag</td>
</tr>
<tr class="odd">
<td align="center">empty</td>
<td align="center">Remove all children from the selected tag</td>
</tr>
<tr class="even">
<td align="center">remove</td>
<td align="center">Remove all selected tags</td>
</tr>
<tr class="odd">
<td align="center">before</td>
<td align="center">Insert content before each selected tag</td>
</tr>
<tr class="even">
<td align="center">after</td>
<td align="center">Insert content after each selected tag</td>
</tr>
<tr class="odd">
<td align="center">replaceWith</td>
<td align="center">Replace the currently selected tag by the provided tag</td>
</tr>
</tbody>
</table></div>
<div class="figure">
<span style="display:block;" id="fig:htmltools-alter-tags"></span>
<img src="images/htmltools/htmltools-alter-tags.png" alt="tagQuery API: alter tags children." width="100%"><p class="caption">
FIGURE 2.7: tagQuery API: alter tags children.
</p>
</div>
<p>Going back to our previous tabs example, we would like to include an icon before each tab title. We leverage the <code>$prepend()</code> method, after selecting the <code>a</code> elements part of the tab navigation:</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Add extra item to tabs at the end</span>
<span class="va">new_tabs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">tabs</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">find</span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">prepend</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"flag"</span><span class="op">)</span><span class="op">)</span>

<span class="va">new_tabs</span><span class="op">$</span><span class="fu">selectedTags</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [[1]]
#&gt; &lt;a href="#" data-toggle="tab" data-value="1" class="nav-link active" data-target="#tab-6315-1"&gt;
#&gt;   &lt;i class="fa fa-flag" role="presentation" aria-label="flag icon"&gt;&lt;/i&gt;
#&gt;   1
#&gt; &lt;/a&gt;
#&gt; 
#&gt; [[2]]
#&gt; &lt;a href="#" data-toggle="tab" data-value="2" class="nav-link" data-target="#tab-6315-2"&gt;
#&gt;   &lt;i class="fa fa-flag" role="presentation" aria-label="flag icon"&gt;&lt;/i&gt;
#&gt;   2
#&gt; &lt;/a&gt;
#&gt; 
#&gt; [[3]]
#&gt; &lt;a href="#" data-toggle="tab" data-value="3" class="nav-link" data-target="#tab-6315-3"&gt;
#&gt;   &lt;i class="fa fa-flag" role="presentation" aria-label="flag icon"&gt;&lt;/i&gt;
#&gt;   3
#&gt; &lt;/a&gt;</code></pre>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span><span class="va">new_tabs</span><span class="op">$</span><span class="fu">allTags</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>The result is shown in Figure <a href="htmltools-overview.html#fig:htmltools-tabs-icons">2.8</a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:htmltools-tabs-icons"></span>
<img src="images/htmltools/htmltools-tabs-icons.png" alt="tagQuery API in action: a customized Shiny tabsetPanel." width="25%"><p class="caption">
FIGURE 2.8: tagQuery API in action: a customized Shiny tabsetPanel.
</p>
</div>
</div>
</div>
<div id="htmtools-chain-queries" class="section level3" number="2.6.4">
<h3>
<span class="header-section-number">2.6.4</span> Chain tag queries<a class="anchor" aria-label="anchor" href="#htmtools-chain-queries"><i class="fas fa-link"></i></a>
</h3>
<p>One of the strengths of the <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> API is the ability to <strong>chain</strong> methods, where the classic <a href="https://github.com/rstudio/htmltools">htmltools</a> syntax might be <strong>repetitive</strong> and heavy. <code>$resetSelected()</code> allows us to <strong>reset</strong> the tag selection to the root tag after a given operation, thereby making it possible to chain multiple queries with different purposes. The overall flow is more human readable than a step-by-step approach, similar to the <code>tidyverse</code> or <code>ggplot</code> grammar. Let’s combine all previous examples:</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add fade class to all panels</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">tabs</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">find</span><span class="op">(</span><span class="st">".tab-pane"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">addClass</span><span class="op">(</span><span class="st">"fade"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">removeClass</span><span class="op">(</span><span class="st">"active"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">filter</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagGetAttribute</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"data-value"</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">addClass</span><span class="op">(</span><span class="st">"active"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">resetSelected</span><span class="op">(</span><span class="op">)</span><span class="op">$</span>
  <span class="co"># new operation: add icon before each nav link title</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/apropos.html">find</a></span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">prepend</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"flag"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
  <span class="co"># Here the next operation use the same target</span>
  <span class="co"># We don't need to reset the scope</span>
  <span class="fu">removeClass</span><span class="op">(</span><span class="st">"active"</span><span class="op">)</span><span class="op">$</span>
  <span class="co"># Select third nav link</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagGetAttribute</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"data-value"</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span><span class="op">$</span>
  <span class="co"># Make it active</span>
  <span class="fu">addClass</span><span class="op">(</span><span class="st">"active"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; &lt;div class="tabbable"&gt;
#&gt;   &lt;ul class="nav nav-tabs" data-tabsetid="6315"&gt;
#&gt;     &lt;li class="nav-item"&gt;
#&gt;       &lt;a href="#" data-toggle="tab" data-value="1" class="nav-link" data-target="#tab-6315-1"&gt;
#&gt;         &lt;i class="fa fa-flag" role="presentation" aria-label="flag icon"&gt;&lt;/i&gt;
#&gt;         1
#&gt;       &lt;/a&gt;
#&gt;     &lt;/li&gt;
#&gt;     &lt;li class="nav-item"&gt;
#&gt;       &lt;a href="#" data-toggle="tab" data-value="2" class="nav-link" data-target="#tab-6315-2"&gt;
#&gt;         &lt;i class="fa fa-flag" role="presentation" aria-label="flag icon"&gt;&lt;/i&gt;
#&gt;         2
#&gt;       &lt;/a&gt;
#&gt;     &lt;/li&gt;
#&gt;     &lt;li class="nav-item"&gt;
#&gt;       &lt;a href="#" data-toggle="tab" data-value="3" class="nav-link active" data-target="#tab-6315-3"&gt;
#&gt;         &lt;i class="fa fa-flag" role="presentation" aria-label="flag icon"&gt;&lt;/i&gt;
#&gt;         3
#&gt;       &lt;/a&gt;
#&gt;     &lt;/li&gt;
#&gt;   &lt;/ul&gt;
#&gt;   &lt;div class="tab-content" data-tabsetid="6315"&gt;
#&gt;     &lt;div class="tab-pane fade" data-value="1" id="tab-6315-1"&gt;Tab 1&lt;/div&gt;
#&gt;     &lt;div class="tab-pane fade" data-value="2" id="tab-6315-2"&gt;Tab 2&lt;/div&gt;
#&gt;     &lt;div class="tab-pane fade active" data-value="3" id="tab-6315-3"&gt;Tab 3&lt;/div&gt;
#&gt;   &lt;/div&gt;
#&gt; &lt;/div&gt;</code></pre>
</div>
<div id="specific-cases" class="section level3" number="2.6.5">
<h3>
<span class="header-section-number">2.6.5</span> Specific cases<a class="anchor" aria-label="anchor" href="#specific-cases"><i class="fas fa-link"></i></a>
</h3>
<p>There are situations where the previous methods won’t work. What if you want to modify the
tab content from <code>Tab i</code> to <code>This is tab i</code>. A common mistake would be to proceed as follows:</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">tabs</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">find</span><span class="op">(</span><span class="st">".tab-pane"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">empty</span><span class="op">(</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">append</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"This is tab"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [[1]]
#&gt; &lt;div class="tab-pane active" data-value="1" id="tab-6315-1"&gt;
#&gt;   This is tab 1
#&gt;   This is tab 2
#&gt;   This is tab 3
#&gt; &lt;/div&gt;
#&gt; 
#&gt; [[2]]
#&gt; &lt;div class="tab-pane" data-value="2" id="tab-6315-2"&gt;
#&gt;   This is tab 1
#&gt;   This is tab 2
#&gt;   This is tab 3
#&gt; &lt;/div&gt;
#&gt; 
#&gt; [[3]]
#&gt; &lt;div class="tab-pane" data-value="3" id="tab-6315-3"&gt;
#&gt;   This is tab 1
#&gt;   This is tab 2
#&gt;   This is tab 3
#&gt; &lt;/div&gt;</code></pre>
<p>You may think it will add each text to the corresponding panel item, but methods like <code>$append()</code> and <code>$prepend()</code> are only able to add the same element(s) to one or multiple target(s). It will actually add three new children to each selected panel. For this case where the content is <strong>index</strong> specific, we have to utilize <code>$each()</code>. It takes an anonymous function as input, with two parameters. x is the tag and i is the current index. Inside that function, you may edit the tag depending on the index and return the modified structure:</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">tabs</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">find</span><span class="op">(</span><span class="st">".tab-pane"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">empty</span><span class="op">(</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">each</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># replace text</span>
    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChildren</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"This is tab"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span>
    <span class="co"># return edited tag</span>
    <span class="va">x</span>
  <span class="op">}</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [[1]]
#&gt; &lt;div class="tab-pane active" data-value="1" id="tab-6315-1"&gt;This is tab 1&lt;/div&gt;
#&gt; 
#&gt; [[2]]
#&gt; &lt;div class="tab-pane" data-value="2" id="tab-6315-2"&gt;This is tab 2&lt;/div&gt;
#&gt; 
#&gt; [[3]]
#&gt; &lt;div class="tab-pane" data-value="3" id="tab-6315-3"&gt;This is tab 3&lt;/div&gt;</code></pre>
</div>
<div id="htmltools-shinyRPG-rework" class="section level3" number="2.6.6">
<h3>
<span class="header-section-number">2.6.6</span> Practice<a class="anchor" aria-label="anchor" href="#htmltools-shinyRPG-rework"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s rewrite the shinyRPG select (see <a href="htmltools-overview.html#htmltools-shinyRPG">2.5.2</a>) input using the new <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> API. As a reminder, the function is given <a href="https://github.com/RinteRface/shinyRPG/blob/a1fe30761ffd6469f28a0f92107d9613e9eccbe7/R/inputs.R#L180">here</a>. The new approach is described below and leverages almost all the <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> API tools. We first remove the outer div class and the label class with <code>$removeAttrs()</code>. These two steps don’t need any reset since the label is a child of the outer div. The next step is targeting the select element and requires using <code>$siblings()</code> to catch the <code>div</code> parent followed by a <code>$children()</code>, which will capture the select (interestingly, we could also have reset the selection with <code>$resetSelected()</code> and apply <code>$find()</code>). We also add a custom class with <code>$addClass()</code>. We finally go back to the parent outer <code>div</code> with <code>$resetSelected()</code> and apply <code>$each()</code> to replace the inner <code>div</code> with its children.</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">selectTag</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">removeAttrs</span><span class="op">(</span><span class="st">"class"</span><span class="op">)</span><span class="op">$</span> <span class="co"># remove outer div class</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/apropos.html">find</a></span><span class="op">(</span><span class="st">".control-label"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">removeAttrs</span><span class="op">(</span><span class="st">"class"</span><span class="op">)</span><span class="op">$</span> <span class="co"># remove class from child label</span>
  <span class="fu">siblings</span><span class="op">(</span><span class="op">)</span><span class="op">$</span> <span class="co"># go down to the div </span>
  <span class="fu">children</span><span class="op">(</span><span class="op">)</span><span class="op">$</span> <span class="co"># go down to the select tag</span>
  <span class="fu">addClass</span><span class="op">(</span><span class="va">selectClass</span><span class="op">)</span><span class="op">$</span> <span class="co"># add class to child select</span>
  <span class="fu">resetSelected</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="co"># go back to div parent</span>
  <span class="fu">each</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">x</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">children</span>
  <span class="op">}</span><span class="op">)</span><span class="op">$</span> <span class="co"># replace div parent </span>
  <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The complete code may be found in <a href="code-outputs.html#mastering-htmltools-appendix">A.1.1</a>.</p>
</div>
<div id="alter-tag-rendering-with-render-hooks" class="section level3" number="2.6.7">
<h3>
<span class="header-section-number">2.6.7</span> Alter tag rendering with render hooks<a class="anchor" aria-label="anchor" href="#alter-tag-rendering-with-render-hooks"><i class="fas fa-link"></i></a>
</h3>
<div id="simple-hooks" class="section level4" number="2.6.7.1">
<h4>
<span class="header-section-number">2.6.7.1</span> Simple hooks<a class="anchor" aria-label="anchor" href="#simple-hooks"><i class="fas fa-link"></i></a>
</h4>
<p>In this section, we’ll see what is probably one of the most advanced <a href="https://github.com/rstudio/htmltools">htmltools</a> feature, recently introduced in version <a href="https://rstudio.github.io/htmltools/news/index.html#new-features--improvements-0-5-2">0.5.2</a>. How would you conditionally render a tag, for instance depending on different conditions like external options, a specific theme version, …?</p>
<p>Assume you want to design development specific tags, that only appear in Shiny <code>dev</code> mode:</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/devmode.html">devmode</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"shiny.devmode"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] TRUE</code></pre>
<p>Then we create our custom tag with the <code>.renderHook</code> parameter available for the <a href="https://github.com/rstudio/htmltools">htmltools</a> tag element, providing a special function, namely a <strong>render hook</strong>, that will be called upon for tag rendering:</p>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cssStyle</span> <span class="op">&lt;-</span> <span class="st">"color:red; border-style:dashed; border-color:blue;"</span>
<span class="va">customTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">span</a></span><span class="op">(</span><span class="st">""</span>, .renderHook <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"shiny.devmode"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagAppendAttributes</a></span><span class="op">(</span><span class="va">x</span>, style <span class="op">=</span> <span class="va">cssStyle</span><span class="op">)</span>
  <span class="op">}</span> 
<span class="op">}</span><span class="op">)</span>

<span class="va">customTag</span></code></pre></div>
<pre><code>#&gt; &lt;span style="color:red; border-style:dashed; border-color:blue;"&gt;&lt;/span&gt;</code></pre>
<p>Note that if the tag already has any existing <strong>hook</strong>, <code><a href="https://rdrr.io/pkg/htmltools/man/tagAddRenderHook.html">tagAddRenderHook()</a></code> adds another hook to the current list. An option controls whether to erase existing hooks (<code>replace</code>).</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">customTag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAddRenderHook.html">tagAddRenderHook</a></span><span class="op">(</span><span class="va">customTag</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"shiny.devmode"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendChild.html">tagAppendChildren</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"UNDER REWORK"</span><span class="op">)</span>
  <span class="op">}</span> 
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>The hooks list is accessible with:</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">customTag</span><span class="op">$</span><span class="va">.renderHooks</span></code></pre></div>
<pre><code>#&gt; [[1]]
#&gt; function(x) {
#&gt;     if (getOption("shiny.devmode")) {
#&gt;       tagAppendAttributes(x, style = cssStyle)
#&gt;     } 
#&gt;   }
#&gt; 
#&gt; [[2]]
#&gt; function(x) {
#&gt;   if (getOption("shiny.devmode")) {
#&gt;     tagAppendChildren(x, "UNDER REWORK")
#&gt;   } 
#&gt; }</code></pre>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Remove first hook</span>
<span class="co"># customTag$.renderHooks[[1]] &lt;- NULL</span></code></pre></div>
<p>which is convenient to remove or edit hooks. Figure <a href="htmltools-overview.html#fig:htmltools-tags-renderHook">2.9</a> summarizes the main mechanisms.</p>
<div class="figure">
<span style="display:block;" id="fig:htmltools-tags-renderHook"></span>
<img src="images/htmltools/htmltools-tags-renderHook.png" alt="Alter tags before rendering: htmltools hooks." width="100%"><p class="caption">
FIGURE 2.9: Alter tags before rendering: htmltools hooks.
</p>
</div>
<p>Let’s try it in a Shiny app with the <code>dev</code> mode enabled:</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span><span class="va">customTag</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span><span class="va">customTag</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>We disable the <code>dev</code> mode:</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/devmode.html">devmode</a></span><span class="op">(</span>devmode <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"shiny.devmode"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>The result is shown Figure <a href="htmltools-overview.html#fig:htmltools-renderHook">2.10</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:htmltools-renderHook"></span>
<img src="images/htmltools/htmltools-renderHook-1.png" alt="tagAddRenderHook in action. Left: Shiny dev mode enabled; right: Shiny dev mode disabled." width="50%"><img src="images/htmltools/htmltools-renderHook-2.png" alt="tagAddRenderHook in action. Left: Shiny dev mode enabled; right: Shiny dev mode disabled." width="50%"><p class="caption">
FIGURE 2.10: tagAddRenderHook in action. Left: Shiny dev mode enabled; right: Shiny dev mode disabled.
</p>
</div>
<p>In Chapter <a href="beautify-with-bootstraplib.html#bslib-renderHook">9.3.3</a> we’ll discuss another use case, which is about theme-dependent rendering, that is, for instance, rendering a tag differently whether Shiny is in Bootstrap 3 or Bootstrap 4 mode.</p>
</div>
<div id="htmltools-nested-renderhooks" class="section level4" number="2.6.7.2">
<h4>
<span class="header-section-number">2.6.7.2</span> Nested hooks<a class="anchor" aria-label="anchor" href="#htmltools-nested-renderhooks"><i class="fas fa-link"></i></a>
</h4>
<p>In practice, you will rarely have only one render hook to handle. Most Shiny elements are composed
of main wrappers and <strong>nested</strong> tags. For instance, nav elements like <code><a href="https://rdrr.io/pkg/shiny/man/tabsetPanel.html">tabsetPanel()</a></code> and <code><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel()</a></code> are, again, the perfect example.</p>
<p>How do we handle render hooks with nested elements? Let’s see below with a simple example.
We first consider the main wrapper, namely <code>my_wrapper_tag()</code>. The function creates a single <code>div</code> wrapper containing other items generated with another function. In the render hook, we simulate the impact of
a <code>theme_version</code> option. We capture all passed items in a list and apply <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> to edit a given
element targeted with a specific class, using <code>$each()</code> to loop over all items and add an <code>id</code> attribute to them. We store the query result in a new item variable and replace the old items by the newly generated ones in the main wrapper with <code>$empty()</code> and <code>$append()</code>. Note the commented rows, we will discuss it later.</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_wrapper_tag</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">wrapper</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>class <span class="op">=</span> <span class="st">"parent"</span>, <span class="va">...</span><span class="op">)</span>
  <span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAddRenderHook.html">tagAddRenderHook</a></span><span class="op">(</span><span class="va">wrapper</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">version</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"theme_version"</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">version</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw">if</span> <span class="op">(</span><span class="va">version</span> <span class="op">==</span> <span class="st">"4"</span><span class="op">)</span> <span class="op">{</span>
        <span class="co"># resolve sub items</span>
        <span class="co"># items &lt;- lapply(items, as.tags)</span>
        <span class="co"># INSERT BROWSER TO DEBUG</span>
        <span class="va">new_items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">items</span><span class="op">)</span><span class="op">$</span>
          <span class="fu">find</span><span class="op">(</span><span class="st">".new-child"</span><span class="op">)</span><span class="op">$</span>
          <span class="fu">each</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span>
            <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagAppendAttributes</a></span><span class="op">(</span><span class="va">x</span>, id <span class="op">=</span> <span class="va">i</span><span class="op">)</span>
          <span class="op">}</span><span class="op">)</span><span class="op">$</span>
          <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span>
        
        <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span>
          <span class="co"># replace accordion items processed above</span>
          <span class="fu">empty</span><span class="op">(</span><span class="op">)</span><span class="op">$</span>
          <span class="fu">append</span><span class="op">(</span><span class="va">new_items</span><span class="op">)</span><span class="op">$</span>
          <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span>
      <span class="op">}</span> 
    <span class="op">}</span>
    <span class="va">x</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The next step is to design the nested item function. The tag consists of a
simple <code>div</code> element with a class. In the render hook, we get the theme version
and, depending on the result, we add a child to the item with <code>$append()</code>.
Note the <code>new-child</code> class. This is the one targeted one level up in <code>my_wrapper_tag()</code>.</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_nested_tag</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">wrapper</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>class <span class="op">=</span> <span class="st">"nested"</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAddRenderHook.html">tagAddRenderHook</a></span><span class="op">(</span><span class="va">wrapper</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">version</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"theme_version"</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">version</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">x</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">version</span> <span class="op">==</span> <span class="st">"4"</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">new_child</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>class <span class="op">=</span> <span class="st">"new-child"</span><span class="op">)</span>
        
        <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span>
          <span class="fu">append</span><span class="op">(</span><span class="va">new_child</span><span class="op">)</span><span class="op">$</span>
          <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span>
      <span class="op">}</span> 
    <span class="op">}</span>
    <span class="va">x</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We test it below:</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define external option to mimic arbitrary change</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="st">"theme_version"</span> <span class="op">=</span> <span class="st">"4"</span><span class="op">)</span>
<span class="fu">my_wrapper_tag</span><span class="op">(</span><span class="fu">my_nested_tag</span><span class="op">(</span><span class="op">)</span>, <span class="fu">my_nested_tag</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; &lt;div class="parent"&gt;
#&gt;   &lt;div class="nested"&gt;
#&gt;     &lt;div class="new-child"&gt;&lt;/div&gt;
#&gt;   &lt;/div&gt;
#&gt;   &lt;div class="nested"&gt;
#&gt;     &lt;div class="new-child"&gt;&lt;/div&gt;
#&gt;   &lt;/div&gt;
#&gt; &lt;/div&gt;</code></pre>
<p>The code does not seem to work as expected since the child items do not get any new <code>id</code> attribute,
contrary to what is specified in the <code>my_wrapper_tag()</code> render hook. What is the problem here?</p>
<p>It is basically a resolve issue. In the top-level render hook, the newly added item is not yet available. To check this, we can put a <code><a href="https://rdrr.io/r/base/browser.html">browser()</a></code> just before the <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> flow inside <code>my_wrapper_tag()</code>:</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_wrapper_tag</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># start</span>
  <span class="co"># ...</span>
  
  <span class="co"># TO DEBUG</span>
  <span class="fu"><a href="https://rdrr.io/r/base/browser.html">browser</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="va">new_items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">items</span><span class="op">)</span><span class="op">$</span>
    <span class="fu">find</span><span class="op">(</span><span class="st">".new-child"</span><span class="op">)</span><span class="op">$</span>
    <span class="fu">each</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAppendAttributes.html">tagAppendAttributes</a></span><span class="op">(</span><span class="va">x</span>, id <span class="op">=</span> <span class="va">i</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span><span class="op">$</span>
    <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span>
  
  <span class="co"># ...</span>
  <span class="co"># end</span>
<span class="op">}</span></code></pre></div>
<p>Then we run <code>tagQuery(items)$find(".new-child")</code> and capture the output:</p>
<pre><code>#&gt; `$allTags()`:
#&gt; &lt;div class="nested"&gt;
#&gt;   &lt;div class="new-child"&gt;&lt;/div&gt;
#&gt; &lt;/div&gt;
#&gt; &lt;div class="nested"&gt;
#&gt;   &lt;div class="new-child"&gt;&lt;/div&gt;
#&gt; &lt;/div&gt;
#&gt;
#&gt; `$selectedTags()`: (Empty selection)</code></pre>
<p>From what we see, <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> does not manage to find the newly inserted element with <code>new-child</code> class in the lower-level render hook. If we inspect <code><a href="https://rdrr.io/r/utils/str.html">str(items[[1]])</a></code>:</p>
<pre><code>#&gt; List of 4
#&gt; $ name        : chr "div"
#&gt; $ attribs     :List of 1
#&gt;  ..$ class: chr "nested"
#&gt; $ children    : list()
#&gt; $ .renderHooks:List of 1
#&gt;  ..$ :function (x)  
#&gt;  .. ..- attr(*, "srcref")= 'srcref' 
#&gt;  int [1:8] 4 31 20 5 31 5 4 20
#&gt;  .. .. ..- attr(*, "srcfile")=Classes 'srcfilecopy', 
#&gt;  'srcfile' &lt;environment: 0x7fcbf889aba8&gt; 
#&gt; - attr(*, "class")= chr "shiny.tag"</code></pre>
<p>We get the confirmation that the child item is not available for <a href="https://github.com/rstudio/htmltools">htmltools</a>, even if it appears in the code output:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb145-1"><a href="htmltools-overview.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- items[[1]] --&gt;</span></span>
<span id="cb145-2"><a href="htmltools-overview.html#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;div</span> <span class="er">class</span><span class="ot">=</span><span class="st">"nested"</span><span class="kw">&gt;</span></span>
<span id="cb145-3"><a href="htmltools-overview.html#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;div</span> <span class="er">class</span><span class="ot">=</span><span class="st">"new-child"</span><span class="kw">&gt;&lt;/div&gt;</span></span>
<span id="cb145-4"><a href="htmltools-overview.html#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<p>A workaround is to manually resolve the sub items with <code><a href="https://rdrr.io/pkg/htmltools/man/as.tags.html">as.tags()</a></code>, which converts
any arbitrary element to be part of the tag structure. Therefore, if you uncomment <code>items &lt;- lapply(items, as.tags)</code> in <code>my_wrapper_tag()</code>, we obtain:</p>
<pre><code>#&gt; List of 4
#&gt; $ name        : chr "div"
#&gt; $ attribs     :List of 1
#&gt;  ..$ class: chr "nested"
#&gt; $ children    :List of 1
#&gt;  ..$ :List of 3
#&gt;  .. ..$ name    : chr "div"
#&gt;  .. ..$ attribs :List of 1
#&gt;  .. .. ..$ class: chr "new-child"
#&gt;  .. ..$ children: list()
#&gt;  .. ..- attr(*, "class")= chr "shiny.tag"
#&gt; $ .renderHooks: list()
#&gt; - attr(*, "class")= chr "shiny.tag"</code></pre>
<p>confirming the structure is now correctly processed. Running <code>my_wrapper_tag(my_nested_tag(), my_nested_tag())</code> yields:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb147-1"><a href="htmltools-overview.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- RUN: my_wrapper_tag(my_nested_tag(), my_nested_tag()) --&gt;</span></span>
<span id="cb147-2"><a href="htmltools-overview.html#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="htmltools-overview.html#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;div</span> <span class="er">class</span><span class="ot">=</span><span class="st">"parent"</span><span class="kw">&gt;</span></span>
<span id="cb147-4"><a href="htmltools-overview.html#cb147-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;div</span> <span class="er">class</span><span class="ot">=</span><span class="st">"nested"</span><span class="kw">&gt;</span></span>
<span id="cb147-5"><a href="htmltools-overview.html#cb147-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;div</span> <span class="er">class</span><span class="ot">=</span><span class="st">"new-child"</span> <span class="er">id</span><span class="ot">=</span><span class="st">"1"</span><span class="kw">&gt;&lt;/div&gt;</span></span>
<span id="cb147-6"><a href="htmltools-overview.html#cb147-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/div&gt;</span></span>
<span id="cb147-7"><a href="htmltools-overview.html#cb147-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;div</span> <span class="er">class</span><span class="ot">=</span><span class="st">"nested"</span><span class="kw">&gt;</span></span>
<span id="cb147-8"><a href="htmltools-overview.html#cb147-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;div</span> <span class="er">class</span><span class="ot">=</span><span class="st">"new-child"</span> <span class="er">id</span><span class="ot">=</span><span class="st">"2"</span><span class="kw">&gt;&lt;/div&gt;</span></span>
<span id="cb147-9"><a href="htmltools-overview.html#cb147-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/div&gt;</span></span>
<span id="cb147-10"><a href="htmltools-overview.html#cb147-10" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<p>which is exactly what we want! A real-life case study is available later in the book in section <a href="beautify-with-bootstraplib.html#bslib-bootstrap-accordion">9.3.3.3</a>.</p>

</div>
</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></div>
<div class="next"><a href="web-dependencies.html"><span class="header-section-number">3</span> Discover Shiny dependencies</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#htmltools-overview"><span class="header-section-number">2</span> Manipulate HTML tags from R with {htmltools}</a></li>
<li><a class="nav-link" href="#writing-html-tags-from-r"><span class="header-section-number">2.1</span> Writing HTML Tags from R</a></li>
<li><a class="nav-link" href="#notations"><span class="header-section-number">2.2</span> Notations</a></li>
<li><a class="nav-link" href="#adding-new-tags"><span class="header-section-number">2.3</span> Adding new tags</a></li>
<li><a class="nav-link" href="#alternative-way-to-write-tags"><span class="header-section-number">2.4</span> Alternative way to write tags</a></li>
<li>
<a class="nav-link" href="#playing-with-tags"><span class="header-section-number">2.5</span> Playing with tags</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#tags-structure"><span class="header-section-number">2.5.1</span> Tags structure</a></li>
<li><a class="nav-link" href="#htmltools-shinyRPG"><span class="header-section-number">2.5.2</span> Practical examples: shinyRPG</a></li>
<li><a class="nav-link" href="#useful-functions-for-tags"><span class="header-section-number">2.5.3</span> Useful functions for tags</a></li>
<li><a class="nav-link" href="#other-functions"><span class="header-section-number">2.5.4</span> Other functions</a></li>
<li><a class="nav-link" href="#conditionally-set-attributes"><span class="header-section-number">2.5.5</span> Conditionally set attributes</a></li>
<li><a class="nav-link" href="#using"><span class="header-section-number">2.5.6</span> Using %&gt;%</a></li>
<li><a class="nav-link" href="#htmltools-programmatic-children"><span class="header-section-number">2.5.7</span> Programmatically create children elements</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#htmltools-modern"><span class="header-section-number">2.6</span> Modern {htmltools}</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#basics"><span class="header-section-number">2.6.1</span> Basics</a></li>
<li><a class="nav-link" href="#query-tags"><span class="header-section-number">2.6.2</span> Query tags</a></li>
<li><a class="nav-link" href="#modify-tags"><span class="header-section-number">2.6.3</span> Modify tags</a></li>
<li><a class="nav-link" href="#htmtools-chain-queries"><span class="header-section-number">2.6.4</span> Chain tag queries</a></li>
<li><a class="nav-link" href="#specific-cases"><span class="header-section-number">2.6.5</span> Specific cases</a></li>
<li><a class="nav-link" href="#htmltools-shinyRPG-rework"><span class="header-section-number">2.6.6</span> Practice</a></li>
<li><a class="nav-link" href="#alter-tag-rendering-with-render-hooks"><span class="header-section-number">2.6.7</span> Alter tag rendering with render hooks</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/htmltools-overview.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/htmltools-overview.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It was last built on 2022-03-14.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
