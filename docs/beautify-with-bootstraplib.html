<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 Beautify with {bslib} | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.9002/transition.js"></script><script src="libs/bs3compat-0.2.5.9002/tabs.js"></script><script src="libs/bs3compat-0.2.5.9002/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="libs/font-awesome-5.13.0/css/all.min.css" rel="stylesheet">
<link href="libs/font-awesome-5.13.0/css/v4-shims.min.css" rel="stylesheet">
<script src="libs/core-js-2.5.3/shim.min.js"></script><script src="libs/react-17.0.0/react.min.js"></script><script src="libs/react-17.0.0/react-dom.min.js"></script><script src="libs/reactwidget-1.0.0/react-tools.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">2</span> htmltools overview</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">3</span> Discover Shiny dependencies</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Dependency utilities</a></li>
<li><a class="" href="web-applications.html"><span class="header-section-number">5</span> Web application concepts</a></li>
<li class="book-part">Beautify with CSS and Sass</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">6</span> CSS for Shiny</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">7</span> Introduction to Sass</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">8</span> Beautify with {fresh}</a></li>
<li><a class="active" href="beautify-with-bootstraplib.html"><span class="header-section-number">9</span> Beautify with {bslib}</a></li>
<li class="book-part">Unleash interactivity with JavaScript</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> R and JS</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">12</span> Shiny’s input system</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Mastering Shiny’s events</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Dynamically manage content with handlers</a></li>
<li class="book-part">Practice 1: a dashboard template</li>
<li><a class="" href="custom-templates-selection.html"><span class="header-section-number">16</span> Template selection</a></li>
<li><a class="" href="custom-templates-dependencies.html"><span class="header-section-number">17</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">18</span> Create template elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">19</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">20</span> Adding more interactivity</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">21</span> Testing and validating templates elements</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="" href="workflow-charpente.html"><span class="header-section-number">22</span> Introduction to {charpente}</a></li>
<li class="book-part">Case study 2: Mobile development with Shiny</li>
<li><a class="" href="mobile-shiny-intro.html"><span class="header-section-number">23</span> Introduction</a></li>
<li><a class="" href="mobile-shinyMobile.html"><span class="header-section-number">24</span> Reconstruct {shinyMobile}</a></li>
<li><a class="" href="mobile-pwa.html"><span class="header-section-number">25</span> {shinyMobile} and PWA</a></li>
<li><a class="" href="mobile-widgets.html"><span class="header-section-number">26</span> Design widgets</a></li>
<li><a class="" href="mobile-going-further.html"><span class="header-section-number">27</span> Fine tune shinyMobile</a></li>
<li class="book-part">Going further</li>
<li><a class="" href="going-further-reactR.html"><span class="header-section-number">28</span> R + Shiny + React: welcome {reactR}</a></li>
<li><a class="" href="going-further-where-to-go.html"><span class="header-section-number">29</span> What to do next?</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="beautify-with-bootstraplib" class="section level1">
<h1>
<span class="header-section-number">9</span> Beautify with <code>{bslib}</code><a class="anchor" aria-label="anchor" href="#beautify-with-bootstraplib"><i class="fas fa-link"></i></a>
</h1>
<p><a href="https://rstudio.github.io/bslib/">bslib</a> <span class="citation">(Sievert and Cheng <a href="references.html#ref-R-bslib" role="doc-biblioref">2021</a>)</span> is a package developed by RStudio, built on top <a href="https://rstudio.github.io/sass/">sass</a>.
At the time of writing, <a href="https://rstudio.github.io/bslib/">bslib</a> does not support <a href="http://rstudio.github.io/shinydashboard/">shinydashboard</a> and <a href="https://rinterface.github.io/bs4Dash/index.html">bs4Dash</a>.
Again, you’ll see that in few lines of code, you may provide impressive
design modifications to your apps, in a ridiculously short amount of time.</p>
<div id="disclaimer" class="section level2">
<h2>
<span class="header-section-number">9.1</span> Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"><i class="fas fa-link"></i></a>
</h2>
<div class="importantblock">
<p><a href="https://rstudio.github.io/bslib/">bslib</a> requires <a href="https://blog.rstudio.com/2021/02/01/shiny-1-6-0/"><code>{shiny} &gt;= 1.6.0</code></a>.</p>
</div>
</div>
<div id="high-level-customization" class="section level2">
<h2>
<span class="header-section-number">9.2</span> High level customization<a class="anchor" aria-label="anchor" href="#high-level-customization"><i class="fas fa-link"></i></a>
</h2>
<p>Like <a href="https://github.com/dreamRs/fresh">fresh</a>, <a href="https://rstudio.github.io/bslib/">bslib</a> offers a high level set of functions allowing to quickly customize shiny apps. For many users, this step will be enough.</p>
<div id="bslib-high-level" class="section level3">
<h3>
<span class="header-section-number">9.2.1</span> Create a theme<a class="anchor" aria-label="anchor" href="#bslib-high-level"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme()</a></code> seamlessly modifies the main CSS properties like:</p>
<ul>
<li>The <strong>background</strong> color, namely <code>bg</code>.</li>
<li>The <strong>foreground</strong> color, namely <code>fg</code>.</li>
<li>Change default <strong>theme</strong> colors, also called <a href="https://getbootstrap.com/docs/4.1/utilities/colors/">accents</a>.</li>
<li>Modify the <a href="https://rstudio.github.io/bslib/articles/theming.html#main-colors-fonts">font</a>. This leverages the <code><a href="https://rstudio.github.io/bslib/reference/font_face.html">font_google()</a></code>, <code><a href="https://rstudio.github.io/bslib/reference/font_face.html">font_face()</a></code> and <code><a href="https://rstudio.github.io/bslib/reference/font_face.html">font_link()</a></code> functions. In practice, <code><a href="https://rstudio.github.io/bslib/reference/font_face.html">font_google()</a></code> caches the font resources so that they are always available to the user.</li>
</ul>
<p>Additionally, it gives the flexibility to choose <strong>Bootstrap version</strong> with <code><a href="https://rstudio.github.io/bslib/reference/versions.html">version_default()</a></code>. As shown in Chapter <a href="web-dependencies.html#web-dependencies">3</a>, Shiny primarily relies on Bootstrap 3. This function has three flavors:</p>
<ul>
<li>
<strong>Bootstrap 3</strong>, with <code>"3"</code>.</li>
<li>
<strong>Bootstrap 4</strong> + compatibility with Bootstrap 3, with <code>"4"</code>.</li>
<li>More <strong>Bootstrap</strong> versions</li>
</ul>
<p>Advanced users appreciate a <code>...</code> slot to add extra variables through <code><a href="https://rstudio.github.io/bslib/reference/bs_bundle.html">bs_add_variables()</a></code>, with literally hundreds of choices. We give more details in the <a href="beautify-with-bootstraplib.html#bslib-low-level">9.3</a> section.</p>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op">)</span>

<span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>
  version <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/versions.html">version_default</a></span><span class="op">(</span><span class="op">)</span>,
  bootswatch <span class="op">=</span> <span class="cn">NULL</span>,
  <span class="va">...</span>,
  bg <span class="op">=</span> <span class="cn">NULL</span>,
  fg <span class="op">=</span> <span class="cn">NULL</span>,
  primary <span class="op">=</span> <span class="cn">NULL</span>,
  secondary <span class="op">=</span> <span class="cn">NULL</span>,
  success <span class="op">=</span> <span class="cn">NULL</span>,
  info <span class="op">=</span> <span class="cn">NULL</span>,
  warning <span class="op">=</span> <span class="cn">NULL</span>,
  danger <span class="op">=</span> <span class="cn">NULL</span>,
  base_font <span class="op">=</span> <span class="cn">NULL</span>,
  code_font <span class="op">=</span> <span class="cn">NULL</span>,
  heading_font <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div>
<p>Let’s create a very simple theme:</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simple_bs4_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<p>We deliberately trimmed the corresponding output to get a better rendering in the book.</p>
<pre><code>/* Sass Bundle: _root, _reboot, ..., _toasts, _modal, ... */

/* MORE Sass imports ... */

@import "../scss/_toasts.scss";
@import "../scss/_modal.scss";

.table th[align=left] { text-align: left; }
.table th[align=right] { text-align: right; }
.table th[align=center] { text-align: center; }

/* MORE Sass imports ... */

/* *** */

Other Sass Bundle information:
List of 2
 $ html_deps       :List of 1
  ..$ :List of 10
  .. ..$ name      : chr "bs3compat"
  .. ..$ version   : chr "0.2.5.9002"
  .. ..$ src       :List of 1
  .. .. ..$ file: chr "bs3compat/js"
  .. ..$ meta      : NULL
  .. ..$ script    : chr [1:3] "transition.js" "tabs.js" 
  "bs3compat.js"
  .. ..$ stylesheet: NULL
  .. ..$ head      : NULL
  .. ..$ attachment: NULL
  .. ..$ package   : chr "bslib"
  .. ..$ all_files : logi TRUE
  .. ..- attr(*, "class")= chr "html_dependency"
 $ file_attachments: Named chr "..."
  ..- attr(*, "names")= chr "fonts"</code></pre>
<p>At a glance, the output contains a bundle with Sass code for all Bootstrap 4 components (toasts, modals, …). Then, each of those modules are imported with the __<span class="citation">(<span class="citeproc-not-found" data-reference-id="import__"><strong>???</strong></span>)</span> statement. The remaining consists in an HTML dependency providing compatibility with Bootstrap 3 and fonts assets.</p>
</div>
<div id="update-a-theme" class="section level3">
<h3>
<span class="header-section-number">9.2.2</span> Update a theme<a class="anchor" aria-label="anchor" href="#update-a-theme"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://rstudio.github.io/bslib/">bslib</a> exposes handy functions to alter the theme Sass code, that is remove (<code><a href="https://rstudio.github.io/bslib/reference/bs_remove.html">bs_remove()</a></code>) or add (<code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme_update()</a></code>) rules to/from a preexisting theme. This may be useful to reduce the code size or add missing rules on the fly. For instance, if we don’t need to alter the toast component, there is no need to include its Sass code in the theme. We therefore do:</p>
<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simple_bs4_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_remove.html">bs_remove</a></span><span class="op">(</span><span class="va">simple_bs4_theme</span>, <span class="st">"_toasts"</span><span class="op">)</span></code></pre></div>
<p>Inversely, if we missed a CSS rule, we may leverage <code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme_update()</a></code>, which is able to update a given theme object, generated with <code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme()</a></code>. Below, we change the default primary color (<span style="width:12px;height:12px;background:#007bff;border-radius:2px;display:inline-block;margin-right:5px;"></span>) to a lighter blue:</p>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simple_bs4_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme_update</a></span><span class="op">(</span>
  <span class="va">simple_bs4_theme</span>, 
  primary <span class="op">=</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/parseCssColors.html">parseCssColors</a></span><span class="op">(</span><span class="st">"lightblue"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>As stated in the previous chapter, don’t mess too much with the color logic. For instance, setting <code>primary = htmltools::parseCssColors("pink")</code> is a rather bad idea.</p>
<p>Note the use of <code><a href="https://rdrr.io/pkg/htmltools/man/parseCssColors.html">htmltools::parseCssColors()</a></code> which converts a color name to the corresponding HEX code:</p>
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/parseCssColors.html">parseCssColors</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "#0000FF"</code></pre>
<div class="sourceCode" id="cb298"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/parseCssColors.html">parseCssColors</a></span><span class="op">(</span><span class="st">"gainsboro"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "#DCDCDC"</code></pre>
</div>
<div id="preview-a-theme" class="section level3">
<h3>
<span class="header-section-number">9.2.3</span> Preview a theme<a class="anchor" aria-label="anchor" href="#preview-a-theme"><i class="fas fa-link"></i></a>
</h3>
<p>At any time, developers may preview the resulting theme with <code><a href="https://rstudio.github.io/bslib/reference/bs_theme_preview.html">bs_theme_preview()</a></code>, for instance:</p>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="va">neon_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>
  bg <span class="op">=</span> <span class="st">"#000000"</span>,
  fg <span class="op">=</span> <span class="st">"#FFFFFF"</span>,
  primary <span class="op">=</span> <span class="st">"#9600FF"</span>,
  secondary <span class="op">=</span> <span class="st">"#1900A0"</span>,
  success <span class="op">=</span> <span class="st">"#38FF12"</span>,
  info <span class="op">=</span> <span class="st">"#00F5FB"</span>,
  warning <span class="op">=</span> <span class="st">"#FFF100"</span>,
  danger <span class="op">=</span> <span class="st">"#FF00E3"</span>,
  base_font <span class="op">=</span> <span class="st">"Marker Felt"</span>,
  heading_font <span class="op">=</span> <span class="st">"Marker Felt"</span>,
  code_font <span class="op">=</span> <span class="st">"Chalkduster"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme_preview.html">bs_theme_preview</a></span><span class="op">(</span><span class="va">neon_theme</span>, with_themer <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>This gives the result shown on Figure <a href="beautify-with-bootstraplib.html#fig:bootstraplib-theme-preview">9.1</a>.</p>
<div class="figure">
<span id="fig:bootstraplib-theme-preview"></span>
<img src="images/beautify/bootstraplib-theme-preview.png" alt="Theme preview in action" width="100%"><p class="caption">
FIGURE 9.1: Theme preview in action
</p>
</div>
</div>
<div id="live-theming" class="section level3">
<h3>
<span class="header-section-number">9.2.4</span> Live theming<a class="anchor" aria-label="anchor" href="#live-theming"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s go even further! Wouldn’t be that cool to be able to modify the app at runtime with a plug and play widget? This is possible with <a href="https://rstudio.github.io/bslib/">bslib</a>, owing to the <code><a href="https://rstudio.github.io/bslib/reference/run_with_themer.html">run_with_themer()</a></code> wrapper.
It takes a Shiny App object as input (ie defined with <code><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shiny::shinyApp()</a></code>):</p>
<div class="sourceCode" id="cb301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  theme <span class="op">=</span> <span class="va">neon_theme</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabsetPanel.html">tabsetPanel</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span><span class="st">"First tab"</span>,
      <span class="st">"The contents of the first tab"</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"Test"</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span><span class="st">"Second tab"</span>,
      <span class="st">"The contents of the second tab"</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rstudio.github.io/bslib/reference/run_with_themer.html">run_with_themer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>As depicted by Figure <a href="beautify-with-bootstraplib.html#fig:bslib-bs-themer">9.2</a>, the themer not only shows a live
theming widget. It also shows the corresponding code output step by step, so as to
update the original theme. Under the hood, it leverages the <code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme_update()</a></code> function, described above.</p>
<div class="figure">
<span id="fig:bslib-bs-themer"></span>
<img src="images/beautify/bslib-bs-themer-app.png" alt="Live theming with bslib. Left: themer widget. Right: code output." width="50%"><img src="images/beautify/bslib-bs-themer-code.png" alt="Live theming with bslib. Left: themer widget. Right: code output." width="50%"><p class="caption">
FIGURE 9.2: Live theming with bslib. Left: themer widget. Right: code output.
</p>
</div>
<p>Alternatively, passing <code>with_themer = TRUE</code> inside <code>bs_theme_preview</code> does also the same thing.
There are few limitations and we refer the reader to the official <a href="https://rstudio.github.io/bslib/reference/run_with_themer.html#limitations">documentation</a>.
Even though there exists a third function, namely <code>bs_themer</code>, I don’t encourage using it, as it has to be inserted in the server function, which can be easily forgotten by mistake.</p>
</div>
</div>
<div id="bslib-low-level" class="section level2">
<h2>
<span class="header-section-number">9.3</span> Low level customization<a class="anchor" aria-label="anchor" href="#bslib-low-level"><i class="fas fa-link"></i></a>
</h2>
<div id="add-new-variables" class="section level3">
<h3>
<span class="header-section-number">9.3.1</span> Add new variables<a class="anchor" aria-label="anchor" href="#add-new-variables"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://rstudio.github.io/bslib/reference/bs_bundle.html">bs_add_variables()</a></code> adds new variables at a specific position within a theme. By default, they are inserted before other Sass <strong>defaults</strong>. It is a lower level function since you have to
know the corresponding Bootstrap variable(s). Let’s consider the example of a Bootstrap 4 badge where we aim at changing the font size, font weight and padding. The corresponding Sass code may be found <a href="https://github.com/twbs/bootstrap/blob/5d24fef741944c168ad0ca9cabd1509d5803e441/scss/_badge.scss">here</a>, and we identify few variables, whose default values are shown in the Bootstrap 4 variables code <a href="https://github.com/twbs/bootstrap/blob/v4-dev/scss/_variables.scss">here</a>:</p>
<pre class="scss"><code>// Typography
//
// Font, line-height, and color for body text, headings, and more.
$font-weight-bold:        700 !default;

// Define common padding and border radius sizes and more.
$border-radius:           .25rem !default;

// Badges

$badge-font-size:         75% !default;
$badge-font-weight:       $font-weight-bold !default;
$badge-padding-y:         .25em !default;
$badge-padding-x:         .4em !default;
$badge-border-radius:     $border-radius !default;</code></pre>
<p>Now we create our custom theme, increasing the font weight, size and changing the border radius to obtain more rounder <a href="https://shoelace.style/tokens/border-radius">corners</a>:</p>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>

<span class="va">custom_badge_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>
  version <span class="op">=</span> <span class="fl">4</span>,
  <span class="co"># high level theming  </span>
  success <span class="op">=</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/parseCssColors.html">parseCssColors</a></span><span class="op">(</span><span class="st">"lightgreen"</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_bundle.html">bs_add_variables</a></span><span class="op">(</span>
    <span class="co"># low level theming</span>
    <span class="st">"badge-font-weight"</span> <span class="op">=</span> <span class="fl">900</span>,
    <span class="st">"badge-font-size"</span> <span class="op">=</span> <span class="st">"100%"</span>,
    <span class="st">"badge-padding-y"</span> <span class="op">=</span> <span class="st">"0.5em"</span>,
    <span class="st">"badge-padding-x"</span> <span class="op">=</span> <span class="st">"0.8em"</span>,
    <span class="st">"badge-border-radius"</span> <span class="op">=</span> <span class="st">"1rem"</span>
  <span class="op">)</span></code></pre></div>
<p>Note: it would be tempting to change the global <code>$font-weight-bold</code> but it might affect
other elements. Let’s just overwrite the <code>badge-font-weight</code>.</p>
<p>The badge code is given by the following HTML:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb304-1"><a href="beautify-with-bootstraplib.html#cb304-1"></a><span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">"badge badge-success"</span><span class="kw">&gt;</span>Success<span class="kw">&lt;/span&gt;</span></span></code></pre></div>
<p>We leverage our previous knowledge to convert it to R and make it browsable with <a href="https://github.com/rstudio/htmltools">htmltools</a>:</p>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools">htmltools</a></span><span class="op">)</span>

<span class="va">my_badge</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">a</span><span class="op">(</span>class <span class="op">=</span> <span class="st">"badge badge-success"</span>, <span class="st">"1"</span><span class="op">)</span>
<span class="va">preview_badge</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theme</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tag</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">theme</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="co"># default bs4 theme</span>
      <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
      <span class="co"># altered badge</span>
      <span class="va">theme</span>
    <span class="op">}</span>
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/browsable.html">browsable</a></span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>, 
        <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme_dependencies.html">bs_theme_dependencies</a></span><span class="op">(</span><span class="va">theme</span><span class="op">)</span>, 
        <span class="va">my_badge</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co"># preview_badge(custom_badge_theme)</span>
<span class="co"># preview_badge() # default badge</span></code></pre></div>
<div class="figure">
<span id="fig:bslib-custom-badge"></span>
<img src="images/beautify/bslib-custom-badge.png" alt="Custom Bootstrao 4 badge with bslib. Left: custom badge, right: default badge." width="100%"><p class="caption">
FIGURE 9.3: Custom Bootstrao 4 badge with bslib. Left: custom badge, right: default badge.
</p>
</div>
<p><code>bs_theme_dependencies</code> is used outside of a Shiny context to include the theme Sass code as a dependency.</p>
</div>
<div id="import-external-rules" class="section level3">
<h3>
<span class="header-section-number">9.3.2</span> Import external rules<a class="anchor" aria-label="anchor" href="#import-external-rules"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s try with another example. We would like to bring a refreshment to the Bootstrap UI elements with one of the most modern UI kit to date, namely <a href="https://jdan.github.io/98.css/">98.css</a>, a Windows 98 CSS kit. The CSS assets may be accessed from <a href="https://cdn.jsdelivr.net/npm/98.css@0.1.16/dist/98.min.css">jsdelivr</a>, as shown below:</p>
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">win98_cdn</span> <span class="op">&lt;-</span> <span class="st">"https://cdn.jsdelivr.net/npm/98.css@0.1.16/"</span>
<span class="va">win98_css</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">win98_cdn</span>, <span class="st">"dist/98.min.css"</span><span class="op">)</span></code></pre></div>
<p><a href="https://rstudio.github.io/bslib/">bslib</a> exposes neat tools to import extra CSS in the current theme, such as <code><a href="https://rstudio.github.io/bslib/reference/bs_bundle.html">bs_add_rules()</a></code>, which calls <code><a href="https://rstudio.github.io/sass//reference/sass_import.html">sass::sass_file()</a></code> under the hood:</p>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theme</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_bundle.html">bs_add_rules</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">'@import %s'</span>, <span class="va">win98_css</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>The three theme colors are <code>#c0c0c0</code> for the background and all colors (except primary), <code>#03158b</code> for primary and <code>#222222</code> for the text. We also disable the rounded option so that button borders stay squared.</p>
<div class="sourceCode" id="cb308"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">windows_grey</span> <span class="op">&lt;-</span> <span class="st">"#c0c0c0"</span>
<span class="va">windows98_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>
  bg <span class="op">=</span> <span class="va">windows_grey</span>,
  fg <span class="op">=</span> <span class="st">"#222222"</span>,
  primary <span class="op">=</span> <span class="st">"#03158b"</span>,
  base_font <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Times"</span>, <span class="st">"Arial"</span><span class="op">)</span>,
  secondary <span class="op">=</span> <span class="va">windows_grey</span>,
  success <span class="op">=</span> <span class="va">windows_grey</span>,
  danger <span class="op">=</span> <span class="va">windows_grey</span>,
  info <span class="op">=</span> <span class="va">windows_grey</span>,
  light <span class="op">=</span> <span class="va">windows_grey</span>,
  dark <span class="op">=</span> <span class="va">windows_grey</span>,
  warning <span class="op">=</span> <span class="va">windows_grey</span>,
  <span class="st">"font-size-base"</span> <span class="op">=</span> <span class="st">"0.75rem"</span>,
  <span class="st">"enable-rounded"</span> <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_bundle.html">bs_add_rules</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">'@import "%s"'</span>, <span class="va">win98_css</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">windows98_theme</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme_preview.html">bs_theme_preview</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>When you run the above demonstration, you’ll notice that the slider input is not properly
styled. It’s not surprising knowing that the slider is not shaped by Bootstrap but <a href="http://ionden.com/a/plugins/ion.rangeSlider/">Ion.RangeSlider</a>. Therefore, if you want a better appearance, like in <a href="https://jdan.github.io/98.css/#slider">98.css</a>, we would need extra work. The output is shown Figure <a href="beautify-with-bootstraplib.html#fig:bslib-windows-98">9.4</a>.</p>
<div class="figure">
<span id="fig:bslib-windows-98"></span>
<img src="images/beautify/bslib-windows-98.png" alt="Modern Windows 98 theme for Shiny" width="100%"><p class="caption">
FIGURE 9.4: Modern Windows 98 theme for Shiny
</p>
</div>
</div>
</div>
<div id="dynamic-theming" class="section level2">
<h2>
<span class="header-section-number">9.4</span> Dynamic theming<a class="anchor" aria-label="anchor" href="#dynamic-theming"><i class="fas fa-link"></i></a>
</h2>
<div id="basics-2" class="section level3">
<h3>
<span class="header-section-number">9.4.1</span> Basics<a class="anchor" aria-label="anchor" href="#basics-2"><i class="fas fa-link"></i></a>
</h3>
<p>Now, let’s say you design an app and want to give the choice between the vanilla shiny design and your new cyberpunk theme, created in the previous section. We leverage the new <code>session$setCurrentTheme</code> feature that allows to pass <a href="https://rstudio.github.io/bslib/">bslib</a> generated themes to JavaScript through the <strong>session</strong> object. Our Shiny app contains a toggle, which value is either TRUE or FALSE. On the JavaScript side, we first create a custom shiny input with <code>Shiny.setInputValue</code> that gets the current mode value from the toggle. If TRUE, then the custom theme is applied by <code>session$setCurrentTheme</code> in an <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent()</a></code>.</p>
<p>Like for <a href="https://github.com/dreamRs/fresh">fresh</a>, the <a href="https://rstudio.github.io/bslib/">bslib</a> theme does not apply to static plots, as they are not HTML elements. Therefore we load <a href="https://rstudio.github.io/thematic/">thematic</a>:</p>
<div class="sourceCode" id="cb309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/thematic/">thematic</a></span><span class="op">)</span>

<span class="va">theme_toggle</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"custom-control custom-switch"</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">input</span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"custom_mode"</span>,
      type <span class="op">=</span> <span class="st">"checkbox"</span>,
      class <span class="op">=</span> <span class="st">"custom-control-input"</span>,
      onclick <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/HTML.html">HTML</a></span><span class="op">(</span>
        <span class="st">"Shiny.setInputValue(
          'dark_mode',
          document.getElementById('custom_mode').value
        );"</span>
      <span class="op">)</span>
    <span class="op">)</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">label</span><span class="op">(</span>
      <span class="st">"Custom mode?"</span>,
      `for` <span class="op">=</span> <span class="st">"custom_mode"</span>,
      class <span class="op">=</span> <span class="st">"custom-control-label"</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">default</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  theme <span class="op">=</span> <span class="va">default</span>,
  <span class="fu">theme_toggle</span><span class="op">(</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span><span class="st">"obs"</span>, <span class="st">"Number of observations:"</span>,
    min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1000</span>, value <span class="op">=</span> <span class="fl">500</span>
  <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"distPlot"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">custom_mode</span>, <span class="op">{</span>
    <span class="va">session</span><span class="op">$</span><span class="fu">setCurrentTheme</span><span class="op">(</span>
      <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">custom_mode</span><span class="op">)</span> <span class="va">neon_theme</span> <span class="kw">else</span> <span class="va">default</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>

  <span class="va">output</span><span class="op">$</span><span class="va">distPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rstudio.github.io/thematic/reference/thematic_on.html">thematic_shiny</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<div class="warningblock">
<p>At the time of writing, an issue with <code><a href="https://rdrr.io/pkg/shiny/man/bindCache.html">bindCache()</a></code> not aware of <code>session$setCurrentTheme()</code> is described <a href="https://github.com/rstudio/shiny/issues/3208">here</a>, with <a href="https://shiny.rstudio.com/">shiny</a> 1.6.</p>
</div>
</div>
<div id="custom-elements" class="section level3">
<h3>
<span class="header-section-number">9.4.2</span> Custom elements<a class="anchor" aria-label="anchor" href="#custom-elements"><i class="fas fa-link"></i></a>
</h3>
<p>For other elements than core shiny components like <code><a href="https://rdrr.io/pkg/shiny/man/numericInput.html">numericInput()</a></code> or <a href="https://rstudio.github.io/thematic/">thematic</a> compatible elements such as <code><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput()</a></code>, <a href="https://rstudio.github.io/bslib/">bslib</a> provides tools to design dynamically themeable custom components.</p>
<p>Let’s take the example of a simple card where the Sass code is defined below:</p>
<ul>
<li>
<code>.supercard</code> has a shadow, takes half of the page width and has a fixed height.
Notice the <code>background-color</code> that takes the value of the <code>$primary</code> Sass variable,
inherited from Bootstrap 4.</li>
<li>
<code>.supercard_body</code> adds padding to the card body content.</li>
</ul>
<pre class="scss"><code>.supercard {
    box-shadow: 0 4px 10px 0 rgb(0, 0, 0), 0 4px 20px 0
    rgb(0, 0, 0);
    width: 50%;
    height: 200px;
    background-color: $primary;

    .supercard_body {
      padding: 0.01em 16px;
    }
}</code></pre>
<p>Below, for convenience, we put that Sass code inside a R string, even though best practice would
be to save it in a file and compile it with <code><a href="https://rstudio.github.io/sass//reference/sass_import.html">sass_file()</a></code>.</p>
<div class="sourceCode" id="cb311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sass_str</span> <span class="op">&lt;-</span> <span class="st">"
  .supercard {
    box-shadow: 0 4px 10px 0 rgb(0, 0, 0), 0 4px 20px 0
    rgb(0, 0, 0);
    width: 50%;
    height: 200px;

    background-color: $primary;
    .supercard_body {
      padding: 0.01em 16px;
    }
}"</span></code></pre></div>
<p>If you try to run <code><a href="https://rstudio.github.io/sass//reference/sass.html">sass(input = sass_str)</a></code>,
it will fail, as <code>$primary</code> is not defined. Now, the goal is to link this custom Sass code
to the main app theme, created with <code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme()</a></code>. We invoke the <code><a href="https://rstudio.github.io/bslib/reference/bs_dependency.html">bs_dependency()</a></code> function where:</p>
<ul>
<li>
<strong>input</strong> refers to a list of Sass rules, that is <code>sass_str</code> in our example.</li>
<li>
<strong>theme</strong> is a theme generated with <code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme()</a></code>.</li>
<li>
<strong>name</strong> and <code>version</code> are metadata.</li>
</ul>
<p>In case we are not in a <a href="https://rstudio.github.io/bslib/">bslib</a> context, ie the app does not pass a <code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme()</a></code> element,
we create a fallback containing the card CSS code:</p>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools">htmltools</a></span><span class="op">)</span>
<span class="va">super_card_dependency</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theme</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">dep_name</span> <span class="op">&lt;-</span> <span class="st">"supercard"</span>
  <span class="va">dep_version</span> <span class="op">&lt;-</span> <span class="st">"1.0.0"</span>

  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">is_bs_theme</a></span><span class="op">(</span><span class="va">theme</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_dependency.html">bs_dependency</a></span><span class="op">(</span>
      input <span class="op">=</span> <span class="va">sass_str</span>,
      theme <span class="op">=</span> <span class="va">theme</span>,
      name <span class="op">=</span> <span class="va">dep_name</span>,
      version <span class="op">=</span> <span class="va">dep_version</span>
    <span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
      name <span class="op">=</span> <span class="va">dep_name</span>,
      version <span class="op">=</span> <span class="va">dep_version</span>,
      src <span class="op">=</span> <span class="st">"supercard-1.0.0/css"</span>,
      stylesheet <span class="op">=</span> <span class="st">"super-card.css"</span>,
      package <span class="op">=</span> <span class="st">"OSUICode"</span>
    <span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>As shown, in Chapter <a href="htmltools-dependencies.html#htmltools-dependencies">4</a>, we have to add this dependency to the card
tag. Importantly, we wrap it inside <code><a href="https://rstudio.github.io/bslib/reference/bs_dependency.html">bs_dependency_defer()</a></code> that enables us to dynamically update the theme on the server
side, each time <code>session$setCurrentTheme</code> is called:</p>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">super_card</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"supercard"</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"supercard_body"</span>, <span class="va">...</span><span class="op">)</span>,
    <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_dependency.html">bs_dependency_defer</a></span><span class="op">(</span><span class="va">super_card_dependency</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We then create two simple theme, namely white and dark and run the app:</p>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">white_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">dark_theme</span> <span class="op">&lt;-</span> <span class="va">white_theme</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme_update</a></span><span class="op">(</span>
    bg <span class="op">=</span> <span class="st">"black"</span>,
    fg <span class="op">=</span> <span class="st">"white"</span>,
    primary <span class="op">=</span> <span class="st">"orange"</span>
  <span class="op">)</span>


<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  theme <span class="op">=</span> <span class="va">white_theme</span>,
  <span class="fu">theme_toggle</span><span class="op">(</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,
  <span class="fu">super_card</span><span class="op">(</span><span class="st">"Hello World!"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">custom_mode</span>, <span class="op">{</span>
    <span class="va">session</span><span class="op">$</span><span class="fu">setCurrentTheme</span><span class="op">(</span>
      <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">custom_mode</span><span class="op">)</span> <span class="va">dark_theme</span> <span class="kw">else</span> <span class="va">white_theme</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<div class="importantblock">
<p>Live theming requires to pass the <strong>session</strong> parameter to the server function. Don’t forget it!</p>
</div>
<p>The reader is invited to exploit the <code><a href="https://rstudio.github.io/bslib/reference/run_with_themer.html">run_with_themer()</a></code> capabilities, that allows
to dynamically modify the current theme, as shown Figure <a href="beautify-with-bootstraplib.html#fig:bslib-custom-component">9.5</a>.</p>
<div class="figure">
<span id="fig:bslib-custom-component"></span>
<img src="images/beautify/bslib-custom-component.png" alt="Theme preview with custom component" width="100%"><p class="caption">
FIGURE 9.5: Theme preview with custom component
</p>
</div>
<p>Below, we try without passing any theme to <code><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage()</a></code>, to test our CSS fall back strategy:</p>
<div class="sourceCode" id="cb315"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span><span class="fu">super_card</span><span class="op">(</span><span class="st">"Hello World!"</span><span class="op">)</span><span class="op">)</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
</div>
<div id="advanced" class="section level3">
<h3>
<span class="header-section-number">9.4.3</span> Advanced<a class="anchor" aria-label="anchor" href="#advanced"><i class="fas fa-link"></i></a>
</h3>
<p>The above approach allows us to apply a theme based on a user input, like a theme switcher.
However, we can’t access and modify the theme at run time to apply specific rendering properties.
Let’s go further! How do we recover the currently active theme on the server side? Look no further, <code><a href="https://rstudio.github.io/bslib/reference/bs_current_theme.html">bs_current_theme()</a></code> is the weapon you need:</p>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  theme <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html">verbatimTextOutput</a></span><span class="op">(</span><span class="st">"current_theme"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">output</span><span class="op">$</span><span class="va">current_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderPrint</a></span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_current_theme.html">bs_current_theme</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>In a reactive context (Shiny), this calls <code>session$getCurrentTheme()</code>.</p>
<p><code><a href="https://rdrr.io/pkg/htmltools/man/tagAddRenderHook.html">tagAddRenderHook()</a></code>: <a href="https://github.com/rstudio/shiny/pull/3372/files#diff-befe9146792f0d65aeeaf781e8ba00a1a3638ac2be162b61b6c8958440860b56R1029-R1040" class="uri">https://github.com/rstudio/shiny/pull/3372/files#diff-befe9146792f0d65aeeaf781e8ba00a1a3638ac2be162b61b6c8958440860b56R1029-R1040</a>,
…</p>
</div>
</div>
<div id="further-resources" class="section level2">
<h2>
<span class="header-section-number">9.5</span> Further resources<a class="anchor" aria-label="anchor" href="#further-resources"><i class="fas fa-link"></i></a>
</h2>
<p>The reader will refer to the <a href="https://rstudio.github.io/bslib/">bslib</a> various <a href="https://rstudio.github.io/bslib/articles/theming.html">vignettes</a>.</p>

</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="beautify-with-fresh.html"><span class="header-section-number">8</span> Beautify with {fresh}</a></div>
<div class="next"><a href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#beautify-with-bootstraplib"><span class="header-section-number">9</span> Beautify with {bslib}</a></li>
<li><a class="nav-link" href="#disclaimer"><span class="header-section-number">9.1</span> Disclaimer</a></li>
<li>
<a class="nav-link" href="#high-level-customization"><span class="header-section-number">9.2</span> High level customization</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#bslib-high-level"><span class="header-section-number">9.2.1</span> Create a theme</a></li>
<li><a class="nav-link" href="#update-a-theme"><span class="header-section-number">9.2.2</span> Update a theme</a></li>
<li><a class="nav-link" href="#preview-a-theme"><span class="header-section-number">9.2.3</span> Preview a theme</a></li>
<li><a class="nav-link" href="#live-theming"><span class="header-section-number">9.2.4</span> Live theming</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#bslib-low-level"><span class="header-section-number">9.3</span> Low level customization</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#add-new-variables"><span class="header-section-number">9.3.1</span> Add new variables</a></li>
<li><a class="nav-link" href="#import-external-rules"><span class="header-section-number">9.3.2</span> Import external rules</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#dynamic-theming"><span class="header-section-number">9.4</span> Dynamic theming</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#basics-2"><span class="header-section-number">9.4.1</span> Basics</a></li>
<li><a class="nav-link" href="#custom-elements"><span class="header-section-number">9.4.2</span> Custom elements</a></li>
<li><a class="nav-link" href="#advanced"><span class="header-section-number">9.4.3</span> Advanced</a></li>
</ul>
</li>
<li><a class="nav-link" href="#further-resources"><span class="header-section-number">9.5</span> Further resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/beautify-with-bootstraplib.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/beautify-with-bootstraplib.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It was last built on 2021-07-28.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
