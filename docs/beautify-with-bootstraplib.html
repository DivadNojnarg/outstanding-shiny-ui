<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 Become a theming wizard with {bslib} | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<meta name="description" content="{bslib} (Sievert and Cheng 2021) is a package developed by RStudio, built on top {sass} providing weapons to deeply customize your apps, in a ridiculously short amount of time and without too much...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 9 Become a theming wizard with {bslib} | Outstanding User Interfaces with Shiny">
<meta property="og:type" content="book">
<meta property="og:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<meta property="og:description" content="{bslib} (Sievert and Cheng 2021) is a package developed by RStudio, built on top {sass} providing weapons to deeply customize your apps, in a ridiculously short amount of time and without too much...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 9 Become a theming wizard with {bslib} | Outstanding User Interfaces with Shiny">
<meta name="twitter:description" content="{bslib} (Sievert and Cheng 2021) is a package developed by RStudio, built on top {sass} providing weapons to deeply customize your apps, in a ridiculously short amount of time and without too much...">
<meta name="twitter:image" content="https://raw.githubusercontent.com/DivadNojnarg/outstanding-shiny-ui/master/images/intro/crc-press-cover.svg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">2</span> Manipulate HTML tags from R with {htmltools}</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">3</span> Discover Shiny dependencies</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Handle HTML dependencies with {htmltools}</a></li>
<li><a class="" href="web-applications.html"><span class="header-section-number">5</span> Web application concepts</a></li>
<li class="book-part">Beautify with CSS and Sass</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">6</span> CSS for Shiny</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">7</span> Tidy your CSS with Sass</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">8</span> Beautify with {fresh}</a></li>
<li><a class="active" href="beautify-with-bootstraplib.html"><span class="header-section-number">9</span> Become a theming wizard with {bslib}</a></li>
<li class="book-part">Unleash interactivity with JavaScript</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> Communicate between R and JS</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">12</span> Understand and develop new Shiny inputs</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Mastering Shiny’s events</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Optimize your apps with custom handlers</a></li>
<li class="book-part">Practice: A Bootstrap 4 dashboard template</li>
<li><a class="" href="custom-templates-dependencies.html"><span class="header-section-number">16</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">17</span> Create template elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">18</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">19</span> Adding more interactivity</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">20</span> Testing and validating templates elements</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="" href="workflow-charpente.html"><span class="header-section-number">21</span> Automate new template creation with {charpente}</a></li>
<li class="book-part">Case study: Mobile development for Shiny</li>
<li><a class="" href="mobile-shiny-intro.html"><span class="header-section-number">22</span> Introduction</a></li>
<li><a class="" href="mobile-shinyMobile.html"><span class="header-section-number">23</span> Reconstruct {shinyMobile}</a></li>
<li><a class="" href="mobile-pwa.html"><span class="header-section-number">24</span> {shinyMobile} and PWA</a></li>
<li><a class="" href="mobile-widgets.html"><span class="header-section-number">25</span> Design widgets</a></li>
<li><a class="" href="mobile-going-further.html"><span class="header-section-number">26</span> Fine tune {shinyMobile}</a></li>
<li class="book-part">Going further</li>
<li><a class="" href="going-further-reactR.html"><span class="header-section-number">27</span> Shiny and React with {reactR}</a></li>
<li><a class="" href="going-further-webdev.html"><span class="header-section-number">28</span> Divide and Conquere</a></li>
<li><a class="" href="going-further-where-to-go.html"><span class="header-section-number">29</span> What to do next?</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="code-outputs.html"><span class="header-section-number">A</span> Code outputs</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="beautify-with-bootstraplib" class="section level1">
<h1>
<span class="header-section-number">9</span> Become a theming wizard with {bslib}<a class="anchor" aria-label="anchor" href="#beautify-with-bootstraplib"><i class="fas fa-link"></i></a>
</h1>
<p><a href="https://rstudio.github.io/bslib/">bslib</a> <span class="citation">(Sievert and Cheng <a href="references.html#ref-R-bslib" role="doc-biblioref">2021</a>)</span> is a package developed by RStudio, built on top <a href="https://github.com/rstudio/sass">sass</a> providing weapons to deeply customize your apps, in a ridiculously short amount of time and without too much pain, as shown on Figure <a href="beautify-with-bootstraplib.html#fig:bslib-motivations">9.1</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:bslib-motivations"></span>
<img src="images/beautify/bslib-motivations.png" alt="Theme preview in action" width="100%"><p class="caption">
FIGURE 9.1: Theme preview in action
</p>
</div>
<p>At the time of writing, <a href="https://rstudio.github.io/bslib/">bslib</a> does not support <a href="http://rstudio.github.io/shinydashboard/">shinydashboard</a> and <a href="https://rinterface.github.io/bs4Dash/index.html">bs4Dash</a>.
Again, you’ll see that in few lines of code, you may</p>
<div class="importantblock">
<p><a href="https://rstudio.github.io/bslib/">bslib</a> requires <a href="https://blog.rstudio.com/2021/02/01/shiny-1-6-0/"><code>{shiny} &gt;= 1.6.0</code></a>. Bootstrap 5 support requires <code>{shiny} &gt;= 1.6.0.9001</code>.</p>
</div>
<div id="high-level-customization" class="section level2">
<h2>
<span class="header-section-number">9.1</span> High level customization<a class="anchor" aria-label="anchor" href="#high-level-customization"><i class="fas fa-link"></i></a>
</h2>
<p>Like <a href="https://github.com/dreamRs/fresh">fresh</a>, <a href="https://rstudio.github.io/bslib/">bslib</a> offers a <strong>high level</strong> set of functions allowing to quickly customize shiny apps. For many users, this step will be enough.</p>
<div id="bslib-high-level" class="section level3">
<h3>
<span class="header-section-number">9.1.1</span> Create a theme<a class="anchor" aria-label="anchor" href="#bslib-high-level"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme()</a></code> seamlessly modifies the main CSS properties like:</p>
<ul>
<li>The <strong>background</strong> color, namely <code>bg</code>.</li>
<li>The <strong>foreground</strong> color, namely <code>fg</code>.</li>
<li>Change default <strong>theme</strong> colors, also called <a href="https://getbootstrap.com/docs/4.1/utilities/colors/">accents</a>.</li>
<li>Modify the <a href="https://rstudio.github.io/bslib/articles/theming.html#main-colors-fonts">font</a>. This leverages the <code><a href="https://rstudio.github.io/bslib/reference/font_face.html">font_google()</a></code>, <code><a href="https://rstudio.github.io/bslib/reference/font_face.html">font_face()</a></code> and <code><a href="https://rstudio.github.io/bslib/reference/font_face.html">font_link()</a></code> functions. In practice, <code><a href="https://rstudio.github.io/bslib/reference/font_face.html">font_google()</a></code> caches the font resources so that they are always available to the user.</li>
</ul>
<p>Additionally, it gives the flexibility to choose <strong>Bootstrap version</strong>, falling back to <code><a href="https://rstudio.github.io/bslib/reference/versions.html">version_default()</a></code> if not specified. Currently, version is <code>4</code> but will change in the future, that is why it is advised to specify a value to avoid any unexpected breaking change. This function has three flavors:</p>
<ul>
<li>
<strong>Bootstrap 3</strong>, with <code>"3"</code> (see Chapter <a href="web-dependencies.html#web-dependencies">3</a>, Shiny primarily relies on Bootstrap 3).</li>
<li>
<strong>Bootstrap 4</strong> + compatibility with Bootstrap 3, with <code>"4"</code>.</li>
<li>
<strong>Bootstrap 5</strong> with <code>"5"</code>.</li>
<li>More <strong>Bootstrap</strong> versions</li>
</ul>
<p>Advanced users appreciate a <code>...</code> slot to add extra variables through <code><a href="https://rstudio.github.io/bslib/reference/bs_bundle.html">bs_add_variables()</a></code>, with literally hundreds of choices. We give more details in the <a href="beautify-with-bootstraplib.html#bslib-low-level">9.2</a> section. In the following, we decide to default to Bootstrap 4.</p>
<div class="sourceCode" id="cb325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op">)</span>

<span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>
  version <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/versions.html">version_default</a></span><span class="op">(</span><span class="op">)</span>,
  bootswatch <span class="op">=</span> <span class="cn">NULL</span>,
  <span class="va">...</span>,
  bg <span class="op">=</span> <span class="cn">NULL</span>,
  fg <span class="op">=</span> <span class="cn">NULL</span>,
  primary <span class="op">=</span> <span class="cn">NULL</span>,
  secondary <span class="op">=</span> <span class="cn">NULL</span>,
  success <span class="op">=</span> <span class="cn">NULL</span>,
  info <span class="op">=</span> <span class="cn">NULL</span>,
  warning <span class="op">=</span> <span class="cn">NULL</span>,
  danger <span class="op">=</span> <span class="cn">NULL</span>,
  base_font <span class="op">=</span> <span class="cn">NULL</span>,
  code_font <span class="op">=</span> <span class="cn">NULL</span>,
  heading_font <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div>
<p>Let’s create a very simple theme:</p>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simple_bs4_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<p>We deliberately trimmed the corresponding output to get a better rendering in the book.</p>
<pre><code>/* Sass Bundle: _root, _reboot, ..., _toasts, _modal, ... */

/* MORE Sass imports ... */
@import "../scss/_toasts.scss";
@import "../scss/_modal.scss";

/* MORE Sass imports ... */

/* *** */
Other Sass Bundle information:
List of 2
 $ html_deps       :List of 1
  ..$ :List of 10
  .. ..$ name      : chr "bs3compat"
  .. ..$ version   : chr "0.2.5.9002"
  .. ..$ src       :List of 1
  .. .. ..$ file: chr "bs3compat/js"
  .. ..$ meta      : NULL
  .. ..$ script    : chr [1:3] "transition.js" "tabs.js" 
  "bs3compat.js"
  .. ..$ stylesheet: NULL
  .. ..$ head      : NULL
  .. ..$ attachment: NULL
  .. ..$ package   : chr "bslib"
  .. ..$ all_files : logi TRUE
  .. ..- attr(*, "class")= chr "html_dependency"
 $ file_attachments: Named chr "..."
  ..- attr(*, "names")= chr "fonts"</code></pre>
<p>At a glance, the output contains a bundle with Sass code for all Bootstrap 4 components (toasts, modals, …). Then, each of those modules are imported with the <code>@import</code> statement. The remaining consists in an HTML dependency providing compatibility with Bootstrap 3 and fonts assets.</p>
</div>
<div id="update-a-theme" class="section level3">
<h3>
<span class="header-section-number">9.1.2</span> Update a theme<a class="anchor" aria-label="anchor" href="#update-a-theme"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://rstudio.github.io/bslib/">bslib</a> exposes handy functions to alter the theme Sass code, that is remove (<code><a href="https://rstudio.github.io/bslib/reference/bs_remove.html">bs_remove()</a></code>) or add (<code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme_update()</a></code>) rules to/from a preexisting theme. This may be useful to reduce the code size or add missing rules on the fly. For instance, if we don’t need to alter the toast component, there is no need to include its Sass code in the theme. We therefore do:</p>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simple_bs4_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_remove.html">bs_remove</a></span><span class="op">(</span><span class="va">simple_bs4_theme</span>, <span class="st">"_toasts"</span><span class="op">)</span></code></pre></div>
<p>Inversely, if we missed a CSS rule, we may leverage <code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme_update()</a></code>, which is able to update a given theme object, generated with <code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme()</a></code>. Below, we change the default primary color (<span style="width:12px;height:12px;background:#007bff;border-radius:2px;display:inline-block;margin-right:5px;"></span>) to a lighter blue:</p>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simple_bs4_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme_update</a></span><span class="op">(</span>
  <span class="va">simple_bs4_theme</span>, 
  primary <span class="op">=</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/parseCssColors.html">parseCssColors</a></span><span class="op">(</span><span class="st">"lightblue"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Note the use of <code><a href="https://rdrr.io/pkg/htmltools/man/parseCssColors.html">htmltools::parseCssColors()</a></code> which converts a color name to the corresponding HEX code:</p>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/parseCssColors.html">parseCssColors</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] "#0000FF"</code></pre>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/parseCssColors.html">parseCssColors</a></span><span class="op">(</span><span class="st">"gainsboro"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] "#DCDCDC"</code></pre>
</div>
<div id="preview-a-theme" class="section level3">
<h3>
<span class="header-section-number">9.1.3</span> Preview a theme<a class="anchor" aria-label="anchor" href="#preview-a-theme"><i class="fas fa-link"></i></a>
</h3>
<p>We first create a custom neon theme:</p>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bslib_neon_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>
  version <span class="op">=</span> <span class="fl">4</span>, 
  bg <span class="op">=</span> <span class="st">"#000000"</span>,
  fg <span class="op">=</span> <span class="st">"#FFFFFF"</span>,
  primary <span class="op">=</span> <span class="st">"#9600FF"</span>,
  secondary <span class="op">=</span> <span class="st">"#1900A0"</span>,
  success <span class="op">=</span> <span class="st">"#38FF12"</span>,
  info <span class="op">=</span> <span class="st">"#00F5FB"</span>,
  warning <span class="op">=</span> <span class="st">"#FFF100"</span>,
  danger <span class="op">=</span> <span class="st">"#FF00E3"</span>,
  base_font <span class="op">=</span> <span class="st">"Marker Felt"</span>,
  heading_font <span class="op">=</span> <span class="st">"Marker Felt"</span>,
  code_font <span class="op">=</span> <span class="st">"Chalkduster"</span>
<span class="op">)</span></code></pre></div>
<p>At any time, developers may preview the resulting theme with <code><a href="https://rstudio.github.io/bslib/reference/bs_theme_preview.html">bs_theme_preview()</a></code>, for instance:</p>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "bslib/theme-preview" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme_preview.html">bs_theme_preview</a></span><span class="op">(</span><span class="va">bslib_neon_theme</span>, with_themer <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Interestingly, <code><a href="https://rstudio.github.io/bslib/reference/bs_theme_preview.html">bs_theme_preview()</a></code> is no more than <code><a href="https://rdrr.io/pkg/shiny/man/runApp.html">shiny::runApp()</a></code> when the <code>with_themer</code> is <code>FALSE</code>.
This gives the result shown on Figure <a href="beautify-with-bootstraplib.html#fig:bootstraplib-theme-preview">9.2</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:bootstraplib-theme-preview"></span>
<img src="images/beautify/bootstraplib-theme-preview.png" alt="Theme preview in action" width="100%"><p class="caption">
FIGURE 9.2: Theme preview in action
</p>
</div>
</div>
<div id="live-theming" class="section level3">
<h3>
<span class="header-section-number">9.1.4</span> Live theming<a class="anchor" aria-label="anchor" href="#live-theming"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s go even further! Wouldn’t be that cool to be able to modify the app at <strong>runtime</strong> with a plug and play widget? This is possible with <a href="https://rstudio.github.io/bslib/">bslib</a>, owing to the <code><a href="https://rstudio.github.io/bslib/reference/run_with_themer.html">run_with_themer()</a></code> wrapper.
It takes a Shiny App object as input (ie defined with <code><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shiny::shinyApp()</a></code>):</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "bslib/run-with-themer" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  theme <span class="op">=</span> <span class="va">bslib_neon_theme</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabsetPanel.html">tabsetPanel</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span>
      <span class="st">"First tab"</span>,
      <span class="st">"The contents of the first tab"</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="st">"Test"</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op">(</span>
      <span class="st">"Second tab"</span>,
      <span class="st">"The contents of the second tab"</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rstudio.github.io/bslib/reference/run_with_themer.html">run_with_themer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>As depicted by Figure <a href="beautify-with-bootstraplib.html#fig:bslib-bs-themer">9.3</a>, the <strong>themer</strong> not only shows a live
theming widget. It also shows the corresponding code output step by step, so as to
update the original theme. Under the hood, it leverages the <code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme_update()</a></code> function, described above.</p>
<div class="figure">
<span style="display:block;" id="fig:bslib-bs-themer"></span>
<img src="images/beautify/bslib-bs-themer-app.png" alt="Live theming with bslib. Left: themer widget. Right: code output." width="50%"><img src="images/beautify/bslib-bs-themer-code.png" alt="Live theming with bslib. Left: themer widget. Right: code output." width="50%"><p class="caption">
FIGURE 9.3: Live theming with bslib. Left: themer widget. Right: code output.
</p>
</div>
<p>Alternatively, passing <code>with_themer = TRUE</code> inside <code>bs_theme_preview</code> does also the same thing.
For further details, we refer the reader to the official <a href="https://rstudio.github.io/bslib/reference/run_with_themer.html#limitations">documentation</a>.
Even though there exists a third function, namely <code>bs_themer</code>, I don’t encourage using it, as it has to be inserted in the server function, which can be easily forgotten by mistake.</p>
</div>
</div>
<div id="bslib-low-level" class="section level2">
<h2>
<span class="header-section-number">9.2</span> Low level customization<a class="anchor" aria-label="anchor" href="#bslib-low-level"><i class="fas fa-link"></i></a>
</h2>
<div id="add-new-variables" class="section level3">
<h3>
<span class="header-section-number">9.2.1</span> Add new variables<a class="anchor" aria-label="anchor" href="#add-new-variables"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://rstudio.github.io/bslib/reference/bs_bundle.html">bs_add_variables()</a></code> adds new variables at a specific position within a theme. By default, they are inserted before other Sass <strong>defaults</strong>. It is a <strong>lower level</strong> function since you have to
know the corresponding Bootstrap variable(s). Let’s consider the example of a Bootstrap 4 badge where we aim at changing the font size, font weight and padding. The corresponding Sass code may be found <a href="https://github.com/twbs/bootstrap/blob/5d24fef741944c168ad0ca9cabd1509d5803e441/scss/_badge.scss">here</a>, and we identify few variables, whose default values are shown in the Bootstrap 4 variables code <a href="https://github.com/twbs/bootstrap/blob/v4-dev/scss/_variables.scss">here</a>:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb337-1"><a href="beautify-with-bootstraplib.html#cb337-1"></a><span class="er">// Typography</span></span>
<span id="cb337-2"><a href="beautify-with-bootstraplib.html#cb337-2"></a><span class="er">//</span></span>
<span id="cb337-3"><a href="beautify-with-bootstraplib.html#cb337-3"></a><span class="er">// Font, line-height, and color for body text, headings, and more.</span></span>
<span id="cb337-4"><a href="beautify-with-bootstraplib.html#cb337-4"></a>$font-weight-bold<span class="in">:        700 !default</span>;</span>
<span id="cb337-5"><a href="beautify-with-bootstraplib.html#cb337-5"></a></span>
<span id="cb337-6"><a href="beautify-with-bootstraplib.html#cb337-6"></a><span class="er">// Define common padding and border radius sizes and more.</span></span>
<span id="cb337-7"><a href="beautify-with-bootstraplib.html#cb337-7"></a>$border-radius<span class="in">:           .25rem !default</span>;</span>
<span id="cb337-8"><a href="beautify-with-bootstraplib.html#cb337-8"></a></span>
<span id="cb337-9"><a href="beautify-with-bootstraplib.html#cb337-9"></a><span class="er">// Badges</span></span>
<span id="cb337-10"><a href="beautify-with-bootstraplib.html#cb337-10"></a></span>
<span id="cb337-11"><a href="beautify-with-bootstraplib.html#cb337-11"></a>$badge-font-size<span class="in">:         75% !default</span>;</span>
<span id="cb337-12"><a href="beautify-with-bootstraplib.html#cb337-12"></a>$badge-font-weight<span class="in">:       $font-weight-bold</span> !default;</span>
<span id="cb337-13"><a href="beautify-with-bootstraplib.html#cb337-13"></a>$badge-padding-y<span class="in">:         .25em !default</span>;</span>
<span id="cb337-14"><a href="beautify-with-bootstraplib.html#cb337-14"></a>$badge-padding-x<span class="in">:         .4em !default</span>;</span>
<span id="cb337-15"><a href="beautify-with-bootstraplib.html#cb337-15"></a>$badge-border-radius<span class="in">:     $border-radius</span> !default;</span></code></pre></div>
<p>Now we create our custom theme, increasing the font weight, size and changing the border radius to obtain more rounder <a href="https://shoelace.style/tokens/border-radius">corners</a>:</p>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>

<span class="va">custom_badge_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>
  version <span class="op">=</span> <span class="fl">4</span>,
  <span class="co"># high level theming  </span>
  success <span class="op">=</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/parseCssColors.html">parseCssColors</a></span><span class="op">(</span><span class="st">"lightgreen"</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_bundle.html">bs_add_variables</a></span><span class="op">(</span>
    <span class="co"># low level theming</span>
    <span class="st">"badge-font-weight"</span> <span class="op">=</span> <span class="fl">900</span>,
    <span class="st">"badge-font-size"</span> <span class="op">=</span> <span class="st">"100%"</span>,
    <span class="st">"badge-padding-y"</span> <span class="op">=</span> <span class="st">"0.5em"</span>,
    <span class="st">"badge-padding-x"</span> <span class="op">=</span> <span class="st">"0.8em"</span>,
    <span class="st">"badge-border-radius"</span> <span class="op">=</span> <span class="st">"1rem"</span>
  <span class="op">)</span></code></pre></div>
<div class="noteblock">
<p>It would be tempting to change the global <code>$font-weight-bold</code> but it might affect
other elements. Let’s just overwrite the <code>badge-font-weight</code>.</p>
</div>
<p>The badge code is given by the following HTML:</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb339-1"><a href="beautify-with-bootstraplib.html#cb339-1"></a><span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">"badge badge-success"</span><span class="kw">&gt;</span>Success<span class="kw">&lt;/span&gt;</span></span></code></pre></div>
<p>We leverage our previous knowledge to convert it to R and make it browsable with <a href="https://github.com/rstudio/htmltools">htmltools</a>:</p>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools">htmltools</a></span><span class="op">)</span>

<span class="va">my_badge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">a</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"badge badge-success"</span>, <span class="st">"1"</span><span class="op">)</span>
<span class="va">preview_badge</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theme</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tag</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">theme</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="co"># default bs4 theme</span>
      <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
      <span class="co"># altered badge</span>
      <span class="va">theme</span>
    <span class="op">}</span>
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/browsable.html">browsable</a></span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>, 
        <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme_dependencies.html">bs_theme_dependencies</a></span><span class="op">(</span><span class="va">theme</span><span class="op">)</span>, 
        <span class="va">my_badge</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co"># preview_badge(custom_badge_theme)</span>
<span class="co"># preview_badge() # default badge</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:bslib-custom-badge"></span>
<img src="images/beautify/bslib-custom-badge.png" alt="Custom Bootstrap 4 badge with bslib. Left: custom badge, right: default badge." width="25%"><p class="caption">
FIGURE 9.4: Custom Bootstrap 4 badge with bslib. Left: custom badge, right: default badge.
</p>
</div>
<p><code><a href="https://rstudio.github.io/bslib/reference/bs_theme_dependencies.html">bs_theme_dependencies()</a></code> is used outside of a Shiny context to include the theme Sass code as a dependency.</p>
</div>
<div id="import-external-rules" class="section level3">
<h3>
<span class="header-section-number">9.2.2</span> Import external rules<a class="anchor" aria-label="anchor" href="#import-external-rules"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s try with another example. We would like to bring a refreshment to the Bootstrap UI elements with one of the most modern UI kit to date, namely <a href="https://jdan.github.io/98.css/">98.css</a>, a Windows 98 CSS kit. The CSS assets may be accessed from <a href="https://cdn.jsdelivr.net/npm/98.css@0.1.16/dist/98.min.css">jsdelivr</a>, as shown below:</p>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">win98_cdn</span> <span class="op">&lt;-</span> <span class="st">"https://cdn.jsdelivr.net/npm/98.css@0.1.16/"</span>
<span class="va">win98_css</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">win98_cdn</span>, <span class="st">"dist/98.min.css"</span><span class="op">)</span></code></pre></div>
<p><a href="https://rstudio.github.io/bslib/">bslib</a> exposes neat tools to import extra CSS in the current theme, such as <code><a href="https://rstudio.github.io/bslib/reference/bs_bundle.html">bs_add_rules()</a></code>, which calls <code><a href="https://rdrr.io/pkg/sass/man/sass_import.html">sass::sass_file()</a></code> under the hood:</p>
<div class="sourceCode" id="cb342"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theme</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_bundle.html">bs_add_rules</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">'@import "%s"'</span>, <span class="va">win98_css</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>The three theme colors are <code>#c0c0c0</code> for the background and all colors (except primary), <code>#03158b</code> for primary and <code>#222222</code> for the text. We also disable the rounded option so that button borders stay squared.</p>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">windows_grey</span> <span class="op">&lt;-</span> <span class="st">"#c0c0c0"</span>
<span class="va">windows98_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>
  version <span class="op">=</span> <span class="fl">4</span>, 
  bg <span class="op">=</span> <span class="va">windows_grey</span>,
  fg <span class="op">=</span> <span class="st">"#222222"</span>,
  primary <span class="op">=</span> <span class="st">"#03158b"</span>,
  base_font <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Times"</span>, <span class="st">"Arial"</span><span class="op">)</span>,
  secondary <span class="op">=</span> <span class="va">windows_grey</span>,
  success <span class="op">=</span> <span class="va">windows_grey</span>,
  danger <span class="op">=</span> <span class="va">windows_grey</span>,
  info <span class="op">=</span> <span class="va">windows_grey</span>,
  light <span class="op">=</span> <span class="va">windows_grey</span>,
  dark <span class="op">=</span> <span class="va">windows_grey</span>,
  warning <span class="op">=</span> <span class="va">windows_grey</span>,
  <span class="st">"font-size-base"</span> <span class="op">=</span> <span class="st">"0.75rem"</span>,
  <span class="st">"enable-rounded"</span> <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_bundle.html">bs_add_rules</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">'@import "%s"'</span>, <span class="va">win98_css</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>To run the corresponding app you may call <code>windows98_theme %&gt;% bs_theme_preview()</code> or copy and paste the
below code in your R console.</p>
<div class="sourceCode" id="cb344"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "bslib/windows-98" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span></code></pre></div>
<p>When you run the above demonstration, you’ll notice that the slider input is not properly
styled. It’s not surprising knowing that the slider is not shaped by Bootstrap but <a href="http://ionden.com/a/plugins/ion.rangeSlider/">Ion.RangeSlider</a>. Therefore, if you want a better appearance, like in <a href="https://jdan.github.io/98.css/#slider">98.css</a>, we would need extra work. The output is shown Figure <a href="beautify-with-bootstraplib.html#fig:bslib-windows-98">9.5</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:bslib-windows-98"></span>
<img src="images/beautify/bslib-windows-98.png" alt="Modern Windows 98 theme for Shiny" width="100%"><p class="caption">
FIGURE 9.5: Modern Windows 98 theme for Shiny
</p>
</div>
</div>
</div>
<div id="dynamic-theming" class="section level2">
<h2>
<span class="header-section-number">9.3</span> Dynamic theming<a class="anchor" aria-label="anchor" href="#dynamic-theming"><i class="fas fa-link"></i></a>
</h2>
<div id="basics-2" class="section level3">
<h3>
<span class="header-section-number">9.3.1</span> Basics<a class="anchor" aria-label="anchor" href="#basics-2"><i class="fas fa-link"></i></a>
</h3>
<p>Now, let’s say you design an app and want to give the choice between the vanilla shiny design and your new cyberpunk theme, created in the previous section. We leverage the new <code>session$setCurrentTheme</code> feature that allows to pass <a href="https://rstudio.github.io/bslib/">bslib</a> generated themes to JavaScript through the <strong>session</strong> object. Our Shiny app contains a Bootstrap 4 toggle defined by the <code><a href="https://rdrr.io/pkg/OSUICode/man/theme_toggle.html">theme_toggle()</a></code> function, which value is either <code>TRUE</code> or <code>FALSE</code>. On the JavaScript side, we first create a custom shiny input with <code>Shiny.setInputValue</code> that gets the current mode value from the toggle. If <code>TRUE</code>, then the custom theme is applied by <code>session$setCurrentTheme</code> in an <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent()</a></code>.</p>
<div class="sourceCode" id="cb345"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theme_toggle</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"custom-control custom-switch"</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">input</span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"custom_mode"</span>,
      type <span class="op">=</span> <span class="st">"checkbox"</span>,
      class <span class="op">=</span> <span class="st">"custom-control-input"</span>,
      onclick <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/HTML.html">HTML</a></span><span class="op">(</span>
        <span class="st">"Shiny.setInputValue(
          'dark_mode',
          document.getElementById('custom_mode').value
        );"</span>
      <span class="op">)</span>
    <span class="op">)</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">label</span><span class="op">(</span>
      <span class="st">"Custom mode?"</span>,
      `for` <span class="op">=</span> <span class="st">"custom_mode"</span>,
      class <span class="op">=</span> <span class="st">"custom-control-label"</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>If <code>FALSE</code>, we fall back to a default Bootstrap 4 theme provided by <code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme(version = 4)</a></code>.</p>
<p>Like for <a href="https://github.com/dreamRs/fresh">fresh</a>, the <a href="https://rstudio.github.io/bslib/">bslib</a> theme does not apply to static plots, as they are not HTML elements. Therefore we load <a href="https://rstudio.github.io/thematic/">thematic</a>.</p>
<div class="sourceCode" id="cb346"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "bslib/dynamic-theming" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/thematic/">thematic</a></span><span class="op">)</span>

<span class="va">default</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  theme <span class="op">=</span> <span class="va">default</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/theme_toggle.html">theme_toggle</a></span><span class="op">(</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span><span class="st">"obs"</span>, <span class="st">"N:"</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">10</span>, value <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"distPlot"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">custom_mode</span>, <span class="op">{</span>
    <span class="va">session</span><span class="op">$</span><span class="fu">setCurrentTheme</span><span class="op">(</span>
      <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">custom_mode</span><span class="op">)</span> <span class="va">bslib_neon_theme</span> <span class="kw">else</span> <span class="va">default</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>

  <span class="va">output</span><span class="op">$</span><span class="va">distPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rstudio.github.io/thematic/reference/thematic_on.html">thematic_shiny</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<div class="warningblock">
<p>At the time of writing, an issue with <code><a href="https://rdrr.io/pkg/shiny/man/bindCache.html">bindCache()</a></code> not aware of <code>session$setCurrentTheme()</code> is described <a href="https://github.com/rstudio/shiny/issues/3208">here</a>, with <a href="https://shiny.rstudio.com/">shiny</a> 1.6. Moreover, <code>session$setCurrentTheme()</code> is not able to handle dynamic change of Bootstrap version.</p>
</div>
<p>A common mistake would be to forget to specify the <code>session</code> object in the server function, which would cause <code>session$setCurrentTheme()</code> to fail. Be careful!</p>
</div>
<div id="custom-elements" class="section level3">
<h3>
<span class="header-section-number">9.3.2</span> Custom elements<a class="anchor" aria-label="anchor" href="#custom-elements"><i class="fas fa-link"></i></a>
</h3>
<p>For other elements than core shiny components like <code><a href="https://rdrr.io/pkg/shiny/man/numericInput.html">numericInput()</a></code> or <a href="https://rstudio.github.io/thematic/">thematic</a> compatible elements such as <code><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput()</a></code>, <a href="https://rstudio.github.io/bslib/">bslib</a> provides tools to design dynamically themeable custom components.</p>
<p>Let’s take the example of a simple card where the Sass code is defined below:</p>
<ul>
<li>
<code>.supercard</code> has a shadow, takes half of the page width and has a fixed height.
Notice the <code>background-color</code> that takes the value of the <code>$primary</code> Sass variable,
inherited from Bootstrap 4.</li>
<li>
<code>.supercard_body</code> adds padding to the card body content.</li>
</ul>
<div class="sourceCode" id="cb347"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb347-1"><a href="beautify-with-bootstraplib.html#cb347-1"></a><span class="fu">.supercard</span> {</span>
<span id="cb347-2"><a href="beautify-with-bootstraplib.html#cb347-2"></a>  <span class="kw">box-shadow</span>: <span class="dv">0</span> <span class="dv">4</span><span class="dt">px</span> <span class="dv">10</span><span class="dt">px</span> <span class="dv">0</span> <span class="fu">rgb(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="fu">)</span><span class="op">,</span> <span class="dv">0</span> <span class="dv">4</span><span class="dt">px</span> <span class="dv">20</span><span class="dt">px</span> <span class="dv">0</span></span>
<span id="cb347-3"><a href="beautify-with-bootstraplib.html#cb347-3"></a>  <span class="fu">rgb(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb347-4"><a href="beautify-with-bootstraplib.html#cb347-4"></a>  <span class="kw">width</span>: <span class="dv">50</span><span class="dt">%</span><span class="op">;</span></span>
<span id="cb347-5"><a href="beautify-with-bootstraplib.html#cb347-5"></a>  <span class="kw">height</span>: <span class="dv">200</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb347-6"><a href="beautify-with-bootstraplib.html#cb347-6"></a>  <span class="kw">background-color</span>: $primary<span class="op">;</span></span>
<span id="cb347-7"><a href="beautify-with-bootstraplib.html#cb347-7"></a></span>
<span id="cb347-8"><a href="beautify-with-bootstraplib.html#cb347-8"></a>  <span class="fu">.supercard_body</span> {</span>
<span id="cb347-9"><a href="beautify-with-bootstraplib.html#cb347-9"></a>    <span class="kw">padding</span>: <span class="dv">0.01</span><span class="dt">em</span> <span class="dv">16</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb347-10"><a href="beautify-with-bootstraplib.html#cb347-10"></a>  }</span>
<span id="cb347-11"><a href="beautify-with-bootstraplib.html#cb347-11"></a>}</span></code></pre></div>
<p>Below, for convenience, we put that Sass code inside a R string, even though best practice would
be to save it in a file and compile it with <code><a href="https://rdrr.io/pkg/sass/man/sass_import.html">sass_file()</a></code>.</p>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sass_str</span> <span class="op">&lt;-</span> <span class="st">"
  .supercard {
    box-shadow: 0 4px 10px 0 rgb(0, 0, 0), 0 4px 20px 0
    rgb(0, 0, 0);
    width: 50%;
    height: 200px;

    background-color: $primary;
    .supercard_body {
      padding: 0.01em 16px;
    }
}"</span></code></pre></div>
<p>If you try to run <code><a href="https://rdrr.io/pkg/sass/man/sass.html">sass(input = sass_str)</a></code>,
it will fail, as <code>$primary</code> is not defined. Now, the goal is to link this custom Sass code
to the main app theme, created with <code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme()</a></code>. We invoke the <code><a href="https://rstudio.github.io/bslib/reference/bs_dependency.html">bs_dependency()</a></code> function where:</p>
<ul>
<li>
<strong>input</strong> refers to a list of Sass rules, that is <code>sass_str</code> in our example.</li>
<li>
<strong>theme</strong> is a theme generated with <code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme()</a></code>.</li>
<li>
<strong>name</strong> and <code>version</code> are metadata.</li>
</ul>
<p>In case we are not in a <a href="https://rstudio.github.io/bslib/">bslib</a> context, ie the app does not pass a <code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme()</a></code> element,
we create a fallback containing the card CSS code:</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">super_card_dependency</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theme</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">dep_name</span> <span class="op">&lt;-</span> <span class="st">"supercard"</span>
  <span class="va">dep_version</span> <span class="op">&lt;-</span> <span class="st">"1.0.0"</span>

  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">is_bs_theme</a></span><span class="op">(</span><span class="va">theme</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_dependency.html">bs_dependency</a></span><span class="op">(</span>
      input <span class="op">=</span> <span class="va">sass_str</span>,
      theme <span class="op">=</span> <span class="va">theme</span>,
      name <span class="op">=</span> <span class="va">dep_name</span>,
      version <span class="op">=</span> <span class="va">dep_version</span>
    <span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
      name <span class="op">=</span> <span class="va">dep_name</span>,
      version <span class="op">=</span> <span class="va">dep_version</span>,
      src <span class="op">=</span> <span class="st">"supercard-1.0.0/css"</span>,
      stylesheet <span class="op">=</span> <span class="st">"super-card.css"</span>,
      package <span class="op">=</span> <span class="st">"OSUICode"</span>
    <span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>As shown, in Chapter <a href="htmltools-dependencies.html#htmltools-dependencies">4</a>, we have to add this dependency to the card
tag. Importantly, we wrap it inside <code><a href="https://rstudio.github.io/bslib/reference/bs_dependency.html">bs_dependency_defer()</a></code> that enables us to dynamically update the theme on the server
side, each time <code>session$setCurrentTheme</code> is called:</p>
<div class="sourceCode" id="cb350"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">super_card</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"supercard"</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"supercard_body"</span>, <span class="va">...</span><span class="op">)</span>,
    <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_dependency.html">bs_dependency_defer</a></span><span class="op">(</span><span class="va">super_card_dependency</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We then create a simple dark theme that will be utilized by <code>session$setCurrentTheme</code> and run the app:</p>
<div class="sourceCode" id="cb351"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dark_theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme_update</a></span><span class="op">(</span>
    bg <span class="op">=</span> <span class="st">"black"</span>,
    fg <span class="op">=</span> <span class="st">"white"</span>,
    primary <span class="op">=</span> <span class="st">"orange"</span>
  <span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb352"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "bslib/custom-components" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  theme <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/theme_toggle.html">theme_toggle</a></span><span class="op">(</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/super_card.html">super_card</a></span><span class="op">(</span><span class="st">"Hello World!"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">custom_mode</span>, <span class="op">{</span>
    <span class="va">session</span><span class="op">$</span><span class="fu">setCurrentTheme</span><span class="op">(</span>
      <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">custom_mode</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">bslib_dark_theme</span>
      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
        <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
      <span class="op">}</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<div class="importantblock">
<p>Live theming requires to pass the <strong>session</strong> parameter to the server function. Don’t forget it!</p>
</div>
<p>The reader is invited to exploit the <code><a href="https://rstudio.github.io/bslib/reference/run_with_themer.html">run_with_themer()</a></code> capabilities, that allows
to dynamically modify the current theme, as shown Figure <a href="beautify-with-bootstraplib.html#fig:bslib-custom-component">9.6</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:bslib-custom-component"></span>
<img src="images/beautify/bslib-custom-component.png" alt="Theme preview with custom component" width="100%"><p class="caption">
FIGURE 9.6: Theme preview with custom component
</p>
</div>
<p>Below, we try without passing any theme to <code><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage()</a></code>, to test our CSS fall back strategy:</p>
<!-- Don't deploy not very informative ... -->
<div class="sourceCode" id="cb353"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/super_card.html">super_card</a></span><span class="op">(</span><span class="st">"Hello World!"</span><span class="op">)</span><span class="op">)</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
</div>
<div id="bslib-renderHook" class="section level3">
<h3>
<span class="header-section-number">9.3.3</span> Conditional rendering<a class="anchor" aria-label="anchor" href="#bslib-renderHook"><i class="fas fa-link"></i></a>
</h3>
<div id="bootstrap-badges" class="section level4">
<h4>
<span class="header-section-number">9.3.3.1</span> Bootstrap badges<a class="anchor" aria-label="anchor" href="#bootstrap-badges"><i class="fas fa-link"></i></a>
</h4>
<p>In this section, we see how to create components whose rendering may adapt depending on the
currently active theme properties, like the version. Bootstrap badges have slightly different structures between Bootstrap 3 and Bootstrap 4/5:</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb354-1"><a href="beautify-with-bootstraplib.html#cb354-1"></a><span class="co">&lt;!-- BS3 --&gt;</span></span>
<span id="cb354-2"><a href="beautify-with-bootstraplib.html#cb354-2"></a><span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">"badge"</span><span class="kw">&gt;</span>42<span class="kw">&lt;/span&gt;</span></span>
<span id="cb354-3"><a href="beautify-with-bootstraplib.html#cb354-3"></a></span>
<span id="cb354-4"><a href="beautify-with-bootstraplib.html#cb354-4"></a><span class="co">&lt;!-- BS4 --&gt;</span></span>
<span id="cb354-5"><a href="beautify-with-bootstraplib.html#cb354-5"></a><span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">"badge badge-secondary"</span><span class="kw">&gt;</span>New<span class="kw">&lt;/span&gt;</span></span>
<span id="cb354-6"><a href="beautify-with-bootstraplib.html#cb354-6"></a></span>
<span id="cb354-7"><a href="beautify-with-bootstraplib.html#cb354-7"></a><span class="co">&lt;!-- BS5 --&gt;</span></span>
<span id="cb354-8"><a href="beautify-with-bootstraplib.html#cb354-8"></a><span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">"badge bg-secondary"</span><span class="kw">&gt;</span>New<span class="kw">&lt;/span&gt;</span></span></code></pre></div>
<p>Bootstrap 3 badges don’t have any color class contrary to Bootstrap 4 or 5. Bootstrap 4 and 5 badges color classes slightly differ: <code>badge-&lt;COLOR&gt;</code> (BS4) vs <code>bg-&lt;COLOR&gt;</code> (BS5). Below, lets’ write a common wrapper to create a <code><a href="https://rdrr.io/pkg/OSUICode/man/bs_badge.html">bs_badge()</a></code> function for Shiny that works for all Bootstrap versions. No question to create three different functions!
The common skeleton tag is a simple <code>span</code> element with the <code>badge</code> class. Depending on the version, we
create a render hook with <code><a href="https://rdrr.io/pkg/htmltools/man/tagAddRenderHook.html">htmltools::tagAddRenderHook()</a></code> that is able to adequately alter the tag structure. We first get the currently active theme with <code><a href="https://rdrr.io/pkg/shiny/man/getCurrentTheme.html">shiny::getCurrentTheme()</a></code> or <code><a href="https://rstudio.github.io/bslib/reference/bs_current_theme.html">bslib::bs_current_theme()</a></code>. We check if it is a <a href="https://rstudio.github.io/bslib/">bslib</a> theme and if yes, we recover its version with <code><a href="https://rstudio.github.io/bslib/reference/theme_version.html">bslib::theme_version()</a></code>. Note the importance of timing. Calling <code><a href="https://rdrr.io/pkg/shiny/man/getCurrentTheme.html">shiny::getCurrentTheme()</a></code> outside the render hook would give <code>NULL</code>, thereby preventing the code to work. We raise an error if color is used whenever the Bootstrap version is lower than 4. In case of Bootstrap 4 or 5, we utilize <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">htmltools::tagQuery()</a></code> to efficiently modify the tag structure in one single flow of instructions, as shown in section <a href="htmltools-overview.html#htmltools-modern">2.6</a>. Result is shown below:</p>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bs_badge</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">text</span>, <span class="va">color</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Create common badge skeleton for BS3/4/5</span>
  <span class="va">badge_skeleton</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">span</span><span class="op">(</span>class <span class="op">=</span> <span class="st">"badge"</span>, <span class="va">text</span><span class="op">)</span>
  
  <span class="co"># Handle BS4 and BS5 extra class</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">color</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">badge_skeleton</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAddRenderHook.html">tagAddRenderHook</a></span><span class="op">(</span>
      <span class="va">badge_skeleton</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
      <span class="co"># get theme and version</span>
      <span class="va">theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/getCurrentTheme.html">getCurrentTheme</a></span><span class="op">(</span><span class="op">)</span>
      <span class="va">version</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu">bslib</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">is_bs_theme</a></span><span class="op">(</span><span class="va">theme</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="fu">bslib</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/theme_version.html">theme_version</a></span><span class="op">(</span><span class="va">theme</span><span class="op">)</span>
      <span class="op">}</span>
      
      <span class="kw"><a href="https://rdrr.io/r/base/switch.html">switch</a></span><span class="op">(</span>
        <span class="va">version</span>,
        <span class="co"># stop if color is used with BS3</span>
        <span class="st">"3"</span> <span class="op">=</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span>
          <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span>
            <span class="st">"color is not available for Bootstrap %s"</span>, 
            <span class="va">version</span>
          <span class="op">)</span>
        <span class="op">)</span>,
        <span class="st">"4"</span> <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span>
          <span class="fu">addClass</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"badge-%s"</span>, <span class="va">color</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
          <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span>,
        <span class="st">"5"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span>
          <span class="fu">addClass</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"rounded-pill bg-%s"</span>, <span class="va">color</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
          <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span>
      <span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">badge_skeleton</span>
  
<span class="op">}</span></code></pre></div>
<p>Let’s test it below, result illustrated Figure <a href="beautify-with-bootstraplib.html#fig:bslib-dynamic-badges">9.7</a>.</p>
<!-- Not deployed because not very informative. Just a checkup -->
<div class="sourceCode" id="cb356"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># BS3</span>
<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  theme <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/bs_badge.html">bs_badge</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span>

<span class="co"># BS4</span>
<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  theme <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/bs_badge.html">bs_badge</a></span><span class="op">(</span><span class="fl">42</span>, <span class="st">"primary"</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span>

<span class="co"># BS5</span>
<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  theme <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/bs_badge.html">bs_badge</a></span><span class="op">(</span><span class="fl">42</span>, <span class="st">"primary"</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:bslib-dynamic-badges"></span>
<img src="images/beautify/bslib-dynamic-badge-1.png" alt="Conditional rendering of a Bootstrap component. Left: BS3 badge; center: BS4 badge; right: BS5 badge." width="33%"><img src="images/beautify/bslib-dynamic-badge-2.png" alt="Conditional rendering of a Bootstrap component. Left: BS3 badge; center: BS4 badge; right: BS5 badge." width="33%"><img src="images/beautify/bslib-dynamic-badge-3.png" alt="Conditional rendering of a Bootstrap component. Left: BS3 badge; center: BS4 badge; right: BS5 badge." width="33%"><p class="caption">
FIGURE 9.7: Conditional rendering of a Bootstrap component. Left: BS3 badge; center: BS4 badge; right: BS5 badge.
</p>
</div>
</div>
<div id="bootstrap-navs" class="section level4">
<h4>
<span class="header-section-number">9.3.3.2</span> Bootstrap navs<a class="anchor" aria-label="anchor" href="#bootstrap-navs"><i class="fas fa-link"></i></a>
</h4>
<p>Another great real life example if documented <a href="https://github.com/rstudio/shiny/pull/3372/files#diff-befe9146792f0d65aeeaf781e8ba00a1a3638ac2be162b61b6c8958440860b56">here</a>, which briefly consists in handling <a href="https://getbootstrap.com/docs/5.0/components/navs-tabs/">nav</a> element differences
between Bootstrap 3 and Bootstrap 4/5.</p>
</div>
<div id="bslib-bootstrap-accordion" class="section level4">
<h4>
<span class="header-section-number">9.3.3.3</span> Guided exercise: Bootstrap accordions<a class="anchor" aria-label="anchor" href="#bslib-bootstrap-accordion"><i class="fas fa-link"></i></a>
</h4>
<p>We conclude this part by a guided exercise. Similarly as badges, Bootstrap <strong>accordions</strong> differ
between the three last major version. First, they don’t natively exist in Bootstrap 3, and the tag structure is different between Bootstrap 4 and 5. The purpose of this activity is to provide a generalized wrapper that would support all versions.</p>
<p>Figure <a href="beautify-with-bootstraplib.html#fig:bslib-accordion-intro">9.8</a> illustrates the Bootstrap 5 accordion. It is
composed of items that can collapse if one clicks on their title. Overall, they are convenient to
save space in any user interface, when the amount of text would be to much to be printed at once.</p>
<div class="figure">
<span style="display:block;" id="fig:bslib-accordion-intro"></span>
<img src="images/beautify/bslib-accordion-intro.png" alt="A Bootstrap 5 accordion." width="100%"><p class="caption">
FIGURE 9.8: A Bootstrap 5 accordion.
</p>
</div>
<p>From HTML point of view, the accordion has a main <code>div</code> wrapper with the <code>accordion</code> class, inside of which are found the accordion items. Whereas in Bootstrap 5, these elements are <code>div</code> with the <code>accordion-item</code> class, Bootstrap 4 considers <code>div</code> with <code>card</code> class. An accordion item is composed of a title with a button which is able to control the collapsed state of the linked body part, the latter being a simple <code>div</code>. The link is made with the <code>data-bs-target</code> attribute on the title that must match the <code>id</code> attribute of the body part. The <code>data-bs-toggle</code> activates the JS, which makes the whole component collapse. Each body element refers to the parent accordion with <code>data-bs-parent</code> that must match the parent <code>id</code>, thereby guarantying no unwanted interaction between multiple accordions. Below is the HTML structure of the BS5 accordion:</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb357-1"><a href="beautify-with-bootstraplib.html#cb357-1"></a><span class="co">&lt;!-- BS5 --&gt;</span></span>
<span id="cb357-2"><a href="beautify-with-bootstraplib.html#cb357-2"></a><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"accordion"</span><span class="ot"> id=</span><span class="st">"accordionExample"</span><span class="kw">&gt;</span></span>
<span id="cb357-3"><a href="beautify-with-bootstraplib.html#cb357-3"></a>  <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"accordion-item"</span><span class="kw">&gt;</span></span>
<span id="cb357-4"><a href="beautify-with-bootstraplib.html#cb357-4"></a>    <span class="kw">&lt;h2</span><span class="ot"> class=</span><span class="st">"accordion-header"</span><span class="ot"> id=</span><span class="st">"headingOne"</span><span class="kw">&gt;</span></span>
<span id="cb357-5"><a href="beautify-with-bootstraplib.html#cb357-5"></a>      <span class="kw">&lt;button</span> </span>
<span id="cb357-6"><a href="beautify-with-bootstraplib.html#cb357-6"></a><span class="ot">      class=</span><span class="st">"accordion-button"</span> </span>
<span id="cb357-7"><a href="beautify-with-bootstraplib.html#cb357-7"></a><span class="ot">      type=</span><span class="st">"button"</span> </span>
<span id="cb357-8"><a href="beautify-with-bootstraplib.html#cb357-8"></a><span class="ot">      data-bs-toggle=</span><span class="st">"collapse"</span> </span>
<span id="cb357-9"><a href="beautify-with-bootstraplib.html#cb357-9"></a><span class="ot">      data-bs-target=</span><span class="st">"#collapseOne"</span> </span>
<span id="cb357-10"><a href="beautify-with-bootstraplib.html#cb357-10"></a><span class="ot">      aria-expanded=</span><span class="st">"true"</span> </span>
<span id="cb357-11"><a href="beautify-with-bootstraplib.html#cb357-11"></a><span class="ot">      aria-controls=</span><span class="st">"collapseOne"</span><span class="kw">&gt;</span></span>
<span id="cb357-12"><a href="beautify-with-bootstraplib.html#cb357-12"></a>        Accordion Item #1</span>
<span id="cb357-13"><a href="beautify-with-bootstraplib.html#cb357-13"></a>      <span class="kw">&lt;/button&gt;</span></span>
<span id="cb357-14"><a href="beautify-with-bootstraplib.html#cb357-14"></a>    <span class="kw">&lt;/h2&gt;</span></span>
<span id="cb357-15"><a href="beautify-with-bootstraplib.html#cb357-15"></a>    <span class="kw">&lt;div</span> </span>
<span id="cb357-16"><a href="beautify-with-bootstraplib.html#cb357-16"></a><span class="ot">    id=</span><span class="st">"collapseOne"</span> </span>
<span id="cb357-17"><a href="beautify-with-bootstraplib.html#cb357-17"></a><span class="ot">    class=</span><span class="st">"accordion-collapse collapse show"</span> </span>
<span id="cb357-18"><a href="beautify-with-bootstraplib.html#cb357-18"></a><span class="ot">    aria-labelledby=</span><span class="st">"headingOne"</span> </span>
<span id="cb357-19"><a href="beautify-with-bootstraplib.html#cb357-19"></a><span class="ot">    data-bs-parent=</span><span class="st">"#accordionExample"</span><span class="kw">&gt;</span></span>
<span id="cb357-20"><a href="beautify-with-bootstraplib.html#cb357-20"></a>      <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"accordion-body"</span><span class="kw">&gt;</span></span>
<span id="cb357-21"><a href="beautify-with-bootstraplib.html#cb357-21"></a>        Blablabla</span>
<span id="cb357-22"><a href="beautify-with-bootstraplib.html#cb357-22"></a>      <span class="kw">&lt;/div&gt;</span></span>
<span id="cb357-23"><a href="beautify-with-bootstraplib.html#cb357-23"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb357-24"><a href="beautify-with-bootstraplib.html#cb357-24"></a>  <span class="kw">&lt;/div&gt;</span></span>
<span id="cb357-25"><a href="beautify-with-bootstraplib.html#cb357-25"></a>  <span class="co">&lt;!-- Other items ... --&gt;</span></span>
<span id="cb357-26"><a href="beautify-with-bootstraplib.html#cb357-26"></a><span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<p>and the BS4 accordion:</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb358-1"><a href="beautify-with-bootstraplib.html#cb358-1"></a><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"accordion"</span><span class="ot"> id=</span><span class="st">"accordionExample"</span><span class="kw">&gt;</span></span>
<span id="cb358-2"><a href="beautify-with-bootstraplib.html#cb358-2"></a>  <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"card"</span><span class="kw">&gt;</span></span>
<span id="cb358-3"><a href="beautify-with-bootstraplib.html#cb358-3"></a>    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"card-header"</span><span class="ot"> id=</span><span class="st">"headingOne"</span><span class="kw">&gt;</span></span>
<span id="cb358-4"><a href="beautify-with-bootstraplib.html#cb358-4"></a>      <span class="kw">&lt;h2</span><span class="ot"> class=</span><span class="st">"mb-0"</span><span class="kw">&gt;</span></span>
<span id="cb358-5"><a href="beautify-with-bootstraplib.html#cb358-5"></a>        <span class="kw">&lt;button</span> </span>
<span id="cb358-6"><a href="beautify-with-bootstraplib.html#cb358-6"></a><span class="ot">        class=</span><span class="st">"btn btn-link btn-block text-left"</span> </span>
<span id="cb358-7"><a href="beautify-with-bootstraplib.html#cb358-7"></a><span class="ot">        type=</span><span class="st">"button"</span> </span>
<span id="cb358-8"><a href="beautify-with-bootstraplib.html#cb358-8"></a><span class="ot">        data-toggle=</span><span class="st">"collapse"</span> </span>
<span id="cb358-9"><a href="beautify-with-bootstraplib.html#cb358-9"></a><span class="ot">        data-target=</span><span class="st">"#collapseOne"</span> </span>
<span id="cb358-10"><a href="beautify-with-bootstraplib.html#cb358-10"></a><span class="ot">        aria-expanded=</span><span class="st">"true"</span> </span>
<span id="cb358-11"><a href="beautify-with-bootstraplib.html#cb358-11"></a><span class="ot">        aria-controls=</span><span class="st">"collapseOne"</span><span class="kw">&gt;</span></span>
<span id="cb358-12"><a href="beautify-with-bootstraplib.html#cb358-12"></a>          Accordion Item #1</span>
<span id="cb358-13"><a href="beautify-with-bootstraplib.html#cb358-13"></a>        <span class="kw">&lt;/button&gt;</span></span>
<span id="cb358-14"><a href="beautify-with-bootstraplib.html#cb358-14"></a>      <span class="kw">&lt;/h2&gt;</span></span>
<span id="cb358-15"><a href="beautify-with-bootstraplib.html#cb358-15"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb358-16"><a href="beautify-with-bootstraplib.html#cb358-16"></a></span>
<span id="cb358-17"><a href="beautify-with-bootstraplib.html#cb358-17"></a>    <span class="kw">&lt;div</span> </span>
<span id="cb358-18"><a href="beautify-with-bootstraplib.html#cb358-18"></a><span class="ot">    id=</span><span class="st">"collapseOne"</span> </span>
<span id="cb358-19"><a href="beautify-with-bootstraplib.html#cb358-19"></a><span class="ot">    class=</span><span class="st">"collapse show"</span> </span>
<span id="cb358-20"><a href="beautify-with-bootstraplib.html#cb358-20"></a><span class="ot">    aria-labelledby=</span><span class="st">"headingOne"</span> </span>
<span id="cb358-21"><a href="beautify-with-bootstraplib.html#cb358-21"></a><span class="ot">    data-parent=</span><span class="st">"#accordionExample"</span><span class="kw">&gt;</span></span>
<span id="cb358-22"><a href="beautify-with-bootstraplib.html#cb358-22"></a>      <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"card-body"</span><span class="kw">&gt;</span></span>
<span id="cb358-23"><a href="beautify-with-bootstraplib.html#cb358-23"></a>        Blablabla</span>
<span id="cb358-24"><a href="beautify-with-bootstraplib.html#cb358-24"></a>      <span class="kw">&lt;/div&gt;</span></span>
<span id="cb358-25"><a href="beautify-with-bootstraplib.html#cb358-25"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb358-26"><a href="beautify-with-bootstraplib.html#cb358-26"></a>  <span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Compare the Bootstrap 4 and 5 HTML code. What are the differences?
Is the tag structure the same? Are there differences for tag attributes?</li>
<li>Based on the previous question, create the <code><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion.html">bs_accordion()</a></code> function. This
function starts by defining a tag structure common to BS4 and BS5.</li>
</ol>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bs_accordion</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">items</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># main wrapper</span>
  <span class="va">accordion_tag</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"accordion"</span>,
    id <span class="op">=</span> <span class="va">...</span>,
    <span class="va">items</span>
  <span class="op">)</span>
  
  <span class="va">accordion_tag</span>
<span class="op">}</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Let’s handle the Bootstrap differences for <code><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion.html">bs_accordion()</a></code>. As shown above, leverage <code><a href="https://rdrr.io/pkg/htmltools/man/tagAddRenderHook.html">tagAddRenderHook()</a></code>. First, create the <code>get_theme_version()</code> function to detect the currently
used theme version. Then call this function inside the <code><a href="https://rdrr.io/pkg/htmltools/man/tagAddRenderHook.html">tagAddRenderHook()</a></code> and store it in the
<code>version</code> variable.</li>
</ol>
<div class="sourceCode" id="cb360"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Function to get the current them version</span>
<span class="va">get_theme_version</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">theme</span> <span class="op">&lt;-</span> <span class="fu">bslib</span><span class="fu">::</span><span class="va">...</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu">bslib</span><span class="fu">::</span><span class="fu">...</span><span class="op">(</span><span class="va">theme</span><span class="op">)</span><span class="op">)</span> <span class="fu">bslib</span><span class="fu">::</span><span class="fu">...</span><span class="op">(</span><span class="va">theme</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">bs_accordion</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">items</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># Accordion wrapper (see 2 above)</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAddRenderHook.html">tagAddRenderHook</a></span><span class="op">(</span><span class="va">accordion_tag</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># get theme version</span>
    <span class="va">version</span> <span class="op">&lt;-</span> <span class="va">...</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Now, we’ll edit <code><a href="https://rdrr.io/pkg/htmltools/man/tagAddRenderHook.html">tagAddRenderHook()</a></code> so that we raise an error if the Bootstrap version is <code>3</code>. Edit the <code><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion.html">bs_accordion()</a></code> to incorporate the below code.</li>
</ol>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="va">version</span> <span class="op">==</span> <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span>
      <span class="st">"accordion is not available for Bootstrap %s"</span>, 
      <span class="va">version</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>We are good with the main wrapper. Let’s create the <code><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion_item.html">bs_accordion_item()</a></code> function, which will have to be nested inside the <code><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion.html">bs_accordion()</a></code>. We assume it has two main parameters, title and content. To get a better code, we’ll design intermediate components for the header and the body. In this step, we only create the body element since the header is slightly more complex to handle. If you have had a look to the HTML structure, you will notice below that <code>id</code>, <code>aria-labelledby</code> and <code>data-(bs)-parent</code> will be handled later from the <code><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion.html">bs_accordion()</a></code>. These parameters require to know the <code><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion.html">bs_accordion()</a></code> <code>id</code>, which is impossible to get within a child element. We also added
an <code>active</code> parameter to control the start state. Fill in the <code>...</code> element below.</li>
</ol>
<div class="sourceCode" id="cb362"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bs_accordion_item</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">title</span>, <span class="va">content</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">item_body</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">...</span><span class="op">(</span>
    <span class="co"># id will be added from bs_accordion</span>
    <span class="co"># aria-labelledby also added from bs_accordion</span>
    <span class="co"># data parent differs between BS4 and BS5</span>
    class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"collapse"</span>, <span class="kw">if</span> <span class="op">(</span><span class="va">active</span><span class="op">)</span> <span class="va">...</span><span class="op">)</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
      <span class="co"># class differs between BS4 and BS5</span>
      <span class="va">...</span>
    <span class="op">)</span>
  <span class="op">)</span>
  
  <span class="co"># accordion item wrapper </span>
  <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
    <span class="co"># class differs between BS4 and BS5</span>
    <span class="va">...</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Utilize <code><a href="https://rdrr.io/pkg/htmltools/man/tagAddRenderHook.html">tagAddRenderHook()</a></code> to handle BS4 and BS5 differences in <code><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion_item.html">bs_accordion_item()</a></code>.
As in <code><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion.html">bs_accordion()</a></code>, recover the version with <code>get_theme_version()</code>.
Then, create the Bootstrap 4 item header based on its HTML structure shown above.</li>
</ol>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="beautify-with-bootstraplib.html#cb363-1"></a>bs_accordion_item &lt;-<span class="st"> </span><span class="cf">function</span>(title, content, <span class="dt">active =</span> <span class="ot">FALSE</span>) {</span>
<span id="cb363-2"><a href="beautify-with-bootstraplib.html#cb363-2"></a>  </span>
<span id="cb363-3"><a href="beautify-with-bootstraplib.html#cb363-3"></a>  <span class="co"># item body code 5 (see above)</span></span>
<span id="cb363-4"><a href="beautify-with-bootstraplib.html#cb363-4"></a>  <span class="co"># item wrapper 5 (see above)</span></span>
<span id="cb363-5"><a href="beautify-with-bootstraplib.html#cb363-5"></a>  </span>
<span id="cb363-6"><a href="beautify-with-bootstraplib.html#cb363-6"></a>  <span class="kw">tagAddRenderHook</span>(..., <span class="cf">function</span>(x) {</span>
<span id="cb363-7"><a href="beautify-with-bootstraplib.html#cb363-7"></a>    <span class="co"># get theme and version</span></span>
<span id="cb363-8"><a href="beautify-with-bootstraplib.html#cb363-8"></a>    version &lt;-<span class="st"> </span>...</span>
<span id="cb363-9"><a href="beautify-with-bootstraplib.html#cb363-9"></a>    </span>
<span id="cb363-10"><a href="beautify-with-bootstraplib.html#cb363-10"></a>    <span class="co"># create accordion item header </span></span>
<span id="cb363-11"><a href="beautify-with-bootstraplib.html#cb363-11"></a>    ... &lt;-<span class="st"> </span><span class="cf">if</span> (version <span class="op">==</span><span class="st"> "4"</span>) {</span>
<span id="cb363-12"><a href="beautify-with-bootstraplib.html#cb363-12"></a>      tags<span class="op">$</span><span class="kw">div</span>(</span>
<span id="cb363-13"><a href="beautify-with-bootstraplib.html#cb363-13"></a>        <span class="dt">class =</span> ...,</span>
<span id="cb363-14"><a href="beautify-with-bootstraplib.html#cb363-14"></a>        <span class="co"># id will be added from bs_accordion</span></span>
<span id="cb363-15"><a href="beautify-with-bootstraplib.html#cb363-15"></a>        tags<span class="op">$</span><span class="kw">h2</span>(</span>
<span id="cb363-16"><a href="beautify-with-bootstraplib.html#cb363-16"></a>          <span class="dt">class =</span> <span class="st">"mb-0"</span>,</span>
<span id="cb363-17"><a href="beautify-with-bootstraplib.html#cb363-17"></a>          tags<span class="op">$</span><span class="kw">button</span>(</span>
<span id="cb363-18"><a href="beautify-with-bootstraplib.html#cb363-18"></a>            <span class="dt">class =</span> ...,</span>
<span id="cb363-19"><a href="beautify-with-bootstraplib.html#cb363-19"></a>            <span class="dt">type =</span> <span class="st">"button"</span>,</span>
<span id="cb363-20"><a href="beautify-with-bootstraplib.html#cb363-20"></a>            <span class="st">`</span><span class="dt">data-toggle</span><span class="st">`</span> =<span class="st"> "collapse"</span>,</span>
<span id="cb363-21"><a href="beautify-with-bootstraplib.html#cb363-21"></a>            <span class="co"># data-target will be added from bs_accordion </span></span>
<span id="cb363-22"><a href="beautify-with-bootstraplib.html#cb363-22"></a>            <span class="st">`</span><span class="dt">aria-expanded</span><span class="st">`</span> =<span class="st"> </span><span class="kw">tolower</span>(...),</span>
<span id="cb363-23"><a href="beautify-with-bootstraplib.html#cb363-23"></a>            <span class="co"># aria-controls will be added from bs_accordion</span></span>
<span id="cb363-24"><a href="beautify-with-bootstraplib.html#cb363-24"></a>            title</span>
<span id="cb363-25"><a href="beautify-with-bootstraplib.html#cb363-25"></a>          )</span>
<span id="cb363-26"><a href="beautify-with-bootstraplib.html#cb363-26"></a>        )</span>
<span id="cb363-27"><a href="beautify-with-bootstraplib.html#cb363-27"></a>      )</span>
<span id="cb363-28"><a href="beautify-with-bootstraplib.html#cb363-28"></a>    }</span>
<span id="cb363-29"><a href="beautify-with-bootstraplib.html#cb363-29"></a>  }</span>
<span id="cb363-30"><a href="beautify-with-bootstraplib.html#cb363-30"></a><span class="er">}</span></span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>Add an <code>else if</code> statement to handle Bootstrap 5, based on its HTML structure, provided above.</li>
</ol>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="beautify-with-bootstraplib.html#cb364-1"></a><span class="cf">else</span> <span class="cf">if</span> (version <span class="op">==</span><span class="st"> "5"</span>) {</span>
<span id="cb364-2"><a href="beautify-with-bootstraplib.html#cb364-2"></a>  tags<span class="op">$</span><span class="kw">h2</span>(</span>
<span id="cb364-3"><a href="beautify-with-bootstraplib.html#cb364-3"></a>    <span class="dt">class =</span> ...,</span>
<span id="cb364-4"><a href="beautify-with-bootstraplib.html#cb364-4"></a>    tags<span class="op">$</span><span class="kw">button</span>(</span>
<span id="cb364-5"><a href="beautify-with-bootstraplib.html#cb364-5"></a>      <span class="dt">class =</span> ...,</span>
<span id="cb364-6"><a href="beautify-with-bootstraplib.html#cb364-6"></a>      <span class="dt">type =</span> <span class="st">"button"</span>,</span>
<span id="cb364-7"><a href="beautify-with-bootstraplib.html#cb364-7"></a>      <span class="st">`</span><span class="dt">data-bs-toggle</span><span class="st">`</span> =<span class="st"> "collapse"</span>,</span>
<span id="cb364-8"><a href="beautify-with-bootstraplib.html#cb364-8"></a>      <span class="st">`</span><span class="dt">aria-expanded</span><span class="st">`</span> =<span class="st"> </span><span class="kw">tolower</span>(...),</span>
<span id="cb364-9"><a href="beautify-with-bootstraplib.html#cb364-9"></a>      title</span>
<span id="cb364-10"><a href="beautify-with-bootstraplib.html#cb364-10"></a>    )</span>
<span id="cb364-11"><a href="beautify-with-bootstraplib.html#cb364-11"></a>  )</span>
<span id="cb364-12"><a href="beautify-with-bootstraplib.html#cb364-12"></a>}</span></code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>We now have to handle missing classes and add the new elements. We created a switch to start to handle Bootstrap 4 and Bootstrap 5 differences. Based on the accordion item HTML structure, fill in the missing <code><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery()</a></code> steps for Bootstrap 4.</li>
</ol>
<div class="sourceCode" id="cb365"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bs_accordion_item</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">title</span>, <span class="va">content</span>, <span class="va">active</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># item body code (see 5 above)</span>
  <span class="co"># item wrapper (see above)</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAddRenderHook.html">tagAddRenderHook</a></span><span class="op">(</span><span class="va">...</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># get theme and version (see 6 above)</span>
    <span class="co"># create accordion item header (see 6-7 above)</span>
    
    <span class="co"># alter tag structure</span>
    <span class="kw"><a href="https://rdrr.io/r/base/switch.html">switch</a></span><span class="op">(</span>
      <span class="va">version</span>,
      <span class="co"># don't need to handle BS3</span>
      <span class="st">"4"</span> <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span>
        <span class="fu">addClass</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">$</span>
        <span class="co"># prepend header tag</span>
        <span class="fu">prepend</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">$</span>
        <span class="fu">find</span><span class="op">(</span><span class="st">".collapse"</span><span class="op">)</span><span class="op">$</span>
        <span class="fu">children</span><span class="op">(</span><span class="op">)</span><span class="op">$</span>
        <span class="co"># add class to item body</span>
        <span class="fu">addClass</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">$</span>
        <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<ol start="9" style="list-style-type: decimal">
<li>Do the same for Bootstrap 5.</li>
</ol>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="beautify-with-bootstraplib.html#cb366-1"></a>bs_accordion_item &lt;-<span class="st"> </span><span class="cf">function</span>(title, content, <span class="dt">active =</span> <span class="ot">FALSE</span>) {</span>
<span id="cb366-2"><a href="beautify-with-bootstraplib.html#cb366-2"></a>  <span class="co"># item body code (see 5 above)</span></span>
<span id="cb366-3"><a href="beautify-with-bootstraplib.html#cb366-3"></a>  <span class="co"># item wrapper (see 5 above)</span></span>
<span id="cb366-4"><a href="beautify-with-bootstraplib.html#cb366-4"></a>  </span>
<span id="cb366-5"><a href="beautify-with-bootstraplib.html#cb366-5"></a>  <span class="kw">tagAddRenderHook</span>(..., <span class="cf">function</span>(x) {</span>
<span id="cb366-6"><a href="beautify-with-bootstraplib.html#cb366-6"></a>    <span class="co"># get theme and version (see 6 above)</span></span>
<span id="cb366-7"><a href="beautify-with-bootstraplib.html#cb366-7"></a>    <span class="co"># create accordion item header (see 6-7 above)</span></span>
<span id="cb366-8"><a href="beautify-with-bootstraplib.html#cb366-8"></a>    </span>
<span id="cb366-9"><a href="beautify-with-bootstraplib.html#cb366-9"></a>    <span class="co"># alter tag structure</span></span>
<span id="cb366-10"><a href="beautify-with-bootstraplib.html#cb366-10"></a>    <span class="cf">switch</span>(</span>
<span id="cb366-11"><a href="beautify-with-bootstraplib.html#cb366-11"></a>      version,</span>
<span id="cb366-12"><a href="beautify-with-bootstraplib.html#cb366-12"></a>      <span class="co"># don't need to handle BS3</span></span>
<span id="cb366-13"><a href="beautify-with-bootstraplib.html#cb366-13"></a>      <span class="st">"4"</span> =<span class="st">  </span><span class="co"># see 8 above,</span></span>
<span id="cb366-14"><a href="beautify-with-bootstraplib.html#cb366-14"></a><span class="st">      "5"</span> =<span class="st"> </span><span class="kw">tagQuery</span>(x)<span class="op">$</span></span>
<span id="cb366-15"><a href="beautify-with-bootstraplib.html#cb366-15"></a><span class="st">        </span><span class="kw">addClass</span>(...)<span class="op">$</span></span>
<span id="cb366-16"><a href="beautify-with-bootstraplib.html#cb366-16"></a><span class="st">        </span><span class="kw">prepend</span>(...)<span class="op">$</span></span>
<span id="cb366-17"><a href="beautify-with-bootstraplib.html#cb366-17"></a><span class="st">        </span><span class="kw">find</span>(<span class="st">".collapse"</span>)<span class="op">$</span></span>
<span id="cb366-18"><a href="beautify-with-bootstraplib.html#cb366-18"></a><span class="st">        </span><span class="kw">addClass</span>(<span class="st">"accordion-collapse"</span>)<span class="op">$</span></span>
<span id="cb366-19"><a href="beautify-with-bootstraplib.html#cb366-19"></a><span class="st">        </span><span class="kw">children</span>()<span class="op">$</span></span>
<span id="cb366-20"><a href="beautify-with-bootstraplib.html#cb366-20"></a><span class="st">        </span><span class="kw">addClass</span>(...)<span class="op">$</span></span>
<span id="cb366-21"><a href="beautify-with-bootstraplib.html#cb366-21"></a><span class="st">        </span><span class="kw">allTags</span>()</span>
<span id="cb366-22"><a href="beautify-with-bootstraplib.html#cb366-22"></a>    )</span>
<span id="cb366-23"><a href="beautify-with-bootstraplib.html#cb366-23"></a>  })</span>
<span id="cb366-24"><a href="beautify-with-bootstraplib.html#cb366-24"></a>}</span></code></pre></div>
<ol start="10" style="list-style-type: decimal">
<li>We come back to <code><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion.html">bs_accordion()</a></code> in order to create the correct
<code><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion_item.html">bs_accordion_item()</a></code> children ids (mentioned in 5) and treat missing attributes. We have to process all items and use <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> since it works well with shiny tags. We first prefix all ids by the parent accordion one to avoid uniqueness issue in case of multiple accordions (There exist much better methods but this is not the purpose of the example). Then, items are resolved with <code><a href="https://rdrr.io/pkg/htmltools/man/as.tags.html">htmltools::as.tags()</a></code>, as explained in section <a href="htmltools-overview.html#htmltools-nested-renderhooks">2.6.7.2</a>. Fill in the blanks <code>...</code>.</li>
</ol>
<div class="sourceCode" id="cb367"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bs_accordion</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">items</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># Accordion wrapper (see 2 above)</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagAddRenderHook.html">tagAddRenderHook</a></span><span class="op">(</span><span class="va">accordion_tag</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># get theme and version (see 3 above)</span>
    <span class="co"># Check version (see 3 above)</span>
    
    <span class="co"># process accordion items to add missing attributes</span>
    <span class="va">new_items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
      
      <span class="co"># temp ids based on the parent id</span>
      <span class="va">heading_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">...</span>, <span class="st">"heading"</span>, <span class="va">i</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span>
      <span class="va">controls_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">...</span>, <span class="st">"_collapse_"</span>, <span class="va">i</span><span class="op">)</span>
      <span class="va">target_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"#"</span>, <span class="va">controls_id</span><span class="op">)</span>
      
      <span class="co"># resolve bs_accordion_item</span>
      <span class="va">items</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/as.tags.html">as.tags</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>
      
      <span class="co"># see 11</span>
    <span class="op">}</span><span class="op">)</span>
    <span class="co"># see 13</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<ol start="11" style="list-style-type: decimal">
<li>Right after the <code><a href="https://rdrr.io/pkg/htmltools/man/as.tags.html">as.tags()</a></code> function, add a switch to handle the Bootstrap 4 version. Fill in the blanks <code>...</code>.
Overall this codes add missing attributes so that the accordion works properly.</li>
</ol>
<div class="sourceCode" id="cb368"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># handle BS4 </span>
<span class="kw"><a href="https://rdrr.io/r/base/switch.html">switch</a></span><span class="op">(</span>
  <span class="va">version</span>,
  <span class="st">"4"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">...</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span>
    <span class="fu">find</span><span class="op">(</span><span class="st">".card-header"</span><span class="op">)</span><span class="op">$</span>
    <span class="fu">addAttrs</span><span class="op">(</span><span class="st">"id"</span> <span class="op">=</span> <span class="va">...</span><span class="op">)</span><span class="op">$</span>
    <span class="fu">find</span><span class="op">(</span><span class="st">".btn"</span><span class="op">)</span><span class="op">$</span>
    <span class="fu">addAttrs</span><span class="op">(</span>
      <span class="st">"data-target"</span> <span class="op">=</span> <span class="va">...</span>,
      <span class="st">"aria-controls"</span> <span class="op">=</span> <span class="va">...</span>
    <span class="op">)</span><span class="op">$</span>
    <span class="fu">resetSelected</span><span class="op">(</span><span class="op">)</span><span class="op">$</span>
    <span class="fu">find</span><span class="op">(</span><span class="st">".collapse"</span><span class="op">)</span><span class="op">$</span>
    <span class="fu">addAttrs</span><span class="op">(</span>
      <span class="st">"id"</span> <span class="op">=</span> <span class="va">...</span>,
      <span class="st">"aria-labelledby"</span> <span class="op">=</span> <span class="va">...</span>,
      <span class="st">"data-parent"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"#"</span>, <span class="va">...</span><span class="op">)</span>
    <span class="op">)</span><span class="op">$</span>
    <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span>,
  <span class="st">"5"</span> <span class="op">=</span> <span class="co"># see 12</span>
<span class="op">)</span></code></pre></div>
<ol start="12" style="list-style-type: decimal">
<li>Add a Bootstrap 5 case to the switch filling the following code.</li>
</ol>
<div class="sourceCode" id="cb369"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">...</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">find</span><span class="op">(</span><span class="st">".accordion-header"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">addAttrs</span><span class="op">(</span><span class="st">"id"</span> <span class="op">=</span> <span class="va">...</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">children</span><span class="op">(</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">addAttrs</span><span class="op">(</span>
    <span class="st">"data-bs-target"</span> <span class="op">=</span> <span class="va">...</span>,
    <span class="st">"aria-controls"</span> <span class="op">=</span> <span class="va">...</span>
  <span class="op">)</span><span class="op">$</span>
  <span class="fu">resetSelected</span><span class="op">(</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">find</span><span class="op">(</span><span class="st">".accordion-collapse"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">addAttrs</span><span class="op">(</span>
    <span class="st">"id"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dots.html">...elt</a></span><span class="op">(</span><span class="op">)</span>,
    <span class="st">"aria-labelledby"</span> <span class="op">=</span> <span class="va">...</span>,
    <span class="st">"data-bs-parent"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"#"</span>, <span class="va">id</span><span class="op">)</span>
  <span class="op">)</span><span class="op">$</span>
  <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<ol start="13" style="list-style-type: decimal">
<li>Add the newly processed accordion items at the end of the <code><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion.html">bs_accordion()</a></code> render hook, paying attention to fill the blank.</li>
</ol>
<div class="sourceCode" id="cb370"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alter main tag structure</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagQuery.html">tagQuery</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span>
  <span class="co"># replace accordion items processed above</span>
  <span class="fu">empty</span><span class="op">(</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">append</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">allTags</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<ol start="14" style="list-style-type: decimal">
<li>We create a Shiny app to test the newly designed components with Bootstrap 4. You may use <code><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme(version = 5)</a></code> to handle Bootstrap 5.</li>
</ol>
<div class="sourceCode" id="cb371"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### RUN ### </span>
<span class="co"># OSUICode::run_example( </span>
<span class="co">#  "bslib/conditional-rendering/bs4-accordions" </span>
<span class="co">#   "package = "OSUICode" </span>
<span class="co"># ) </span>

<span class="co">### APP CODE ### </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">OSUICode</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  theme <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/bs_theme.html">bs_theme</a></span><span class="op">(</span>version <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion.html">bs_accordion</a></span><span class="op">(</span>
    id <span class="op">=</span> <span class="st">"accordion"</span>,
    items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tagList.html">tagList</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion_item.html">bs_accordion_item</a></span><span class="op">(</span>
        title <span class="op">=</span> <span class="st">"Item 1"</span>,
        <span class="st">"Item 1 content"</span>,
        active <span class="op">=</span> <span class="cn">TRUE</span>
      <span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/bs_accordion_item.html">bs_accordion_item</a></span><span class="op">(</span>
        title <span class="op">=</span> <span class="st">"Item 2"</span>,
        <span class="st">"Item 2 content"</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rstudio.github.io/bslib/reference/run_with_themer.html">run_with_themer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Figure <a href="beautify-with-bootstraplib.html#fig:bslib-bootstrap-accordions">9.9</a> shows the expected output for Bootstrap 4 and 5. Solutions may be found <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/blob/b95f656bce9de7600c05b5045a4e005f70c4f83d/R/bslib-utils.R#L166">here</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:bslib-bootstrap-accordions"></span>
<img src="images/beautify/bslib-accordion-bs4.png" alt="Bootstrap accordions for Shiny. Left: BS4 accordion; right: BS5 accordion." width="50%"><img src="images/beautify/bslib-accordion-bs5.png" alt="Bootstrap accordions for Shiny. Left: BS4 accordion; right: BS5 accordion." width="50%"><p class="caption">
FIGURE 9.9: Bootstrap accordions for Shiny. Left: BS4 accordion; right: BS5 accordion.
</p>
</div>
</div>
</div>
</div>
<div id="further-resources" class="section level2">
<h2>
<span class="header-section-number">9.4</span> Further resources<a class="anchor" aria-label="anchor" href="#further-resources"><i class="fas fa-link"></i></a>
</h2>
<p>The reader will refer to the <a href="https://rstudio.github.io/bslib/">bslib</a> various <a href="https://rstudio.github.io/bslib/articles/theming.html">vignettes</a>.</p>

</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="beautify-with-fresh.html"><span class="header-section-number">8</span> Beautify with {fresh}</a></div>
<div class="next"><a href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#beautify-with-bootstraplib"><span class="header-section-number">9</span> Become a theming wizard with {bslib}</a></li>
<li>
<a class="nav-link" href="#high-level-customization"><span class="header-section-number">9.1</span> High level customization</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#bslib-high-level"><span class="header-section-number">9.1.1</span> Create a theme</a></li>
<li><a class="nav-link" href="#update-a-theme"><span class="header-section-number">9.1.2</span> Update a theme</a></li>
<li><a class="nav-link" href="#preview-a-theme"><span class="header-section-number">9.1.3</span> Preview a theme</a></li>
<li><a class="nav-link" href="#live-theming"><span class="header-section-number">9.1.4</span> Live theming</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#bslib-low-level"><span class="header-section-number">9.2</span> Low level customization</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#add-new-variables"><span class="header-section-number">9.2.1</span> Add new variables</a></li>
<li><a class="nav-link" href="#import-external-rules"><span class="header-section-number">9.2.2</span> Import external rules</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#dynamic-theming"><span class="header-section-number">9.3</span> Dynamic theming</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#basics-2"><span class="header-section-number">9.3.1</span> Basics</a></li>
<li><a class="nav-link" href="#custom-elements"><span class="header-section-number">9.3.2</span> Custom elements</a></li>
<li><a class="nav-link" href="#bslib-renderHook"><span class="header-section-number">9.3.3</span> Conditional rendering</a></li>
</ul>
</li>
<li><a class="nav-link" href="#further-resources"><span class="header-section-number">9.4</span> Further resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/beautify-with-bootstraplib.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/beautify-with-bootstraplib.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It was last built on 2021-09-27.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
